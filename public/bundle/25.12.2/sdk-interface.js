/*! SDK Interface v25.12.2_webgl-1476-gb1a50f26e1 */var e={846:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Floorplans"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floorplans"},arguments:[{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"StringValue",value:"Matterport",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"flags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"provider"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:402}};t.loc.source={body:'query Floorplans($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      floorplans(provider: "Matterport") {\n        id\n        status\n        url\n        validUntil\n        filename\n        format\n        height\n        width,\n        resolution,\n        origin {\n          x,\n          y\n        }\n        floor {\n          id\n        }\n        flags\n        provider\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function n(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var a=e.type;"NamedType"===a.kind&&t.add(a.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){n(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){n(e,t)})),e.definitions&&e.definitions.forEach((function(e){n(e,t)}))}var a={};function o(e,t){for(var n=0;n<e.definitions.length;n++){var a=e.definitions[n];if(a.name&&a.name.value==t)return a}}t.definitions.forEach((function(e){if(e.name){var t=new Set;n(e,t),a[e.name.value]=t}})),e.exports=t,e.exports.Floorplans=function(e,t){var n={kind:e.kind,definitions:[o(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var s=a[t]||new Set,r=new Set,i=new Set;for(s.forEach((function(e){i.add(e)}));i.size>0;){var c=i;i=new Set,c.forEach((function(e){r.has(e)||(r.add(e),(a[e]||new Set).forEach((function(e){i.add(e)})))}))}return r.forEach((function(t){var a=o(e,t);a&&n.definitions.push(a)})),n}(t,"Floorplans")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};n.d(a,{m:()=>id});const o="$ExternalCommands",s="$CwfTypes",r="$Libs",i="IAnalytics",c="ILayersModule",d="ITranslate",l="IPolicyModule",u="IRoomBoundDataModule",h="IRoomBoundModule",p="ISweepDataModule";var m,g,f,w,y,v,T,I,b,E,C,S,A,O,D,M,R,x;!function(e){let t,n,a,o;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(n=e.Phase||(e.Phase={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(a=e.Application||(e.Application={})),function(e){e.RoomBounds="feature.roombounds",e.Defurnish="feature.defurnish"}(o=e.Feature||(e.Feature={}))}(m||(m={})),function(e){let t,n,a;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(n=e.Direction||(e.Direction={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade",e.MOVEFADE="transition.movefade",e.ORBIT="transition.orbit"}(a=e.TransitionType||(e.TransitionType={}))}(g||(g={})),function(e){let t;!function(e){let t,n,a;!function(e){e.TO_API="coordinatesToAPI",e.TO_SDK="coordinatesToSDK"}(t=e.Coordinates||(e.Coordinates={})),function(e){e.TO_API="sweepRotationToAPI",e.TO_SDK="sweepRotationToSDK"}(n=e.SweepRotation||(e.SweepRotation={})),function(e){e.TO_API="cameraRotationToAPI",e.TO_SDK="cameraRotationToSDK"}(a=e.CameraRotation||(e.CameraRotation={}))}(t=e.TransformType||(e.TransformType={}))}(f||(f={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(w||(w={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}(y||(y={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(v||(v={})),function(e){let t,n,a;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.default",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(n=e.OpenPolicy||(e.OpenPolicy={})),function(e){e.DEFAULT="link.destination.default",e.MATTERPORT="link.destination.matterport"}(a=e.DestinationPolicy||(e.DestinationPolicy={}))}(T||(T={})),function(e){let t,n,a,o;e.Transition=g.TransitionType,function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(t=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(n=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(a=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(o=e.MediaType||(e.MediaType={}))}(I||(I={})),function(e){let t,n;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(n=e.Event||(e.Event={})),e.TransitionType=g.TransitionType}(b||(b={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(E||(E={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(C||(C={})),function(e){let t,n;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(n=e.SourceType||(e.SourceType={}))}(S||(S={})),function(e){let t,n,a;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),e.Transition=g.TransitionType,function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(a=e.Placement||(e.Placement={}))}(A||(A={})),function(e){let t;!function(e){e.UNKNOWN="tag.attachment.unknown",e.APPLICATION="tag.attachment.application",e.AUDIO="tag.attachment.audio",e.IMAGE="tag.attachment.image",e.MODEL="tag.attachment.model",e.PDF="tag.attachment.pdf",e.RICH="tag.attachment.rich",e.TEXT="tag.attachment.text",e.VIDEO="tag.attachment.video",e.ZIP="tag.attachment.zip",e.SANDBOX="tag.attachment.sandbox"}(t=e.AttachmentType||(e.AttachmentType={}))}(O||(O={})),function(e){let t,n;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={})),function(e){e.INACTIVE="tour.inactive",e.ACTIVE="tour.active",e.STOP_SCHEDULED="tour.stopscheduled"}(n=e.PlayState||(e.PlayState={}))}(D||(D={})),function(e){let t,n;!function(e){e.BASE="viewtype.base",e.LAYERED_BASE="viewtype.layeredbase",e.USER="viewtype.user",e.DEFURNISH="viewtype.defurnish",e.OTHER="viewtype.other"}(t=e.ViewType||(e.ViewType={})),function(e){e.BASE="layertype.base",e.VIEW_DATA="layertype.viewdata",e.USER="layertype.user",e.IN_MEMORY="layertype.inmemory",e.OTHER="layertype.other"}(n=e.LayerType||(e.LayerType={}))}(M||(M={})),function(e){let t,n,a;!function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(t=e.Component||(e.Component={})),function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(n=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(a=e.PathType||(e.PathType={}))}(R||(R={})),function(e){let t;!function(e){e.ON="on",e.OFF="off"}(t=e.Visibility||(e.Visibility={}))}(x||(x={}));class P{constructor(e){this.directionMap={[g.Direction.FORWARD]:e.FORWARD.clone(),[g.Direction.LEFT]:e.LEFT.clone(),[g.Direction.RIGHT]:e.RIGHT.clone(),[g.Direction.BACK]:e.BACK.clone(),[g.Direction.UP]:e.UP.clone(),[g.Direction.DOWN]:e.DOWN.clone()}}toVector(e){return this.directionMap[e]}}class N{constructor(e){this.CwfViewmode=e}toSdk(e,t,n){switch(e){case this.CwfViewmode.Panorama:return t?b.Mode.INSIDE:b.Mode.OUTSIDE;case this.CwfViewmode.Dollhouse:return n?b.Mode.FLOORPLAN:b.Mode.DOLLHOUSE;case this.CwfViewmode.Floorplan:return b.Mode.FLOORPLAN;case this.CwfViewmode.Transition:return b.Mode.TRANSITIONING;case this.CwfViewmode.Outdoor:return b.Mode.OUTSIDE;default:return b.Mode.INSIDE}}fromSdk(e){switch(e){case b.Mode.INSIDE:case b.Mode.OUTSIDE:return this.CwfViewmode.Panorama;case b.Mode.DOLLHOUSE:return this.CwfViewmode.Dollhouse;case b.Mode.FLOORPLAN:return this.CwfViewmode.Floorplan;case b.Mode.TRANSITIONING:return this.CwfViewmode.Transition}}}class _{constructor(e){this.CommandMode=e}toSdk(e){switch(e){case this.CommandMode.INSIDE:return b.Mode.INSIDE;case this.CommandMode.DOLLHOUSE:return b.Mode.DOLLHOUSE;case this.CommandMode.FLOORPLAN:return b.Mode.FLOORPLAN;case this.CommandMode.TRANSITIONING:return b.Mode.TRANSITIONING;case this.CommandMode.OUTSIDE:return b.Mode.OUTSIDE;default:return b.Mode.INSIDE}}fromSdk(e){switch(e){case b.Mode.INSIDE:return this.CommandMode.INSIDE;case b.Mode.OUTSIDE:return this.CommandMode.OUTSIDE;case b.Mode.DOLLHOUSE:return this.CommandMode.DOLLHOUSE;case b.Mode.FLOORPLAN:return this.CommandMode.FLOORPLAN;case b.Mode.TRANSITIONING:return this.CommandMode.TRANSITIONING}}}class k{constructor(e){this.toSdkTransitionMap={[e.Interpolate]:g.TransitionType.FLY,[e.FadeToBlack]:g.TransitionType.FADEOUT,[e.Instant]:g.TransitionType.INSTANT,[e.MoveToBlack]:g.TransitionType.MOVEFADE,[e.OrbitTo]:g.TransitionType.ORBIT},this.fromSdkTransitionMap={[g.TransitionType.FLY]:e.Interpolate,[g.TransitionType.FADEOUT]:e.FadeToBlack,[g.TransitionType.INSTANT]:e.Instant,[g.TransitionType.MOVEFADE]:e.MoveToBlack,[g.TransitionType.ORBIT]:e.OrbitTo}}toSdkTransition(e){return this.toSdkTransitionMap[e]}fromSdkTransition(e){return this.fromSdkTransitionMap[e]}}class L{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const n=this.tempEuler.setFromQuaternion(e,L.eulerOrder),a=t||{};return a.x=this.THREE.MathUtils.radToDeg(n.x),a.y=this.THREE.MathUtils.radToDeg(n.y),a.z=this.THREE.MathUtils.radToDeg(n.z),a}rotationToQuaternion(e,t){const n=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=L.eulerOrder,n.setFromEuler(this.tempEuler)}}L.eulerOrder="YXZ";class V{constructor(e){this.CwfSweepAlignmentType=e}isSweepAligned(e,t){if(!e||!t)return!1;const n=t&&e.getSweep(t);return!!n&&n.alignmentType===this.CwfSweepAlignmentType.ALIGNED}isCurrentSweepAligned(e){return this.isSweepAligned(e,e.state.currentSweep)}}class F{constructor(e){this.sweepData=e}getIdForSweep(e){return e.platformId}getSweepForId(e){return this.sweepData.getSweep(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class U{constructor(e){this.floorData=e}getIdForFloor(e){return e.id}getFloorForId(e){return this.floorData.getFloor(e)}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class G{constructor(e){this.roomData=e}getIdForRoom(e){return e.id}getRoomForId(e){return this.roomData.get(e)}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}class H{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}class B{constructor(...e){this.fulfilledOptionals=[],this.observable=new H,this.dependencies=e||[]}static createWithOptionals(e,t){const n=new B(...e);n.fulfilledOptionals.length=t.length;for(let e=0;e<t.length;++e){let a;n.fulfilledOptionals[e]={get:()=>a};const o=t[e];Promise.all([o]).then((([e])=>{a=e,n.notify()}))}return n}static getBuilder(){class e{constructor(){this.dependencies=[],this.optionals=[]}addDependencies(...t){const n=new e,a=[...this.dependencies,...t];return n.dependencies=a,n.optionals=this.optionals,n}addOptionals(...t){const n=new e,a=[...this.optionals,...t];return n.dependencies=this.dependencies,n.optionals=a,n}build(){return B.createWithOptionals(this.dependencies,this.optionals)}}return new e}static get none(){return this._none}async getDependencies(){return Promise.all(this.dependencies)}getOptionals(){return this.fulfilledOptionals}onOptionalsFulfilled(e){return this.observable.observe({notify:e})}notify(){this.observable.notify()}static extend(e,...t){return new B(...e.dependencies,...t)}static combine(e,t){return new B(...e.dependencies,...t.dependencies)}static async createFromDI(e,t,n){const a=await Promise.all(t.map((t=>e.resolve(t)))),o=n?n(...a):a;return new B(...o)}}B._none=new B;class z{constructor(e,...t){this.ctor=e,this.args=t}create(...e){return new this.ctor(...this.args,...e)}}const $=window.navigationStart||Date.now(),j=new WeakMap;var q;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(q||(q={}));class W{static for(e){let t=j.get(e);if(!t){const n=e.name||e.constructor.name;t=new W(n),j.set(e,t)}return t}constructor(e){this.timers={},this.handlers={[q.DEBUG]:console.debug,[q.INFO]:console.info,[q.WARN]:console.warn,[q.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(W.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(q.DEBUG)}get devInfo(){return()=>{}}get debugInfo(){return this.debug}get warnError(){return this.warn}get debugWarn(){return this.message(W.level>=q.DEBUG?q.WARN:q.DEBUG)}get info(){return this.message(q.INFO)}get warn(){return this.message(q.WARN)}get error(){return this.message(q.ERROR)}get assert(){return(e,...t)=>{if(e)return;const n="Assertion failed";0===t.length?t=[n]:"string"==typeof t[0]?t[0]=n+": "+t[0]:t.unshift(n);this.message(q.ERROR)(...t)}}time(e){W.level>=q.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(W.level>=q.DEBUG){const t=this.timers[e];if(!t)return;const n=(Date.now()-t)/1e3;this.debug(e,n+"s")}}getPrefix(){const e=(Date.now()-$)/1e3+"s";return`${this.prefix} ${e}`}}W.level=q.INFO;const K=new W("sdk command");class Y{static async create(e,t){const n=await e.getDependencies(),a=e.getOptionals();return new Y("function"==typeof t?t(...n,...a):t.create(...n,...a))}static async createDI(e,t,n,a){const o=a?await B.createFromDI(e,t,a):await B.createFromDI(e,t),s=await o.getDependencies();return new Y(n(...s))}constructor(e){this._executor=e}get executor(){return this._executor}validateInput(e,t){return this.executor.validateInput(e,t)}exec(e,t){const n=this.executor.validateInput(e,t);return this.executor.exec(n,t)}}function X(e,t,n){return`'${e}' is expected to be a(n) ${t}; got '${JSON.stringify(n)}'`}function Z(e,t,n){return e.validateInput(t,n)}function Q(e,t,n){return e.exec(t,n)}async function J(e,t){return new class{constructor(e){this.command=e}validateInput(e,t){return Z(this.command,e,t)}exec(e,n){return K.warn(t),this.command.exec(e,n)}}(await e)}function ee(e){return!!e&&"string"==typeof e}function te(e){return"string"==typeof e}const ne=["dev-app.matterport.com","dev-app.matterportvr.cn","qa3-app.matterport.com","qa3-app.matterportvr.cn","gc1-app.matterport.com","my.matterport.com","my.matterportvr.cn","showcase-next.matterport.com","static.matterport.com","static.matterportvr.cn","static.matterport.us","matterport.github.io","local-dev.matterport.com","127.0.0.1","localhost"];class ae{constructor(e){this.getModelViewsQuery=e}validateInput(e,t){return ee(e.spaceSid)||this.throw(X("spaceSid","string",e.spaceSid)),{spaceSid:e.spaceSid}}async exec(e,t){return await this.getModelViewsQuery(e.spaceSid)}throw(e){throw Error("Api.getViews: "+e)}}class oe{constructor(e){this.toSdkPhaseMap={[e.UNINITIALIZED]:m.Phase.UNINITIALIZED,[e.WAITING]:m.Phase.WAITING,[e.LOADING]:m.Phase.LOADING,[e.STARTING]:m.Phase.STARTING,[e.PLAYING]:m.Phase.PLAYING,[e.ERROR]:m.Phase.ERROR},this.fromSdkPhaseMap={[m.Phase.UNINITIALIZED]:e.UNINITIALIZED,[m.Phase.WAITING]:e.WAITING,[m.Phase.LOADING]:e.LOADING,[m.Phase.STARTING]:e.STARTING,[m.Phase.PLAYING]:e.PLAYING,[m.Phase.ERROR]:e.ERROR}}toSdkAppPhase(e){return this.toSdkPhaseMap[e]}fromSdkAppPhase(e){return this.fromSdkPhaseMap[e]}}class se{constructor(e){this.toSdkApplicationMap={[e.SHOWCASE]:m.Application.SHOWCASE,[e.WORKSHOP]:m.Application.WORKSHOP,[e.WEBVR]:m.Application.WEBVR,[e.UNKNOWN]:m.Application.UNKNOWN},this.fromSdkApplicationMap={[m.Application.SHOWCASE]:e.SHOWCASE,[m.Application.WORKSHOP]:e.WORKSHOP,[m.Application.WEBVR]:e.WEBVR,[m.Application.UNKNOWN]:e.UNKNOWN}}toSdkApplication(e){return this.toSdkApplicationMap[e]}fromSdkApplication(e){return this.fromSdkApplicationMap[e]}}const re="IAppPhaseModule",ie="ISettingsModule";class ce{static async create(e,t,n){const a=await e.getDependencies();return new ce(a,e,t,n)}static async createDI(e,t,n,a,o){const s=o?await B.createFromDI(e,t,o):await B.createFromDI(e,t);return this.create(s,n,a)}constructor(e,t,n,a){this.dependencies=e,this.optionals=t,this.subscriptionFactory=n,this.observers=new Set,this.currentData=a.create(),this.freshDataCache=a.create()}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class t{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}if(this.observers.add(e),1===this.observers.size){const e=()=>{const e=this.optionals.getOptionals();this.currentData.update(...this.dependencies,...e),this.changeSubscription=this.subscriptionFactory.create(new t(this),...this.dependencies,...e)};this.dependencySubscription=this.optionals.onOptionalsFulfilled((()=>{var t;null===(t=this.changeSubscription)||void 0===t||t.cancel(),e()})),e()}e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&(this.dependencySubscription.cancel(),this.changeSubscription.cancel()))}onChanged(){if(this.freshDataCache.update(...this.dependencies,...this.optionals.getOptionals()),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}const de=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,le=(e,t=[])=>{if(void 0!==e){if(t.includes(e))return Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if(ArrayBuffer.isView(e))for(const t of[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array])if(e instanceof t)return new t(e);if("object"==typeof e){const n=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const a in e){if(de(a))continue;const o=e[a];o instanceof Date?n[a]=new Date(o):"function"!=typeof o&&(t.push(e),n[a]="object"==typeof o?le(o,t):o,t.pop())}return n}return e}},ue=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const n in t)if(!(n in e))return!0;for(const n in e)if(ue(e[n],t[n]))return!0;return!1};class he{create(e,t){return t.onChanged((()=>e.onChanged()))}}class pe{constructor(e,t){this._data={phase:m.Phase.UNINITIALIZED,phaseTimes:{},application:m.Application.SHOWCASE},this.AppPhase=e.AppPhase,this.appPhaseConverter=t.appPhaseConverter,this.applicationConverter=t.applicationConverter}get data(){return this._data}equals(e){return!ue(this,e)}copy(e){this._data.phase=e.data.phase,function(e,t,...n){for(const a of n)e[a]=t[a]}(this.data.phaseTimes,e.data.phaseTimes),this._data.application=e.data.application}update(e){this._data.phase=this.appPhaseConverter.toSdkAppPhase(e.phase),this._data.application=this.applicationConverter.toSdkApplication(e.application),this._data.phaseTimes[m.Phase.WAITING]=e.phaseTimes[this.AppPhase.WAITING],this._data.phaseTimes[m.Phase.LOADING]=e.phaseTimes[this.AppPhase.LOADING],this._data.phaseTimes[m.Phase.PLAYING]=e.phaseTimes[this.AppPhase.PLAYING],this._data.phaseTimes[m.Phase.STARTING]=e.phaseTimes[this.AppPhase.STARTING],this._data.phaseTimes[m.Phase.UNINITIALIZED]=e.phaseTimes[this.AppPhase.UNINITIALIZED],this._data.phaseTimes[m.Phase.ERROR]=e.phaseTimes[this.AppPhase.ERROR]}}class me{get id(){return this.constructor.id}}class ge extends me{constructor(){super()}}ge.id="GET_APP_STATE";class fe extends me{constructor(){super()}}var we,ye,ve;function Te(e){return e.viewType===we.DEFURNISH}fe.id="GET_APP_PHASE_TIMES",function(e){e.BASE="base",e.LAYERED_BASE="layered-base",e.INSIGHTS="insights",e.USER="user",e.DEFURNISH="defurnish",e.SESSION="session",e.DIGIPRO_SESSION="digipro-session",e.TRUEPLAN="trueplan",e.PRIVATE_SESSION="bundle-session",e.COMPOSITE_PROJECT="composite",e.COMPOSITE_COMPARE="composite.compare",e.COMPOSITE_EXTERIOR="composite.exterior",e.COMPOSITE_SITE="composite.site",e.OTHER="other"}(we||(we={})),function(e){e.BASE_LAYER="matterport.base",e.VIEW_DATA_LAYER="matterport.user.data",e.USER_LAYER="matterport.user.data.ext",e.OVERLAY_ASSETS_LAYER="matterport.overlay.assets",e.COMMON_USER_LAYER="matterport.user.data.common",e.COMMON_CAMERA_REMOVAL_LAYER="matterport.overlay.camera_removal.assets.common",e.PROXY_LAYER="matterport.proxy.common",e.IN_MEMORY="matterport.in-memory",e.COMMON_IN_MEMORY="matterport.in-memory.common",e.WORKSHOP="matterport.workshop.jsonstore",e.OTHER="other layer type",e.COMPOSITE_BASE="matterport.base.composite",e.COMPOSITE_USER_LAYER="matterport.user.data.ext.composite",e.COMPOSITE_VIEW_DATA_LAYER="matterport.user.data.composite"}(ye||(ye={})),function(e){e.TYPE="type",e.FLOOR="floor",e.ROOM="room",e.LAYER="layer",e.DATE="date"}(ve||(ve={}));const Ie="model-views-feature",be="data-layers-feature";var Ee;!function(e){e.DISABLED="disabled",e.VIEWS_OPTIONAL_OPT_IN="user_views",e.VIEWS_ENABLED="views_enabled",e.VIEWS_AND_LAYERS="views_layers",e.LAYERS_ONLY="layers"}(Ee||(Ee={}));var Ce;!function(e){e.DISABLED="0",e.VIEWS_ENABLED="2",e.VIEWS_AND_LAYERS="3",e.LAYERS_ONLY="4"}(Ce||(Ce={}));const Se=new W("Subscription");class Ae{constructor(e,t,n=!1,a=""){this.startSubscription=e,this.endSubscription=t,this.id=a,this.isSubbed=!1,n&&this.renew()}renew(){this.isSubbed?Se.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function Oe(e,t,n=!0,a=""){return new Ae(e,t,n,a)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var De=function(e,t){return De=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},De(e,t)};function Me(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}De(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Re(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))}function xe(e,t){var n,a,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,a=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}Object.create;function Pe(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ne(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,o,s=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)r.push(a.value)}catch(e){o={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return r}function _e(e,t){for(var n=0,a=t.length,o=e.length;n<a;n++,o++)e[o]=t[n];return e}function ke(e){return this instanceof ke?(this.v=e,this):new ke(e)}function Le(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,o=n.apply(e,t||[]),s=[];return a={},r("next"),r("throw"),r("return"),a[Symbol.asyncIterator]=function(){return this},a;function r(e){o[e]&&(a[e]=function(t){return new Promise((function(n,a){s.push([e,t,n,a])>1||i(e,t)}))})}function i(e,t){try{(n=o[e](t)).value instanceof ke?Promise.resolve(n.value.v).then(c,d):l(s[0][2],n)}catch(e){l(s[0][3],e)}var n}function c(e){i("next",e)}function d(e){i("throw",e)}function l(e,t){e(t),s.shift(),s.length&&i(s[0][0],s[0][1])}}function Ve(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Pe(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(n){t[n]=e[n]&&function(t){return new Promise((function(a,o){(function(e,t,n,a){Promise.resolve(a).then((function(t){e({value:t,done:n})}),t)})(a,o,(t=e[n](t)).done,t.value)}))}}}Object.create;function Fe(e){return"function"==typeof e}function Ue(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ge=Ue((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function He(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Be=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,a,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var r=Pe(s),i=r.next();!i.done;i=r.next()){i.value.remove(this)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}else s.remove(this);var c=this.initialTeardown;if(Fe(c))try{c()}catch(e){o=e instanceof Ge?e.errors:[e]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var l=Pe(d),u=l.next();!u.done;u=l.next()){var h=u.value;try{je(h)}catch(e){o=null!=o?o:[],e instanceof Ge?o=_e(_e([],Ne(o)),Ne(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}}if(o)throw new Ge(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)je(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&He(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&He(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),ze=Be.EMPTY;function $e(e){return e instanceof Be||e&&"closed"in e&&Fe(e.remove)&&Fe(e.add)&&Fe(e.unsubscribe)}function je(e){Fe(e)?e():e.unsubscribe()}var qe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},We={setTimeout:function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var o=We.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,_e([e,t],Ne(n))):setTimeout.apply(void 0,_e([e,t],Ne(n)))},clearTimeout:function(e){var t=We.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Ke(e){We.setTimeout((function(){var t=qe.onUnhandledError;if(!t)throw e;t(e)}))}function Ye(){}var Xe=Ze("C",void 0,void 0);function Ze(e,t,n){return{kind:e,value:t,error:n}}var Qe=null;function Je(e){if(qe.useDeprecatedSynchronousErrorHandling){var t=!Qe;if(t&&(Qe={errorThrown:!1,error:null}),e(),t){var n=Qe,a=n.errorThrown,o=n.error;if(Qe=null,a)throw o}}else e()}var et=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,$e(t)&&t.add(n)):n.destination=it,n}return Me(t,e),t.create=function(e,t,n){return new ot(e,t,n)},t.prototype.next=function(e){this.isStopped?rt(function(e){return Ze("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?rt(Ze("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?rt(Xe,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Be),tt=Function.prototype.bind;function nt(e,t){return tt.call(e,t)}var at=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){st(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){st(e)}else st(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){st(e)}},e}(),ot=function(e){function t(t,n,a){var o,s,r=e.call(this)||this;Fe(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=a?a:void 0}:r&&qe.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return r.unsubscribe()},o={next:t.next&&nt(t.next,s),error:t.error&&nt(t.error,s),complete:t.complete&&nt(t.complete,s)}):o=t;return r.destination=new at(o),r}return Me(t,e),t}(et);function st(e){var t;qe.useDeprecatedSynchronousErrorHandling?(t=e,qe.useDeprecatedSynchronousErrorHandling&&Qe&&(Qe.errorThrown=!0,Qe.error=t)):Ke(e)}function rt(e,t){var n=qe.onStoppedNotification;n&&We.setTimeout((function(){return n(e,t)}))}var it={closed:!0,next:Ye,error:function(e){throw e},complete:Ye},ct="function"==typeof Symbol&&Symbol.observable||"@@observable";function dt(e){return e}function lt(e){return 0===e.length?dt:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var ut=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var a,o=this,s=(a=e)&&a instanceof et||function(e){return e&&Fe(e.next)&&Fe(e.error)&&Fe(e.complete)}(a)&&$e(a)?e:new ot(e,t,n);return Je((function(){var e=o,t=e.operator,n=e.source;s.add(t?t.call(s,n):n?o._subscribe(s):o._trySubscribe(s))})),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=ht(t))((function(t,a){var o=new ot({next:function(t){try{e(t)}catch(e){a(e),o.unsubscribe()}},error:a,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ct]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return lt(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=ht(e))((function(e,n){var a;t.subscribe((function(e){return a=e}),(function(e){return n(e)}),(function(){return e(a)}))}))},e.create=function(t){return new e(t)},e}();function ht(e){var t;return null!==(t=null!=e?e:qe.Promise)&&void 0!==t?t:Promise}var pt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function mt(e){if(e instanceof ut)return e;if(null!=e){if(function(e){return Fe(e[ct])}(e))return r=e,new ut((function(e){var t=r[ct]();if(Fe(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if((s=e)&&"number"==typeof s.length&&"function"!=typeof s)return o=e,new ut((function(e){for(var t=0;t<o.length&&!e.closed;t++)e.next(o[t]);e.complete()}));if(Fe(null==(a=e)?void 0:a.then))return n=e,new ut((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Ke)}));if(function(e){return Symbol.asyncIterator&&Fe(null==e?void 0:e[Symbol.asyncIterator])}(e))return gt(e);if(function(e){return Fe(null==e?void 0:e[pt])}(e))return t=e,new ut((function(e){var n,a;try{for(var o=Pe(t),s=o.next();!s.done;s=o.next()){var r=s.value;if(e.next(r),e.closed)return}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}e.complete()}));if(function(e){return Fe(null==e?void 0:e.getReader)}(e))return gt(function(e){return Le(this,arguments,(function(){var t,n,a;return xe(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,ke(t.read())];case 3:return n=o.sent(),a=n.value,n.done?[4,ke(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,ke(a)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,n,a,o,s,r;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function gt(e){return new ut((function(t){(function(e,t){var n,a,o,s;return Re(this,void 0,void 0,(function(){var r,i;return xe(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Ve(e),c.label=1;case 1:return[4,n.next()];case 2:if((a=c.sent()).done)return[3,4];if(r=a.value,t.next(r),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i=c.sent(),o={error:i},[3,11];case 6:return c.trys.push([6,,9,10]),a&&!a.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}var ft=Ue((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),wt=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Me(t,e),t.prototype.lift=function(e){var t=new yt(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new ft},t.prototype.next=function(e){var t=this;Je((function(){var n,a;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=Pe(t.currentObservers),s=o.next();!s.done;s=o.next()){s.value.next(e)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Je((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Je((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,a=n.hasError,o=n.isStopped,s=n.observers;return a||o?ze:(this.currentObservers=null,s.push(e),new Be((function(){t.currentObservers=null,He(s,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,a=t.thrownError,o=t.isStopped;n?e.error(a):o&&e.complete()},t.prototype.asObservable=function(){var e=new ut;return e.source=this,e},t.create=function(e,t){return new yt(e,t)},t}(ut),yt=function(e){function t(t,n){var a=e.call(this)||this;return a.destination=t,a.source=n,a}return Me(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:ze},t}(wt);function vt(e){return function(t){if(function(e){return Fe(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Tt(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(!0!==t){if(!1!==t){var o=new ot({next:function(){o.unsubscribe(),e()}});return mt(t.apply(void 0,_e([],Ne(n)))).subscribe(o)}}else e()}class It{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return Oe((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){It.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){It.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}get asRxJS$(){return this._rxJS$||(this._rxJS$=new ut((e=>{const t=this.onChanged((t=>{e.next(t)}));return()=>{this._rxJS$=null,t.cancel()}})).pipe(function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new wt}:t,a=e.resetOnError,o=void 0===a||a,s=e.resetOnComplete,r=void 0===s||s,i=e.resetOnRefCountZero,c=void 0===i||i;return function(e){var t,a,s,i=0,d=!1,l=!1,u=function(){null==a||a.unsubscribe(),a=void 0},h=function(){u(),t=s=void 0,d=l=!1},p=function(){var e=t;h(),null==e||e.unsubscribe()};return vt((function(e,m){i++,l||d||u();var g=s=null!=s?s:n();m.add((function(){0!=--i||l||d||(a=Tt(p,c))})),g.subscribe(m),!t&&i>0&&(t=new ot({next:function(e){return g.next(e)},error:function(e){l=!0,u(),a=Tt(h,o,e),g.error(e)},complete:function(){d=!0,u(),a=Tt(h,r),g.complete()}}),mt(e).subscribe(t))}))(e)}}({connector:()=>new wt,resetOnRefCountZero:!0}))),this._rxJS$}static isObservable(e){return e&&e.isObservable}}const bt=new W("ObservableObject"),Et=1===function(e,t=null,n=typeof t){return function(e,t=null,n=typeof t){if(null===e)return t;if("boolean"===n)return"true"===e||"1"===e;if("number"===n)return+e;if("object"===n&&t instanceof Array)return""===e?t:e.split(",");return e}(new URLSearchParams(window.location.search).get(e),t,n)}("debug",0);const Ct=new Map;if(Et){const e=setInterval((()=>{(function(){for(const e of Ct.values())for(const t in e)return bt.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),bt.error("See stack trace of the property write below:"),bt.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}var St,At,Ot,Dt,Mt;!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(St||(St={})),function(e){e.IMPERIAL="imperial",e.METRIC="metric"}(At||(At={}));!function(e){e[e.Pan=0]="Pan",e[e.PanDollhouse=1]="PanDollhouse",e[e.Zoom=2]="Zoom",e[e.Delay=3]="Delay",e[e.None=4]="None"}(Ot||(Ot={})),function(e){e[e.Left=1]="Left",e[e.Auto=0]="Auto",e[e.Right=-1]="Right"}(Dt||(Dt={})),function(e){e[e.Move=0]="Move",e[e.Burns=1]="Burns",e[e.Zoom=2]="Zoom",e[e.Path=3]="Path",e[e.FloorChange=4]="FloorChange",e[e.Delay=5]="Delay",e[e.Nop=6]="Nop"}(Mt||(Mt={}));Mt.Burns,Mt.Zoom,Mt.Delay;var Rt;!function(e){e[e.Panorama=1]="Panorama",e[e.Dollhouse=2]="Dollhouse",e[e.Floorplan=3]="Floorplan",e[e.Outdoor=4]="Outdoor",e[e.Orthographic=5]="Orthographic",e[e.Mesh=6]="Mesh",e[e.Transition=-1]="Transition"}(Rt||(Rt={}));Rt.Dollhouse,Rt.Panorama;var xt,Pt;!function(e){e.BASE="base",e.STANDARD="standard",e.HIGH="high",e.ULTRAHIGH="ultrahigh"}(xt||(xt={})),function(e){e[e.BASE=512]="BASE",e[e.STANDARD=1024]="STANDARD",e[e.HIGH=2048]="HIGH",e[e.ULTRAHIGH=4096]="ULTRAHIGH"}(Pt||(Pt={}));xt.BASE,Pt.BASE,xt.STANDARD,Pt.STANDARD,xt.HIGH,Pt.HIGH,xt.ULTRAHIGH,Pt.ULTRAHIGH,Pt.BASE,xt.BASE,Pt.STANDARD,xt.STANDARD,Pt.HIGH,xt.HIGH,Pt.ULTRAHIGH,xt.ULTRAHIGH,xt.BASE,Object.freeze({maxSweepDistance:1/0,maxRaycastDistance:10,maxDistanceBeforeAddingSweeps:3,minSweepDistance:1.5,maxSidestepDistance:.4,pathRadius:.1,maxTotalSteps:40}),Dt.Auto;var Nt;!function(e){e.DefurnishView="defurnish_view",e.PresentedBy="presented_by",e.HighlightReel="highlight_reel",e.FloorPlan="floor_plan",e.RoomBounds="room_bounds",e.TourButtons="tour_buttons",e.Labels="labels",e.LabelsDollhouse="labels_dh",e.Measurements="measurements",e.FloorSelect="floor_select",e.SavedMeasurements="measurements_saved",e.Dollhouse="dollhouse",e.InstantTransitions="fast_transitions",e.TransitionSpeed="transition_speed",e.TransitionTime="transition_time",e.PanSpeed="pan_speed",e.DollhousePanSpeed="dollhouse_pan_speed",e.PanAlignment="pan_alignment",e.ZoomDuration="zoom_duration",e.PanAngle="pan_angle",e.PanDirection="pan_direction",e.Units="unit_type",e.DetailsEmail="contact_email",e.DetailsAddress="address",e.DetailsName="contact_name",e.DetailsSummary="model_summary",e.DetailsPhone="contact_phone",e.DetailsModelName="model_name",e.DetailsExternalUrl="external_url",e.BackgroundColor="background_color",e.SpaceSearch="space_search"}(Nt||(Nt={}));function _t(e){return e.tryGetSetting(Nt.RoomBounds,!1)}class kt{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}class Lt{constructor(){this.rooms=0,this.rbError=!1,this.views=[],this.layers=[]}create(e,t,n,a){return new kt(t.onChanged((()=>this.throttleSettingsDataChanges(e,t))),n.onChanged((()=>this.throttleRoomBoundDataChanges(e,n))),a.onChanged((()=>this.throttleLayersDataDataChanges(e,a))))}throttleRoomBoundDataChanges(e,t){const n=t.rooms.size;this.rooms!==n&&e.onChanged()}throttleSettingsDataChanges(e,t){const n=t.tryGetSetting("SETTING_RB_ERROR_GETTING_USER_VIEW",!1);this.rbError!==n&&e.onChanged()}throttleLayersDataDataChanges(e,t){let n=!1;const a=t.getOrderedModelViews();for(const e of a)if(!this.views.includes(e)){n=!0;break}this.views=a;const o=t.getCurrentUserLayers();for(const e of o)if(!this.layers.includes(e)){n=!0;break}this.layers=o,n&&e.onChanged()}}class Vt{constructor(){this._data={[m.Feature.RoomBounds]:void 0,[m.Feature.Defurnish]:void 0}}get data(){return this._data}equals(e){return Object.entries(e.data).every((([e,t])=>this.data[e]===t))}copy(e){for(const[t,n]of Object.entries(e.data))this.data[t]=n}update(e,t,n){const a=e.tryGetSetting("SETTING_RB_ERROR_GETTING_USER_VIEW",!1),o=t.rooms.size;var s;this.data[m.Feature.Defurnish]=!!(null===(s=n.getOrderedModelViews({includeDefurnish:!0,includeDisabled:!1}).filter((e=>Te(e))).find((e=>Te(e))))||void 0===s?void 0:s.id),this.data[m.Feature.RoomBounds]=_t(e)&&!a&&o>0}}var Ft;!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(Ft||(Ft={}));const Ut={$id:"records",type:"object",minProperties:1,maxProperties:6,additionalProperties:{type:["string","number","boolean"]},required:[]},Gt={$id:"options",type:"object",properties:{alwaysTrack:{type:"boolean",nullable:!0},version:{type:"number"},records:{$ref:"records"}},required:[],additionalProperties:!1},Ht={$id:"payload",type:"object",properties:{name:{type:"string"},options:{$ref:"options"}},required:["name"],additionalProperties:!1};class Bt{constructor(e,t){this.sdk=e,this.jsonSchemaValidator=t}validateInput(e,t){this.validate||(this.jsonSchemaValidator.addSchema([Ht,Ut,Gt]),this.validate=this.jsonSchemaValidator.getSchema("payload"));if(!this.validate(e)){const t=this.jsonSchemaValidator.prettify(this.validate,{data:e,colors:!1});throw Error(t)}return e}async exec(e,t){var n,a,o;const s={version:(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.version)||1,alwaysTrack:(null===(a=null==e?void 0:e.options)||void 0===a?void 0:a.alwaysTrack)||!1,records:(null===(o=null==e?void 0:e.options)||void 0===o?void 0:o.records)||{}};return this.sdk.track(t,e.name,s)}}class zt{constructor(e){this.localeInterface=e}validateInput(e,t){return e}async exec(e,t){return this.localeInterface.languageCode}}class $t{constructor(e){this.localeInterface=e}validateInput(e,t){return e}async exec(e,t){return this.localeInterface.t.bind(this.localeInterface)}}var jt,qt;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(jt||(jt={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(qt||(qt={}));const Wt=new WeakMap;class Kt{constructor({retries:e=0,concurrency:t=6}={}){this.totalBytesDownloaded=0,this.queue=[],this.retries=e,this.concurrency=t}get(e,t){return this.request("GET",e,t)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}request(e,t,n){const a=new Yt(e,t,n);if(null==n?void 0:n.signal){const e=()=>{this.queue.includes(a)&&(a.status===qt.SENDING&&a.abort(),this.dequeue(a),a.onFail(new DOMException("Aborted","AbortError")))};n.signal.addEventListener("abort",e),Wt.set(a,(()=>{var t;null===(t=n.signal)||void 0===t||t.removeEventListener("abort",e),Wt.delete(a)}))}return this.enqueue(a),a.promise}update(){let e;for(;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=qt.PENDING;this.updateTimeout=null}enqueue(e){let t=0;for(t=0;t<this.queue.length;t++){if(this.queue[t].priority<e.priority)break}this.queue.splice(t,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((()=>{this.update()}),1))}dequeue(e){var t;null===(t=Wt.get(e))||void 0===t||t();const n=this.queue.indexOf(e);if(-1===n)throw new Error("Can't dequeue request not in queue");this.queue.splice(n,1),this.update()}getNextPendingRequest(){for(let e=0;e<this.queue.length&&e<this.concurrency;e++){const t=this.queue[e];if(t.status===qt.PENDING)return t}return null}getNextOverflowingGet(){for(let e=this.concurrency;e<this.queue.length;e++){const t=this.queue[e];if(t.status===qt.SENDING&&t.priority!==jt.HIGHEST&&"GET"===t.method)return t}return null}shouldRetryStatusCode(e){return!Kt.doNotRetryStatusCodes[e]}sendRequest(e){e.status=qt.SENDING,e.send().then((t=>{e.status=qt.DONE,this.dequeue(e),e.contentLength&&e.contentLength>0&&(this.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(t)})).catch((t=>{const n=null!==e.maxRetries?e.maxRetries:this.retries;let a=e.sendAttempts<n;if("object"==typeof t){const e=t.status_code||0;a=a&&this.shouldRetryStatusCode(e)}a?(e.status=qt.PENDING,this.update(),console.warn(`Retried ${e.url}`),console.warn(t)):(e.status=qt.FAILED,this.dequeue(e),console.warn(`Failed ${e.url}`),e.onFail(t))}))}}Kt.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0};class Yt{constructor(e,t,n={}){this.sendAttempts=0,this.status=qt.PENDING,this.contentLength=0,this.isAborting=!1,this.url=t,this.method=e,this.auth=n.auth||null,this.withCredentials=n.withCredentials||!1,this.priority=n.priority||jt.MEDIUM,this.responseType=n.responseType||null,this.body=n.body||null,this.headers=n.headers||{},this.maxRetries=n.maxRetries||null,this.onProgress=n.onProgress,this.promise=new Promise(((e,t)=>{this.onDone=e,this.onFail=t}))}send(){const e=this.xhr=function(e,t,n){let a;if("undefined"!=typeof XMLHttpRequest)a=new XMLHttpRequest,a.withCredentials=n;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");a=new XDomainRequest}return a.open(e,t,!0),a}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)e.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');e.responseType="blob"}"json"===this.responseType&&e.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&e.setRequestHeader("Authorization",this.auth);for(const t in this.headers)e.setRequestHeader(t,this.headers[t]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),e.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(e.onprogress=this.onProgress),new Promise(((t,n)=>{e.onreadystatechange=()=>{if(4===e.readyState){if(200===e.status||201===e.status||204===e.status)return this.parseResponse(this.xhr).then((e=>{t(e)}));if(!this.isAborting)return this.parseResponse(this.xhr).then((t=>{n(Object.assign({status_code:e.status},t))})).catch((()=>{n({status_code:e.status})}));this.isAborting=!1}},e.onerror=function(e){n(e)},e.send(this.body),this.sendAttempts++}))}parseResponse(e){return new Promise(((t,n)=>{var a;try{if(!e)throw new Error(`No request received. Trying ${this.method} on ${this.url} and expecting ${this.responseType}, but request was ${this.xhr}`);let n=e.response;if(this.contentLength=parseInt(null!==(a=e.getResponseHeader("Content-Length"))&&void 0!==a?a:"0",10),"json"===this.responseType&&"object"!=typeof n)t(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==this.responseType)t(n);else{const e=URL.createObjectURL(n);n=new Image,n.onload=function(){URL.revokeObjectURL(e),t(n)},n.src=e,n.crossOrigin="Anonymous"}}catch(e){n({error:"Payload was not valid JSON"})}}))}abort(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.isAborting=!0,this.xhr.abort()}}const Xt=W;class Zt{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new Qt(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new Zt;return e.resolve(),e.promise()}static reject(e){const t=new Zt;return t.reject(e),t.promise()}static all(e){const t=[];for(const n of e)n.nativePromise?t.push(n.nativePromise()):t.push(n);const n=new Zt;return Promise.all(t).then((e=>n.resolve(e)),(e=>n.reject(e))),n.promise()}}class Qt{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}const Jt=new Xt("asset.registerTexture");class en{constructor(e,t,n){this.THREE=e,this.loadImage=t,this.scopedTextures=n,this.svgLoader=new tn(new Kt)}validateInput(e,t){const{textureId:n,textureSrc:a}=e;if(!ee(n))throw Error(`textureId ${n} is not a valid string`);if(!ee(a))throw Error(`textureSrc ${a} is not a valid string`);const o=this.scopedTextures.get(t.client.applicationKey);if(o){if(o.map[n])throw Error(n+" already has a registered texture")}return{textureId:n,textureSrc:a}}async exec(e,t){const{textureId:n,textureSrc:a}=e,o=this.scopedTextures.get(t.client.applicationKey)||{imagePromise:{},map:{}};this.scopedTextures.set(t.client.applicationKey,o);const[s,r]=a.endsWith(".svg")?this.loadSvgTexture(a):this.loadImageTexture(a);o.imagePromise[n]=r;try{const e=await r;s.image=e,s.needsUpdate=!0,o.map[n]=s}catch(t){throw delete o.imagePromise[n],Error(`Failed to load ${e.textureSrc}`)}}loadImageTexture(e){const t=new Zt,n=this.loadImage(e,(()=>t.resolve(n.image)),(e=>t.reject(e)));return[n,t.nativePromise()]}loadSvgTexture(e){const t=new this.THREE.Texture;t.colorSpace=this.THREE.SRGBColorSpace;return[t,this.svgLoader.load(e)]}}class tn{constructor(e){this.queue=e}async load(e){const t=await this.queue.get(e,{responseType:"text"}),n=document.createElement("div");n.innerHTML=t;const a=n.querySelector("svg");if(!a)throw Error("Failed trying to load "+e+"as an svg.");const o=a.getAttribute("width"),s=a.getAttribute("height");return o||s?(s&&!o&&(Jt.warn(e,"does not have a defined width. Defaulting width equal to height"),a.setAttribute("width",s)),o&&!s&&(Jt.warn(e,"does not have a defined height. Defaulting height equal to width"),a.setAttribute("height",o))):(Jt.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),a.setAttribute("width",tn.defaultResolution),a.setAttribute("height",tn.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([a.outerHTML],{type:"image/svg+xml"}))}))}}tn.defaultResolution="128";var nn,an,on,sn,rn=n(846);!function(e){e.PHOTO="photo",e.RICH="rich",e.VIDEO="video"}(nn||(nn={})),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(an||(an={})),function(e){e.ALPHA="alpha",e.COLORED_ROOMS="colored_rooms",e.MEASUREMENTS="measurements",e.PHOTOGRAMY="photogramy",e.SCHEMATIC="schematic"}(on||(on={})),function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(sn||(sn={}));class cn{constructor(e,t,n){this.floorData=e,this.modelData=t,this.apiClient=n}validateInput(e){const{sid:t}=e;if(!t)return{sid:this.modelData.model.sid};if(ee(t))return{sid:t};throw Error(`"${t}" is not a valid sid string`)}async exec(e,t){var n,a,o,s,r,i,c,d,l;const u=this.floorData.getFloorIdMap(!1),h=await this.apiClient.query(rn.Floorplans,{modelId:e.sid});(null===(o=null===(a=null===(n=null==h?void 0:h.data)||void 0===n?void 0:n.model)||void 0===a?void 0:a.assets)||void 0===o?void 0:o.floorplans)||this.throw("error fetching floorplans");const p=[];for(const e of null===(r=null===(s=h.data)||void 0===s?void 0:s.model)||void 0===r?void 0:r.assets.floorplans){let t=!1,n=!1;for(const a of e.flags)a===on.PHOTOGRAMY&&(t=!0),a===on.ALPHA&&(n=!0);if(t&&n){const t=null===(i=e.url)||void 0===i?void 0:i.search("vr_colorplan");if(t&&-1!==t){const t=null===(c=null==e?void 0:e.floor)||void 0===c?void 0:c.id;if(t){const n=u[t];p[parseInt(n,10)]=e}}}}const m=[];for(const e of p)if(e.url){const t=fetch(e.url).then((e=>e.arrayBuffer()));m.push(t)}return{imageDataUrls:(await Promise.all([...m]).catch((e=>this.throw(e)))).map((e=>(e=>{const t=[];for(let n=0;n<e.length;n+=8192)t.push(String.fromCharCode.apply(null,e.subarray(n,n+8192)));return btoa(t.join(""))})(new Uint8Array(e)))),data:{height:p[0].height||100,imageOriginX:(null===(d=p[0].origin)||void 0===d?void 0:d.x)||0,imageOriginY:(null===(l=p[0].origin)||void 0===l?void 0:l.y)||0,resolutionPpm:p[0].resolution||100,width:p[0].width||100}}}throw(e){throw Error("Asset.getVrColorplans: "+e)}}class dn{constructor(e){this.attachmentRegistry=e}validateInput(e,t){return ee(e.id)||this.throw(X("tagId","string",e.id)),this.attachmentRegistry.get(t.client.applicationKey,e.id)||this.throw(`${e.id} does not map to a valid asset`),e}async exec(e,t){const n=this.attachmentRegistry.get(t.client.applicationKey,e.id);return n||this.throw(`${e.id} does not map to a valid asset`),n}throw(e){throw Error("Asset.getAssetById: "+e)}}class ln{constructor(e){this.attachmentRegistry=e}validateInput(e,t){return e}exec(){return this.attachmentRegistry.refresh()}}function un(e,t,n,a,o,s){const{floorData:r,modelData:i,modelApiClient:c}=o,d=function(e,t){const n=Y.create(t,new z(cn));return e.addAsyncCommandToInterface({namespace:"Asset",name:"getVrColorplans",args:["sid"],origins:ne},n),n}(e,new B(r,i,c)),l=function(e,t,n,a){const o=Y.create(a,new z(en,t,n.loadImage));return e.addCommandToInterface({namespace:"Asset",name:"registerTexture",args:["textureId","textureSrc"]},o),o}(e,t,n,new B(a)),u=function(e,t){const n=Y.create(t,new z(dn));return e.addAsyncCommandToInterface({namespace:"Asset",name:"getAssetById",args:["id"],origins:ne},n),n}(e,new B(s)),h=function(e,t){const n=Y.create(t,new z(ln));return e.addAsyncCommandToInterface({namespace:"Asset",name:"refreshAssets",args:[],origins:ne},n),n}(e,new B(s));return{getVrColorplans:d,registerTexture:l,getAssetById:u,refreshAssets:h}}class hn extends me{constructor(){super()}}hn.id="GET_POSE";const pn=40*Math.PI/180/1e3;class mn extends me{constructor(e){super(),this.payload=e}}mn.id="LOOK_AT_SCREEN_COORDS";const gn=new Xt("broadcast.move"),fn=100;function wn(e,t){return Object.values(e).includes(t)}class yn extends me{constructor(e){super(),this.payload=e}}yn.id="MOVE_DIRECTION";const vn=.005;class Tn extends me{constructor(e){super(),this.payload={x:e.x,z:e.z}}}function In(e,t){e.x=t.x,e.y=t.y}function bn(e,t){In(e,t),e.z=t.z}Tn.id="PAN";class En extends Error{constructor(e,t){var n;super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(n=e)&&n instanceof Error&&n.isMock&&(this.isMock=!0))}}function Cn(e,t){const n=t.length;e.length=n;for(let a=0;a<n;++a)e[a]=t[a];return e}class Sn extends En{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}const An=(e,t,n=1e-5)=>Math.abs(e-t)<=n,On=(e,t,n=1e-5)=>An(e.x,t.x,n)&&An(e.y,t.y,n),Dn=(e,t,n=1e-5)=>On(e,t,n)&&An(e.z,t.z,n);class Mn{create(e,t,n,a){const o=()=>e.onChanged();return new kt(t.onChanged(o),n.onChanged(o),a.onChanged(o))}}class Rn{constructor(e,t){this._data={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:b.Mode.TRANSITIONING},this.THREE=e,this.viewmodeConverter=t,this.tempEuler=new e.Euler}get data(){return this._data}equals(e){const t=1e-5;return Dn(e._data.position,this._data.position,t)&&On(e._data.rotation,this._data.rotation,t)&&((e,t,n=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,a)=>!An(e,t[a],n))))(e._data.projection,this._data.projection,t)&&e._data.sweep===this._data.sweep&&e._data.mode===this._data.mode}update(e,t,n,a){const o=this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ"),s=t.state.currentSweep&&t.isSweepUnaligned(t.state.currentSweep),r=n.isInside()?e.pose.position:e.pose.fovCorrectedPosition();bn(this._data.position,r),this._data.rotation.x=this.THREE.MathUtils.radToDeg(o.x),this._data.rotation.y=this.THREE.MathUtils.radToDeg(o.y),this._data.projection=Float32Array.from(e.pose.projection.asThreeMatrix4().transpose().elements),this._data.sweep=t.currentSweepObject?a.getIdForSweep(t.currentSweepObject):"",this._data.mode=this.viewmodeConverter.toSdk(n.currentMode,!s,e.pose.isPitchFactorOrtho)}copy(e){bn(this._data.position,e.data.position),In(this._data.rotation,e.data.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new Sn;const n=t.length;for(let a=0;a<n;++a)e[a]=t[a]}(this._data.projection,e.data.projection),this._data.sweep=e.data.sweep,this._data.mode=e.data.mode}}var xn,Pn,Nn,_n,kn;!function(e){e.Desktop="desktop",e.Mobile="mobile",e.VrOrientOnly="xr.orientonly",e.VrWithController="xr.controller",e.VrWithTrackedController="xr.trackedcontroller",e.VrTransientPointer="xr.transient-pointer",e.VrUnknown="xr."}(xn||(xn={})),function(e){e.None="interaction.none",e.Direct="interaction.direct",e.Key="interaction.key",e.Gui="interaction.gui",e.Mouse="interaction.mouse",e.Touch="interaction.touch",e.Pen="interaction.pen",e.XRController="interaction.xr.controller",e.XRGaze="interaction.xr.gaze",e.XRScreen="interaction.xr.screen"}(Pn||(Pn={})),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate",e[e.MoveToBlack=3]="MoveToBlack",e[e.OrbitTo=4]="OrbitTo"}(Nn||(Nn={})),function(e){e[e.Full=0]="Full",e[e.ClearToBlack=1]="ClearToBlack",e[e.BlackToClear=2]="BlackToClear"}(_n||(_n={})),function(e){e[e.Top=1]="Top",e[e.Bottom=2]="Bottom"}(kn||(kn={}));const Ln=Math.PI/180;Math.PI;Object.freeze({camera:{transitionBlackoutTime:300,transitionFadeTime:800,baseTransitionTime:200,transitionSpeed:3,autoOrbitMinVelocity:.002,autoOrbitMaxVelocity:.08,autoOrbitTransitionTIme:1e3,autoOrbitLowerPhiLimit:30*Ln,autoOrbitUpperPhiLimit:90*Ln}});xn.Desktop,Nn.Interpolate,xn.Mobile,Nn.Interpolate,xn.VrOrientOnly,Nn.FadeToBlack,xn.VrWithController,Nn.FadeToBlack,xn.VrWithTrackedController,Nn.FadeToBlack,xn.VrTransientPointer,Nn.FadeToBlack,xn.VrUnknown,Nn.FadeToBlack;const Vn=75*Ln;function Fn(e){return async function(t,n,a){const{x:o,y:s,z:r,w:i}=a.startOrientation,c=new e.Quaternion(o,s,r,i).normalize(),{x:d,y:l,z:u,w:h}=a.endOrientation,p=new e.Quaternion(d,l,u,h).normalize(),m=a.duration||0;await t.rotateBetweenOrientations(!!a.fadeToBlack,c,p,m,a.allowOverlappingTransitions)}}class Un extends me{constructor(e){super(),this.payload={xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,rotationSpeed:e.rotationSpeed,clampYRotation:e.clampYRotation}}}Un.id="ROTATE";class Gn extends me{constructor(e){super(),this.payload={startOrientation:Object.assign({},e.startOrientation),endOrientation:Object.assign({},e.endOrientation),duration:e.duration,fadeToBlack:e.fadeToBlack,allowOverlappingTransitions:e.allowOverlappingTransitions}}}function Hn(e,t,n){const a=new e.Euler,o=new e.Euler;return async function(e,s,r,i){if(r.currentMode!==t.Panorama)throw Error("Camera.setRotation is only available in Panorama mode");const c=i.xAngle%(.5*Math.PI),d=i.yAngle%(2*Math.PI),l=e.pose.rotation;a.setFromQuaternion(l,"YXZ");let u=d-a.y;return Math.abs(u)>Math.PI&&(u-=2*Math.sign(u)*Math.PI),o.set(c-a.x,u,0,"YXZ"),o.y%=2*Math.PI,n(s,e,{xAngle:-o.y,yAngle:o.x,zAngle:0,rotationSpeed:i.rotationSpeed,clampYRotation:!1})}}Gn.id="ROTATE_BETWEEN_ORIENTATIONS";class Bn extends Un{}function zn(e,t,n,a){const o=t.MathUtils.degToRad(80)/1e3;a.getDependencies().then((([e,t,a])=>{n.addBinding(Un,(async a=>await n.rotateCamera(e,t,a))),n.addBinding(Gn,(async a=>await n.rotateCameraBetweenOrientations(e,t,a))),n.addBinding(Bn,(async o=>await n.orientCamera(t,e,a,o)))}));const s=e=>{const n=(e=e||{}).options||{},a=t.MathUtils.degToRad(e.xAngle||0),s=t.MathUtils.degToRad(e.yAngle||0),r=t.MathUtils.degToRad(e.zAngle||0),i=!!e.clampYRotation;let c=o;if(n.speed){if(isNaN(n.speed)||n.speed<=0)throw new Error(`${JSON.stringify(n)} does not contain valid rotation speed`);c=t.MathUtils.degToRad(n.speed)/1e3}if(isNaN(a)||isNaN(s)||isNaN(r))throw new Error(`${JSON.stringify(e)} does not contain valid rotation angles`);return{xAngle:a,yAngle:s,zAngle:r,rotationSpeed:c,clampYRotation:i}};e.addCommandCreator({namespace:"Camera",name:"rotate",args:["xAngle","yAngle","options"]},(e=>new Un(s({xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,options:e.options,clampYRotation:!0})))),e.addCommandCreator({namespace:"Camera",name:"rotateBetweenOrientations",args:["startOrientation","endOrientation","duration","fadeToBlack","allowOverlappingTransitions"]},(e=>new Gn((e=>{const t=e=>null===e.x||isNaN(e.x)||null===e.y||isNaN(e.y)||null===e.z||isNaN(e.z)||null===e.w||isNaN(e.w);if(!(e=e||{}).duration||isNaN(e.duration)||e.duration<=0)throw new Error(`${JSON.stringify(e)} does not contain valid rotation duration`);if(t(e.startOrientation)||t(e.endOrientation))throw new Error(`${JSON.stringify(e)} does not contain valid start and end orientations`);const{x:n,y:a,z:o,w:s}=e.startOrientation,{x:r,y:i,z:c,w:d}=e.endOrientation;return{startOrientation:{x:n,y:a,z:o,w:s},endOrientation:{x:r,y:i,z:c,w:d},duration:e.duration,fadeToBlack:!!e.fadeToBlack,allowOverlappingTransitions:!!e.allowOverlappingTransitions}})({startOrientation:null==e?void 0:e.startOrientation,endOrientation:null==e?void 0:e.endOrientation,duration:e.duration,fadeToBlack:e.fadeToBlack,allowOverlappingTransitions:e.allowOverlappingTransitions})))),e.addCommandCreator({namespace:"Camera",name:"setRotation",args:["rotation","options"]},(e=>{const t=(e=e||{}).rotation||{};return new Bn(s({xAngle:t.x,yAngle:t.y,zAngle:t.z,options:e.options,clampYRotation:!1}))}))}Bn.id="SET_ORIENTATION";class $n extends me{}$n.id="STOP";const jn=.7,qn=3,Wn=function(e,t,n){return Math.max(t,Math.min(e,n))};const Kn=new Xt("command.zoom");class Yn{constructor(e,t,n,a){this.cameraData=n,this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomSetCommand=e.ZoomSetCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomPct-0;if(isNaN(t))throw Error(t+" is not a valid zoom level");return t<jn&&qn<t&&(e.zoomPct=Wn(t,jn,qn),Kn.warn(t,`is outside the valid zoom range of [${jn}, ${qn}]`)),e}async exec(e,t){return Qn(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomSetCommand(e.zoomPct)),this.cameraData.zoom()}}class Xn{constructor(e,t,n,a){this.cameraData=n,this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomInCommand=e.ZoomInCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomDelta-0;if(isNaN(t))throw Error(t+" is not a valid zoom delta");return e.zoomDelta=t||0,e}async exec(e,t){return Qn(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomInCommand(e.zoomDelta)),this.cameraData.zoom()}}class Zn{constructor(e,t,n,a){this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomResetCommand=e.ZoomResetCommand,this.issueCommand=t.issueCommand}validateInput(e){return e}async exec(e,t){Qn(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomResetCommand)}}function Qn(e,t){if(t!==e.Panorama)throw Error("Zoom controls are currently only supported in Panorama mode")}class Jn{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ea{constructor(e){this._data={level:1}}get data(){return this._data}equals(e){return this._data.level===e.data.level}copy(e){this._data.level=e.data.level}update(e,t){t.isInside()&&(this._data.level=e.zoom())}}function ta(e,t){const n=new e.Euler;return function(a,o,s,r,i){const c=n.setFromQuaternion(o.pose.rotation,"YXZ"),d=s.state.currentSweep&&s.isSweepUnaligned(s.state.currentSweep);return a.position.x=o.pose.position.x,a.position.y=o.pose.position.y,a.position.z=o.pose.position.z,a.rotation.x=e.MathUtils.radToDeg(c.x),a.rotation.y=e.MathUtils.radToDeg(c.y),a.projection=Float32Array.from(o.pose.projection.asThreeMatrix4().transpose().elements),a.sweep=s.currentSweepObject?i.getIdForSweep(s.currentSweepObject):"",a.mode=t.toSdk(r.currentMode,!d,o.pose.isPitchFactorOrtho),a}}class na{constructor(){this.wasInTransition=!1,this.currentFloor=""}create(e,t,n,a,o){return new kt(t.makeFloorChangeSubscription((()=>this.throttleCurrentFloorChanges(e,t))),a.onChanged((()=>this.throttleCameraTranstionChanges(e,a,n,o))),n.onChanged((()=>this.throttleCameraTranstionChanges(e,a,n,o))),o.onChanged((()=>this.throttleCameraTranstionChanges(e,a,n,o))))}throttleCameraTranstionChanges(e,t,n,a){const o=t.transition.active||n.state.transition.active;o!==this.wasInTransition&&(this.wasInTransition=o,e.onChanged())}throttleCurrentFloorChanges(e,t){const n=t.currentFloorId;n!==this.currentFloor&&(this.currentFloor=n,e.onChanged())}}class aa{constructor(e){this._data={id:void 0,sequence:void 0,name:""},this.SweepAlignmentType=e.SweepAlignmentType,this.SweepPlacementType=e.SweepPlacementType}get data(){return this._data}equals(e){const t=this.data,n=e.data;return t.id===n.id&&t.sequence===n.sequence&&t.name===n.name}copy(e){this._data.id=e.data.id,this._data.sequence=e.data.sequence,this._data.name=e.data.name}update(e,t,n,a,o){const s=e.currentFloor,r=t.state.currentSweep&&t.getSweep(t.state.currentSweep);!a.isTourActive()&&n.transition.active&&!t.state.transition.active||function(){if(t.state.transition.active&&t.state.transition.to&&t.state.transition.from){const e=t.getSweep(t.state.transition.to),n=t.getSweep(t.state.transition.from);return e.floorId!==n.floorId}return!1}()?(this._data.id="",this._data.sequence=void 0,this._data.name=""):r&&r.alignmentType===this.SweepAlignmentType.UNALIGNED&&r.placementType===this.SweepPlacementType.UNPLACED?(this._data.id=void 0,this._data.sequence=void 0,this._data.name=""):s?(this._data.id=o.getIdFromCwfId(s.id),this._data.sequence=s.index,this._data.name=s.name):(this._data.id="",this._data.sequence=-1,this._data.name="all")}}class oa{static async create(e,t,n){const a=await e.getDependencies();return new oa(a,e,t,n)}static async createDI(e,t,n,a,o){const s=o?await B.createFromDI(e,t,o):await B.createFromDI(e,t);return this.create(s,n,a)}constructor(e,t,n,a){this.dependencies=e,this.optionals=t,this.subscriptionFactory=n,this.dataFactory=a,this.dirty=!0,this.observers=new Set,this.currentData=a.create(...e,...t.getOptionals());const o=new class{constructor(e){this.collection=e}onChanged(){this.collection.dirty=!0;for(const e of this.collection.observers)e.onChanged()}}(this);this.dependencySubscription=t.onOptionalsFulfilled((()=>{var e;null===(e=this.changeSubscription)||void 0===e||e.cancel(),this.changeSubscription=this.subscriptionFactory.create(o,...this.dependencies,...this.optionals.getOptionals()),o.onChanged()})),this.changeSubscription=this.subscriptionFactory.create(o,...this.dependencies,...this.optionals.getOptionals()),this.changeSubscription.cancel()}getData(){return this.currentData.data}subscribe(e){const t=this.dependencies,n=this.optionals;const a=new class{constructor(e){this.sdkCollection=e,this.needsUpdate=!0,this.diffRecord={added:new Map,removed:new Map,updated:new Map},this.dataView=e.dataFactory.create(...t,...n.getOptionals())}get dirty(){return this.needsUpdate}readDiff(){const{added:t,removed:n,updated:a}=this.diffRecord;if(t.clear(),n.clear(),a.clear(),!this.dirty)return this.diffRecord;this.sdkCollection.update(e);const o=this.sdkCollection.currentData;for(const e in o.data)this.dataView.data.hasOwnProperty(e)?this.dataView.isItemEqual(o,e)||a.set(e,o.data[e]):t.set(e,o.data[e]);for(const e in this.dataView.data)o.data.hasOwnProperty(e)||n.set(e,this.dataView.data[e]);return this.dataView.update(e),this.needsUpdate=!1,this.diffRecord}onChanged(){this.needsUpdate=!0}renew(){this.sdkCollection.addObserver(this)}cancel(){this.sdkCollection.removeObserver(this)}}(this);return this.addObserver(a),a}update(e){this.dirty&&this.observers.size>0&&(this.currentData.update(e),this.dirty=!1)}addObserver(e){0===this.observers.size&&(this.dependencySubscription.renew(),this.changeSubscription.renew(),this.dirty=!0),this.observers.add(e)}removeObserver(e){this.observers.delete(e),0===this.observers.size&&(this.dependencySubscription.cancel(),this.changeSubscription.cancel(),this.currentData.clear())}}class sa{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ra{constructor(e,t){this.floorData=e,this.floorIdMap=t,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.id===a.id&&n.name===a.name&&n.sequence===a.sequence}update(){for(const e of this.floorData.getCollection()){const t=this.floorIdMap.getIdFromCwfId(e.id),n=this._data[t]||{};n.id=t,n.sequence=e.index,n.name=e.name,this._data[t]=n}for(const e in this.data){this.floorIdMap.getFloorForId(e)||delete this._data[e]}}clear(){this._data={}}}class ia extends me{}async function ca(e){try{const{currentFloor:t,totalFloors:n}=e,a=e.getFloorNames();return{currentFloor:t?t.index:-1,floorNames:a,totalFloors:n}}catch(e){throw Error("no floors currently loaded")}}ia.id="GET_FLOORS_DATA";class da extends me{constructor(e){super(),this.payload=e}}da.id="MOVE_TO_FLOOR";class la{constructor(e,t,n){this.floorsViewData=n,this.issueCommand=t.issueCommand,this.ShowAllFloorsCommand=e.ShowAllFloorsCommand}validateInput(e){return e}async exec(e,t){try{await this.issueCommand(new this.ShowAllFloorsCommand({moveCamera:!0}));const e=this.floorsViewData.currentFloor;return e?e.index:-1}catch(e){throw Error("Could not show all floors")}}}class ua{constructor(e){this.FloorsData=e}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.FloorsData.getFloorIdMap(e.invert)}}class ha extends me{}function pa(e,t){return function(n,a,o,s){const r=o.getCollection(),i=[],c=new e.Vector2;for(const o of r){t(n,o.position,c);const{id:r,index:d}=a.getFloor(o.floorId),l=s.getIdFromCwfId(r),u=le(o);i.push(Object.assign(Object.assign({},u),{position:(new e.Vector3).copy(o.position),screenPosition:c,floor:d,floorInfo:{id:l,sequence:d}}))}return i}}ha.id="LABEL_GET";class ma{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ga{constructor(e,t,n){this.labelData=e,this.floorsData=t,this.floorIdMap=n,this._data={}}get data(){return this._data}isItemEqual(e,t){return!ue(this.data[t],e.data[t])}update(){var e;for(const t of this.labelData.getCollection()){const n=null!==(e=this.data[t.sid])&&void 0!==e?e:{};n.position=t.position,n.sid=t.sid,n.text=t.text,n.visible=t.visible;const a=this.floorsData.getFloor(t.floorId);n.floorInfo={id:this.floorIdMap.getIdFromCwfId(a.id),sequence:a.index},this.data[n.sid]=n}for(const e in this.data){this.labelData.getLabel(e)||delete this.data[e]}}clear(){this._data={}}}class fa{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const n=this.deepLinker.creator.createLink();return decodeURIComponent(n.href)}}class wa{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const n=this.deepLinker.creator.createDeepLink();return decodeURIComponent(n.href)}}function ya(e){return!!e&&"object"==typeof e}function va(e){return"boolean"==typeof e}function Ta(e,t,n,a){switch(e){case T.OpenPolicy.DEFAULT:n.handler.resetPolicy(t);break;case T.OpenPolicy.NEW_WINDOW:n.handler.setPolicy(t,n.handler.HandlingPolicy.NEW_WINDOW);break;case T.OpenPolicy.SAME_FRAME:n.handler.setPolicy(t,n.handler.HandlingPolicy.IN_FRAME);break;case T.OpenPolicy.CURRENT_WINDOW:n.handler.setPolicy(t,n.handler.HandlingPolicy.CUSTOM,(e=>{a.sendPrivateMessage("open link",{href:e})}))}}class Ia{constructor(e,t,n){this.sdk=e,this.deepLinker=t,this.api=n}validateInput(e){if(!wn(T.OpenPolicy,e.policy))throw Error(`Link.setModelLinkPolicy: ${e.policy} is not a valid Link.OpenPolicy`);if(!ee(e.baseHref))throw Error("Link.setModelLinkPolicy: could not determine window.location");if(wn(T.DestinationPolicy,e.destinationPolicy))return{policy:e.policy,baseHref:e.baseHref,destinationPolicy:e.destinationPolicy};const t=ya(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!ee(t)||ee(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setModelLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const n=ba(e,this.api);e.policy!==T.OpenPolicy.NEW_WINDOW&&e.policy!==T.OpenPolicy.CURRENT_WINDOW||!n?Ta(e.policy,this.deepLinker.LinkType.MODEL,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.MODEL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const a=new URLSearchParams(window.location.search),o=new URL(t).searchParams;a.set("m",o.get("m")||o.get("model")||"");const s=new URL(Aa(n,a));s.searchParams.set("m",o.get("m")||o.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===T.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(s.href)})}))}}function ba(e,t){var n;if(function(e){return!e.destinationPolicy}(e))return null===(n=e.options)||void 0===n?void 0:n.templateHref;const a=t.getApi().baseUrl;return{[T.DestinationPolicy.DEFAULT]:"",[T.DestinationPolicy.MATTERPORT]:a+"/show/"}[e.destinationPolicy]}class Ea{constructor(e,t,n){this.sdk=e,this.deepLinker=t,this.api=n}validateInput(e){if(!wn(T.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);if(!ee(e.baseHref))throw Error("Link.setNavigationLinkPolicy: could not determine window.location");if(wn(T.DestinationPolicy,e.destinationPolicy))return{policy:e.policy,baseHref:e.baseHref,destinationPolicy:e.destinationPolicy};const t=ya(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!ee(t)||ee(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setNavigationLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const n=ba(e,this.api);e.policy!==T.OpenPolicy.NEW_WINDOW&&e.policy!==T.OpenPolicy.CURRENT_WINDOW||!n?Ta(e.policy,this.deepLinker.LinkType.NAVIGATION,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.NAVIGATION,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const a=new URLSearchParams(window.location.search),o=new URLSearchParams(t),s=new URL(Aa(n,a));!function(e,t){const[n,a,o,s,r,i,c]=[t.get("sm"),t.get("sp"),t.get("sq"),t.get("sr"),t.get("ss"),t.get("sz"),t.get("start")];ee(n)&&e.set("sm",n);ee(a)&&e.set("sp",a);ee(o)&&e.set("sq",o);ee(s)&&e.set("sr",s);ee(r)&&e.set("ss",r);ee(i)&&e.set("sz",i);ee(c)&&e.set("start",c)}(s.searchParams,o),s.searchParams.set("m",o.get("m")||o.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===T.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(s.href)})}))}}class Ca{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!wn(T.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);return{policy:e.policy}}async exec(e,t){Ta(e.policy,this.deepLinker.LinkType.SAME_ORIGIN,this.deepLinker,this.sdk)}}class Sa{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){const{openInNewWindow:t}=e;if(!va(t))throw Error(`${e.openInNewWindow} is expected to strictly be a boolean to avoid confusion about truth-y and false-y values.`);return{openInNewWindow:t}}async exec(e,t){e.openInNewWindow?this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.NEW_WINDOW):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(e=>{this.sdk.sendPrivateMessage("open link",{href:e})}))}}function Aa(e,t){const n=/\$\{([a-zA-Z]+)\}/,a=new URL(e);let o,s=decodeURI(a.pathname);for(;o=s.match(n);){const e=t.get(o[1]);s=s.replace(o[0],`${e}`)}for(a.pathname=s;o=a.search.match(n);){const e=t.get(o[1]);a.search=null!==e||""===e?a.search.replace(o[0],`${o[1]}=${e}`):a.search.replace(o[0],`${o[1]}`)}return a.href}function Oa(e,t){return!!Array.isArray(e)&&e.every(t)}class Da{constructor(e){this.deepLinks=e}validateInput(e){const{policy:t,baseHref:n}=e;if(!wn(T.CreationPolicy,t))throw Error(`Link.setShareLinkPolicy: ${e.policy} is not a valid Link.ShareLinkPolicy`);if(!ee(n))throw Error("Link.setShareLinkPolicy: Could not determine window.location");const a=ya(e.options)&&e.options.includeParams?e.options.includeParams:[];if(!Oa(a,ee))throw Error("Link.setShareLinkPolicy: 'includeParams' expects an array of strings");return{policy:t,baseHref:this.validateBaseHref(t,n),options:{includeParams:a}}}validateBaseHref(e,t){const n=/^https:\/\/([a-z0-9\-]*\.)*(matterport\.com|matterportvr\.cn)$/,a=/^https:\/\/static\.(matterport\.com|matterportvr\.cn)$/;return{[T.CreationPolicy.MATTERPORT]:function(){if(window.location.origin.match(n)&&!window.location.origin.match(a))return window.location.href;const e=decodeURIComponent(new URLSearchParams(window.location.search.toLowerCase()).get("apihost")||"");return e.match(n)?e+"/show/":"https://my.matterport.com/show/"},[T.CreationPolicy.REFERRER]:function(){return t},[T.CreationPolicy.WINDOW]:function(){return window.location.href}}[e]()}async exec(e,t){this.deepLinks.creator.setDefaultBaseHref(e.baseHref,e.options.includeParams)}}class Ma{constructor(e,t){this.toSdkMediaMap={[e.PHOTO]:I.MediaType.PHOTO,[e.VIDEO]:I.MediaType.VIDEO,[e.RICH]:I.MediaType.RICH},this.toSdkMediaFromChunk={[t.error]:I.MediaType.NONE,[t.link]:I.MediaType.NONE,[t.none]:I.MediaType.NONE,[t.photo]:I.MediaType.PHOTO,[t.rich]:I.MediaType.RICH,[t.text]:I.MediaType.NONE,[t.video]:I.MediaType.VIDEO}}toSdkMedia(e){return this.toSdkMediaMap[e]}fromTagChunkType(e){return this.toSdkMediaFromChunk[e]}}class Ra{constructor(e){this.toSdkChunkTypeMap={[e.error]:I.DescriptionChunkType.NONE,[e.link]:I.DescriptionChunkType.LINK,[e.none]:I.DescriptionChunkType.NONE,[e.photo]:I.DescriptionChunkType.NONE,[e.rich]:I.DescriptionChunkType.NONE,[e.text]:I.DescriptionChunkType.TEXT,[e.video]:I.DescriptionChunkType.NONE}}toSdkChunkType(e){return this.toSdkChunkTypeMap[e]}}class xa{constructor(e){this.toSdkLinkTypeMap={[e.NAVIGATION]:I.LinkType.NAVIGATION,[e.MODEL]:I.LinkType.MODEL,[e.EXT_LINK]:I.LinkType.EXT_LINK}}toSdkLinkType(e){return this.toSdkLinkTypeMap[e]}}var Pa,Na,_a,ka,La;!function(){(Pa||(Pa={})).create=async function(t,n){const a=await t.getDependencies();return new e(n.create(...a))};class e{constructor(e){this.executor=e}validateInput(e,t){return this.executor.validateInput(e,t)}exec(e,t){const n=this.executor.validateInput(e,t);return this.executor.exec(n,t)}}}(),function(e){e.FILE_TOO_LARGE="oversize",e.EMPTY_FILE="empty",e.OVER_QUOTA="overQuota",e.UPLOAD_FAILED="failed",e.PERMISSION_DENIED="permission"}(Na||(Na={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(_a||(_a={})),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(ka||(ka={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload",e.SANDBOX="sandbox"}(La||(La={}));const Va=new Xt("expiring-resource"),Fa=new WeakMap;class Ua{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){if(!e)return;this.value=e.value,this.validUntil=e.validUntil;const t=Fa.get(this);t&&(t.resolve(),Fa.delete(this))}async get(){if(this.validUntil&&this.onStale){const e=Date.now();if(e+6e4+1e4>this.validUntil.getTime()){let t=Fa.get(this);t||(t=new Zt,Fa.set(this,t),this.onStale()),e+6e4+1e3>this.validUntil.getTime()&&(Va.info("Stale resource, waiting for refresh"),await t.nativePromise(),Va.info("Refreshed resource"))}}return this.value}getCurrentValue(){return this.value}}function Ga(e=11,t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"){let n="";const a=window.crypto||window.msCrypto;let o;o=a?a.getRandomValues(new Uint8Array(e)):new Uint8Array(e).map((()=>255*Math.random()));for(let a=0;a<e;a++)n+=t.charAt(o[a]%t.length);return n}var Ha,Ba;!function(e){e.PHOTO="photo",e.VIDEO="video",e.LINK="link",e.RICH="rich"}(Ha||(Ha={})),function(e){e.IMAGE="tag.attachment.image",e.RICH="tag.attachment.rich",e.VIDEO="tag.attachment.video"}(Ba||(Ba={}));class za{constructor(e,t,n,a){this.attachmentsModule=t,this.pluginConfigData=a,this.globalAttachments=new Map,this.perClientAttachments=new Map,this.clientAttachments=new Map,this.clientIds=new Set,this.attachmentDescriptors=new Map,this.attachmentsToRefresh=new Map,this.refreshTimeout=0,this.shouldRefresh=!1,this.observable=new H,this.oEmbed=n;for(const t of e.getTagList()){const n=e.getTag(t);for(const e of n.fileAttachments)this.globalAttachments.set(e.id,e),this.attachmentsToRefresh.set(e.id,e);for(const e of n.externalAttachments)this.globalAttachments.set(e.id,e),this.setDescriptorUrl(e,e.src)}null==a||a.getMdsResult().then((e=>e.flatMap((e=>e.attachments)))).then((e=>{e.forEach((e=>{this.globalAttachments.set(e.id,e),this.attachmentsToRefresh.set(e.id,e)}))}))}async refresh(){const e=await this.attachmentsModule.getAllAttachments();for(const t of e)this.globalAttachments.has(t.id)||(this.globalAttachments.set(t.id,t),this.attachmentsToRefresh.set(t.id,t));if(this.pluginConfigData){(await this.pluginConfigData.getMdsResult()).flatMap((e=>e.attachments)).forEach((e=>{this.globalAttachments.set(e.id,e),this.attachmentsToRefresh.set(e.id,e)}))}this.refreshNextExpiringAttachment()}get(e,t){return this.globalAttachments.get(t)||this.clientAttachments.get(t)}add(e,t){const n=this.createIAttachment({src:t.src,type:t.type});return this.clientAttachments.set(n.id,n),this.setDescriptorUrl(n,t.src),this.clientIds.add(n.id),this.observable.notify(),n.id}async addBySrc(e,t){const n=await this.createOEmbedIAttachment(t);return this.clientAttachments.set(n.id,n),this.setDescriptorUrl(n,t),this.clientIds.add(n.id),this.observable.notify(),n.id}addSandbox(e,t){const n=this.getUniqueId(),a=t.name||"sandbox-"+n,o={id:n,src:a,srcDoc:t.srcDoc,onLoad:t.sandboxLoadedHandler,category:La.SANDBOX,mediaType:ka.RICH,parentType:an.MATTERTAG,thumbnailUrl:new Ua("",null),downloadUrl:new Ua("",null),url:new Ua("",null),created:new Date,height:t.size.h,width:t.size.w};return this.clientAttachments.set(n,o),this.setDescriptorUrl(o,a),this.clientIds.add(n),this.observable.notify(),[n,o]}has(e){return this.globalAttachments.has(e)||this.clientIds.has(e)}*[Symbol.iterator](e){for(const e of this.globalAttachments)yield e;for(const e of this.clientAttachments)yield e;if(e){const t=this.perClientAttachments.get(e)||[];for(const e of t)yield e}}*descriptors(){for(const e of this.attachmentDescriptors)yield e}onChanged(e){return this.shouldRefresh=!0,this.refreshNextExpiringAttachment(),this.observable.observe(e)}getUniqueId(){const e=Ga(10);return this.globalAttachments.has(e)||this.clientIds.has(e)?this.getUniqueId():e}async refreshNextExpiringAttachment(){if(!this.shouldRefresh)return;const e=Array.from(this.attachmentsToRefresh.values()).reduce(((e,t)=>e&&e.url.validUntil?t.url.validUntil&&t.url.validUntil<e.url.validUntil?t:e:t),null);if(!e)return;for(const[,e]of this.attachmentsToRefresh)this.setDescriptorUrl(e,await e.url.get());const t=e.url;if(t.validUntil){const n=t.validUntil.getTime()-Date.now();if(n<=0){const n=await t.get();this.setDescriptorUrl(e,n);for(const e of this.attachmentsToRefresh.values())this.setDescriptorUrl(e,e.url.getCurrentValue());this.observable.notify(),this.refreshTimeout=0}else this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=window.setTimeout((()=>this.refreshNextExpiringAttachment()),n)}}setDescriptorUrl(e,t){this.attachmentDescriptors.set(e.id,{id:e.id,src:t,type:this.getAttachmentType(e.mediaType)})}getAttachmentType(e){return{[ka.APPLICATION]:O.AttachmentType.APPLICATION,[ka.AUDIO]:O.AttachmentType.AUDIO,[ka.IMAGE]:O.AttachmentType.IMAGE,[ka.MODEL]:O.AttachmentType.MODEL,[ka.PDF]:O.AttachmentType.PDF,[ka.RICH]:O.AttachmentType.RICH,[ka.TEXT]:O.AttachmentType.TEXT,[ka.VIDEO]:O.AttachmentType.VIDEO,[ka.ZIP]:O.AttachmentType.ZIP}[e]}createIAttachment(e){const t={[Ba.IMAGE]:ka.IMAGE,[Ba.RICH]:ka.RICH,[Ba.VIDEO]:ka.VIDEO};return{id:this.getUniqueId(),mediaType:t[e.type],category:La.EXTERNAL,src:e.src,parentType:an.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Ua("",null),downloadUrl:new Ua("",null),url:new Ua("",null),mimeType:""}}async createOEmbedIAttachment(e){const t={[Ha.PHOTO]:ka.IMAGE,[Ha.RICH]:ka.RICH,[Ha.VIDEO]:ka.VIDEO},n=this.getUniqueId(),a=t[(await this.oEmbed.getOEmbedData(e)).type];if(!a)throw Error("unable to determine media type");return{id:n,mediaType:a,category:La.EXTERNAL,src:e,parentType:an.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Ua("",null),downloadUrl:new Ua("",null),url:new Ua("",null),mimeType:""}}}const $a={[I.MediaType.PHOTO]:Ba.IMAGE,[I.MediaType.RICH]:Ba.RICH,[I.MediaType.VIDEO]:Ba.VIDEO};class ja{constructor(e,t,n,a){this.tagAdd=e,this.tagEditIcon=t,this.tagAttach=n,this.attachmentRegistry=a}validateInput(e,t){return{descriptors:this.tagAdd.validateInput({descriptors:Array.isArray(e.descriptors)?e.descriptors:[e.descriptors]},t).descriptors}}async exec(e,t){const n=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors],a=new Map;for(const e of n)if(e.media&&e.media.type!==I.MediaType.NONE){const n=this.attachmentRegistry.add(t.client.applicationKey,{src:e.media.src,type:$a[e.media.type]});a.set(e.media.src,n)}const o=async e=>{for(let a=0;a<e.length;++a){const o=n[a];o.iconId&&await this.tagEditIcon.exec({id:e[a],iconId:o.iconId},t)}},s=async e=>{for(let o=0;o<e.length;++o){const s=n[o];if(s.media&&s.media.type!==I.MediaType.NONE){const n=a.get(s.media.src);n&&this.tagAttach.exec({tagId:e[o],attachmentIds:[n]},t)}}};return this.tagAdd.exec({descriptors:n},t).then((async e=>(await o(e),await s(e),e)))}}function qa(e,t,n){return(n=n||{}).x=e[t].x,n.y=e[t].y,n.z=e[t].z,n}function Wa(e,t,n){return(n=n||{}).r=e[t].r,n.g=e[t].g,n.b=e[t].b,n}class Ka{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Ya{constructor(e,t,n,a){this.mattertagData=t,this.floorsData=n,this.floorIdMap=a,this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!ue(this.data[t],e.data[t])}update(){for(const e of this.mattertagData.getTagList()){const t=this.mattertagData.getTag(e),n=this.floorsData.getFloor(t.floorId),a=this.data[t.sid]||{};a.sid=t.sid,a.enabled=t.enabled,a.anchorPosition=qa(t,"anchorPosition",a.anchorPosition),a.stemVector=qa(t,"stemVector",a.stemVector),a.stemVisible=t.stemVisible,a.label=t.label,a.description=t.description,a.media=this.getMedia(t,a.media),a.color=Wa(t,"color",a.color),a.floorIndex=n?n.index:-1,a.floorInfo=a.floorInfo||{},a.floorInfo.id=this.floorIdMap.getIdFromCwfId(n.id),a.floorInfo.sequence=n.index,this._data[t.sid]=a}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}getMedia(e,t){const n=e.externalAttachments.get(0),a=n?this.mediaConverter.toSdkMedia(n.mediaType):I.MediaType.NONE,o=n&&a!==I.MediaType.NONE?n.src:"";return(t=t||{}).src=o,t.type=a,t}}class Xa{constructor(e,t,n){this.tagEditBillboard=t,this.tagAttach=n,[this.mattertagData,this.attachmentRegistry]=e}validateInput(e,t){if(!ya(e.properties))throw Error("Mattertag.editBillboard: editable properties is not an object");const n=Z(this.tagEditBillboard,e,t),a=e.properties.media;if(a){if(!ya(a)||!wn(I.MediaType,a.type))throw Error("Mattertag.editBillboard: media was not a valid media descriptor");if(a.type!==I.MediaType.NONE){if(!ee(a.src))throw Error(`Mattertag.editBillboard: media was of type "${a.type}" but has no src value`);return{id:n.id,properties:Object.assign(Object.assign({},n.properties),{media:{src:a.src,type:a.type}})}}n.properties.media={src:"",type:I.MediaType.NONE}}return n}async exec(e,t){const n=this.mattertagData.getTag(e.id),a=(()=>{if(e.properties.media&&e.properties.media.type!==I.MediaType.NONE)return this.attachmentRegistry.add(t.client.applicationKey,{src:e.properties.media.src,type:$a[e.properties.media.type]})})(),o=this.mattertagData;return Q(this.tagEditBillboard,e,t).then((()=>{e.properties.media&&(n.fileAttachments.replace([]),n.externalAttachments.replace([])),a&&Q(this.tagAttach,{tagId:n.sid,attachmentIds:[a]},t),o.commit()}))}}function Za(e,t,n){function a(e){if(!e)return;return{label:e.label,type:n.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const o=[];for(const n of e)o.push({type:t.toSdkChunkType(n.type),link:a(n.link),text:n.text});return o}class Qa{constructor(e,t,n,a){this.commands=e,this.tagData=t,this.floorData=n,this.floorIdMap=a}validateInput(e,t){return e}async exec(e,t){return function(e,t,n,a){const o=[];return e.iterate((e=>{const{id:s,index:r}=t.getFloor(e.floorId),i=n.getIdFromCwfId(s),c=e.externalAttachments.get(0),d=c?a.mediaConverter.toSdkMedia(c.mediaType):I.MediaType.NONE,l=c&&d!==I.MediaType.NONE?c.src:"";o.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:Za(e.parsedDescription,a.chunkTypeConverter,a.linkTypeConverter),mediaSrc:l,mediaType:d,media:{type:d,src:l},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:r,floorIndex:r,floorInfo:{id:i,sequence:r},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),o}(this.tagData,this.floorData,this.floorIdMap,this.commands)}}class Ja extends En{constructor(e){super("Expected tagId parameter to be of type string; got "+(Array.isArray(e)?"Array":typeof e))}}class eo{constructor(e,t,n){this.mattertagsData=e,this.attachmentRegistry=t,this.registerSandbox=n}validateInput(e,t){var n,a;if(!ee(e.tagId)||!this.mattertagsData.getTag(e.tagId))throw new Ja(e.tagId);const o=e.options||{};return"string"==typeof(null===(n=o.size)||void 0===n?void 0:n.w)&&(o.size.w=parseInt(o.size.w,10)),"string"==typeof(null===(a=o.size)||void 0===a?void 0:a.h)&&(o.size.h=parseInt(o.size.h,10)),Object.assign(Object.assign({},this.registerSandbox.validateInput(Object.assign(Object.assign({},e),{options:o}),t)),{tagId:e.tagId})}async exec(e,t){const{clientId:n,html:a,options:o,tagId:s}=e,{sandboxId:r,attachmentId:i}=await this.registerSandbox.exec({clientId:n,html:a,options:o},t),c=this.attachmentRegistry.get(t.client.applicationKey,i);return c&&function(e){return"onLoad"in e}(c)&&this.mattertagsData.getTag(s).sandboxAttachments.replace([c]),{sandboxId:r,attachmentId:i}}}class to{constructor(e){this.tagRemove=e}validateInput(e,t){return{ids:Z(this.tagRemove,{ids:Array.isArray(e.ids)?e.ids:[e.ids]},t).ids}}async exec(e,t){return Q(this.tagRemove,{ids:Array.isArray(e.ids)?e.ids:[e.ids]},t)}}class no{constructor(e,t,n,a,o,s){this.FocusOnPinInsideCommand=e,this.OpenTagCommand=t,this.issueCommand=n,this.mattertagData=a,this.tagsViewData=o,this.annotationsViewData=s}validateInput(e,t){if(!ee(e.id)||!this.mattertagData.getTag(e.id))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.transitionType&&!wn(I.Transition,e.transitionType))throw Error(`${e.transitionType} does not match valid transition type`);return{id:e.id,transitionType:e.transitionType,force:!!e.force}}async exec(e,t){const n=this.mattertagData.getTag(e.id);let a=new k(Nn).fromSdkTransition(e.transitionType);return void 0===a&&(a=Nn.Interpolate),(this.tagsViewData.getCapabilities(e.id).focus||e.force)&&(await this.issueCommand(new this.FocusOnPinInsideCommand({pinPosition:Object.assign(Object.assign({},n),{stemLength:n.stemHeight,stemNormal:n.stemVector}),transition:a})),(this.annotationsViewData.getCapabilities(e.id).preview||e.force)&&await this.issueCommand(new this.OpenTagCommand(e.id))),e.id}}class ao{constructor(e,t){this.tagAllowAction=e,this.annotationsViewData=t}validateInput(e,t){const n=Z(this.tagAllowAction,{id:e.tagId,allow:{}},t),a={navigating:!1,opening:!1};return ya(e.prevent)&&(a.navigating=!!e.prevent.navigating,a.opening=!!e.prevent.opening),{tagId:n.id,prevent:a}}exec(e,t){const n=this.annotationsViewData.getCapabilities(e.tagId);return Q(this.tagAllowAction,{id:e.tagId,allow:{navigating:!e.prevent.navigating,opening:!e.prevent.opening,docking:n.dock}},t)}}function oo(e,t,n,a,o,s){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:I.DescriptionChunkType}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:I.Event}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:I.LinkType}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:I.MediaType}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:I.Transition});const r=Object.assign(Object.assign({},n),{mediaConverter:new so(t.MediaType)}),[i,c,d,l,u,h]=s;!function(e,t,n){const a=["",!1],o=e=>(a[0]=e.id,a[1]=e.hovering,a);n.subscribe(t.PinHoverChangeMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(I.Event.HOVER,o,n)}));const s=[""],r=e=>(s[0]=e.id,s);n.subscribe(t.PinClickedMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(I.Event.CLICK,r,n)}))}(e,t,n),function(e,t,n,a){a.getDependencies().then((([a])=>{const o=["",""],s=e=>{var t;return o[0]=(null===(t=a.billboardAnnotation)||void 0===t?void 0:t.id)||"",o[1]=e.url,o};n.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast(I.Event.LINK_OPEN,s,t)}))}))}(e,t,n,new B(d));const p=function(e,t,n){const a=Pa.create(new B(t.add,t.editIcon,t.attach,n),new z(ja));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"add",args:["descriptors"],options:{replay:!0,deprecated:"Tag.add"}},a),a}(e,o,h),m=function(e,t,n){const a=oa.create(n,new Ka,new z(Ya,t));return e.addCollectionToInterface({namespace:"Mattertag",name:"data"},a),a}(e,r,new B(i,l,u)),g=function(e,t,n){const a=Y.create(new B(n.getDependencies(),t.editBillboard,t.attach),new z(Xa));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editBillboard",args:["id","properties"],options:{replay:!0,deprecated:"`Tag.editBillboard`, or `Tag.registerAttachment` and `Tag.attach` for media"}},a),a}(e,o,new B(i,h)),f=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editColor",args:["id","color"],options:{replay:!0,deprecated:"Tag.editColor"}},t),t}(e,o.editColor),w=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editIcon",args:["id","iconId"],options:{replay:!0,deprecated:"Tag.editIcon"}},t),t}(e,o.editIcon),y=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["id","opacity"],options:{replay:!0,deprecated:"Tag.editOpacity"}},t),t}(e,o.editOpacity),v=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editPosition",args:["id","options"],options:{replay:!0,deprecated:"Tag.editPosition"}},t),t}(e,o.editPosition),T=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editStem",args:["id","stemParams"],options:{replay:!0,deprecated:"Tag.editStem"}},t),t}(e,o.editStem);!function(e,t,n){const a=Y.create(n,new z(Qa,t));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"getData",args:[],options:{deprecated:"Tag.data"}},a)}(e,r,new B(i,l,u));const b=function(e,t,n){const a=Pa.create(B.extend(n,t.registerSandbox),new z(eo));return e.addCommandToInterface({namespace:"Mattertag",name:"injectHTML",subRoutine:"mattertag.inject",args:["tagId","html","options"],options:{replay:!0,deprecated:"Tag.registerSandbox and Tag.attaach"}},a),a}(e,o,new B(i,h));!function(e,t,n,a){const o=Y.create(a,new z(no,t.FocusOnPinInsideCommand,t.OpenTagCommand,n.issueCommand));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"navigateToTag",args:["id","transitionType","force"]},o)}(e,t,n,new B(i,c,d));const E=function(e,t){const n=Y.create(t,new z(ao));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["tagId","prevent"],options:{replay:!0,deprecated:"Tag.allowAction"}},n),n}(e,new B(o.allowAction,d));!function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"registerIcon",args:["textureId","textureSrc"],options:{deprecated:"Asset.registerTexture"}},t)}(e,a.registerTexture);const C=function(e,t){const n=Y.create(new B(t),new z(to));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"remove",args:["ids"],options:{replay:!0,deprecated:"Tag.remove"}},n),n}(e,o.remove),S=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"resetIcon",args:["id"],options:{replay:!0,deprecated:"Tag.resetIcon"}},t),t}(e,o.resetIcon);return{data:m,add:p,editBillboard:g,editColor:f,editIcon:w,editOpacity:y,editPosition:v,editStem:T,inject:b,preventAction:E,remove:C,resetIcon:S}}class so{constructor(e){this.toSdkMediaMap={[e.IMAGE]:I.MediaType.PHOTO,[e.VIDEO]:I.MediaType.VIDEO,[e.RICH]:I.MediaType.RICH,[e.APPLICATION]:I.MediaType.NONE,[e.AUDIO]:I.MediaType.NONE,[e.MODEL]:I.MediaType.NONE,[e.PDF]:I.MediaType.NONE,[e.TEXT]:I.MediaType.NONE,[e.ZIP]:I.MediaType.NONE}}toSdkMedia(e){return this.toSdkMediaMap[e]}}class ro extends me{}ro.id="MEASUREMENTS_GET";const io=async(e,t)=>{const n=[];for(const a of e.groups()){const e=a.info,o=t.getFloor(e.floorId);for(let t=1;t<a.count;t++){const s=a.get(t-1),r=a.get(t);n.push({sid:e.sid,label:e.text,floor:o.index,start:{x:s.x,y:s.y,z:s.z},end:{x:r.x,y:r.y,z:r.z}})}}return n};class co{constructor(e){this.CwfMeasuringPhase=e}create(e,t){let n=t.groupCount,a=t.phase;const o=()=>{const o=t.groupCount,s=t.phase;n===o&&a!==this.CwfMeasuringPhase.EDITING||s!==this.CwfMeasuringPhase.IDLE||(e.onChanged(),n=o),a=s};return new kt(t.onPhaseChanged(o),t.onSelectedGroupIndexChanged(o))}}class lo{constructor(e){this.measurementModeData=e,this.data={}}update(){for(const e of this.measurementModeData.groups())this.createMeasurement(e);for(const e in this.data){this.measurementModeData.getGroupInfoBySid(e)||delete this.data[e]}}isItemEqual(e,t){return!ue(this.data[t],e.data[t])}clear(){this.data={}}createMeasurement(e){const t=e.info.sid,n=this.data[t]||{},a=n.points||[];n.label=e.info.text,n.segmentLengths=e.segmentLengths,n.totalLength=e.length,function(e,t){let n=0;for(const a of t){const t=e[n]||{};t.x=a.x,t.y=a.y,t.z=a.z,e[n]=t,++n}e.length=n}(a,e),n.sid=t,n.points=a,this.data[t]=n}}class uo{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ho{constructor(){this._data={active:!1}}get data(){return this._data}equals(e){return this._data.active===e.data.active}copy(e){this._data.active=e.data.active}update(e){this._data.active=e.modeActive()}}(class extends me{constructor(e){super(),this.payload={collapse:e}}}).id="TOOL_PANEL_TOGGLE_COLLAPSE";(class extends me{constructor(e){super(),this.payload={collapse:e}}}).id="TOOL_BOTTOM_PANEL_COLLAPSE";class po extends me{constructor(e,t){super(),this.payload={toolName:e,active:t}}}po.id="TOGGLE_TOOL";(class extends me{constructor(e){super(),this.payload={checkForEdits:e}}}).id="CLOSE_REMOVE_TOOLS";(class extends me{constructor(e){super(),this.payload={tools:e}}}).id="REGISTER_TOOLS";(class extends me{}).id="OPEN_PREVIOUS_TOOL";(class extends me{}).id="OPEN_INITIAL_TOOL";(class extends me{constructor(e,t=!1){super(),this.payload={toolName:e,softOpening:t}}}).id="OPEN_TOOL";(class extends me{}).id="CLOSE_CURRENT_TOOL";(class extends me{constructor(e){super(),this.payload={toolName:e}}}).id="CLOSE_TOOL";class mo{constructor(e,t){this.toolType=e,this.issueCommand=t}validateInput(e){const t=e.active;if(!va(t))throw Error(X("active","boolean",t));return{active:t}}async exec(e){await this.issueCommand(new po(this.toolType.MEASUREMENTS,e.active))}}class go extends En{constructor(e="Unhandled Transition Exception"){super(e),this.name="TransitionException"}}class fo extends go{constructor(e="Unhandled Viewmode Exception",t){super(e),this.originalError=t,this.name="ViewmodeException"}}class wo extends fo{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}function yo(e){return"number"==typeof e&&!isNaN(e)}function vo(e){return e-0}function To(e,t,n){return Math.max(t,Math.min(e,n))}function Io(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return yo(t.x)&&yo(t.y)&&yo(t.z)}return!1}const bo=new Xt("move-to-mode-command");class Eo extends me{constructor(e){super(),this.payload=e}}Eo.id="MOVE_TO_MODE";class Co{constructor(e,t,n,a){this.THREE=e,this.viewmodeConverter=t,this.conversion=n,this.transitionTypeConverter=a}validateMoveToModeInput(e){if(!e)throw Error("Mode.moveTo -> no arguments provided -- mode is required");e.options||(e.options={});const t=e.mode;if(!wn(b.Mode,e.mode))throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);if(t===b.Mode.TRANSITIONING)throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);e.options&&e.options.rotation&&(e.options.rotation.z=e.options.rotation.z||0);const n=this.validatePayloadOptions(e.options);return{mode:this.viewmodeConverter.fromSdk(t),options:{transition:n.transition,position:n.position,rotation:n.rotation,zoom:n.zoom}}}validatePayloadOptions(e){let t,n,a,o;if(e){if(e.transition&&(a=this.transitionTypeConverter.fromSdkTransition(e.transition),void 0===a))throw Error(`Mode.moveTo -> ${e.transition} is not a valid transition style`);e.rotation&&Io(e.rotation)&&(t=this.conversion.rotationToQuaternion(e.rotation)),e.position&&Io(e.position)&&(n=new this.THREE.Vector3(parseFloat(e.position.x),parseFloat(e.position.y),parseFloat(e.position.z))),e.zoom&&!isNaN(e.zoom)&&(o=e.zoom)}return{rotation:t,position:n,transition:a,zoom:o}}}class So{create(e,t,n,a){const o=()=>e.onChanged();return new kt(a.pose.isPitchFactorOrthoObservable.onChanged(o),n.onChanged(o),t.onChanged(o))}}class Ao{constructor(e,t){this._data=b.Mode.INSIDE,this.viewmodeConverter=t.viewmodeConverter}get data(){return this._data}equals(e){return this._data===e.data}copy(e){this._data=e.data}update(e,t,n){const a=t.state.currentSweep&&t.isSweepAligned(t.state.currentSweep);this._data=this.viewmodeConverter.toSdk(e.currentMode,!!a,n.pose.isPitchFactorOrtho)}}class Oo extends me{}function Do(e,t,n){t.addBinding(Oo,(async()=>{const e=await n.getDependencies();return await async function(e,n,a,o){const s={sid:"",sweeps:[],modelSupportsVr:!1};try{const r=n.getSweepList(),i=e.model;return await t.makeModelData(i.sid,i.options.isVR,r,a,o,s),s}catch(e){throw Error("no model currently loaded")}}(...e)})),e.addCommandCreator({namespace:"Model",name:"getData",args:[]},(()=>new Oo))}Oo.id="GET_MODEL_DATA";class Mo extends me{}function Ro(e,t,n,a){a.getDependencies().then((e=>n.addBinding(Mo,(async()=>function(e,n){function a(e,t){if(n.tryGetSetting(e,!0))return t}const o=e.model;return{sid:o.sid,name:a(t.OptionsKey.DetailsModelName,o.details.name),presentedBy:a(t.OptionsKey.PresentedBy,o.details.presentedBy),summary:a(t.OptionsKey.DetailsSummary,o.details.summary),defaultViewId:a(t.OptionsKey.DetailsSummary,o.details.defaultViewId),description:a(t.OptionsKey.DetailsSummary,o.details.description),formattedAddress:a(t.OptionsKey.DetailsAddress,o.details.formattedAddress),contactEmail:a(t.OptionsKey.DetailsEmail,o.details.contact.email),contactName:a(t.OptionsKey.DetailsName,o.details.contact.name),phone:a(t.OptionsKey.DetailsPhone,o.details.contact.phone),formattedContactPhone:a(t.OptionsKey.DetailsPhone,o.details.contact.formattedPhone),externalUrl:a(t.OptionsKey.DetailsExternalUrl,o.details.externalUrl)}}(...e))))),e.addCommandCreator({namespace:"Model",name:"getDetails",args:[]},(()=>new Mo))}Mo.id="GET_MODEL_DETAILS";const xo=e=>null!==e.position?{x:e.position.x,y:e.position.y,z:e.position.z}:null;function Po(e,t){return async function(n,a,o,s,r,i){i.sweeps=[];for(const n of o){const a=n.floorId?s.getFloor(n.floorId).index:-1;i.sweeps.push({uuid:r.getIdForSweep(n),sid:r.getIdForSweep(n),alignmentType:t.toSdkAlignment(n.alignmentType),placementType:t.toSdkPlacement(n.placementType),neighbors:await Promise.all(n.neighbours.map((async e=>await r.getIdFromCwfId(e)))),position:xo(n),rotation:e.quaternionToRotation(n.rotation),floor:a})}return i.sid=n,i.modelSupportsVr=a,i}}const No={namespace:"OAuth",name:"updateToken",args:["token"]};class _o{constructor(e){this.tokenUpdater=e}validateInput(e){const{token:t}=e;if(!ee(t))throw Error();return{token:t}}async exec(e,t){this.tokenUpdater.setToken(e.token)}}var ko,Lo,Vo;!function(e){e[e.None=0]="None",e[e.AnonymousFetch=1]="AnonymousFetch",e[e.UserFetch=2]="UserFetch"}(ko||(ko={})),function(e){e[e.FetchAnonymous=1]="FetchAnonymous",e[e.FetchAsUser=2]="FetchAsUser",e[e.AnyFetch=3]="AnyFetch",e[e.LocalData=4]="LocalData",e[e.EarlyLoad=268435456]="EarlyLoad",e[e.DisableSES=2147483648]="DisableSES"}(Lo||(Lo={})),function(e){e[e.Locked=0]="Locked",e[e.Default=4]="Default",e[e.DefaultEarlyLoad=268435462]="DefaultEarlyLoad",e[e.Fetch=6]="Fetch",e[e.FetchEarlyLoad=268435462]="FetchEarlyLoad",e[e.OpenEnvironment=4294967295]="OpenEnvironment"}(Vo||(Vo={}));const Fo=["$fetchLevel","$canPlaceInGrid"];class Uo{constructor(e){this.pluginRegistry=e}validateInput(e){if(!ya(e.key))throw Error(e.key+" is not a valid object");const t=e.key;if(!te(t.applicationKey))throw Error(t.applicationKey+" is not a valid string");if(!te(t.id))throw Error(t.id+"is not a valid string");if(!te(e.path))throw Error(e.path+" is not a valid string");return e}async exec(e){var t,n,a;let o=ko.AnonymousFetch,s=!1;void 0!==(null===(t=e.config)||void 0===t?void 0:t.$fetchLevel)?o=To(e.config.$fetchLevel&Lo.AnyFetch,ko.None,ko.UserFetch):void 0!==(null===(n=e.config)||void 0===n?void 0:n.$canPlaceInGrid)&&(s=e.config.$canPlaceInGrid);const r={};for(const t in e.config)Fo.includes(t)||(r[t]=e.config[t]);const i=Object.assign({},null===(a=e.metadata)||void 0===a?void 0:a.peerDependencies);return this.pluginRegistry.load({applicationKey:e.key.applicationKey,id:e.key.id||"default",src:e.path,strict:!1,permissionLevel:o,canPlaceInGrid:s,config:r||{},peerDependencies:i})}}class Go{constructor(e){this.pluginRegistry=e}validateInput(e){if(!ya(e.key))throw Error(e.key+" is not a valid object");if(!te(e.key.applicationKey))throw Error(e.key+" is not a valid string");return e}async exec(e){return this.pluginRegistry.unload(e.key)}}class Ho{create(e,t,n){return new kt(t.onChanged((()=>e.onChanged())),n.onChanged((()=>e.onChanged())))}}class Bo{constructor(e,t){this.pluginData=e,this.pluginUIData=t,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.applicationKey===a.applicationKey&&n.id===a.id&&n.visibility===a.visibility}update(){var e;for(const[t,n]of this.pluginData.plugins.entries()){const{id:a,applicationKey:o}=n;this._data[t]={id:a,applicationKey:o,visibility:(null===(e=this.pluginUIData.visibilityData.get(a))||void 0===e?void 0:e.visible)?x.Visibility.ON:x.Visibility.OFF}}for(const e in this.data)this.pluginData.plugins.has(e)||delete this._data[e]}clear(){this._data={}}}class zo{create(e,t){return t.onChanged((()=>e.onChanged()))}}class $o{constructor(e,t){this.colliderTypes=t,this.ZERO=new e.Vector3(0,0,0),this.tempVec=new e.Vector3,this._data={position:{x:0,y:0,z:0},normal:{x:0,y:0,z:0},object:C.Colliders.NONE,floorId:void 0,floorIndex:void 0}}get data(){return this._data}equals(e){const t=1e-5,n=e.data.position,a=this._data.position,o=e.data.normal,s=this._data.normal;return Dn(n,a,t)&&Dn(o,s,t)&&e.data.object===this._data.object}update(e,t,n,a,o){const s=e.hit;s?(bn(this._data.position,s.point),bn(this._data.normal,s.face.normal),this._data.floorId=void 0,s.object instanceof this.colliderTypes.ModelColliderTarget?(this._data.object=C.Colliders.MODEL,this._data.floorId=function(e,t,n,a,o,s){let r;const i=o.floorIdFromObject(e.object);if(i)return r=t.getFloor(i),r.index;s.copy(e.point);const c=a.meshSubGroupsFromPoint(s);if(!c.length)return;const d=n.getByMeshSubgroup(c[0]);if(!d)return;return r=t.getFloor(d.floorId),r.index}(s,t,n,a,o,this.tempVec)):s.object instanceof this.colliderTypes.PinHeadMesh||s.object instanceof this.colliderTypes.InstancedPinHeads?this._data.object=C.Colliders.TAG:s.object instanceof this.colliderTypes.PuckCollider?this._data.object=C.Colliders.SWEEP:this._data.object=C.Colliders.UNKNOWN):(bn(this._data.position,this.ZERO),bn(this._data.normal,this.ZERO),this._data.object=C.Colliders.NONE,this._data.floorId=void 0),this._data.floorIndex=this._data.floorId}copy(e){bn(this._data.position,e.data.position),bn(this._data.normal,e.data.normal),this._data.object=e.data.object,this._data.floorId=e.data.floorId,this._data.floorIndex=e.data.floorIndex}}class jo{constructor(e,t){this.cursorController=e,this.textureAaps=t}validateInput(e){if(!ee(e.textureId))throw Error("textureId is not a valid string");return{textureId:e.textureId}}async exec(e,t){const{textureId:n}=e,a=this.textureAaps.get(t.client.applicationKey).map[n];this.cursorController.setTexture(a)}}class qo{constructor(e){this.cursorController=e}validateInput(e){return e}async exec(e,t){this.cursorController.setTexture(null)}}class Wo{constructor(e){this.cursorController=e}validateInput(e){(e=e||{}).props=e.props||{};const t=e.props;if(t.fadeIn){const e=t.fadeIn;if(e.duration&&(!yo(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeIn.duration was specified but was not a valid duration; got ${e.duration}`)}if(t.fadeOut){const e=t.fadeOut;if(e.duration&&(!yo(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeOut.duration was specified but was not a valid duration; got ${e.duration}`);if(e.delay&&(!yo(e.delay)||e.delay<=0))throw Error(`Pointer.setFadeProps: fadeOut.delay was specified but was not a valid delay; got ${e.delay}`)}return e}async exec(e,t){this.cursorController.setFadeProps(e.props)}}class Ko{constructor(e){this.cursorController=e,this.visible=!0,this.ruleAdded=!1}isVisible(){return this.visible}validateInput(e){if(!va(e.visible))throw Error(`Pointer.setVisible: visible was specified but was not a valid boolean; got ${e.visible}`);return e}async exec(e,t){this.ruleAdded||(this.isVisible=this.isVisible.bind(this),this.cursorController.addVisibilityRule(this.isVisible),this.ruleAdded=!0),this.visible=e.visible}}class Yo{constructor(e){this.r3fModule=e}validateInput(e){return e}async exec(e,t){return this.r3fModule.registerExternalR3F(e.callbacks)}}const Xo=new Xt("mpSdk.R3F.navigationToggle");class Zo{constructor(e){this.enabled=!0,this.userNavigationEnabled=()=>this.enabled,e.addNavigationRule(this.userNavigationEnabled.bind(this))}validateInput(e){return e}async exec(e,t){this.enabled=e.enabled,Xo.debug(e)}}class Qo{constructor(e,t,n,a,o){this.THREE=e,this.cwfTypes=t,this.commands=n,this.navigation=a,this.viewmodeData=o}validateInput(e){if(!e)throw Error('focus: no arguments provided -- "target" point|box is required');const t=e.target;if(!function(e){if(e&&"object"==typeof e&&"min"in e&&"max"in e){const t=e;if(Io(t.min)&&Io(t.max))return!0}return!1}(t)&&!Io(t))throw new Error('focus: invalid "target"');const n=e.options;if(n){const{from:e,mode:t,transition:a}=n;if(e&&!Io(e))throw new Error('focus: "options.from" must be a Vector3|undefined');if(t){if(void 0===this.commands.viewmodeConverter.fromSdk(t))throw Error(`focus: ${t} is not a valid "options.mode"`)}let o=this.cwfTypes.CameraTransitionType.Interpolate;if(a&&(o=this.commands.cameraTransitionConverter.fromSdkTransition(a),void 0===o))throw Error(`focus: ${a} is not a valid "options.transition"`)}return e}async exec(e,t){const n=e.target,a=this.convertOptions(e);try{await this.navigation.focus(n,a)}catch(e){console.warn("focus: unable to focus",e)}}convertOptions(e){var t,n,a,o;const s=null===(t=e.options)||void 0===t?void 0:t.mode,r=s?this.commands.viewmodeConverter.fromSdk(s):null!==(n=this.viewmodeData.currentMode)&&void 0!==n?n:void 0,i=null===(a=e.options)||void 0===a?void 0:a.from,c=i&&Io(i)?new this.THREE.Vector3(i.x,i.y,i.z):void 0,d=null===(o=e.options)||void 0===o?void 0:o.transition;return{from:c,mode:r,transition:d?this.commands.cameraTransitionConverter.fromSdkTransition(d):this.cwfTypes.CameraTransitionType.Interpolate}}}const Jo=new Xt("mpSdk.R3F.controlsToggle");class es{constructor(e){this.cameraModule=e,this.sub=null}validateInput(e){return e}async exec(e,t){Jo.debug(e),this.sub&&e.enabled&&(this.sub.cancel(),this.sub=null),this.sub||e.enabled||(this.sub=this.cameraModule.disableAllCameraControls())}}class ts{constructor(e){this.rendererModule=e}validateInput(e){return e}async exec(e,t){return this.rendererModule.getScene().scene}}class ns{constructor(e,t){this.captureCamera=e,this.encodeRenderTarget=t}async capture(e,t,n,a){const{camera:o,scene:s}=t.getScene();return o.getWorldPosition(this.captureCamera.position),o.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(o.projectionMatrix),this.captureCamera.layers.mask=e.visibleObjects.mask,a.setSize(e.resolution.width,e.resolution.height),n.render(a.target,s,this.captureCamera),await this.encodeRenderTarget(a)}}function as(e){return yo(e)&&e%1==0}const os=new Xt("command.takeScreenshot");var ss,rs;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(ss||(ss={}));class is{constructor(e,t,n,a,o,s){this.canvasData=a,this.rendererModule=o,this.renderToTexture=s,this.RenderLayers=t.RenderLayers,this.screenCapturer=e,this.requestTarget=n.requestTarget,this.getRenderLayer=n.getRenderLayer,this.jpegAsBase64=n.jpegAsBase64}validateInput(e){return{resolution:this.validateResolution(e.resolution,this.canvasData,this.rendererModule),visibleObjects:this.buildVisibilityOptions(e.visibleObjects),returnType:e.returnType===ss.ArrayBufferJPG?ss.ArrayBufferJPG:ss.Base64JPG}}async exec(e,t){const n=await this.requestTarget(),a=await this.screenCapturer.capture({resolution:e.resolution,visibleObjects:this.buildVisibilityLayers(e.visibleObjects)},this.rendererModule,this.renderToTexture,n);return e.returnType===ss.ArrayBufferJPG?a.buffer instanceof ArrayBuffer?a.buffer:new Uint8Array(a).buffer:this.jpegAsBase64(a)}validateResolution(e,t,n){const a={width:0,height:0};if(!e)return a.width=t.width,a.height=t.height,a;if(!function(e){const t=e;return!!t&&("number"==typeof t.width&&"number"==typeof t.height)}(e))throw Error('"resolution" provided was not valid. Expected .width and .height to be numbers.');a.width=e.width,a.height=e.height;const o=n.maxTextureSize;if(e.width<=0||e.width>o)throw Error('"resolution.width" provided was outside the valid range of [0, '+o+"]");if(e.height<=0||e.height>o)throw Error('"resolution.height" provided was outside the valid range of [0, '+o+"]");if(!as(a.width)){const e=Math.round(a.width);os.info(`Integer width expected. Rounding from ${a.width} to ${e}`),a.width=e}if(!as(a.height)){const e=Math.round(a.height);os.info(`Integer width expected. Rounding from ${a.height} to ${e}`),a.height=e}return a}buildVisibilityOptions(e){const t=e||{};return{measurements:!!t.measurements,mattertags:!!t.mattertags,sweeps:!!t.sweeps,views:!!t.views}}buildVisibilityLayers(e){const t=this.RenderLayers.ALL;return e.mattertags||t.removeLayers(this.getRenderLayer("pins")),e.measurements||t.removeLayers(this.getRenderLayer("measurements")),e.sweeps||t.removeLayers(this.getRenderLayer("sweep-pucks")),e.views||(t.removeLayers(this.getRenderLayer("sweep-portal-mesh")),t.removeLayers(this.getRenderLayer("sweep-pin-mesh"))),t}}class cs{constructor(e,t,n,a,o,s,r,i){this.renderer=a,this.renderToTexture=o,this.viewmodeData=s,this.sweepData=r,this.sweepTextureLoader=i,this.Viewmode=t.Viewmode,this.requestTarget=n.requestTarget,this.encodeRenderTarget=n.encodeRenderTarget,this.jpegAsBase64=n.jpegAsBase64,this.getXmp=n.getXmp,this.getOrientedAngleTo=n.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}async exec(e,t){if(!this.sweepData.state.currentSweep||this.viewmodeData.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const n=this.renderer.getScene().camera,a=this.sweepData.getSweep(this.sweepData.state.currentSweep),o=await this.sweepTextureLoader.load(a);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(a.rotation).setY(0);const s=this.getOrientedAngleTo(this.sweepForward,n.getWorldDirection(this.viewForward).setY(0))+Math.PI,r=await this.requestTarget();r.setSize(cs.equirectangularRes.width,cs.equirectangularRes.height),this.renderToTexture.renderEquirectangular(o,r.target,s);const i=await this.encodeRenderTarget(r,this.getXmp(r.width,r.height,0,0));return this.jpegAsBase64(i)}}cs.equirectangularRes={width:4096,height:2048};class ds{constructor(e,t){this.issueCommand=t.issueCommand,this.GetScreenPositionCommand=e.GetScreenPositionCommand}validateInput(e){if(!Io(e.worldPosition))throw Error(`Renderer.getScreenPosition: 'worldPosition' was specified but was not a valid Vector3; got ${e.worldPosition}`);return e}async exec(e,t){return await this.issueCommand(new this.GetScreenPositionCommand(e))}}class ls{constructor(e,t){this.floorsData=e,this.floorCaster=t}validateInput(e){if(!function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return yo(t.x)&&yo(t.y)}return!1}(e.screenPosition))throw Error(`Renderer.getWorldPositionData: 'screenPosition' was not a valid Vector2; got ${e.screenPosition}`);return e}async exec(e,t){const n=await this.floorCaster.getFloorIntersect(e.screenPosition,e.height,e.includeHiddenFloors),a=this.floorsData.getFloorAtIndex(n.floorIndex);return a?{position:n.position,floorInfo:{id:a.id,sequence:a.index},floor:n.floorIndex}:{position:n.position,floorInfo:{id:"",sequence:-1},floor:-1}}}function us(e,t,n,a,o,s,r){e.id=n.getIdFromCwfId(t.id),e.label=r&&r.hasRoom(t.id)?r.getRoomLabel(t.id,""):"",e.bounds=e.bounds||{},e.bounds.min=qa(a.boundingBox,"min",e.bounds.min),e.bounds.max=qa(a.boundingBox,"max",e.bounds.max),e.floorInfo=function(e,t,n,a){a=a||{};try{const o=t.getFloor(e);a.id=n.getIdFromCwfId(o.id),a.sequence=o.index}catch(e){a.id="",a.sequence=-1}return a}(t.floorId,o,s,e.floorInfo)}class hs{constructor(){this.wasTransitioning360=!1,this.cameraPosition={x:0,y:0,z:0}}create(e,t,n,a,o){return new kt(a.onChanged((()=>this.throttleCameraPositionChanges(e,a))),o.onChanged((()=>this.throttleSweepChanges(e,o))))}throttleCameraPositionChanges(e,t){const n=t.pose.position;n.x===this.cameraPosition.x&&n.y===this.cameraPosition.y&&n.z===this.cameraPosition.z||(this.cameraPosition.x=n.x,this.cameraPosition.y=n.y,this.cameraPosition.z=n.z,e.onChanged())}throttleSweepChanges(e,t){const n=t.state.transition;t.state.transition.active?(t.isSweepUnaligned(n.from)||t.isSweepUnaligned(n.to))&&(this.wasTransitioning360=!0):this.wasTransitioning360&&!t.isSweepUnaligned(t.state.currentSweep)&&(e.onChanged(),this.wasTransitioning360=!1)}}class ps{constructor(){this.currentRooms={rooms:[]}}get data(){return this.currentRooms}equals(e){return this.data.rooms.length===e.data.rooms.length&&this.currentRooms.rooms.every((t=>e.data.rooms.findIndex((e=>e.id===t.id))>-1))}copy(e){this.currentRooms.rooms.length=e.data.rooms.length,Cn(this.currentRooms.rooms,e.data.rooms)}update(e,t,n,a,o,s,r,i,c){if(o.isInside()&&a.isSweepUnaligned(a.state.currentSweep)||a.state.transition.active&&(a.isSweepUnaligned(a.state.transition.to)||a.isSweepUnaligned(a.state.transition.from)))return void(this.currentRooms.rooms.length=0);const d=s.meshSubGroupsFromPoint(n.pose.position);this.currentRooms.rooms.length=0;for(let n=0;n<d.length;++n){const a=d[n],o=e.getByMeshSubgroup(a),l=s.meshGroups.rooms.get(a);if(!o||!l)continue;const u=this.currentRooms.rooms[n]||{};us(u,o,r,l,t,i,c.get()),this.currentRooms.rooms.push(u)}}}class ms{constructor(){}create(e,t){return{renew(){},cancel(){}}}}class gs{constructor(e,t,n,a,o,s){this.roomData=e,this.floorData=t,this.roomIdMap=n,this.floorIdMap=a,this.meshData=o,this.roomBoundData=s,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.id===a.id&&Dn(n.bounds.min,a.bounds.min)&&Dn(n.bounds.max,a.bounds.max)}update(){for(const e of this.roomData.rooms()){const t=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(!t)continue;const n=this.roomIdMap.getIdFromCwfId(e.id),a=this._data[n]||{};us(a,e,this.roomIdMap,t,this.floorData,this.floorIdMap,this.roomBoundData.get()),this._data[n]=a}for(const e in this.data){this.roomIdMap.getRoomForId(e)||delete this._data[e]}}clear(){this._data={}}}class fs{constructor(e,t){this.RoomData=e,this.FloorsData=t}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.RoomData.getRoomIdMap(this.FloorsData,e.invert)}}class ws{constructor(e){this.roomBoundViewData=e}validateInput(e){return{visible:!!e.visible}}async exec(e){await this.roomBoundViewData.forceRoomDimensionVisibility(e.visible)}}!function(e){e.OUTPUT="output",e.INPUT="input",e.EVENT="event",e.EMIT="emit"}(rs||(rs={}));class ys{constructor(e){this.sceneModule=e}validateInput(e){if(!ee(e.name))throw Error(`Scene.register name ${e.name} is not a string`);if(!e.factory||"function"!=typeof e.factory)throw Error("Scene.register factory is not a function");return e}async exec(e,t){if(this.sceneModule.registerFactory({scope:t.client.applicationKey,name:e.name},e.factory))return{dispose:()=>{this.sceneModule.unregisterFactory(e.name,e.factory)}};throw Error("There was an error registering the scene component")}}class vs{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.createNode(t.client.applicationKey,{owner:t.client.id}).publicFacade()}}class Ts extends me{constructor(e){super(),this.payload=e}}Ts.id="SCENE_QUERY";class Is extends me{constructor(e){super(),this.payload=e}}Is.id="SCENE_CONFIGURE";class bs extends me{constructor(e){super(),this.payload=e}}bs.id="SCENE_GETIMAGE";(class extends me{constructor(e){super(),this.payload=e}}).id="SCENE_EXPORT";class Es{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.deserialize(t.client.applicationKey,e.text,t.client.id).object}}const Cs=new Xt("serialize");class Ss{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){Array.isArray(e.objects)&&Cs.warn("Serializing an array of ISceneNodes is deprecated and may produce an unexpected result.                Serialization of the ISceneObject container should be done instead.");return Array.isArray(e.objects)?this.sceneModule.serializeNodeList(e.objects):this.sceneModule.serialize(e.objects)}}class As{constructor(e){this.sceneModule=e}validateInput(e){if(!yo(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const n=[];for(let a=0;a<e.count;a++){const e=this.sceneModule.createNode(t.client.applicationKey,{owner:t.client.id});n.push(e.publicFacade())}return n}}class Os{constructor(e){this.sceneModule=e}validateInput(e){if(!Oa(e.components,ya))throw Error("Scene.registerComponents array elements must be objects");for(const t of e.components){if(!ee(t.name))throw Error(`Scene.registerComponents name ${t.name} is not a string`);if(!t.factory||"function"!=typeof t.factory)throw Error("Scene.registerComponents factory is not a function")}return e}async exec(e,t){const n=[];for(const a of e.components){if(!this.sceneModule.registerFactory({scope:t.client.applicationKey,name:a.name},a.factory))throw Error("There was an error registering a scene component");{const e=this.sceneModule,t=function(t,n){return{dispose:function(){e.unregisterFactory(t,n)}}}(a.name,a.factory);n.push(t)}}return n}}class Ds{constructor(e){this.sceneModule=e}validateInput(e){if(!yo(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const n=[];for(let a=0;a<e.count;a++)n.push(this.sceneModule.createObject(t.client.applicationKey,{owner:t.client.id}).publicFacade());return n}}(class extends me{constructor(e){super(),this.payload=e}}).id="SCENE_UNREGISTER_COMPONENTS";class Ms{constructor(e){this.sceneModule=e}validateInput(e){if(e=e||{},!Array.isArray(e.components))throw Error("components must be an array");return e.components=e.components||[],e}async exec(e){for(const t of e.components)this.sceneModule.unregisterFactory(t.name,t.factory)}}class Rs{constructor(e,t){this.sensorModule=e,this.sensorMap=t}validateInput(e){if(!ee(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!va(e.show))throw Error(`Sensor.showDebug: 'show' was not a boolean; got ${e.show}`);return{sensorId:e.sensorId,show:e.show}}async exec(e){if(e.show){const t=this.sensorMap.get(e.sensorId);this.sensorModule.setDebugSensor(t)}else this.sensorModule.setDebugSensor(null)}}class xs{constructor(e){this.sensor=e,this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(){for(const[e,t]of this.sensor.readings){const n=this.addOrGetSourceId(e),a=this._data[n]||{};a.inRange=t.inRange,a.inView=t.inView,a.distanceSquared=t.distanceSq,a.direction=qa(t,"direction",a.direction),this._data[n]=a}for(const e in this.data){const t=this.reverseSourceLookup.get(e);t&&!this.sensor.readings.get(t)&&(this.sourceMap.delete(t),this.reverseSourceLookup.delete(e),delete this._data[e])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const n="source-"+ ++this.sourceId;return this.sourceMap.set(e,n),this.reverseSourceLookup.set(n,e),n}}class Ps{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return Dn(this.data.origin,e.data.origin,t)&&Dn(this.data.forward,e.data.forward,t)}copy(e){bn(this._data.origin,e.data.origin),bn(this._data.forward,e.data.forward)}update(e){bn(this._data.origin,e.frustum.origin),bn(this._data.forward,e.frustum.forward)}}class Ns{constructor(e,t,n,a,o){this.sdk=e,this.sensorFactories=t,this.sensors=n,this.sensorMap=a,this.removerMap=o}validateInput(e){if(!wn(S.SensorType,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}async exec(e,t){const n=this.sensorFactories[e.type].create(e,this.sensors),a="sensor-"+ ++Ns.nextSensorId;this.sensorMap.set(a,n);const o=ce.create(new B(n),new ks,new z(Ps)),s=this.sdk.addObservable(a,o),r=oa.create(new B(n),new Ls,new z(xs)),i=this.sdk.addCollection(a,r);return this.removerMap.set(a,{dispose(){s.dispose(),i.dispose()}}),{sensorId:a}}}Ns.nextSensorId=0;class _s{validateInput(e){return e}create(e,t){return t.createCameraBoundSensor()}}class ks{create(e,t){return t.frustum.observe(new Vs(e))}}class Ls{create(e,t){return t.onReadingsUpdated(new Vs(e))}}class Vs{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}class Fs{constructor(e,t){this.sensorMap=e,this.sourceMap=t}validateInput(e){if(!ee(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!Oa(e.sourceIds,ee))throw Error("dev error: this should not occur unless the sdk was not setup properly");for(const t of e.sourceIds)if(!this.sourceMap.has(t))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId,sourceIds:e.sourceIds}}async exec(e){const t=this.sensorMap.get(e.sensorId),n=e.sourceIds.map(this.sourceMap.get,this.sourceMap);t.addSource(...n)}}class Us{constructor(e,t){this.sensorMap=e,this.removerMap=t}validateInput(e){if(!ee(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId}}async exec(e){this.removerMap.get(e.sensorId).dispose();this.sensorMap.get(e.sensorId).dispose()}}const Gs={namespace:"Sensor",name:"createSensor",subRoutine:"sensor.create",args:[]},Hs={namespace:"Sensor",name:"addSource",varArg:!0,args:["sensorId","sourceIds"]},Bs={namespace:"Sensor",name:"dispose",args:["sensorId"]},zs={namespace:"Sensor",name:"showDebug",args:["sensorId","show"]},$s={namespace:"Sensor",name:"createSource",subRoutine:"source.create",args:["type","options"]},js={namespace:"Sensor",name:"updateSource",args:["sourceId","type","options"]};class qs{constructor(e,t,n){this.radius=1/0,this.type=e.SPHERE,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{origin:this._volume.origin,radius:this._volume.radius}}}const Ws=Math.PI/180;class Ks{constructor(e,t,n){this.type=e.BOX,this._volume=t,this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{center:this._volume.center,size:this._volume.size,orientation:this.convertQuaternionToOrientation(this._volume.orientation)}}updateOrientation(e){this.eulerCache.set(e.pitch*Ws,e.yaw*Ws,e.roll*Ws,"YXZ"),this.quaternionCache.setFromEuler(this.eulerCache),this._volume.updateOrientation(this.quaternionCache)}convertQuaternionToOrientation(e){return this.eulerCache.setFromQuaternion(this.quaternionCache.set(e.x,e.y,e.z,e.w)).reorder("YXZ"),{yaw:this.eulerCache.y*Ws,pitch:this.eulerCache.x*Ws,roll:this.eulerCache.z*Ws}}}class Ys{constructor(e,t,n){this.type=e.CYLINDER,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{basePoint:this._volume.basePoint,height:this._volume.height,radius:this._volume.radius}}}function Xs(e){if(e&&"object"==typeof e&&"yaw"in e&&"pitch"in e&&"roll"in e){const t=e;return yo(t.yaw)&&yo(t.pitch)&&yo(t.roll)}return!1}class Zs{constructor(e,t){this.sourceFactories=e,this.sourceMap=t}validateInput(e){if(!wn(S.SourceType,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}async exec(e){const t=this.sourceFactories[e.type].create(e),n="source-"+ ++Zs.nextSourceId;return this.sourceMap.set(n,t),{sourceId:n,type:e.type,volume:t.describeVolume()}}}Zs.nextSourceId=0;class Qs{constructor(e,t,n){this.sourceType=e,this.sphereVolumeFactory=t,this.THREE=n}validateInput(e){if(ya(e.options)){if(e.options.origin&&!Io(e.options.origin))throw Error(`Source.Box: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(e.options.radius&&(!yo(e.options.radius)||e.options.radius<0))throw Error(`Source.Sphere: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{origin:t.origin||{x:0,y:0,z:0},radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new qs(this.sourceType,new this.sphereVolumeFactory,this.THREE),n=t.volume;return n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),t}}class Js{constructor(e,t,n){this.sourceType=e,this.boxVolumeFactory=t,this.THREE=n}validateInput(e){if(ya(e.options)){if(e.options.center&&!Io(e.options.center))throw Error(`Source.Box: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&(!Io(e.options.size)||e.options.size.x<0||e.options.size.y<0||e.options.size.z<0))throw Error(`Source.Box: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!Xs(e.options.orientation))throw Error(`Source.Box: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`)}const t=e.options||{};return{type:e.type,options:{center:t.center||{x:0,y:0,z:0},size:t.size||{x:1/0,y:1/0,z:1/0},orientation:t.orientation||{yaw:0,pitch:0,roll:0}}}}create(e){const t=new Ks(this.sourceType,new this.boxVolumeFactory,this.THREE),n=t.volume;return n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),t}}class er{constructor(e,t,n){this.sourceType=e,this.cylinderVolumeFactory=t,this.THREE=n}validateInput(e){if(ya(e.options)){if(e.options.basePoint&&!Io(e.options.basePoint))throw Error(`Source.Cylinder: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!yo(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!yo(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{basePoint:t.basePoint||{x:0,y:0,z:0},height:t.hasOwnProperty("height")?t.height:1/0,radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Ys(this.sourceType,new this.cylinderVolumeFactory,this.THREE),n=t.volume;return n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),t}}class tr{constructor(e,t){this.sourceUpdaters=e,this.sourceMap=t}validateInput(e){if(!ee(e.sourceId)||!this.sourceMap.has(e.sourceId))throw Error("dev error: this should not occur unless the sdk was not setup properly");const t=this.sourceMap.get(e.sourceId);return this.sourceUpdaters[t.type].validateInput(e)}async exec(e){const t=this.sourceMap.get(e.sourceId);this.sourceUpdaters[t.type].update(e,t)}}class nr{validateInput(e){if(!ya(e.options))throw Error("Source.Sphere.update: invalid options provided to .update");if(!Io(e.options.origin))throw Error(`Source.Sphere.update: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(!yo(e.options.radius)||e.options.radius<0)throw Error(`Source.Sphere.update: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),n.notify()}}class ar{validateInput(e){if(!ya(e.options))throw Error("Source.Box.update: invalid options provided to .update");if(e.options.center&&!Io(e.options.center))throw Error(`Source.Box.update: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&!(Io(e.options.size)&&e.options.size.x>=0&&e.options.size.y>=0&&e.options.size.z>=0))throw Error(`Source.Box.update: 'size' was specified but was not a valid Vector3; got ${JSON.stringify(e.options.size)}\n        ${"object"==typeof e}`);if(e.options.orientation&&!Xs(e.options.orientation))throw Error(`Source.Box.update: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`);return e}update(e,t){const n=t.volume;n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),n.notify()}}class or{validateInput(e){if(!ya(e.options))throw Error("Source.Cylinder.update: invalid options provided to .update");if(e.options.basePoint&&!Io(e.options.basePoint))throw Error(`Source.Cylinder.update: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!yo(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder.update: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!yo(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),n.notify()}}function sr(e,t,n){const a=new Map,o=new Map;return function(s,r){!function(e,t,n,a){const o=new Map,s=Y.create(new B(t,n),new z(Fs)),r=Y.create(new B(t,o),new z(Us)),i=Y.create(B.extend(a,t),new z(Rs));e.addCommandUnlisted(Hs,s),e.addCommandUnlisted(Bs,r),e.addCommandUnlisted(zs,i);const c={[S.SensorType.CAMERA]:new _s},d=Y.create(B.extend(a,t,o),new z(Ns,e,c));e.addCommandToInterface(Gs,d),e.addEnumToInterface({namespace:"Sensor",name:"SensorType",values:S.SensorType})}(s,a,o,r),function(e,t,n,a,o){const s=new B(t),r={[a.SPHERE]:new nr,[a.BOX]:new ar,[a.CYLINDER]:new or},i=Y.create(s,new z(tr,r));e.addCommandUnlisted(js,i);const c={[S.SourceType.SPHERE]:new Qs(a,o.sphere,n),[S.SourceType.BOX]:new Js(a,o.box,n),[S.SourceType.CYLINDER]:new er(a,o.cylinder,n)},d=Y.create(s,new z(Zs,c));e.addCommandToInterface(Object.assign({},$s),d),e.addEnumToInterface({namespace:"Sensor",name:"SourceType",values:S.SourceType})}(s,o,e,t,n)}}var rr;!function(e){e.FPS="stat.fps"}(rr||(rr={}));class ir{constructor(e,t){this.perfStatInterval=1e3,this.elapsedTime=0,this.frameCount=0,this.lastCalcTime=0,this.fps=[0],this.waitForUpdate=e,this.perfStatInterval=t.tryGetSetting("perfInterval",this.perfStatInterval)}async calcAndBroadcast(e){await this.waitForUpdate();const t=Date.now(),n=t-this.lastCalcTime;this.lastCalcTime=t,this.elapsedTime+=n,this.frameCount++,this.elapsedTime>=this.perfStatInterval&&(this.fps[0]=1e3*this.frameCount/this.elapsedTime,this.elapsedTime=0,this.frameCount=0,e.broadcast(rr.FPS,(()=>this.fps))),this.calcAndBroadcast(e)}}function cr(e,t="",n=""){let a="sdkStorage/";return t&&t.length>0&&(a=a+t+"/"),n&&n.length>0&&(a=a+n+"/"),a+e}class dr{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return e}async exec(e){localStorage.setItem(cr(e.key,this.modelData.model.sid),JSON.stringify(e.data))}}class lr{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){const t=localStorage.getItem(cr(e.key,this.modelData.model.sid));return t?JSON.parse(t):null}}class ur{constructor(e){this.modelData=e}validateInput(e){let t=null==e?void 0:e.modelId;if(null==t)t=this.modelData.model.sid;else if("*"===t)t="";else if("string"!=typeof t)throw Error(t+" is not a valid key");return{modelId:t}}async exec(e){const t=cr("",e.modelId),n={};for(const[e,a]of Object.entries(localStorage))e.startsWith(t)&&(n[e.slice(t.length)]=JSON.parse(a));return n}}class hr{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){localStorage.removeItem(cr(e.key,this.modelData.model.sid))}}class pr{constructor(e,t){this.toSdkAlignmentMap={[e.ALIGNED]:A.Alignment.ALIGNED,[e.UNALIGNED]:A.Alignment.UNALIGNED},this.toSdkPlacementMap={[t.UNPLACED]:A.Placement.UNPLACED,[t.AUTO]:A.Placement.AUTO,[t.MANUAL]:A.Placement.MANUAL}}toSdkAlignment(e){return this.toSdkAlignmentMap[e]}toSdkPlacement(e){return this.toSdkPlacementMap[e]}}const mr=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",defurnishableStartDate:new Date("03/10/2023"),defurnishableStartVersion:"1.2.29221.4-gcac59bd3ec.REL_1425",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"});function gr(e,t){if(!e||!t)return null;let n=null;for(const a of t.rooms.values())if(a.floorId===e.floorId&&a.containsPoint(e.floorPosition.x,e.floorPosition.z)){n=a;break}return n}class fr{constructor(){this.currentSweep="",this.sweepTransitionActive=!1,this.currentMode=null,this.modeTransitionActive=!1}create(e,t,n){return new kt(t.onChanged((()=>this.throttleSweepDataChanges(e,t))),n.onChanged((()=>this.throttleViewmodeDataChanges(e,n))))}throttleSweepDataChanges(e,t){const n=t.state.currentSweep||"",a=t.state.transition.active&&t.state.transition.to!==t.state.transition.from;this.currentSweep===n&&this.sweepTransitionActive===a||(this.currentSweep=n,this.sweepTransitionActive=a,e.onChanged())}throttleViewmodeDataChanges(e,t){const n=t.currentMode,a=t.transition.active;this.currentMode===n&&this.modeTransitionActive===a||(this.currentMode=n,this.modeTransitionActive=a,e.onChanged())}}class wr{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},wr.empty),{puckPosition:Object.assign({},wr.empty.puckPosition),floorInfo:Object.assign({},wr.empty.floorInfo),neighbors:[],position:Object.assign({},wr.empty.position),rotation:Object.assign({},wr.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=mr.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&Dn(this.currentSweep.position,e.data.position,t)&&Dn(this.currentSweep.rotation,e.data.rotation,t)&&Dn(this.currentSweep.puckPosition,e.data.puckPosition,t)}copy(e){this.copySweep(e.data)}update(e,t,n,a,o,s){const r=e.currentSweepObject;if(!r||e.state.transition.active||t.transition.active||!t.isInside()&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(wr.empty);let i;try{i=n.getFloor(r.floorId||"")}catch(e){i={id:void 0,index:void 0}}const c=s&&gr(r,s.get()||null),d=a.getIdForSweep(r);this.currentSweep.uuid=r.uuid,this.currentSweep.sid=d,this.currentSweep.id=d,this.currentSweep.enabled=r.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(r.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(r.placementType),this.currentSweep.neighbors=[...r.neighbours.map((t=>e.getSweep(t)?a.getIdFromCwfId(t):null))].filter((e=>null!==e)),this.currentSweep.roomInfo.id=c?c.id:void 0,bn(this.currentSweep.position,r.position),bn(this.currentSweep.rotation,r.rotation),bn(this.currentSweep.puckPosition,r.floorPosition),this.currentSweep.alignmentType===A.Alignment.UNALIGNED&&this.currentSweep.placementType===A.Placement.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=i.id?o.getIdFromCwfId(i.id):i.id,this.currentSweep.floorInfo.sequence=i.index)}copySweep(e){this.currentSweep.uuid=e.uuid,this.currentSweep.sid=e.sid,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],this.currentSweep.roomInfo.id=e.roomInfo.id,bn(this.currentSweep.position,e.position),bn(this.currentSweep.rotation,e.rotation),bn(this.currentSweep.puckPosition,e.puckPosition)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let n=0;n<t;++n)if(this.currentSweep.neighbors[n]!==e.neighbors[n])return!1;return t===e.neighbors.length}}wr.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:A.Alignment.ALIGNED,placementType:A.Placement.UNPLACED,puckPosition:{x:0,y:0,z:0},floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},roomInfo:{id:void 0}};class yr{constructor(e,t,n,a){this.sweepData=n,this.sweepIdMap=a,this.NavigateToSweepCommand=e.NavigateToSweepCommand,this.issueCommand=t.issueCommand,this.cameraTransitionConverter=t.cameraTransitionConverter,this.conversion=t.conversionUtils}validateInputSweepId(e,t,n){if(!e||!ee(e))throw Error(`Sweep.moveTo: 'sweep' was not a valid sweep id; got ${e}`);const a=n.getSweepForId(e);if(!a)throw Error(e+" does not map to a valid sweep in this model");return a.id}validateInputRotation(e){if(!e)return;const t=Error(`Sweep.moveTo: 'options.rotation' was specified but was not a valid Rotation; got ${e}`);if(e&&!ya(e))throw t;const n=e||{},a={x:vo(n.x),y:vo(n.y)};if(n.z&&(a.z=vo(n.z)),!function(e){const t=e;return!!t&&!("object"!=typeof t||"z"in t&&!yo(t.z))&&yo(t.x)&&yo(t.y)}(a))throw t;return a}validateTransitionTime(e){if(!e)return;const t=Error(`Sweep.moveTo: options.transitionTime was specified but was not a valid, positive time; got ${e}`);if(!yo(e)&&!ee(e))throw t;const n="number"==typeof e?e:vo(e);if(!yo(n)||n<=0)throw t;return n}validateInput(e){const t=this.validateInputSweepId(e.sweep,this.sweepData,this.sweepIdMap),n=e.options||{},a=this.validateInputRotation(n.rotation),o=this.validateTransitionTime(n.transitionTime);if(n.transition&&!wn(g.TransitionType,n.transition))throw Error(`Sweep.moveTo: options.transition was specified but was not a valid transition type; got ${n.transition}`);return{sweep:t,options:{rotation:a,transition:n.transition,transitionTime:o}}}async exec(e,t){const n=e.options.rotation?this.conversion.rotationToQuaternion(e.options.rotation):void 0,a=e.options.transition,o=e.options.transition?this.cameraTransitionConverter.fromSdkTransition(a):void 0,s=e.options.transitionTime;return await this.issueCommand(new this.NavigateToSweepCommand({sweep:e.sweep,rotation:n,transition:o,transitionTime:s}))}}class vr{create(e,t){return t.onSweepsChanged((()=>e.onChanged()))}}class Tr{constructor(e,t,n,a,o,s,r){this.sweepData=n,this.floorsData=a,this.sweepIdMap=o,this.floorIdMap=s,this.roomBoundData=r,this._data={},this.conversionUtils=e,this.sweepPlacementConverter=t}get data(){return this._data}isItemEqual(e,t){return!ue(this.data[t],e.data[t])}update(){const e={};for(const t of this.sweepData.sweeps()){const{id:n,index:a}=t.floorId?this.floorsData.getFloor(t.floorId):{id:"",index:-1},o=n?this.floorIdMap.getIdFromCwfId(n):void 0,s=this.sweepIdMap.getIdFromCwfId(t.id);e[s]=t.id;const r=this.data[s]||{};r.uuid=t.uuid,r.sid=s,r.id=s,r.enabled=t.enabled,r.alignmentType=this.sweepPlacementConverter.toSdkAlignment(t.alignmentType),r.placementType=this.sweepPlacementConverter.toSdkPlacement(t.placementType),r.neighbors=[...t.neighbours.map((e=>this.sweepData.getSweep(e)?this.sweepIdMap.getIdFromCwfId(e):null))].filter((e=>null!==e)),r.position=Ir(t.position,r.position),r.rotation=this.conversionUtils.quaternionToRotation(t.rotation,r.rotation),r.puckPosition=Ir(t.floorPosition,r.puckPosition),r.floorInfo=o?{id:o,sequence:a}:{id:"",sequence:-1};const i=this.roomBoundData&&gr(t,this.roomBoundData.get()||null);r.roomInfo={id:i?i.id:void 0},this.data[r.id]=r}for(const t in this.data)this.sweepData.containsSweep(e[t])||delete this.data[t]}clear(){this._data={}}}function Ir(e,t){return(t=t||{}).x=e.x,t.y=e.y,t.z=e.z,t}class br{constructor(e){this.sweepData=e}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.sweepData.getSweepIdMap(e.invert)}}class Er{constructor(e){this.sweepData=e}validateInput(e,t){const n=null==e?void 0:e.id;if(!n)throw Error("Sweep.GetLabelFromIdExecutor: Missing input 'id' field");if(!te(n))throw Error(`Sweep.GetLabelFromIdExecutor: provided ${null==e?void 0:e.id} is not a valid string`);return{id:n}}async exec(e,t){var n,a;let o=null===(n=this.sweepData.getSweep(e.id))||void 0===n?void 0:n.index;return void 0===o&&(o=null===(a=this.sweepData.getSweepByUuid(e.id))||void 0===a?void 0:a.index),void 0!==o?(o+1).toString():null}}class Cr{constructor(e,t){this.sweepData=e,this.sweepIdMap=t}validateInput(e){return{sweepIds:Ar(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)Or(t,!0,this.sweepData)}}class Sr{constructor(e,t){this.sweepData=e,this.sweepIdMap=t}validateInput(e){return{sweepIds:Ar(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)Or(t,!1,this.sweepData)}}function Ar(e,t,n){if(!Array.isArray(e))throw Error();return e.map((e=>function(e,t,n){if(!ee(e))throw Error(e+" is not a valid string input");const a=n.getSweepForId(e);if(!a)throw Error(e+" does not map to a valid sweep in this model");return a.id}(e,0,n)))}function Or(e,t,n){const a=n.getSweep(e);a.enabled=t,a.commit()}class Dr{constructor(e,t,n){this.sweepData=n,this.SweepNeighborModifyCommand=e.SweepNeighborModifyCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const n=null==e?void 0:e.sweepId;if(!n)throw Error("Sweep.AddSweepNeighborsExecutor: Missing input 'sweepId' field");if(!te(n))throw Error(`Sweep.AddSweepNeighborsExecutor: provided "${null==e?void 0:e.sweepId}" is not a valid string`);if(!this.sweepData.containsSweep(e.sweepId))throw Error(`Sweep.AddSweepNeighborsExecutor: provided sweep ID "${null==e?void 0:e.sweepId}" is not a valid V2 ID`);const a=this.sweepData;const o=null==e?void 0:e.toAdd;if(!o||!Oa(o,(function(e){const t=a.containsSweep(e);return te(e)&&t})))throw Error("Sweep.AddSweepNeighborsExecutor: Invalid list of neighbors to add");return{sweepId:n,toAdd:o}}async exec(e,t){const n=this.sweepData.getSweep(e.sweepId);return await this.issueCommand(new this.SweepNeighborModifyCommand(n.id,e.toAdd)),this.sweepData.getSweep(e.sweepId).neighbours}}class Mr{constructor(e,t,n){this.sweepData=n,this.SweepNeighborModifyCommand=e.SweepNeighborModifyCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const n=null==e?void 0:e.sweepId;if(!n)throw Error("Sweep.RemoveSweepNeighborsExecutor: Missing input 'sweep' field");if(!te(n))throw Error(`Sweep.RemoveSweepNeighborsExecutor: provided "${null==e?void 0:e.sweepId}" is not a valid string`);if(!this.sweepData.containsSweep(e.sweepId))throw Error(`Sweep.AddSweepNeighborsExecutor: provided sweep ID "${null==e?void 0:e.sweepId}" is not a valid V2 Sweep ID`);const a=this.sweepData;const o=null==e?void 0:e.toRemove;if(!o||!Oa(o,(function(e){const t=a.getSweep(n).neighbours.includes(e);return te(e)&&t})))throw Error("Sweep.RemoveSweepNeighborsExecutor: Invalid list of neighbors to remove.");return{sweepId:n,toRemove:o}}async exec(e,t){const n=this.sweepData.getSweep(e.sweepId);return await this.issueCommand(new this.SweepNeighborModifyCommand(n.id,[],e.toRemove)),this.sweepData.getSweep(e.sweepId).neighbours}}class Rr{create(e,t){return t.onChanged({notify(){e.onChanged()}})}}class xr{constructor(e){this.attachmentRegistry=e,this._data={}}get data(){return this._data}isItemEqual(e,t){return this.data[t].id===e.data[t].id&&this.data[t].src===e.data[t].src&&this.data[t].type===e.data[t].type}update(){for(const[,e]of this.attachmentRegistry.descriptors()){const t=this._data[e.id]||{};t.id=e.id,t.src=e.src,t.type=e.type,this._data[e.id]=t}for(const e in this.data){this.attachmentRegistry.has(e)||delete this._data[e]}}clear(){this._data={}}}class Pr{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t,this.attachmentCounts=new Map}validateInput(e,t){ee(e.tagId)||this.throw(X("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),Oa(e.attachmentIds,ee)||this.throw(X("attachmentId","string or strings",e.tagId));for(const n of e.attachmentIds)this.attachmentRegistry.get(t.client.applicationKey,n)||this.throw(`${n} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const n of e.attachmentIds){const a=this.attachmentRegistry.get(t.client.applicationKey,n);a||this.throw(`${n} does not map to a valid attachment`);const o=this.attachmentCounts.get(a)||0;this.attachmentCounts.set(a,o+1);const s=this.mattertagData.getTag(e.tagId);a.category===La.UPLOAD?s.fileAttachments.push(a):a.category===La.EXTERNAL?s.externalAttachments.push(a):a.category===La.SANDBOX&&s.sandboxAttachments.push(Object.assign(Object.assign({},a),{src:a.src+`?id=${a.id}&parent=${e.tagId}&${o}`}))}this.mattertagData.commit()}throw(e){throw Error("Tag.attach: "+e)}}class Nr{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t}validateInput(e,t){ee(e.tagId)||this.throw(X("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),Oa(e.attachmentIds,ee)||this.throw(X("attachmentId","string or strings",e.tagId));for(const n of e.attachmentIds)this.attachmentRegistry.get(t.client.applicationKey,n)||this.throw(`${n} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const n of e.attachmentIds){const a=this.attachmentRegistry.get(t.client.applicationKey,n);if(!a)return void this.throw(`${n} does not map to a valid attachment`);const o=this.mattertagData.getTag(e.tagId);a.category===La.UPLOAD?_r(o.fileAttachments,a.id):a.category===La.EXTERNAL?_r(o.externalAttachments,a.id):a.category===La.SANDBOX&&_r(o.sandboxAttachments,a.id)}this.mattertagData.commit()}throw(e){throw Error("Tag.detach: "+e)}}function _r(e,t){const n=e.findIndex((e=>e.id===t));n>=0&&e.splice(n,1)}class kr{constructor(e){this.attachmentRegistry=e,this.log=new Xt("tag.registerAttachment")}validateInput(e){const t=e.srcs;return Oa(t,te)||(Oa(t,this.validateDescriptor)&&this.log.warn("Using attachment descriptors is deprecated and will be removed when Early Access closes."),this.throw(X("descriptors","Array of AttachmentDescriptors or strings",t))),{srcs:t}}validateDescriptor(e,t){return ya(e)||this.throw(`descriptor #${t} is not an object`),ee(e.src)||this.throw(`descriptor[${t}].src is not a string`),wn(O.AttachmentType,e.type)&&e.type!==O.AttachmentType.UNKNOWN||this.throw(`descriptor[${t}].type is not a valid attachment type`),e.type===O.AttachmentType.SANDBOX&&this.throw(`descriptor[${t}] has type ${O.AttachmentType.SANDBOX} and should be registered using 'Tag.registerSandbox' instead`),!0}async exec(e,t){const n=[];for(const a of e.srcs){const e="string"==typeof a?await this.attachmentRegistry.addBySrc(t.client.applicationKey,a):this.attachmentRegistry.add(t.client.applicationKey,a);n.push(e)}return n}throw(e){throw Error("Tag.registerAttachment: "+e)}}(class extends me{constructor(e){super(),this.payload={tags:e}}}).id="MATTERTAG_DISC_POSITIONS";class Lr extends me{constructor(e){super(),this.payload=e}}Lr.id="ADD_MATTERTAG";(class extends me{constructor(e){super(),this.payload={sid:e}}}).id="DELETE_MATTERTAG";class Vr extends me{constructor(e,t,n,a){super(),this.payload={sid:e,standardOptions:t,mediaOptions:n,positionOptions:a}}}Vr.id="MATTERTAG_EDIT";class Fr extends me{constructor(e,t,n){super(),this.payload={sid:e,attachmentOptions:t,operation:n}}}Fr.id="MATTERTAG_EDIT_ATTACHMENTS",function(e){let t;!function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"}(t=e.Operation||(e.Operation={}))}(Fr||(Fr={}));class Ur extends me{constructor(e,t,n=[],a){super(),this.payload={id:e,properties:t,fileAttachments:n,embed:a}}}Ur.id="MATTERTAG_NEW_SAVE";class Gr extends me{constructor(e,t,n=[],a=[],o){super(),this.payload={id:e,properties:t,pendingAttachments:n,removedAttachments:a,embed:o}}}Gr.id="MATTERTAG_SAVE";const Hr=new Xt("mattertag-util");function Br(e,t,n,a){const o=a.meshSubGroupsFromPoint(e);let s=1/0,r="";for(const t of n.rooms())if(o.includes(t.meshSubgroup)){const n=a.meshGroups.rooms.get(t.meshSubgroup),o=e.y-((null==n?void 0:n.boundingBox.min.y)||-1/0);o<s&&(s=o,r=t.floorId)}try{return t.getFloor(r).index}catch(e){return Hr.debug("Unable to deduce floor index from position; defaulting to floor 0"),0}}function zr(e,t){return e instanceof Function?e(t):t===e}class $r extends It{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return le(this._value)}waitFor(e){return new Promise((t=>{if(zr(e,this._value))t();else{const n=this.onChanged((a=>{zr(e,a)&&(n.cancel(),t())}))}}))}}const jr=new Xt("ProgressTracker");class qr{constructor(e){this.totalTasks=e,this.taskCompleted=0,this.percentCompleted=new $r(-1)}start(){jr.debug("start"),this.percentCompleted.value=0}notifyTaskCompleted(){this.taskCompleted>=this.totalTasks||(this.taskCompleted++,this.percentCompleted.value=this.taskCompleted/this.totalTasks,jr.debug(`percent completed: ${this.percentCompleted.value}`))}forceComplete(){this.percentCompleted.value=1,jr.debug(`forceComplete: ${this.percentCompleted.value}`)}}const Wr=new Xt("command.importTags");class Kr{constructor(e,t,n,a,o,s,r,i,c){this.sdkLayer=e,this.THREE=t,this.externals=n,this.getTagsQuery=a,this.mattertagsData=o,this.floorsData=s,this.roomData=r,this.meshData=i,this.layersModule=c}validateInput(e,t){if(ee(e.spaceSid)||this.throw(X("spaceSid","string",e.spaceSid)),!e.options)return{spaceSid:e.spaceSid,options:{}};const n={};ya(e.options)||this.throw("options is not an object");const a=e.options;return a.progress&&("function"==typeof a.progress?n.progress=a.progress:this.throw("progress option is not a function")),a.allowedLayers&&(Oa(a.allowedLayers,te)?n.allowedLayers=a.allowedLayers:this.throw("allowedLayers option is not an array")),{spaceSid:e.spaceSid,options:n}}async exec(e,t){const n=await this.getTagsQuery(e.spaceSid),a=[];for(const t of n)t.sid="imported-"+t.sid,this.mattertagsData.getTag(t.sid)||(e.options.allowedLayers?e.options.allowedLayers.includes(t.layerId)&&a.push(t):a.push(t));const o=[],s=a.length+1,r=new qr(s),i=[];if(e.options.progress&&i.push(r.percentCompleted.onChanged(e.options.progress)),r.start(),!this.sdkLayer)return Wr.warn("SDK Layers is not ready to be used."),[];await this.layersModule.selectLayer(this.sdkLayer.id,!0),r.notifyTaskCompleted();for(const t of a){const n=new this.THREE.Vector3,a=new this.THREE.Vector3;n.set(t.anchorPosition.x,t.anchorPosition.y,t.anchorPosition.z),a.set(t.stemVector.x,t.stemVector.y,t.stemVector.z);const s=a.length();a.normalize();const r=Br(n,this.floorsData,this.roomData,this.meshData),i=this.floorsData.getFloorAtIndex(r);i||this.throw(`Could not add Tag ${t.sid} due to invalid floor position floorIndex: ${r} spaceId ${e.spaceSid}`),o.push({id:t.sid,positionOptions:{position:t.anchorPosition,normal:a,floorId:i.id},standardOptions:{label:t.label,description:t.description,stemVisible:t.stemVisible,stemHeight:s,color:t.color,icon:t.icon},attachmentOptions:{fileAttachments:t.fileAttachments,externalAttachments:t.externalAttachments,refreshIds:[e.spaceSid]}})}i.push(this.mattertagsData.mattertags.onElementChanged({onAdded:()=>{r.notifyTaskCompleted()}}));const c=await this.externals.issueCommand(new Lr(o));for(let e=0;e<a.length;e++){const t=a[e],n=this.mattertagsData.getTag(c[e]);n.enabled=t.enabled;for(const e of t.keywords)n.keywords.push(e)}return r.forceComplete(),i.forEach((e=>e.cancel())),c}throw(e){throw Error("Tag.importTags: "+e)}}class Yr{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Xr{constructor(e,t,n,a,o,s){this.THREE=e,this.mattertagData=t,this.tagsViewData=n,this.roomIdMap=a,this.roomData=o,this.meshData=s,this._data={}}get data(){return this._data}isItemEqual(e,t){return!ue(this.data[t],e.data[t])}update(){const e=e=>{const t=(new this.THREE.Vector3).set(e.x,e.y,e.z);for(const e of this.roomData.rooms()){const n=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(n&&n.boundingBox.containsPoint(t))return e}};for(const t of this.tagsViewData.getOrderedTags()){const n=this.mattertagData.getTag(t.id),a=this.data[n.sid]||{};if(a.id=n.sid,a.enabled=n.enabled,a.anchorPosition=qa(n,"anchorPosition",a.anchorPosition),a.stemVector=qa(n,"stemVector",a.stemVector),a.stemVisible=n.stemVisible,a.label=n.label,a.description=n.description,a.color=Wa(n,"color",a.color),a.keywords=Cn(a.keywords||[],n.keywords.values()),a.iconId=n.icon?n.icon:"",a.fontId=n.icon?n.icon.split("_")[2]:"",n.roomId)a.roomId=this.roomIdMap.getIdFromCwfId(n.roomId);else{const t=e(a.anchorPosition);t&&t.id&&(a.roomId=this.roomIdMap.getIdFromCwfId(t.id))}const o=n.fileAttachments.map((e=>e.id)),s=n.externalAttachments.map((e=>e.id)),r=n.sandboxAttachments.map((e=>e.id));a.attachments=[...o,...s,...r],this._data[n.sid]=a}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}}function Zr(e){if(e&&"object"==typeof e&&"r"in e&&"g"in e&&"b"in e){const t=e;return yo(t.r)&&yo(t.g)&&yo(t.b)}return!1}const Qr=new Xt("command.add");class Jr{constructor(e,t,n,a,o,s,r,i,c,d,l){this.THREE=e,this.Mattertag=t.Mattertag,this.issueCommand=n.issueCommand,this.isMpFontId=n.isMpFontId,this.mattertagsData=a,this.tagAttach=o,this.tagEditIcon=s,this.tagEditOpacity=r,this.attachmentRegistry=i,this.iconMaps=c,this.meshQuery=d}validateInput(e,t){const{descriptors:n}=e;return Oa(n,((e,n)=>this.validateDescriptor(e,n,t)))||this.throw("descriptors is not an array"),{descriptors:n}}validateDescriptor(e,t,n){var a,o,s;if(ya(e)||this.throw(`descriptor #${t} is not an object`),Io(e.anchorPosition)||this.throw(`descriptor[${t}].anchorPosition is not vector`),Io(e.stemVector)||this.throw(`descriptor[${t}].stemVector is not vector`),void 0===e.id||ee(e.id)||this.throw(`descriptor[${t}].id is not a valid string`),void 0===e.enabled||va(e.enabled)||this.throw(`descriptor #${t}.enabled is not a boolean`),void 0===e.stemVisible||va(e.stemVisible)||this.throw(`descriptor[${t}].stemVisible is not a boolean`),void 0===e.label||te(e.label)||this.throw(`descriptor[${t}].label is not a string`),void 0===e.description||te(e.description)||this.throw(`descriptor[${t}].description is not a string`),void 0!==e.attachments){Oa(e.attachments,te)||this.throw(`descriptor[${t}].attachments is not an array of strings`);for(let a=0;a<e.attachments.length;++a){const o=e.attachments[a];this.attachmentRegistry.get(n.client.applicationKey,o)||this.throw(`descriptor[${t}].attachment[${a}] does not map to a valid attachment`)}}return void 0===e.color||Zr(e.color)||this.throw(`descriptor[${t}].color is not a Color`),void 0!==e.opacity&&(yo(e.opacity)||this.throw(`descriptor[${t}].opacity is not a number`),o=e.opacity,s=1,0<=o&&o<=s||(Qr.warn(`descriptor[${t}].opacity was clamped from ${e.opacity} to the range [0, 1]`),e.opacity=To(e.opacity,0,1))),void 0===e.iconId||ee(e.iconId)||this.throw(`descriptor[${t}].iconId is not a valid string`),e.id=e.id?this.Mattertag.idGenerator.reserve(e.id):this.Mattertag.idGenerator.generate(),e.id&&ee(e.id)&&this.mattertagsData.getTag(e.id)&&this.throw(`descriptor[${t}].id (${e.id}) is already in use`),!e.iconId||this.isMpFontId(e.iconId)||(null===(a=this.iconMaps.get(n.client.applicationKey))||void 0===a?void 0:a.imagePromise[e.iconId])||this.throw(`descriptor[${t}].iconId (${e.iconId}) does not map to a registered icon`),e.keywords&&!Oa(e.keywords,te)&&this.throw(`descriptor[${t}].keywords is not an array of strings`),!0}async exec(e,t){const n=[],a=[];for(let t=0;t<e.descriptors.length;t++){const o=new this.THREE.Vector3,s=new this.THREE.Vector3,r=e.descriptors[t];o.set(r.anchorPosition.x,r.anchorPosition.y,r.anchorPosition.z),s.set(r.stemVector.x,r.stemVector.y,r.stemVector.z);const i=s.length();s.normalize();const c={floorId:"",roomId:"",layerId:""};this.meshQuery.inferMeshIdsFromPoint(c,o,!0),c.floorId||this.throw(`Could not add Tag on invalid floor with index: ${c.floorId}`),n.push({id:r.id,positionOptions:{position:o,normal:s,floorId:c.floorId},standardOptions:{enabled:r.enabled,label:r.label,description:r.description,stemVisible:r.stemVisible,stemHeight:i,color:r.color,keywords:r.keywords}}),r.attachments&&a.push(t)}const o=await this.issueCommand(new Lr(n));for(let n=0;n<e.descriptors.length;n++){const a=o[n],s=e.descriptors[n];void 0!==s.opacity&&await this.tagEditOpacity.exec({id:a,opacity:s.opacity},t),void 0!==s.iconId&&this.tagEditIcon.exec({id:a,iconId:s.iconId},t),s.attachments&&this.tagAttach.exec({tagId:a,attachmentIds:s.attachments},t)}return o}throw(e){throw Error("Tag.add: "+e)}}function ei(e,t){return ee(e)&&!!t.getTag(e)}class ti{constructor(e,t){this.externals=e,this.mattertagsData=t}validateInput(e,t){var n;if(!ei(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!ya(e.options))throw Error(X("options","object",e.options));return{id:e.id,options:{force:!!(null===(n=e.options)||void 0===n?void 0:n.force)}}}async exec(e,t){await this.externals.issueCommand(new this.externals.OpenTagCommand(e.id,{forceOpen:e.options.force}))}}var ni,ai;!function(e){e.NOTE="note",e.TAG="tag",e.OBJECT="object"}(ni||(ni={}));class oi{constructor(e,t){this.mattertagsData=e,this.annotationsModule=t}validateInput(e,t){var n;if(!ei(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!ya(e.options))throw Error(X("options","object",e.options));return{id:e.id,options:{force:!!(null===(n=e.options)||void 0===n?void 0:n.force)}}}async exec(e,t){this.annotationsModule.dockAnnotation(e.id,ni.TAG,e.options.force)}}class si{constructor(e,t,n){this.externals=e,this.mattertagsData=t,this.tagsViewData=n}validateInput(e,t){if(!ei(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);return{id:e.id}}async exec(e,t){var n;(null===(n=this.tagsViewData.openTagView)||void 0===n?void 0:n.id)===e.id&&await this.externals.issueCommand(new this.externals.CloseTagCommand)}}!function(e){e.MATTERTAG="mattertag",e.NOTE="note",e.OBJECT="object"}(ai||(ai={}));ai.MATTERTAG,ai.NOTE,ai.OBJECT;var ri,ii,ci,di;!function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(ri||(ri={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed"}(ii||(ii={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(ci||(ci={}));class li{constructor(){this.focusedPin=null,this.selectedPin=null,this.dockedAnnotation=null}create(e,t,n){return new kt(t.onChanged((()=>this.throttlePinChanges(e,t))),n.onChanged((()=>this.throttleAnnotationChanges(e,n))))}throttlePinChanges(e,t){var n,a;const o=null!==(a=null===(n=t.focusedPin)||void 0===n?void 0:n.id)&&void 0!==a?a:null,s=t.selectedPinId;this.focusedPin===o&&this.selectedPin===s||(this.focusedPin=o,this.selectedPin=s,e.onChanged())}throttleAnnotationChanges(e,t){var n,a;const o=null!==(a=null===(n=t.dockedAnnotation)||void 0===n?void 0:n.id)&&void 0!==a?a:null;this.dockedAnnotation!==o&&(this.dockedAnnotation=o,e.onChanged())}}class ui{constructor(){this._data={hovered:null,selected:new Set,docked:null}}get data(){return this._data}equals(e){return this.data.hovered===e.data.hovered&&this.data.docked===e.data.docked&&(t=this.data.selected,n=e.data.selected,t.size===n.size&&[...t].every((e=>n.has(e))));var t,n}update(e,t){var n,a;const o=e.focusedPin,s=e.selectedPinId?e.getPin(e.selectedPinId):null,r=null!==(a=null===(n=t.dockedAnnotation)||void 0===n?void 0:n.id)&&void 0!==a?a:null;this._data.hovered=(null==o?void 0:o.pinType)===ai.MATTERTAG?o.id:null,this._data.selected.clear(),s&&s.pinType===ai.MATTERTAG&&this._data.selected.add(s.id),this._data.docked=r}copy(e){this._data.hovered=e.data.hovered,this._data.docked=e.data.docked,function(e,t){e.clear();for(const n of t)e.add(n)}(this._data.selected,e.data.selected)}}!function(e){e.SETUP="sandbox.setup",e.TO_SANDBOX="sandbox.to.sandbox",e.TO_CLIENT="sandbox.to.client"}(di||(di={}));Symbol.iterator;Symbol.iterator;class hi{constructor(){this.values=new Map}add(e,t){this.getValuesAtKey(e).add(t)}remove(e,t){const n=this.values.get(e);null==n||n.delete(t)}removeKey(e){this.values.delete(e)}getValuesAtKey(e){const t=this.values.get(e)||new Set;return this.values.set(e,t),t}valuesPerKey(e){return this.getValuesAtKey(e).size}get keys(){return this.values.keys()}hasKey(e){return this.values.has(e)}has(e,t){var n;return!!(null===(n=this.values.get(e))||void 0===n?void 0:n.has(t))}*[Symbol.iterator](){for(const[e,t]of this.values)for(const n of t)yield[e,n]}}Map;class pi{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}class mi{constructor(e,t,n,a){this.sdk=e,this.attachmentRegistry=t,this.tagViewData=n,this.iframeSrcDoc=a,this.idGenerator=new pi,this.sandboxSubs=new Set}validateInput(e){if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!yo(e.clientId))throw Error("Unexpected error: unable to create iframe");const t=e.options||{},n={on:"on",off:"off",send:"send",tag:"tag",docked:"docked"};t.globalVariableMap&&(ee(t.globalVariableMap.on)&&(n.on=t.globalVariableMap.on),ee(t.globalVariableMap.off)&&(n.off=t.globalVariableMap.off),ee(t.globalVariableMap.send)&&(n.send=t.globalVariableMap.send),ee(t.globalVariableMap.tag)&&(n.tag=t.globalVariableMap.tag),ee(t.globalVariableMap.docked)&&(n.docked=t.globalVariableMap.docked));const a={w:0,h:0};if(t.size){if(!(yo(t.size.w)&&t.size.w>=0&&yo(t.size.h)&&t.size.h>=0))throw Error(X("options.size","Size",t.size));a.w=t.size.w,a.h=t.size.h}return{clientId:e.clientId,html:e.html,options:{name:t.name||"",globalVariableMap:n,size:a}}}async exec(e,t){const n=this.idGenerator.generate(),a=e=>{const a=a=>{a.source===e&&a.data.sandboxId===n&&this.sdk.sendPrivateMessage(di.TO_CLIENT,a.data,t.client.id)};window.addEventListener("message",a),this.sandboxSubs.add({dispose(){window.removeEventListener("message",a)}})},o=e=>{const a=this.sdk.addPrivateMessageHandler({clientId:t.client.id,messageType:di.TO_SANDBOX,onMessage(t){t.sandboxId===n&&e.postMessage(t,"*")}});this.sandboxSubs.add(a)},[s]=this.attachmentRegistry.addSandbox(t.client.applicationKey,{name:e.options.name,srcDoc:this.iframeSrcDoc,sandboxLoadedHandler:(t,s)=>{var r;const i=t.contentWindow;for(const e of this.sandboxSubs)e.dispose();this.sandboxSubs.clear(),a(i),o(i),i.postMessage({type:di.SETUP,sandboxId:n,customHTML:e.html,parentTag:s,docked:(null===(r=this.tagViewData.dockedAnnotation)||void 0===r?void 0:r.id)===s,globalVariableMap:e.options.globalVariableMap},"*")},size:e.options.size});return{sandboxId:n,attachmentId:s}}}class gi{constructor(e,t,n,a){this.pinViewData=e,this.tagsViewData=t,this.annotationsViewData=n,this.annotationsModule=a}validateInput(e,t){const n=e.id;ee(n)&&this.pinViewData.getPin(n)||this.throw(`${e.id} does not map to a valid tag`);const a={opening:!1,navigating:!1,docking:!1,sharing:!1};return ya(e.allow)&&(a.opening=!!e.allow.opening,a.navigating=!!e.allow.navigating,a.docking=!!e.allow.docking,a.sharing=!!e.allow.sharing),{id:n,allow:a}}async exec(e,t){var n,a;const o=this.pinViewData.getPin(e.id);o?(this.annotationsViewData.updateCapabilities(o.id,{dock:e.allow.docking,preview:e.allow.opening,share:e.allow.sharing}),this.tagsViewData.updateCapabilities(o.id,{focus:!!e.allow.navigating}),(!e.allow.docking&&(null===(n=this.annotationsViewData.dockedAnnotation)||void 0===n?void 0:n.id)===e.id||!e.allow.opening&&(null===(a=this.annotationsViewData.selectedAnnotation)||void 0===a?void 0:a.id)===e.id)&&this.annotationsModule.closeAnnotation(o.id,ni.TAG)):this.throw(`${e.id} does not map to a valid tag`)}throw(e){throw Error("Tag.allowAction: "+e)}}class fi{constructor(e,t,n){this.mattertagData=n,this.EditMattertagCommand=e.EditMattertagCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const{id:n}=e;return ee(n)||this.throw(X("id","string",n)),this.mattertagData.getTag(n)||this.throw(`${n} does not map to a valid tag`),{id:n,properties:this.validateProperties(e.properties)}}validateProperties(e){ya(e)||this.throw("'properties' input is not an object");const{label:t,description:n}=e;return void 0===t||te(t)||this.throw(X("label","string (or undefined)",t)),void 0===n||te(n)||this.throw(X("description","string (or undefined)",n)),{label:t,description:n}}async exec(e,t){try{await this.issueCommand(new this.EditMattertagCommand(e.id,{label:e.properties.label,description:e.properties.description}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editBillboard: "+e)}}class wi{constructor(e,t,n,a){this.THREE=e,this.EditMattertagCommand=t.EditMattertagCommand,this.issueCommand=n.issueCommand,this.mattertagData=a}validateInput(e,t){return ee(e.id)||this.throw(X("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),Zr(e.color)||this.throw(X("color","Color",e.color)),{id:e.id,color:e.color}}async exec(e,t){try{const t=(new this.THREE.Color).setRGB(e.color.r,e.color.g,e.color.b);await this.issueCommand(new this.EditMattertagCommand(e.id,{color:t}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editColor: "+e)}}class yi{constructor(e,t,n,a,o,s){this.THREE=t,this.isMpFontId=n,this.mattertagData=a,this.pinsModule=o,this.iconMaps=s,this.issueCommand=e.issueCommand}validateInput(e,t){var n;ee(e.id)||this.throw(X("id","string",e.id));this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),ee(e.iconId)||this.throw(X("iconId","string",e.iconId));const a=this.isMpFontId(e.iconId);return(null===(n=this.iconMaps.get(t.client.applicationKey))||void 0===n?void 0:n.imagePromise[e.iconId])||a||this.throw(`${e.iconId} does not map to a registered icon or font id`),{id:e.id,iconId:e.iconId}}async exec(e,t){const{id:n,iconId:a}=e,o=this.iconMaps.get(t.client.applicationKey);if(o&&e.iconId in o.imagePromise){let e;try{e=await o.imagePromise[a]}catch(e){this.throw(e)}const t=o.map[a],s=e.naturalWidth/e.naturalHeight,r=new this.THREE.Vector3;s>1?r.set(s,1,1):r.set(1,1/s,1),this.pinsModule.setPinRenderOverrides(n,t,r)}else{this.mattertagData.getTag(e.id).icon=e.iconId,await this.issueCommand(new Vr(e.id,{icon:e.iconId}))}}throw(e){throw Error("Tag.editIcon: "+e)}}class vi{constructor(e,t,n,a,o){this.cwfTypes=e,this.closeTag=n,this.mattertagData=a,this.annotationsViewData=o,this.issueCommand=t.issueCommand}validateInput(e,t){te(e.id)&&this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),e.stemParams&&ya(e.stemParams)||this.throw("invalid stem parameters objeect");const{stemHeight:n,stemVisible:a}=e.stemParams;return void 0===n||yo(n)||this.throw(X("stemHeight","number",e.id)),void 0===a||va(a)||this.throw(X("stemVisibility","boolean",e.id)),{id:e.id,stemParams:{stemHeight:n,stemVisible:a}}}async exec(e,t){var n;const{stemHeight:a,stemVisible:o}=e.stemParams,s={};void 0!==a&&(s.stemHeight=a,(null===(n=this.annotationsViewData.dockedAnnotation)||void 0===n?void 0:n.id)!==e.id&&this.closeTag.exec({id:e.id},t)),void 0!==o&&(s.stemVisible=o),await this.issueCommand(new this.cwfTypes.EditMattertagCommand(e.id,s))}throw(e){throw Error("Tag.editStem: "+e)}}class Ti{constructor(e,t,n,a){this.ChangePinOpacityScaleCommand=e.ChangePinOpacityScaleCommand,this.PinType=e.PinType,this.issueCommand=t.issueCommand,this.mattertagData=n,this.pinsViewData=a}validateInput(e,t){return ee(e.id)||this.throw(X("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),(!yo(e.opacity)||e.opacity<0||e.opacity>1)&&this.throw("'opacity' should be a number in the range of [0, 1]"),{id:e.id,opacity:e.opacity}}async exec(e,t){await this.waitForTagView(e.id),await this.issueCommand(new this.ChangePinOpacityScaleCommand(e.id,this.PinType.MATTERTAG,e.opacity))}async waitForTagView(e){if(!this.pinsViewData.getPin(e))return new Promise((t=>{const n=this.pinsViewData.onPinUpdate({onAdded(a,o){o===e&&(n.cancel(),t())}})}))}throw(e){throw Error("Tag.editOpacity: "+e)}}class Ii{constructor(e){this.editPositions=e}validateInput(e,t){return this.editPositions.validateInput({descriptors:[{id:e.id,options:e.options}]},t).descriptors[0]}async exec(e,t){this.editPositions.exec({descriptors:[{id:e.id,options:e.options}]},t)}}class bi{constructor(e,t,n,a){this.closeTag=e,this.mattertagData=t,this.annotationsViewData=n,this.roomIdMap=a}validateInput(e,t){const{descriptors:n}=e;return Oa(n,((e,n)=>this.validateDescriptor(e,n,t)))||this.throw("descriptors is not an array"),{descriptors:n}}validateDescriptor(e,t,n){return ya(e)||this.throw(`descriptor #${t} is not an object`),void 0===e.id||ee(e.id)||this.throw(`descriptor[${t}].id is not a valid string`),this.validateOptions(e.options)||this.throw(`descriptor #${t}.options is not an object`),!0}validateOptions(e){return e&&ya(e)||this.throw("invalid options provided"),{anchorPosition:this.validateVector3(e.anchorPosition,"`anchorPosition` was provided but not a valid Vector3"),stemVector:this.validateVector3(e.stemVector,"`stemVector` was provided, but not a valid Vector3"),roomId:this.validateRoomId(e.roomId)}}validateVector3(e,t){return void 0===e||Io(e)||this.throw(t),e}validateRoomId(e){return void 0===e||ee(e)||this.throw(X("roomId","string (or undefined)",e)),e&&!this.roomIdMap.getRoomForId(e)&&this.throw(`${e} does not map to a valid room`),e}throw(e){throw Error("Tag.editPositions: "+e)}async exec(e,t){this.mattertagData.atomic((()=>{var n;for(const a of e.descriptors){const{anchorPosition:e,stemVector:o}=a.options,s=this.mattertagData.getTag(a.id),r=a.options.roomId&&this.roomIdMap.getRoomForId(a.options.roomId),i=r?r.floorId:s.floorId,c=e?s.anchorPosition.clone().set(e.x,e.y,e.z):s.anchorPosition,d=o?s.stemVector.clone().set(o.x,o.y,o.z):s.stemVector,l=o?d.length():s.stemHeight;d.normalize(),(e||o)&&(null===(n=this.annotationsViewData.dockedAnnotation)||void 0===n?void 0:n.id)!==a.id&&this.closeTag.exec({id:a.id},t),s.atomic((()=>{s.anchorPosition.set(c.x,c.y,c.z),s.anchorNormal.set(d.x,d.y,d.z),s.floorId=i,s.stemHeight=l,s.anchorPosition.set(c.x,c.y,c.z),s.stemVector.set(d.x,d.y,d.z),s.floorId=i,s.commit()}))}}))}}const Ei={namespace:"Tag",name:"editKeywords",args:["tagId","keywords"]};class Ci{constructor(e){this.tagsData=e,this.keywordUpdates=[]}validateInput(e){if(!Oa(e.keywords,ee))throw Error();if(ee(e.tagId)){const t=this.tagsData.getTag(e.tagId);if(t)return{tag:t,keywords:e.keywords}}throw Error(`${e.tagId} does not map to a valid tag`)}async exec(e){this.keywordUpdates.push(e),1===this.keywordUpdates.length&&((e,t=250)=>{let n;return(...a)=>{window.clearTimeout(n),n=window.setTimeout((()=>e.apply(null,a)),t)}})(this.updateKeywords.bind(this),0)()}updateKeywords(){this.tagsData.atomic((()=>{for(const e of this.keywordUpdates){const t=new Set(e.keywords);e.tag.keywords.replace([...t])}})),this.keywordUpdates.length=0}}const Si={namespace:"Tag",name:"editEnabled",args:["tagId","enabled"]};class Ai{constructor(e){this.tagsData=e}validateInput(e,t){if(!va(e.enabled))throw Error(X("enabled","boolean",e.enabled));if(ee(e.tagId)){const t=this.tagsData.getTag(e.tagId);if(t)return{tag:t,enabled:e.enabled}}throw Error(`${e.tagId} does not map to a valid tag`)}async exec(e,t){e.tag.enabled=e.enabled,e.tag.commit()}}class Oi{constructor(e,t){this.mattertagData=e,this.annotationsModule=t}validateInput(e){const t=e.ids;return Oa(t,ee)||this.throw("'ids' is expected to be a series of strings"),{ids:t}}async exec(e){const t=[];for(const t of e.ids)this.annotationsModule.closeAnnotation(t,ni.TAG);return this.mattertagData.atomic((()=>{for(const n of e.ids)this.mattertagData.removeTag(n),t.push(n)})),t}throw(e){throw Error("Tag.remove: "+e)}}class Di{constructor(e,t){this.mattertagData=e,this.pinsModule=t}validateInput(e,t){return ee(e.id)||this.throw(X("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),{id:e.id}}async exec(e,t){const{id:n}=e;this.pinsModule.setPinRenderOverrides(n,null,null)}throw(e){throw Error(`Tag.resetIcon: ${e}`)}}const Mi="TAG_NAV_OVERLAY",Ri="TAG_BILLBOARD_SHARE",xi="TAG_BILLBOARD_DOCK";Object.freeze({colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"]});class Pi{constructor(e,t){this.setting=e,this.settingsData=t}validateInput(e){if(void 0===e.enable&&(e.enable=!this.settingsData.tryGetSetting(this.setting,!0)),!va(e.enable))throw Error(X("enable","boolean or undefined",e.enable));return{enable:e.enable}}async exec(e){this.settingsData.setSetting(this.setting,e.enable)}}const Ni=new Xt("command.saveToLayer");class _i{constructor(e,t,n,a,o){this.sdkLayer=e,this.externalCommands=t,this.mattertagsData=n,this.layersModule=a,this.attachmentsModule=o}validateInput(e,t){const n={};if(!e.options)return{options:n};if(!ya(e.options))throw new Error("Validation Error: `options` must be an object.");if(e.options.progress){if("function"!=typeof e.options.progress)throw new Error("Validation Error: `progress` must be a function.");n.progress=e.options.progress}if(e.options.tagsToUpdate){if(!Oa(e.options.tagsToUpdate,ee))throw new Error("tagsToUpdate' is expected to be a series of strings");n.tagsToUpdate=e.options.tagsToUpdate}if(e.options.layerName){if(!te(e.options.layerName)||0===e.options.layerName.trim().length)throw new Error("Validation Error: `layerName` must be a non-empty string.");n.layerName=e.options.layerName}return{options:n}}async exec(e,t){var n,a;if(null===this.sdkLayer)return Ni.warn("Layers must be enabled to use Tag.saveToLayer."),[];const o=[];let s=0;for(const t of this.mattertagsData){const a={isTransientTag:t.layerId===this.sdkLayer.id,isUpdateTag:null===(n=e.options.tagsToUpdate)||void 0===n?void 0:n.includes(t.sid)};o.push(t),s+=t.externalAttachments.length,a.isTransientTag&&(s+=t.fileAttachments.length)}if(0===o.length)return[];const r=new qr(o.length+s+1);let i;e.options.progress&&(i=r.percentCompleted.onChanged(e.options.progress)),r.start();const c=(new Date).toLocaleString(),d=e.options.layerName?e.options.layerName.trim():`Imported ${c}`,l=o.filter((e=>{var t;return e.layerId===(null===(t=this.sdkLayer)||void 0===t?void 0:t.id)})).length;l>0&&await this.layersModule.addLayer(d,!1),r.notifyTaskCompleted();const u=[];for(const t of o){const n={position:t.anchorPosition,normal:t.anchorNormal,roomId:t.roomId,floorId:t.floorId,color:Object.assign({},t.color),description:t.description,label:t.label,stemHeight:t.stemHeight,stemVisible:t.stemVisible,enabled:t.enabled,keywords:t.keywords.values(),icon:t.icon},o=null===(a=e.options.tagsToUpdate)||void 0===a?void 0:a.includes(t.sid),s=[];if(!o){for(const e of t.fileAttachments){const n=await fetch(await e.url.get()),a=await n.blob(),o=new File([a],e.filename||"image.jpg",{type:a.type}),i=await this.attachmentsModule.uploadAttachments(t.sid,an.MATTERTAG,[o]);i[0].attachment&&s.push(i[0].attachment),r.notifyTaskCompleted()}t.fileAttachments.length=0,s.forEach((e=>{t.fileAttachments.push(e)}))}let i=null;if(t.externalAttachments&&t.externalAttachments.length>0&&(i=await this.attachmentsModule.embedMedia(t.sid,an.MATTERTAG,t.externalAttachments.get(0).src),r.notifyTaskCompleted()),o){const e=[];try{await this.externalCommands.issueCommand(new Gr(t.sid,n,s,e,i))}catch(e){Ni.warn(`Could not save tag sid:${t.sid} label: ${t.label}}, skipping it.`)}}else{const e=t.sid.replace(/^.*?_/,"");try{await this.externalCommands.issueCommand(new Ur(e,n,s,i)),u.push(t.sid)}catch(n){Ni.warn(`Could not save tag sid:${e} label: ${t.label}}, skipping it.`)}}r.notifyTaskCompleted(),this.attachmentsModule.resetAttachmentChanges()}return r.forceComplete(),null==i||i.cancel(),u}}class ki{constructor(){this.activePromise=Promise.resolve(new Li)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new Li)))})),t=this.activePromise;return this.activePromise=e,t}}class Li{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}const Vi=new Xt("command.importAttachments");class Fi{constructor(e,t){this.externals=e,this.getTagsQuery=t,this.lock=new ki,this.lastImportCache=null}validateInput(e,t){if(!ee(e.srcSpaceId))throw Error("invalid space id"+e.srcSpaceId);if(!ee(e.destTagId))throw Error("invalid tag id"+e.destTagId);if(!Oa(e.attachmentIds,ee))throw Error("invalid attachment ids"+JSON.stringify(e.attachmentIds));return e}async exec(e,t){const n=await this.lock.lock();let a;if(this.lastImportCache&&this.lastImportCache.spaceId===e.srcSpaceId&&Date.now()<this.lastImportCache.validUntil)a=this.lastImportCache.tags,n.unlock();else try{a=await this.getTagsQuery(e.srcSpaceId),this.lastImportCache={spaceId:e.srcSpaceId,tags:a,validUntil:Date.now()+6e4}}catch(t){throw Error(`Tag.importAttachments: Error reading tags from space id ${e.srcSpaceId}`)}finally{n.unlock()}const o=a.reduce(((e,t)=>({fileAttachments:Object.fromEntries([...Object.entries(e.fileAttachments),...t.fileAttachments.map((e=>[e.id,e]))]),externalAttachments:Object.fromEntries([...Object.entries(e.externalAttachments),...t.externalAttachments.map((e=>[e.id,e]))])})),{fileAttachments:{},externalAttachments:{}}),s=Object.values(o.fileAttachments).filter((t=>e.attachmentIds.includes(t.id))),r=Object.values(o.externalAttachments).filter((t=>e.attachmentIds.includes(t.id))),i=[...s,...r],c=new Set(e.attachmentIds);return i.forEach((e=>c.delete(e.id))),c.size>0&&Vi.warn(`couldn't find ${c.size} attachments. Continuing without them.\n         \n\t${[...c].join("\n\t")}`),(s.length||r.length)&&await this.externals.issueCommand(new Fr(e.destTagId,{fileAttachments:s,externalAttachments:r,refreshIds:[e.srcSpaceId]},Fr.Operation.ADD)),{copied:e.attachmentIds.filter((e=>!c.has(e))),missing:[...c]}}}function Ui(e,t,n,a,o,s,r,i,c,d,l){const{mattertagData:u,pinsModule:h,meshData:p,floorData:m,pinViewData:g,annotationsViewData:f,tagsViewData:w,roomData:y,roomIdMap:v,settingsData:T,meshQuery:I,layersModule:b,annotationsModule:E,attachmentsModule:C}=l;e.addEnumToInterface({namespace:"Tag",name:"AttachmentType",values:O.AttachmentType});const S=function(e,t){const n=oa.create(t,new Rr,new z(xr));return e.addCollectionToInterface({namespace:"Tag",name:"attachments"},n),n}(e,new B(s)),A=function(e,t){const n=Y.create(t,new z(kr));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerAttachment",args:["srcs"],varArg:!0},n),n}(e,new B(s)),D=function(e,t){const n=Y.create(t,new z(mi,e));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerSandbox",args:["html","options"],subRoutine:"tag.registerSandbox"},n),n}(e,new B(s,f,r)),M=function(e,t){const n=Y.create(t,new z(Pr));return e.addAsyncCommandToInterface({namespace:"Tag",name:"attach",args:["tagId","attachmentIds"],varArg:!0,options:{replay:!0}},n),n}(e,new B(u,s)),R=function(e,t){const n=Y.create(t,new z(Nr));return e.addAsyncCommandToInterface({namespace:"Tag",name:"detach",args:["tagId","attachmentIds"],varArg:!0,options:{replay:!0}},n),n}(e,new B(u,s)),x=function(e,t){const n=ce.create(t,new li,new z(ui));return e.addObservableToInterface({namespace:"Tag",name:"openTags"},n),n}(e,new B(g,f)),P=function(e,t,n){const a=oa.create(n,new Yr,new z(Xr,t));return e.addCollectionToInterface({namespace:"Tag",name:"data",elementFactory:"tag.data"},a),a}(e,t,new B(u,w,v,y,p)),N=function(e,t,n,a){const o=Y.create(a,new z(ti,Object.assign(Object.assign({},t),n)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"open",args:["id","options"]},o),o}(e,n,a,new B(u,w)),_=function(e,t){const n=Y.create(t,new z(oi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"dock",args:["id","options"]},n),n}(e,new B(u,E)),k=function(e,t,n,a){const o=Y.create(a,new z(si,Object.assign(Object.assign({},t),n)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"close",args:["id"]},o),o}(e,n,a,new B(u,w)),L=function(e,t){const n=Y.create(t,new z(gi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"allowAction",args:["id","allow"],options:{replay:!0}},n),n}(e,new B(g,w,f,E)),V=function(e,t,n,a){const o=Y.create(a,new z(fi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editBillboard",args:["id","properties"],options:{replay:!0}},o),o}(e,n,a,new B(u)),F=function(e,t,n,a,o){const s=Y.create(o,new z(wi,t,n,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editColor",args:["id","color"],options:{replay:!0}},s),s}(e,t,n,a,new B(u)),U=function(e,t,n,a,o){const s=Y.create(o,new z(yi,t,n,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editIcon",args:["id","iconId"],options:{replay:!0}},s),s}(e,a,t,d,new B(u,h,o,w)),G=function(e,t,n,a){const o=Y.create(a,new z(Ti,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editOpacity",args:["id","opacity"],options:{replay:!0}},o),o}(e,n,a,new B(u,g)),H=function(e,t,n,a){const o=Y.create(a,new z(vi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editStem",args:["id","stemParams"],options:{replay:!0}},o),o}(e,n,a,new B(k,u,f)),$=function(e,t){const n=Y.create(t,new z(bi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPositions",args:["descriptors"],varArg:!0,options:{replay:!0}},n),n}(e,new B(k,u,f,v)),j=function(e,t){const n=Y.create(t,new z(Ii));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPosition",args:["id","options"],options:{replay:!0}},n),n}(e,new B($)),q=function(e,t){const n=Pa.create(t,new z(Ci));return e.addCommandUnlisted(Ei,n),n}(e,new B(u)),W=function(e,t){const n=Pa.create(t,new z(Ai));return e.addCommandUnlisted(Si,n),n}(e,new B(u)),K=function(e,t){const n=Y.create(t,new z(Oi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"remove",args:["ids"],varArg:!0,options:{replay:!0}},n),n}(e,new B(u,E)),X=function(e,t){const n=Y.create(t,new z(Di));return e.addAsyncCommandToInterface({namespace:"Tag",name:"resetIcon",args:["id"],options:{replay:!0}},n),n}(e,new B(u,h)),Z=function(e,t,n,a,o){const s=Y.create(o,new z(Jr,t,n,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"add",args:["descriptors"],varArg:!0,options:{replay:!0}},s),s}(e,t,n,a,new B(u,M,U,G,s,o,I,w)),Q=function(e,t,n,a,o,s){const r=Y.create(o,new z(Kr,t,n,a,s));return e.addAsyncCommandToInterface({namespace:"Tag",name:"importTags",args:["spaceSid","options"],varArg:!1,origins:ne,options:{replay:!1}},r),r}(e,c,t,a,new B(u,m,y,p,b),i),J=function(e,t,n,a){const o=Y.create(a,new z(_i,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"saveToLayer",args:["options"],varArg:!1,origins:ne,options:{replay:!1}},o),o}(e,c,a,new B(u,b,C)),ee=function(e,t,n){const a=Y.create(B.none,new z(Fi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"importAttachments",args:["destTagId","srcSpaceId","attachmentIds"],origins:ne},a),a}(e,a,i),te=new B(T),ae=function(e,t){const n=Y.create(t,new z(Pi,xi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleDocking",args:["enable"]},n),n}(e,te),oe=function(e,t){const n=Y.create(t,new z(Pi,Mi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleNavControls",args:["enable"]},n),n}(e,te),se=function(e,t){const n=Y.create(t,new z(Pi,Ri));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleSharing",args:["enable"]},n),n}(e,te);return{attachments:S,registerAttachment:A,registerSandbox:D,attach:M,importTags:Q,detach:R,data:P,openTags:x,add:Z,open:N,dock:_,close:k,allowAction:L,editBillboard:V,editColor:F,editIcon:U,editOpacity:G,editStem:H,editPosition:j,editPositions:$,editKeywords:q,editEnabled:W,remove:K,resetIcon:X,toggleDocking:ae,toggleNavControls:oe,toggleSharing:se,saveToLayer:J,importAttachments:ee}}class Gi{constructor(e,t){this.tagsViewData=e,this.layersData=t}validateInput(e,t){return{}}async exec(e,t){const n={};for(const e of this.tagsViewData.getCollection()){const t=this.layersData.getLayer(e.layerId);n[e.id]=!!(null==t?void 0:t.toggled)||!e.layerId}return n}}class Hi{validateInput(e){if(!ee(e.arg0))throw Error(`Stat.test: arg0 was specified but was not a valid string; got ${e.arg0}`);return e}async exec(e,t){return e.arg0}}class Bi{create(){return Oe((()=>{}),(()=>{}))}}class zi{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.test===a.test}update(){}clear(){this._data={}}}var $i;!function(e){e.ENUM1="test.enum1",e.ENUM2="test.enum2"}($i||($i={}));class ji{validateInput(e){return e}async exec(e,t){}}class qi{create(e){return Oe((()=>{}),(()=>{}))}}class Wi{constructor(){this._data={testString:"hello"}}get data(){return this._data}equals(e){return this._data.testString===e.data.testString}copy(e){this._data.testString=e.data.testString}update(){}}function Ki(e,t){const{tagsViewData:n,layersData:a}=t,o=function(e,t){const n=oa.create(t,new Bi,new z(zi));return e.addCollectionToInterface({namespace:"Test",name:"directCollection",sdkTypes:[Ft.DIRECT],origins:ne},n),e.addCollectionToInterface({namespace:"Test",name:"postMessageCollection",sdkTypes:[Ft.POSTMESSAGE],origins:ne},n),n}(e,B.none),s=function(e,t){const n=ce.create(t,new qi,new z(Wi));return e.addObservableToInterface({namespace:"Test",name:"directObservable",sdkTypes:[Ft.DIRECT],origins:ne},n),e.addObservableToInterface({namespace:"Test",name:"postMessageObservable",sdkTypes:[Ft.POSTMESSAGE],origins:ne},n),n}(e,B.none),r=function(e,t){const n=Y.create(t,new z(Gi));return e.addAsyncCommandToInterface({namespace:"Test",name:"getTagVisibility",args:[],origins:ne},n),n}(e,new B(n,a));return function(e){e.addEnumToInterface({namespace:"Test",name:"directEnum",values:$i,sdkTypes:[Ft.DIRECT],origins:ne}),e.addEnumToInterface({namespace:"Test",name:"postMessageEnum",values:$i,sdkTypes:[Ft.POSTMESSAGE],origins:ne})}(e),function(e,t){const n=Y.create(t,new z(Hi));e.addCommandToInterface({namespace:"Test",name:"echo",args:["arg0"],origins:ne},n),e.addAsyncCommandToInterface({namespace:"Test",name:"echoAsync",args:["arg0"],origins:ne},n),e.addCommandToInterface({namespace:"Test.Sub",name:"echo",args:["arg0"],origins:ne},n),e.addAsyncCommandToInterface({namespace:"Test.Sub",name:"echoAsync",args:["arg0"],origins:ne},n),e.addCommandToInterface({namespace:"Test.Sub.Sub2",name:"echo",args:["arg0"],origins:ne},n),e.addAsyncCommandToInterface({namespace:"Test.Sub.Sub2",name:"echoAsync",args:["arg0"],origins:ne},n)}(e,B.none),function(e,t){const n=Y.create(t,new z(ji));e.addCommandToInterface({namespace:"Test",name:"directCommand",args:[],sdkTypes:[Ft.DIRECT],varArg:!1,origins:ne},n),e.addCommandToInterface({namespace:"Test",name:"postMessageCommand",args:[],sdkTypes:[Ft.POSTMESSAGE],varArg:!1,origins:ne},n)}(e,B.none),{collection:o,observable:s,visibleTagsCheckCommand:r}}(class extends me{constructor(){super()}}).id="LOCK_NAVIGATION";(class extends me{constructor(){super()}}).id="UNLOCK_NAVIGATION";(class extends me{constructor(e){super(),this.payload=e}}).id="FOCUS_ON_POINT_INSIDE";(class extends me{constructor(e){super(),this.payload=e}}).id="FOCUS_ON_PIN_INSIDE";class Yi extends me{constructor(e){super(),this.payload=Object.assign({},e)}}Yi.id="MOVE_TO_SWEEP";(class extends me{constructor(e){super(),this.payload=e}}).id="NAVIGATE_TO_LABEL";(class extends me{constructor(e){super(),this.payload={room:e}}}).id="NAVIGATE_TO_ROOM";(class extends me{constructor(e){super(),this.payload={pose:e}}}).id="NAVIGATE_TO_POSE";class Xi{constructor(e,t,n){this.commands=e,this.sweepData=t,this.roomBoundData=n}validateInput(e){const t=this.validateInputRoomId(e.roomId),n=e.options||{};if(n.transition&&!wn(g.TransitionType,n.transition))throw Error(`PI.Room.moveTo: options.transition was specified but was not a valid transition type; got ${n.transition}`);const a=this.validateTransitionTime(n.transitionTime),o=this.validateCenterOnSweeps(n.centerOnSweeps),s=this.validateFindBestView(n.findBestView);return{roomId:t,options:{transition:n.transition,transitionTime:a,centerOnSweeps:o,findBestView:s}}}validateInputRoomId(e){if(!e||!ee(e))throw Error(`PI.Room.moveTo: 'roomId' was not a valid room id; got ${e}`);if(!this.roomBoundData.tryGetRoom(e))throw Error(e+" does not map to a valid room in this model");return e}validateTransitionTime(e){if(!e)return;const t=Error(`PI.Room.moveTo: transitionTime was specified but was not a valid, positive time; got ${e}`);if(!yo(e))throw t;if(e<=0)throw t;return e}validateCenterOnSweeps(e){if(null==e)return!1;if("boolean"!=typeof e)throw Error(`PI.Room.moveTo: options.centerOnSweeps was specified but was not a boolean; got ${e}`);return e}validateFindBestView(e){if(!e)return!1;if("boolean"!=typeof e)throw Error(`PI.Room.moveTo: options.findBestView was specified but was not a boolean; got ${e}`);return e}findSweepsInRoom(e){const t=this.roomBoundData.getRoom(e),n=Array.from(this.sweepData.sweeps()).filter((t=>t.enabled&&t.roomId===e));if(0===n.length)throw Error(`No enabled sweeps found in room with id: ${e}`);return{sweeps:n,targetRoom:t}}calculateRotationFromOtherSweeps(e,t){const n=t.length;if(0===n)return;const a=t.reduce(((e,t)=>({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z})),{x:0,y:0,z:0}),o=a.x/n-e.x,s=a.z/n-e.z,r=a.y/n-e.y,i=Math.atan2(o,s);return{x:Math.atan2(r,Math.sqrt(o*o+s*s)),y:Math.PI+i}}calculateRotationFromViewCenter(e,t){const n={x:t.x-e.x,y:t.y-e.y,z:t.z-e.z};return{x:0,y:Math.atan2(n.x,n.z)-Math.PI}}async getBestSweepIdAndRotation(e){const t=await this.roomBoundData.getBestView(e);return t?{sweepId:t.sweepId,rotation:{x:0,y:t.angle}}:this.getFirstSweepIdAndRotation(e,!1)}getFirstSweepIdAndRotation(e,t){const{sweeps:n,targetRoom:a}=this.findSweepsInRoom(e),o=n[0];let s;if(t&&n.length>1)s=this.calculateRotationFromOtherSweeps(o.position,n.slice(1).map((e=>e.position)));else if(!t){const e=a.getViewCenter();s=this.calculateRotationFromViewCenter(o.position,e)}return{sweepId:o.id,rotation:s}}async exec(e){var t,n,a,o,s,r;const i=null!==(n=null===(t=e.options)||void 0===t?void 0:t.centerOnSweeps)&&void 0!==n&&n;let c;c=null!==(o=null===(a=e.options)||void 0===a?void 0:a.findBestView)&&void 0!==o&&o?await this.getBestSweepIdAndRotation(e.roomId):this.getFirstSweepIdAndRotation(e.roomId,i);const d=c.rotation?this.commands.conversionUtils.rotationToQuaternion({x:180*c.rotation.x/Math.PI,y:180*c.rotation.y/Math.PI}):void 0,l=(null===(s=e.options)||void 0===s?void 0:s.transition)?this.commands.cameraTransitionConverter.fromSdkTransition(e.options.transition):void 0,u=null===(r=e.options)||void 0===r?void 0:r.transitionTime;return await this.commands.issueCommand(new Yi({sweep:c.sweepId,rotation:d,transition:l,transitionTime:u}))}}class Zi{create(e,t){return t.makeCurrentRoomWithSweepDataSubscription((()=>e.onChanged()))}}class Qi{constructor(){this._data=null}get data(){return this._data}equals(e){return null===this._data&&null===e._data||null!==this._data&&null!==e._data&&(this._data.id===e._data.id&&this._data.name===e._data.name&&this._data.area===e._data.area&&JSON.stringify(this._data.roomTypes)===JSON.stringify(e._data.roomTypes))}copy(e){this._data=e._data?Object.assign({},e._data):null}update(e){if(e.isInTransitionState())return void(this._data=null);const t=e.currentRoom;if(t){const n=e.roomClassifications;this._data={id:t.id,name:t.name,area:t.area,roomTypes:(t.roomTypeIds||[]).map((e=>{const t=n[e];return{id:e,label:(null==t?void 0:t.label)||e,defaultKeywords:null==t?void 0:t.defaultKeywords}}))}}else this._data=null}}const Ji="internal_2",ec="spaces.plugins.groups";const tc=new Xt("sdk: tours");class nc{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){return void 0!==e.index&&isNaN(e.index)&&(tc.warn(e.index,"is not a valid number"),e.index=void 0),void 0!==e.steps&&isNaN(e.steps)&&(tc.warn(e.steps,"is not a valid number"),e.steps=void 0),e}async exec(e){if(0===this.tourData.getHighlightsCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStart ignored, cannot change location at this time, another transition is active");try{this.tourControls.startTour(e)}catch(e){throw Error(`Error occurred while starting tour - ${e}`)}}}class ac{constructor(e){this.tourControls=e}validateInput(e){return e}async exec(e){try{await this.tourControls.stopTour()}catch(e){throw Error(`Error occurred while stopping tour - ${e}`)}}}class oc{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){const t=e.index;if(!yo(t))throw Error(t+" is not a valid tour snapshot index");if(t<0||t>this.tourData.getHighlightsCount())throw Error(`${t} is outside of the range of tour snapshots: [0 , ${this.tourData.getHighlightsCount()-1}]`);return{index:t}}async exec(e){if(0===this.tourData.getHighlightsCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{await this.tourControls.tourGoTo(e.index)}catch(e){throw Error(`Error occurred while jumping to new tour location - ${e}`)}}}class sc{constructor(e,t,n){this.forward=e,this.tourControls=t,this.tourData=n}validateInput(e){return e}async exec(e){if(0===this.tourData.getHighlightsCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{this.forward?await this.tourControls.tourGoNext():await this.tourControls.tourGoPrevious()}catch(e){throw Error(`Error while trying to travel to the next tour snapshot - ${e}`)}}}class rc{constructor(e,t,n){this.tourData=t,this.settingsData=n}validateInput(e){let t=null==e?void 0:e.options;return t&&"object"==typeof t||(t={}),"boolean"!=typeof t.forceRegenerate&&(t.forceRegenerate=!1),"boolean"!=typeof t.forceAutotour&&(t.forceAutotour=!1),{options:{forceRegenerate:t.forceRegenerate,forceAutotour:t.forceAutotour}}}async exec(e){(0===this.tourData.getHighlightsCount()||e.options.forceAutotour)&&await this.tourData.setupTour(this.settingsData,e.options.forceRegenerate)}}function ic(e,t,n,a){!function(e,t,n){t.addBinding(cc,(async()=>n.getDependencies().then((async([n,a])=>{const o=await Promise.all(a.getEnabledSnapshots().map((n=>async function(e,t,n){const a=!e.is360,o=n.viewmodeConverter.toSdk(e.metadata.cameraMode,a);if(!o||o===n.commandModeConverter.toSdk(t.CommandViewmode.TRANSITIONING))throw Error("Failed to convert snapshot, invalid viewmode");const s={sid:e.sid,thumbnailUrl:await e.thumbnailUrl.get(),imageUrl:await e.imageUrl.get(),is360:e.is360,name:e.name,mode:o,zoom:e.metadata.ssZoom,position:e.metadata.cameraPosition,rotation:n.conversionUtils.quaternionToRotation(e.metadata.cameraQuaternion)};return s}(n,e,t))));if(0===o.length)throw Error("No tour data found");return o}))))}(t,n,a),e.addCommandCreator({namespace:"Tour",name:"getData",args:[]},(()=>new cc));const o=a,s=Y.create(o,new z(nc)),r=Y.create(o,new z(ac)),i=Y.create(o,new z(oc)),c=Y.create(o,new z(sc,!0)),d=Y.create(o,new z(sc,!1)),l=Y.create(o,new z(rc));e.addAsyncCommandToInterface({namespace:"Tour",name:"setup",args:["options"],origins:ne},l),e.addAsyncCommandToInterface({namespace:"Tour",name:"start",args:["index"]},s),e.addCommandToInterface({namespace:"Tour",name:"stop",args:[]},r),e.addCommandToInterface({namespace:"Tour",name:"step",args:["index"]},i),e.addCommandToInterface({namespace:"Tour",name:"prev",args:[]},d),e.addCommandToInterface({namespace:"Tour",name:"next",args:[]},c)}class cc extends me{}cc.id="GET_TOUR_DATA";class dc{create(e,t){return t.onChanged((()=>e.onChanged()))}}class lc{constructor(){this._data={step:null,index:null}}get data(){return this._data}equals(e){return this._data.step===e.data.step&&this._data.index===e.data.index}copy(e){this._data.step=e.data.step,this._data.index=e.data.index}update(e){var t,n;this._data.step=e.isTourActive()&&null!==(t=e.getTourCurrentSnapshotSid())&&void 0!==t?t:null,this._data.index=e.isTourActive()&&null!==(n=e.getTourCurrentSnapshotIndex())&&void 0!==n?n:null}}class uc{create(e,t){return t.onChanged((()=>e.onChanged()))}}class hc{constructor(e){this._data={current:D.PlayState.INACTIVE},this.tourStateConverter=e.tourStateConverter}get data(){return this._data}equals(e){return this._data.current===e.data.current}copy(e){this._data.current=e.data.current}update(e){this._data.current=this.tourStateConverter.toSdkTourState(e.getTourState())}}class pc{constructor(e){this.toSdkTourStateMap={[e.Inactive]:D.PlayState.INACTIVE,[e.Active]:D.PlayState.ACTIVE,[e.StopScheduled]:D.PlayState.STOP_SCHEDULED}}toSdkTourState(e){return this.toSdkTourStateMap[e]}}class mc{create(e,t){return t.onChanged((()=>e.onChanged()))}}class gc{constructor(){this._data={from:null,to:null}}get data(){return this._data}equals(e){return this._data.from===e.data.from&&this._data.to===e.data.to}copy(e){this._data.from=e.data.from,this._data.to=e.data.to}update(e){const t=this.hasEnded;if(this.hasEnded=e.tourEnded,!t&&this.hasEnded)return this._data.from=null,void(this._data.to=null);const n=-1===e.tourCurrentSnapshot?null:e.getTourEntrySidFromIndex(e.tourCurrentSnapshot),a=-1===e.transition.toIndex?null:e.getTourEntrySidFromIndex(e.transition.toIndex);null!==a&&(n===a?(this._data.from=null,this._data.to=null):(this._data.from=n,this._data.to=a))}}const fc={includeDefurnish:!0,includeDisabled:!1,includeInsights:!1};function wc(e,t){var n;const a={[ye.BASE_LAYER]:M.LayerType.BASE,[ye.VIEW_DATA_LAYER]:M.LayerType.VIEW_DATA,[ye.USER_LAYER]:M.LayerType.USER,[ye.COMMON_USER_LAYER]:M.LayerType.USER,[ye.IN_MEMORY]:M.LayerType.IN_MEMORY,[ye.COMMON_IN_MEMORY]:M.LayerType.IN_MEMORY};var o;return(t=t||{}).id=e.id,t.name=e.name,t.type=null!==(n=a[e.layerType])&&void 0!==n?n:M.LayerType.OTHER,t.toggled=e.toggled,t.common=(o=e.layerType)===ye.COMMON_IN_MEMORY||o===ye.COMMON_USER_LAYER||o===ye.PROXY_LAYER,t}class yc{constructor(){this.layerSubscriptions=new Map}create(e,t){const n=t.layersData.onCurrentLayersChanged((()=>{this.subscribeToLayers(e,t.layersData),e.onChanged()}));return{renew:()=>{n.renew();for(const[,e]of this.layerSubscriptions)e.renew()},cancel:()=>{n.cancel();for(const[,e]of this.layerSubscriptions)e.cancel()}}}subscribeToLayers(e,t){for(const n of t.getOrderedModelViews(fc)){if(n.enabled)for(const a of t.filterUserFacingLayers(n.layers))this.layerSubscriptions.has(a)||this.layerSubscriptions.set(a,a.onChanged((()=>e.onChanged())));for(const n of t.inMemoryLayers)this.layerSubscriptions.has(n)||this.layerSubscriptions.set(n,n.onChanged((()=>e.onChanged())))}}}class vc{constructor(e){this._data={},this.layersData=e.layersData}get data(){return this._data}isItemEqual(e,t){return this.isLayerEqual(this.data[t],e.data[t])}isLayerEqual(e,t){return e.id===t.id&&e.name===t.name&&e.toggled===t.toggled&&e.type===t.type}update(){const e=new Set;for(const t of this.layersData.getOrderedModelViews(fc))if(t.enabled)for(const n of this.layersData.filterUserFacingLayers(t.layers))this._data[n.id]=wc(n,this._data[n.id]),e.add(n.id);for(const t of this.layersData.inMemoryLayers)this._data[t.id]=wc(t,this._data[t.id]),e.add(t.id);for(const t in this.data)e.has(t)||delete this._data[t]}clear(){this._data={}}}function Tc(e,t,n){const a={[we.DEFURNISH]:M.ViewType.DEFURNISH,[we.BASE]:M.ViewType.BASE,[we.LAYERED_BASE]:M.ViewType.LAYERED_BASE,[we.USER]:M.ViewType.USER};(n=n||{}).id=t.id,n.name=t.name,n.type=(t.viewType?a[t.viewType]:M.ViewType.OTHER)||M.ViewType.OTHER,n.active=e.currentViewId===t.id,n.transient=t.transient;const o=e.filterUserFacingLayers(t.layers).map((e=>wc(e)));return n.layers=Cn(n.layers||[],o),n}class Ic{constructor(){this.viewSubscriptions=new Map}create(e,t){return new kt(t.layersData.onModelViewsChanged((()=>e.onChanged())),t.layersData.onCurrentLayersChanged((()=>e.onChanged())),this.watchViews(t.layersData,e))}watchViews(e,t){return e.onModelViewsChanged((()=>{for(const[t,n]of[...this.viewSubscriptions])e.hasView(t.id)||(n.cancel(),this.viewSubscriptions.delete(t));e.getOrderedModelViews().forEach((e=>{if(e.enabled&&!this.viewSubscriptions.has(e)){const n=e.layers.onChanged((()=>t.onChanged()));this.viewSubscriptions.set(e,n)}}))})),{renew:()=>{this.viewSubscriptions.forEach((e=>e.renew()))},cancel:()=>{this.viewSubscriptions.forEach((e=>e.cancel()))}}}}class bc{constructor(e){this._data={},this.layersData=e.layersData}get data(){return this._data}isItemEqual(e,t){return this.isViewEqual(this.data[t],e.data[t])}isViewEqual(e,t){return e.id===t.id&&e.name===t.name&&e.layers.length===t.layers.length&&e.active===t.active&&e.type===t.type&&e.layers.every(((e,n)=>{const a=t.layers[n];return e.id===a.id&&e.name===a.name&&e.toggled===a.toggled}))}update(){for(const e of this.layersData.getOrderedModelViews(fc))this._data[e.id]=Tc(this.layersData,e,this._data[e.id]);for(const e in this.data)try{this.layersData.getView(e)||delete this._data[e]}catch(t){delete this._data[e]}}clear(){this._data={}}}class Ec{constructor(e,t){this.ownedViews=e,this.layersModule=t}validateInput(e){if(!ee(e.name))throw X("name","string",e.name);return{name:e.name}}async exec(e,t){const n=await this.layersModule.addUserView(e.name,!0);return this.ownedViews.add(t.client.applicationKey,n.id),Tc(this.layersModule.layersData,n)}}class Cc{constructor(e,t){this.ownedViews=e,this.layersModule=t}validateInput(e,t){if(!ee(e.viewId))throw X("name","string",e.viewId);const n=this.layersModule.layersData.getView(e.viewId);if(!n||!n.transient)throw Error(`${e.viewId} does not map to a valid view`);if(!this.ownedViews.has(t.client.applicationKey,n.id))throw Error("Cannot delete a view not associated with this SDK connection");return{view:n}}async exec(e,t){await this.layersModule.deleteView(e.view.id),this.ownedViews.remove(t.client.applicationKey,e.view.id)}}var Sc;!function(e){e.ADD="view.add.layer",e.REMOVE="view.remove.layer"}(Sc||(Sc={}));const Ac={namespace:"View",name:"update",args:["op","viewId","layerId"]},Oc={namespace:"View",name:"activate",args:["viewId","returnToStart"]};const Dc={namespace:"View",name:"toggleLayer",args:["layerId","activate"]},Mc={namespace:"View",name:"queryLayerInterface",args:[]},Rc={namespace:"View",name:"persist",args:["viewId"]};class xc extends me{constructor(e){super(),this.payload=e}}var Pc;xc.id="SAVE_COMMAND",function(e){e.BLURS="blurs",e.BLUR_SUGGESTIONS="blur-suggestions",e.FLOORS="floors",e.HIGHLIGHTS="highlights",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTS="measurements",e.NOTES="notes",e.OBJECT_ANNOTATIONS="objectAnnotations",e.ORDERED_LISTS="orderedLists",e.PHOTOS="photos",e.PLUGINS="plugins",e.SETTINGS="settings",e.START_LOCATION="startlocation",e.SWEEPS="sweeps",e.LAYERS="layers",e.ROOM_BOUNDS="room_bounds"}(Pc||(Pc={}));class Nc{constructor(e,t,n){this.issueCommand=e,this.ignoredLayerer=t,this.layersModule=n}validateInput(e,t){const n=this.layersModule.layersData.getView(e.viewId);if(!n)throw Error(`View id ${e.viewId} does not map to a valid View. Was it deleted or already persisted?`);return{view:n}}async exec(e,t){const n=await this.layersModule.addUserView(e.view.name);for(const t of e.view.layers)this.ignoredLayerer.includes(t)||(await this.layersModule.addLayer(t.name,!1),await t.applyTransactions());return await this.layersModule.deleteView(e.view.id),await this.issueCommand(new xc({dataTypes:[...Object.values(Pc)]})),Tc(this.layersModule.layersData,n)}}class _c{constructor(e,t){this.ownedLayers=e,this.layersModule=t}validateInput(e,t){if(!ee(e.name))throw Error("an empty name is not allowed");const n=e.options;if(n&&!ya(n))throw Error("invalid `options` object");const a=null==n?void 0:n.common;if(void 0!==a&&!va(a))throw X("options.common","boolean",a);return{name:e.name,options:{common:!!a}}}async exec(e,t){const{options:{common:n}}=e,a=this.layersModule.addInMemoryLayer({name:e.name,toggled:!0,visible:!0,common:n});return this.ownedLayers.add(t.client.applicationKey,a.id),{id:a.id,name:a.name,type:M.LayerType.IN_MEMORY,toggled:!0,common:n}}}class kc{constructor(e,t){this.ownedLayers=e,this.layersModule=t}validateInput(e,t){if(!ee(e.layerId))throw Error(`${e.layerId} does not map to a valid layer`);const n=this.layersModule.layersData.findLayer(e.layerId);if(!n)throw Error(`${e.layerId} does not map to a valid layer`);if(!this.ownedLayers.has(t.client.applicationKey,n.id))throw Error("Cannot delete a layer not associated with this SDK connection");return{layer:n}}async exec(e,t){for(const t of this.layersModule.layersData.getOrderedModelViews()){const n=t.layers.findIndex((t=>t.id===e.layer.id));n>-1&&t.layers.remove(n)}this.layersModule.deleteInMemoryLayer(e.layer.id),this.ownedLayers.remove(t.client.applicationKey,e.layer.id)}}const Lc=new Xt("View.updateLayer");class Vc{constructor(e,t){this.ownedLayers=e,this.layersData=t.layersData}validateInput(e,t){if(!wn(Sc,e.op))throw Error(`${e.op} is an unsupported operation`);if(!ee(e.viewId))throw Error(`${e.viewId} is not a valid view id`);const n=this.layersData.getView(e.viewId);if(!n)throw Error(`${e.viewId} does not map to a valid View`);if(!ee(e.layerId))throw Error(`${e.layerId} is not a valid layer id`);const a=this.layersData.inMemoryLayers.find((t=>t.id===e.layerId));if(!a)throw Error(`Only SDK created layers can be manipulated. ${e.layerId} does not map to an SDK-owned layer`);if(!this.ownedLayers.has(t.client.applicationKey,a.id))throw Error("Cannot manipulate layers not associated with this SDK connection");return{op:e.op,view:n,layer:a}}async exec(e,t){({[Sc.ADD]:(e,t)=>{this.layersData.commonInMemoryLayers.includes(t)?Lc.debug("Layer is common. No need to add."):e.layers.includes(t)||e.layers.push(t)},[Sc.REMOVE]:(e,t)=>{const n=e.layers.findIndex((e=>e.id===t.id));if(n>=0){this.layersData.commonInMemoryLayers.includes(t)?Lc.debug("Layer is common. Cannot be removed from View."):e.layers.remove(n)}}})[e.op](e.view,e.layer)}}class Fc{constructor(e,t){this.layersModule=e,this.cameraStartModule=t}validateInput(e,t){if(!ee(e.viewId)||!this.layersModule.layersData.getView(e.viewId))throw Error(`${e.viewId} does not map to a valid View`);return{viewId:e.viewId,returnToStart:!!e.returnToStart}}async exec(e,t){e.returnToStart?await this.layersModule.setActiveModelView(e.viewId):(this.cameraStartModule.setMoveCameraOnViewChange(!1),await this.layersModule.setActiveModelView(e.viewId),this.cameraStartModule.setMoveCameraOnViewChange(!0))}}class Uc{create(e,t){return new kt(t.layersData.onPropertyChanged("currentViewId",(()=>e.onChanged())),t.layersData.onCurrentLayersChanged((()=>e.onChanged())))}}class Gc{constructor(){this._data={id:"",name:"",active:!1,type:M.ViewType.OTHER,layers:[],transient:!1}}get data(){return this._data}copy(e){this._data.id=e.data.id,this._data.name=e.data.name,this._data.active=e.data.active,this._data.type=e.data.type,this._data.transient=e.data.transient,Cn(this._data.layers,e.data.layers)}equals(e){return this.data.id===e.data.id&&this.data.name===e.data.name&&this.data.active===e.data.active&&this.data.type===e.data.type&&this.data.transient===e.data.transient&&this.data.layers.length===e.data.layers.length&&this._data.layers.every(((e,t)=>{const n=this.data.layers[t];return e.id===n.id&&e.name===n.name&&e.toggled===n.toggled}))}update(e){const t=e.layersData,n=t.getView(t.currentViewId);Tc(t,n,this._data)}}class Hc{static isValue(e){return new Hc(new Bc(e))}static isType(e){return new Hc(new zc(e))}static isInstanceOf(e){return new Hc(new $c(e))}static is(e){return new Hc(new jc(e))}static isAny(){return new Hc(new qc)}constructor(e){this.matcher=e}compare(e){return this.matcher.matches(e)}}class Bc{constructor(e){this.value=e}matches(e){return this.value===e}}class zc{constructor(e){this.type=e}matches(e){return Object.getPrototypeOf(e).constructor===this.type}}class $c{constructor(e){this.type=e}matches(e){if("object"==typeof e)return e instanceof this.type;const t=this.type;switch(typeof e){case"number":return t===Number;case"string":return t===String;case"boolean":return t===Boolean;case"function":return t===Function}return!1}}class jc{constructor(e){this.predicate=e}matches(e){return this.predicate(e)}}class qc{constructor(){}matches(){return!0}}class Wc{constructor(e,t){this.sdk=e,this.commandFilter=t,this._data=new Map}validateInput(){return{}}async exec(){return this.data}get data(){return this._data=new Map(this.sdk.registeredCommands(this.commandFilter)),this._data}}class Kc{constructor(e){this.layersData=e.layersData}validateInput(e,t){if(!ee(e.layerId))throw Error(`${e.layerId} does not map to a valid Layer`);const n=this.layersData.getLayer(e.layerId);if(!n)throw Error(`${e.layerId} does not map to a valid Layer`);return{layer:n,activate:void 0===e.activate?void 0:!!e.activate}}async exec(e,t){const n=void 0!==e.activate?e.activate:!e.layer.toggled;this.layersData.toggleLayer(e.layer.id,n)}}function Yc(e,t,n,a){e.addEnumToInterface({namespace:"View",name:"ViewType",values:M.ViewType}),e.addEnumToInterface({namespace:"View",name:"LayerType",values:M.LayerType});const o=new hi,s=new hi,r=new B(t.layersModule),i=function(e,t){const n=ce.create(t,new Uc,new z(Gc));return e.addObservableToInterface({namespace:"View",name:"current",objectFactory:"View"},n),n}(e,r),c=function(e,t){const n=oa.create(t,new Ic,new z(bc));return e.addCollectionToInterface({namespace:"View",name:"views",elementFactory:"View"},n),n}(e,r),d=function(e,t){const n=oa.create(t,new yc,new z(vc));return e.addCollectionToInterface({namespace:"View",name:"layers",elementFactory:"Layer"},n),n}(e,r),l=function(e,t,n){const a=Pa.create(t,new z(Ec,n));return e.addCommandToInterface({namespace:"View",name:"createView",args:["name"],subRoutine:"View"},a),a}(e,r,o),u=function(e,t,n){const a=Pa.create(t,new z(Cc,n));return e.addCommandToInterface({namespace:"View",name:"deleteView",args:["viewId"],subRoutine:"view.deleteView"},a),a}(e,r,o);!function(e,t,n,a){const o=Pa.create(t,new z(Nc,n.issueCommand,a));e.addCommandUnlisted(Rc,o)}(e,r,n,a),function(e){const t=Hc.is((e=>{var t,n;return!(null===(t=e.options)||void 0===t?void 0:t.deprecated)&&!!(null===(n=e.options)||void 0===n?void 0:n.replay)})),n=Pa.create(B.none,new z(Wc,e,t));e.addCommandUnlisted(Mc,n)}(e);const h=function(e,t,n){const a=Pa.create(t,new z(Vc,n));return e.addCommandUnlisted(Ac,a),a}(e,r,s),p=function(e,t){const n=Pa.create(t,new z(Fc));return e.addCommandUnlisted(Oc,n),n}(e,B.extend(r,t.cameraStartModule)),m=function(e,t,n){const a=Pa.create(t,new z(_c,n));return e.addCommandToInterface({namespace:"View",name:"createLayer",args:["name","options"],subRoutine:"Layer"},a),a}(e,r,s),g=function(e,t,n){const a=Pa.create(t,new z(kc,n));return e.addCommandToInterface({namespace:"View",name:"deleteLayer",args:["layerId"],subRoutine:"view.deleteLayer"},a),a}(e,r,s),f=function(e,t){const n=Pa.create(t,new z(Kc));return e.addCommandUnlisted(Dc,n),n}(e,r);return{current:i,views:c,layers:d,createView:l,deleteView:u,updateView:h,activateView:p,createLayer:m,deleteLayer:g,toggleLayer:f}}const Xc=new Xt("layer interrupt");class Zc{constructor(e,t){this.layersModule=e,this.commonLayer=t}async interrupt({commandDef:e,executionContext:t,command:n,payload:a}){var o;if(!(null===(o=e.options)||void 0===o?void 0:o.replay))return;return{deferTo:new Promise(((o,s)=>{const r=t.layerId?this.layersModule.layersData.getLayerAnyView(t.layerId):this.commonLayer;if(!r)throw Error(t.layerId+" does not map to a valid layer");const i=r.onApply((async r=>{Xc.debug("executing",`${e.namespace}.${e.name}`,a);try{o(await n.exec(a,t))}catch(e){return Xc.debugWarn(e),s(e),r}}).bind(null,(()=>i.delete())))}))}}}class Qc{constructor(e){this.commands=e,this.issueCommand=this.commands.issueCommand}validateInput(e){return{}}async exec(e){await this.issueCommand(new this.commands.DisableInputCommand)}}class Jc{constructor(e){this.commands=e,this.issueCommand=this.commands.issueCommand}validateInput(e){return{}}async exec(e){await this.issueCommand(new this.commands.EnableInputCommand)}}class ed{create(e,t,n){const a=()=>e.onChanged();return new kt(n.onChanged(a),t.onChanged(a))}}class td{constructor(e){this._data={from:null,to:null},this.viewmodeConverter=e.viewmodeConverter}get data(){return this._data}equals(e){return this._data.from===e._data.from&&this._data.to===e._data.to}copy(e){this._data={from:e._data.from,to:e._data.to}}update(e,t){const n=t.state.currentSweep&&t.isSweepAligned(t.state.currentSweep),a=t.state.transition.to&&t.isSweepAligned(t.state.transition.to);this._data=e.transition.active?{from:this.viewmodeConverter.toSdk(e.transition.from,!!n,e.transition.isFromPitchFactorOrtho),to:this.viewmodeConverter.toSdk(e.transition.to,!!a,e.transition.isToPitchFactorOrtho)}:{from:null,to:null}}}function*nd(e){const t=[...e];for(let e=t.length-1;e>=0;--e)yield t[e]}function*ad(...e){for(const t of e)yield*t}class od{constructor(e){this.sdk=e,this.allRegisteredCommands=new Map,this.commandObservers=new Set,this.globalInterrupts=new Set,this.commandInterrupts=new hi,this.globalCommandHooks=new Set,this.commandHooks=new hi}connect(e,t){return this.sdk.connect(e,t)}connectPlugin(e,t){return this.sdk.connectPlugin(e,t)}getClientAuth(e){return this.sdk.getClientAuth(e)}addEnumToInterface(e){return this.sdk.addEnumToInterface(e)}addCommandToInterface(e,t){return this.sdk.addCommandToInterface(e,this.createCommandProxy(e,t))}addAsyncCommandToInterface(e,t){return this.sdk.addAsyncCommandToInterface(e,this.createCommandProxy(e,t))}addCommandUnlisted(e,t,n){return this.sdk.addCommandUnlisted(e,this.createCommandProxy(e,t),n)}addObservable(e,t){return this.sdk.addObservable(e,t)}addObservableToInterface(e,t){return this.sdk.addObservableToInterface(e,t)}addCollection(e,t){return this.sdk.addCollection(e,t)}addCollectionToInterface(e,t){return this.sdk.addCollectionToInterface(e,t)}broadcast(e,t,n){return this.sdk.broadcast(e,t,n)}sendPrivateMessage(e,t){return this.sdk.sendPrivateMessage(e,t)}addPrivateMessageHandler(e){return this.sdk.addPrivateMessageHandler(e)}addCommandCreator(e,t){return this.sdk.addCommandCreator(e,t)}interruptCommands(e,...t){if(0===t.length)this.globalInterrupts.add(e);else for(const n of t)this.commandInterrupts.add(n,e)}hookCommands(e,...t){if(0===t.length)this.globalCommandHooks.add(e);else for(const n of t)this.commandHooks.add(n,e)}async createCommandProxy(e,t){var n;const a={beforeFirstExec:async e=>{for(const n of ad(this.globalInterrupts,this.commandInterrupts.getValuesAtKey(t))){const t=await n.interrupt(e);if(t)return t}},beforeExec:async e=>{var n;for(const a of ad(this.globalCommandHooks,this.commandHooks.getValuesAtKey(t)))await(null===(n=a.beforeExec)||void 0===n?void 0:n.call(a,e))},afterExec:async e=>{var n;for(const a of ad(nd(this.commandHooks.getValuesAtKey(t)),nd(this.globalCommandHooks)))await(null===(n=a.postExec)||void 0===n?void 0:n.call(a,e))}};if(this.allRegisteredCommands.set(`${e.namespace}.${e.name}`,e),this.triggerCommandObservers(e),null===(n=e.options)||void 0===n?void 0:n.deprecated){const n=`"${e.namespace}.${e.name}" is deprecated`+(te(e.options.deprecated)?`; use ${e.options.deprecated}`:"");return new sd(a,e,await J(t,n))}return new sd(a,e,await t)}*registeredCommands(e){for(const t of this.allRegisteredCommands){const[,n]=t;e.compare(n)&&(yield t)}}onCommandsUpdated(e,t){const n=[e,t],a={renew:()=>this.commandObservers.add(n),cancel:()=>this.commandObservers.delete(n)};return a.renew(),a}triggerCommandObservers(e){for(const[t,n]of this.commandObservers)n.compare(e)&&t(e)}track(e,t,n){this.sdk.track(e,t,n)}}class sd{constructor(e,t,n){this.hooks=e,this.commandDef=t,this.command=n}async exec(e,t){const n={commandDef:this.commandDef,executionContext:t,command:this.command,payload:e,proxy:this};if(!t.isReExec){const e=await this.hooks.beforeFirstExec(n);if(e)return e.deferTo}await this.hooks.beforeExec(n);const a=await this.command.exec(e,t);return await this.hooks.afterExec(n),t.isReExec=!0,a}validateInput(e,t){return this.command.validateInput(e,t)}}const rd=new Xt("SDK interface");async function id(e,t,n,a,f,y,I,S){Xt.level=I.logLevel||q.INFO;const{THREE:O}=t,{api:M,cameraData:H,canvasData:$,deepLinks:j,floorData:W,floorViewData:K,labelData:X,layersModule:Z,mattertagData:Q,tagsViewData:ee,measurementModeData:te,meshData:de,modelData:le,annotationsViewData:ue,raycasterData:me,roomData:we,roomBoundData:ye,roomBoundViewData:ve,settingsData:Te,sweepData:Ee,tourData:Ce,viewmodeData:Se,attachmentsModule:Ae,cameraModule:Oe,commonControlsModule:De,floorCasterModule:Me,meshQuery:Re,modelMeshModule:xe,navigationModule:Pe,plugin:Ne,pluginConfigData:_e,renderToTextureModule:ke,sceneModule:Le,sensorModule:Ve,settingsModule:Fe,tourControlsModule:Ue,webglRendererModule:Ge,zoomControlModule:He,sweepTextureLoader:Be,cursorController:ze,pluginData:$e,pluginUiData:je,externalR3FModule:qe}=f,[We,Ke]=await Promise.all([Z,Te]);let Ye=Ke.tryGetSetting(be,!1)||Ke.tryGetSetting(Ie,!1),Xe=null;try{Xe=We.addInMemoryLayer({name:"Temporary Layer",visible:!0,toggled:!0,common:!0})}catch(e){Ye=!1,Xe=null,rd.info("Error setting up layers. Views and Layers features will be disabled. -- ",e)}const Ze=new od(e),Qe=new L(O),Je=new N(n.Viewmode),et=function(e){return async function(t,n,a){const o=a.rotationSpeed;let s=a.yAngle;if(a.clampYRotation)if(n.pose.isPitchFactorOrtho)s=0;else{const e=n.pose.phi()+a.yAngle-Vn;e>0&&(s=Math.max(a.yAngle-e,0))}let r=0;const i=Math.abs(a.xAngle),c=Math.abs(s),d=Math.max(i,c);if(d>=Math.PI){const e=d/Math.PI,t=Math.floor(e),n=i/e,a=c/e,o=i-n*t,s=c-a*t;r=Math.acos(Math.cos(n)*Math.cos(a))*t+Math.acos(Math.cos(o)*Math.cos(s))}else r=Math.acos(Math.cos(Math.abs(a.xAngle))*Math.cos(Math.abs(s)));if(r){const n=new e.Vector2(-a.xAngle,s);return n.multiplyScalar(o/r),t.startRotateTransition(r/o,n,!1)}}}(O),tt=new pr(n.SweepAlignmentType,n.SweepPlacementType),nt=Object.assign(Object.assign({},a),{conversionUtils:new L(O),directionConverter:new P(n.Vectors),getPose:ta(O,Je),rotateCamera:et,rotateCameraBetweenOrientations:Fn(O),orientCamera:Hn(O,n.Viewmode,et),stopCamera:async function(e){return e.stop()},appPhaseConverter:new oe(n.AppPhase),applicationConverter:new se(n.Application),mediaConverter:new Ma(n.MattertagMediaType,n.TagDescriptionChunkType),chunkTypeConverter:new Ra(n.TagDescriptionChunkType),linkTypeConverter:new xa(n.TagLinkType),sweepPlacementConverter:tt,viewmodeConverter:Je,commandModeConverter:new _(n.CommandViewmode),cameraTransitionConverter:new k(n.CameraTransitionType),makeLabelData:pa(O,a.worldToScreenPosition),makeModelData:Po(Qe,tt),sweepUtils:new V(n.SweepAlignmentType),tourStateConverter:new pc(n.TourState)});S.bindConstant(o,nt),S.bindConstant(s,n),S.bindConstant(r,t);const at=async function(e){const t=await e;return new F(t)}(Ee),ot=async function(e){const t=await e;return new U(t)}(W),st=async function(e){const t=await e;return new G(t)}(we),rt=async function(e,t,n,a){const[o,s,r]=await Promise.all([e,t,a]);return new za(o,s,n,r)}(Q,Ae,t.oEmbed,void 0),it=new Map;!function(e,t){const n=Y.create(new B,new z(ae,t));e.addAsyncCommandToInterface({namespace:"API",name:"getViews",args:["spaceSid"],varArg:!1,origins:ne,options:{replay:!1}},n)}(Ze,nt.getModelViewsQuery),function(e){e.addEnumToInterface({namespace:"App",name:"Phase",values:m.Phase}),e.addEnumToInterface({namespace:"App",name:"Event",values:m.Event}),e.addEnumToInterface({namespace:"App",name:"Feature",values:m.Feature}),e.addEnumToInterface({namespace:"App",name:"Application",values:m.Application})}(Ze),function(e,t){const n=t.get(s),a=t.get(o),r=[void 0],i=e=>(r[0]=a.appPhaseConverter.toSdkAppPhase(e.phase),r);a.subscribe(n.AppPhaseChangeMessage,(t=>{e.broadcast(m.Event.PHASE_CHANGE,i,t)}))}(Ze,S),function(e,t){const n=t.get(o);t.resolve(re).then((e=>{n.addBinding(ge,(async()=>{try{const t=e.data;return{phase:n.appPhaseConverter.toSdkAppPhase(t.phase),application:n.applicationConverter.toSdkApplication(t.application)}}catch(e){throw Error("Error: Can't get application data at this time")}}))})),e.addCommandCreator({namespace:"App",name:"getState",args:[]},(()=>new ge))}(Ze,S),function(e,t){const n=t.get(o);n.addBinding(fe,(async()=>{const e={[m.Phase.WAITING]:null,[m.Phase.LOADING]:null,[m.Phase.STARTING]:null,[m.Phase.PLAYING]:null,[m.Phase.ERROR]:null},a=(await t.resolve(re)).data;for(const t in a.phaseTimes){const o=Number(t);e[n.appPhaseConverter.toSdkAppPhase(o)]=a.phaseTimes[o]}return e})),e.addCommandCreator({namespace:"App",name:"getLoadTimes",args:[]},(()=>new fe))}(Ze,S),function(e,t){const n=t.get(s),a=t.get(o),r=ce.createDI(t,[re],new he,new z(pe,n,a),(e=>[e.data]));e.addObservableToInterface({namespace:"App",name:"state"},r)}(Ze,S),function(e,t){const n=ce.createDI(t,[ie,u,c],new Lt,new z(Vt),((e,t,n)=>[e.settingsData,t.data,n.layersData]));e.addObservableToInterface({namespace:"App",name:"features"},n)}(Ze,S),function(e,t){const n=Y.createDI(t,[d],(e=>new zt(e)));e.addCommandToInterface({namespace:"App.Locale",name:"getLanguageCode",args:[]},n)}(Ze,S),function(e,t){const n=Y.createDI(t,[d],(e=>new $t(e)));e.addCommandToInterface({namespace:"App.Locale",name:"getT",args:[],sdkTypes:[Ft.DIRECT]},n)}(Ze,S),function(e,t){const n=t.get(r),a=Y.createDI(t,[i],(t=>new Bt(e,n.jsonSchemaValidator)));e.addCommandToInterface({namespace:"App",name:"track",args:["name","options"],sdkTypes:[Ft.DIRECT]},a)}(Ze,S);const ct=un(Ze,O,nt,it,f,rt);!function(e,t,n){n.getDependencies().then((([e,n,a,o])=>{const s={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:b.Mode.TRANSITIONING};t.addBinding(hn,(async()=>t.getPose(s,e,n,a,o)))})),e.addCommandCreator({namespace:"Camera",name:"getPose",args:[]},(()=>new hn))}(Ze,nt,new B(H,Ee,Se,at)),function(e,t,n,a){a.getDependencies().then((([e,a,o])=>{n.addBinding(mn,(async function(s={}){if(!o.isInside())throw Error("Camera.lookAtScreenCoords must be called from Inside mode");const r=n.screenPositionToNDC(s.x,s.y,a.width,a.height),i=new t.Vector3(0,0,-1).applyQuaternion(a.pose.rotation),c=n.ndcToWorldPosition(a,new t.Vector2(r.x,r.y),1).normalize(),d=i.clone().setY(0).angleTo(c.clone().setY(0)),l=Math.asin(c.y-i.y),u=d*Math.sign(r.x),h=l;return n.rotateCamera(e,a,{xAngle:u,yAngle:h,zAngle:0,rotationSpeed:pn,clampYRotation:!1})}))})),e.addCommandCreator({namespace:"Camera",name:"lookAtScreenCoords",args:["x","y"]},(function(e={}){if(e.x=e.x||0,e.y=e.y||0,isNaN(e.x)||isNaN(e.y))throw new Error(`${JSON.stringify(e)} does not contain valid screen coordinates`);return new mn({x:e.x,y:e.y})}))}(Ze,O,nt,new B(De,H,Se)),function(e,t,n){n.getDependencies().then((([n,a,o,s])=>{const r=[{position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:b.Mode.TRANSITIONING}],i=(()=>{let c=0,d=!1;const l=()=>(t.getPose(r[0],n,a,o,s),r);return()=>{const t=Date.now(),n=c+fn;if(t>n){d=!1,c=t;try{e.broadcast(g.Event.MOVE,l)}catch(e){gn.debug("failed to broadcast pose, one of the module dependencies are probably not loaded yet")}}else d||(setTimeout((()=>i()),n-t),d=!0)}})();n.onChanged(i),o.onChanged(i)})),e.addEnumToInterface({namespace:"Camera",name:"Event",values:g.Event})}(Ze,nt,new B(H,Ee,Se,at)),function(e,t,n){n.getDependencies().then((([e])=>t.addBinding(yn,(async n=>{const a=n.direction;if(!wn(g.Direction,n.direction))throw new Error(`${n.direction} is not a valid direction`);await e.navigateInLocalDirection(t.directionConverter.toVector(a))})))),e.addEnumToInterface({namespace:"Camera",name:"Direction",values:g.Direction}),e.addCommandCreator({namespace:"Camera",name:"moveInDirection",args:["direction"]},(e=>new yn(e||{})))}(Ze,nt,new B(Pe)),function(e,t,n,a){a.getDependencies().then((([e,a])=>{n.addBinding(Tn,(async n=>{const o=a.pose.position,s=n.x-o.x,r=n.z-o.z,i=new t.Vector2(s,r),c=i.length();i.setLength(vn),await e.startTranslateTransition(c/vn,i,!1)}))})),e.addCommandCreator({namespace:"Camera",name:"pan",args:["position"]},(e=>{if((e=e||{}).position=e.position||{},e.position.x=e.position.x-0,e.position.z=e.position.z-0,isNaN(e.position.x)||isNaN(e.position.z))throw new Error(`${JSON.stringify(e)} does not contain a valid position to pan`);return new Tn({x:e.position.x,z:e.position.z})}))}(Ze,O,nt,new B(De,H)),function(e,t,n,a){const o=ce.create(a,new Mn,new z(Rn,t,n.viewmodeConverter));e.addObservableToInterface({namespace:"Camera",name:"pose"},o)}(Ze,O,nt,new B(H,Ee,Se,at)),zn(Ze,O,nt,new B(De,H,Se)),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding($n,(async()=>await t.stopCamera(e)))})),e.addCommandCreator({namespace:"Camera",name:"stop",args:[]},(()=>new $n))}(Ze,nt,new B(De)),function(e,t,n,a){const o=a,s=Y.create(o,new z(Yn,t,n)),r=Y.create(o,new z(Xn,t,n)),i=Y.create(o,new z(Zn,t,n));e.addCommandToInterface({namespace:"Camera",name:"zoomTo",args:["zoomPct"]},s),e.addCommandToInterface({namespace:"Camera",name:"zoomBy",args:["zoomDelta"]},r),e.addCommandToInterface({namespace:"Camera",name:"zoomReset",args:[]},i)}(Ze,n,nt,new B(H,Se,He)),function(e,t,n){const a=ce.create(n,new Jn,new z(ea,t));e.addObservableToInterface({namespace:"Camera",name:"zoom"},a)}(Ze,n,new B(H,Se)),function(e,t,n){const a=ce.create(n,new na,new z(aa,t));e.addObservableToInterface({namespace:"Floor",name:"current"},a)}(Ze,n,new B(K,Ee,H,Ce,ot)),function(e,t,n,a){e.addEnumToInterface({namespace:"Floor",name:"Event",values:w.Event}),a.getDependencies().then((([a])=>{const o=[-1,-1];function s(e){if(a){const t=e.to?a.getFloor(e.to):null,n=e.from?a.getFloor(e.from):null;t&&(o[0]=t.index),n&&(o[1]=n.index)}return o}const r=[-1,""];function i(e){if(a){const t=e.floorId?a.getFloor(e.floorId):null;t&&(r[0]=t.index)}return r[1]=e.floorName,r}n.subscribe(t.StartMoveToFloorMessage,(t=>e.broadcast(w.Event.CHANGE_START,s,t))),n.subscribe(t.EndMoveToFloorMessage,(t=>e.broadcast(w.Event.CHANGE_END,i,t)))}))}(Ze,n,nt,new B(W)),function(e,t){const n=oa.create(t,new sa,new z(ra));e.addCollectionToInterface({namespace:"Floor",name:"data"},n)}(Ze,new B(W,ot)),function(e,t,n){t.addBinding(ia,(async()=>{const[e]=await n.getDependencies();return ca(e)})),e.addCommandCreator({namespace:"Floor",name:"getData",args:[]},(()=>new ia))}(Ze,nt,new B(K)),function(e,t,n,a){a.getDependencies().then((([e])=>n.addBinding(da,(async a=>{if("number"!=typeof a.floorIndex||a.floorIndex<0)throw Error("floor index must be a non-negative number");try{const o="boolean"==typeof a.moveCamera&&!a.moveCamera,s=o?250:void 0;await n.issueCommand(new t.MoveToFloorIndexCommand(a.floorIndex,o,s));const r=e.currentFloor;return r?r.index:-1}catch(e){throw Error(`Could not move to floor at index ${a.floorIndex}`)}})))),e.addCommandCreator({namespace:"Floor",name:"moveTo",args:["floorIndex","moveCamera"]},(e=>new da(e)))}(Ze,n,nt,new B(K)),function(e,t,n,a){const o=Y.create(a,new z(la,t,n));e.addCommandToInterface({namespace:"Floor",name:"showAll",args:["moveCamera"]},o)}(Ze,n,nt,new B(K)),function(e,t){const n=Y.create(t,new z(ua));e.addCommandToInterface({namespace:"Floor.Conversion",name:"createIdMap",args:["invert"]},n)}(Ze,new B(W)),function(e,t,n){t.addBinding(ha,(async()=>t.makeLabelData(...await n.getDependencies()))),e.addCommandCreator({namespace:"Label",name:"getData",args:[]},(()=>new ha))}(Ze,nt,new B(H,W,X,ot)),function(e,t,n,a){e.addEnumToInterface({namespace:"Label",name:"Event",values:v.Event}),a.getDependencies().then((([t,a,o,s,r])=>{const i=()=>[n.makeLabelData(t,o,a,r)];t.onChanged((n=>{t.pose.isPitchFactorOrtho&&e.broadcast(v.Event.POSITION_UPDATED,i,n)}))}))}(Ze,0,nt,new B(H,X,W,Se,ot)),function(e,t){const n=oa.create(t,new ma,new z(ga));e.addCollectionToInterface({namespace:"Label",name:"data"},n)}(Ze,new B(X,W,ot)),function(e,t){const n=Y.create(t,new z(fa));e.addAsyncCommandToInterface({namespace:"Link",name:"createLink",args:[]},n)}(Ze,new B(j)),function(e,t){const n=Y.create(t,new z(wa));e.addAsyncCommandToInterface({namespace:"Link",name:"createDeepLink",args:[]},n)}(Ze,new B(j)),function(e,t){const n=Y.create(t,new z(Ia,e)),a=Y.create(t,new z(Ea,e)),o=Y.create(t,new z(Ca,e)),s=Y.create(t,new z(Sa,e));e.addEnumToInterface({namespace:"Link",name:"OpenPolicy",values:T.OpenPolicy}),e.addEnumToInterface({namespace:"Link",name:"DestinationPolicy",values:T.DestinationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setModelLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},n),e.addAsyncCommandToInterface({namespace:"Link",name:"setNavigationLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},a),e.addAsyncCommandToInterface({namespace:"Link",name:"setSameOriginLinkPolicy",args:["policy"]},o),e.addAsyncCommandToInterface({namespace:"Link",name:"setExternalLinkPolicy",args:["openInNewWindow"]},s)}(Ze,new B(j,y)),function(e,t){const n=Y.create(t,new z(Da));e.addEnumToInterface({namespace:"Link",name:"CreationPolicy",values:T.CreationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setShareLinkPolicy",args:["policy","baseHref","options"],subRoutine:"link.setsharepolicy"},n)}(Ze,new B(j));const dt=async function(){const e=I.sandboxPath;return(await fetch(e)).text()}(),lt=Ui(Ze,O,n,nt,it,rt,dt,nt.getTagsQuery,Xe,nt.isMpFontId,Object.assign(Object.assign({},f),{roomIdMap:st}));oo(Ze,n,Object.assign(Object.assign({},nt),{getIframeSrcDoc:dt}),ct,lt,[Q,ee,ue,W,ot,rt]),function(e,t,n){t.addBinding(ro,(async()=>{const[e,t]=await n.getDependencies();return io(e,t)})),e.addCommandCreator({namespace:"Measurements",name:"getData",args:[]},(()=>new ro))}(Ze,nt,new B(te,W)),function(e,t,n){const a=oa.create(n,new co(t.MeasuringPhase),new z(lo));e.addCollectionToInterface({namespace:"Measurements",name:"data"},a)}(Ze,n,new B(te)),function(e,t){const n=ce.create(t,new uo,new z(ho));e.addObservableToInterface({namespace:"Measurements",name:"mode"},n)}(Ze,new B(te)),function(e,t,n,a){const o=Y.create(a,(e=>new mo(t.Tools,n.issueCommand)));e.addAsyncCommandToInterface({namespace:"Measurements",name:"toggleMode",args:["active"]},o)}(Ze,n,nt,new B(te)),function(e,t,n,a){e.addEnumToInterface({namespace:"Mode",name:"Event",values:b.Event}),a.getDependencies().then((([a,o,s])=>{const r=[void 0,void 0],i=e=>{const t=o.currentMode,s=n.sweepUtils.isSweepAligned(a,e.fromSweep),i=n.sweepUtils.isSweepAligned(a,e.toSweep);return r[0]=n.viewmodeConverter.toSdk(t,s),r[1]=n.viewmodeConverter.toSdk(t,i),r};n.subscribe(t.EndMoveToSweepMessage,(t=>{n.sweepUtils.isSweepAligned(a,t.fromSweep)!==n.sweepUtils.isSweepAligned(a,t.toSweep)&&e.broadcast(b.Event.CHANGE_END,i,t)}));const c=[void 0,void 0],d=e=>{const t=n.sweepUtils.isCurrentSweepAligned(a);return c[0]=n.viewmodeConverter.toSdk(e.fromMode,t,s.pose.isPitchFactorOrtho),c[1]=n.viewmodeConverter.toSdk(e.toMode,t,s.pose.isPitchFactorOrtho),c};n.subscribe(t.BeginSwitchViewmodeMessage,(t=>e.broadcast(b.Event.CHANGE_START,d,t)));const l=[void 0,void 0],u=e=>{const t=n.sweepUtils.isCurrentSweepAligned(a);return l[0]=n.viewmodeConverter.toSdk(e.fromMode,t,s.pose.isPitchFactorOrtho),l[1]=n.viewmodeConverter.toSdk(e.toMode,t,s.pose.isPitchFactorOrtho),l};n.subscribe(t.EndSwitchViewmodeMessage,(t=>e.broadcast(b.Event.CHANGE_END,u,t)))}))}(Ze,n,nt,new B(Ee,Se,H)),function(e,t,n,a){a.addBinding(Eo,(async e=>{try{e.options=e.options||{};let t=n.CameraTransitionType.Interpolate;const o=e.options.transition;return void 0===o||isNaN(o)||(t=o),await a.issueCommand(new n.ChangeViewmodeCommand(e.mode,t,{position:e.options.position,rotation:e.options.rotation,zoom:e.options.zoom})),e.mode}catch(t){const n=t instanceof wo?`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`:`Mode.moveTo -> Could not move to ${e.mode}`;if(bo.info(t,n),t instanceof wo)throw Error(`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`);throw Error(`Mode.moveTo -> Could not move to ${e.mode}`)}}));const o=new Co(t,a.commandModeConverter,a.conversionUtils,a.cameraTransitionConverter);e.addCommandCreator({namespace:"Mode",name:"moveTo",args:["mode","options"]},(e=>new Eo(o.validateMoveToModeInput(e)))),e.addEnumToInterface({namespace:"Mode",name:"Mode",values:b.Mode}),e.addEnumToInterface({namespace:"Mode",name:"TransitionType",values:g.TransitionType})}(Ze,O,n,nt,new B),function(e,t,n,a){const o=ce.create(a,new So,new z(Ao,t,n));e.addObservableToInterface({namespace:"Mode",name:"current"},o)}(Ze,n,nt,new B(Se,Ee,H)),function(e,t,n){const a=ce.create(n,new ed,new z(td,t));e.addObservableToInterface({namespace:"Mode",name:"transition"},a)}(Ze,nt,new B(Se,Ee)),Do(Ze,nt,new B(le,Ee,W,at)),Ro(Ze,n,nt,new B(le,Te)),function(e,t,n,a){e.addEnumToInterface({namespace:"Model",name:"Event",values:E.Event});const o={sid:"",sweeps:[],modelSupportsVr:!1},s=[o];a.getDependencies().then((a=>{n.subscribe(t.ModelDataLoadedMessage,(async t=>{const[r,i,c]=a;await n.makeModelData(t.sid,t.vrSupported,r.getSweepList(),i,c,o),e.broadcast(E.Event.MODEL_LOADED,(()=>s))}))}))}(Ze,n,nt,new B(Ee,W,at)),function(e,t){const n=Y.create(t,new z(_o));e.addCommandUnlisted(No,n,!0)}(Ze,new B(n.MpSdkAuthentication)),function(e,t){const n=oa.create(t,new Ho,new z(Bo));e.addCollectionToInterface({namespace:"Plugin",name:"data",origins:ne},n)}(Ze,new B($e,je)),function(e,t){const n=Y.create(t,new z(Uo));e.addAsyncCommandToInterface({namespace:"Plugin",name:"load",args:["key","path","config","metadata"],varArg:!1,sdkTypes:[Ft.POSTMESSAGE],origins:ne},n)}(Ze,new B(Ne)),function(e,t){const n=Y.create(t,new z(Go));e.addAsyncCommandToInterface({namespace:"Plugin",name:"unload",args:["key"],varArg:!1,sdkTypes:[Ft.POSTMESSAGE],origins:ne},n)}(Ze,new B(Ne)),function(e){e.addEnumToInterface({namespace:"Plugin",name:"Visibility",values:x.Visibility,origins:ne})}(Ze),async function(){await S.resolve(l).then((e=>{var t,n;const a=e.policyData.getPolicy(ec);null!==(n=null===(t=null==a?void 0:a.options)||void 0===t?void 0:t.includes(Ji))&&void 0!==n&&n&&(function(e,t){const n=t.get(o),a=Y.createDI(t,[p,u],((e,t)=>new Xi(n,e.data,t.data)));e.addCommandToInterface({namespace:"PI.Room",name:"moveTo",args:["roomId","options"]},a),e.addEnumToInterface({namespace:"PI.Room",name:"Transition",values:g.TransitionType})}(Ze,S),function(e,t){const n=ce.createDI(t,[h],new Zi,new z(Qi),(e=>[e.currentRoomData]));e.addObservableToInterface({namespace:"PI.Room",name:"current"},n)}(Ze,S))})).catch((e=>{rd.debug("PolicyModule resolution failed, skipping PI namespace creation",e)}))}(),function(e,t,n,a){const o=ce.create(a,new zo,new z($o,t,n));e.addEnumToInterface({namespace:"Pointer",name:"Colliders",values:C.Colliders}),e.addObservableToInterface({namespace:"Pointer",name:"intersection"},o)}(Ze,O,n,new B(me,W,we,de,Re)),function(e,t,n){const a=Y.create(n,new z(jo)),o=Y.create(n,new z(qo));e.addCommandToInterface({namespace:"Pointer",name:"registerTexture",args:["textureId","textureSrc"],varArg:!1},t),e.addCommandToInterface({namespace:"Pointer",name:"editTexture",args:["textureId"],varArg:!1},a),e.addCommandToInterface({namespace:"Pointer",name:"resetTexture",args:[],varArg:!1},o)}(Ze,ct.registerTexture,new B(ze,it)),function(e,t){const n=Y.create(t,new z(Wo));e.addCommandToInterface({namespace:"Pointer",name:"setFadeProps",args:["props"],varArg:!1},n)}(Ze,new B(ze)),function(e,t){const n=Y.create(t,new z(Ko));e.addCommandToInterface({namespace:"Pointer",name:"setVisible",args:["visible"],varArg:!1},n)}(Ze,new B(ze)),function(e,t){const n=Y.create(t,new z(ts));e.addCommandToInterface({namespace:"Renderer",name:"getScene",args:[],sdkTypes:[Ft.DIRECT],origins:ne},n)}(Ze,new B(Ge)),function(e,t,n,a,o){const s=new ns(new t.PerspectiveCamera,a.encodeRenderTarget),r=new z(is,s,n,a),i=Y.create(o,r),c=Y.create(o,r);e.addCommandToInterface({namespace:"Renderer",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},i),e.addCommandToInterface({namespace:"Camera",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},J(c,"`Camera.takeScreenshot` is deprecated; use `Renderer.takeScreenshot` instead"))}(Ze,O,n,nt,new B($,Ge,ke)),function(e,t,n,a,o){const s=Y.create(o,new z(cs,t,n,a));e.addCommandToInterface({namespace:"Renderer",name:"takeEquirectangular",args:[]},s)}(Ze,O,n,nt,new B(Ge,ke,Se,Ee,Be)),function(e,t,n,a){const o=Y.create(a,new z(ds,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getScreenPosition",args:["worldPosition"]},o)}(Ze,n,nt,new B(Ge)),function(e,t){const n=Y.create(t,new z(ls));e.addCommandToInterface({namespace:"Renderer",name:"getWorldPositionData",args:["screenPosition","height","includeHiddenFloors"]},n)}(Ze,new B(W,Me)),function(e,t){const n=Y.create(t,new z(Yo));e.addAsyncCommandToInterface({namespace:"R3F",name:"registerR3F",args:["callbacks"],sdkTypes:[Ft.DIRECT]},n)}(Ze,new B(qe)),function(e,t,n,a,o){e.addAsyncCommandToInterface({namespace:"R3F",name:"focus",args:["target","options"],sdkTypes:[Ft.DIRECT]},Y.create(o,new z(Qo,t,n,a)))}(Ze,O,n,nt,new B(Pe,Se)),function(e,t){const n=Y.create(t,new z(es));e.addAsyncCommandToInterface({namespace:"R3F",name:"controlsToggle",args:["enabled"],sdkTypes:[Ft.DIRECT]},n)}(Ze,new B(Oe)),function(e,t){const n=Y.create(t,new z(Zo));e.addAsyncCommandToInterface({namespace:"R3F",name:"navigationToggle",args:["enabled"],sdkTypes:[Ft.DIRECT]},n)}(Ze,new B(Pe)),function(){const e=B.getBuilder().addDependencies(we,W,H,Ee,Se,de,st,ot).addOptionals(ye).build();!function(e,t){const n=ce.create(t,new hs,new z(ps));e.addObservableToInterface({namespace:"Room",name:"current",objectFactory:"current.room"},n)}(Ze,e);const t=B.getBuilder().addDependencies(we,W,st,ot,de).addOptionals(ye).build();!function(e,t){const n=oa.create(t,new ms,new z(gs));e.addCollectionToInterface({namespace:"Room",name:"data",elementFactory:"collection.room"},n)}(Ze,t),function(e,t){const n=Y.create(t,new z(fs));e.addCommandToInterface({namespace:"Room.Conversion",name:"createIdMap",args:["invert"]},n)}(Ze,new B(we,W)),function(e,t){const n=Y.create(t,new z(ws));e.addCommandToInterface({namespace:"Room.Bounds",name:"forceRoomDimensionVisibility",args:["visible"]},n)}(Ze,new B(ve))}(),function(e,t,n,a,o,s,r){(function(e){e.addEnumToInterface({namespace:"Scene",name:"InteractionType",values:R.InteractionType,sdkTypes:[Ft.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"Component",values:R.Component,sdkTypes:[Ft.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"PathType",values:rs,sdkTypes:[Ft.DIRECT]})})(e),function(e,t){const n=Y.create(t,new z(ys));e.addAsyncCommandToInterface({namespace:"Scene",name:"register",args:["name","factory"],sdkTypes:[Ft.DIRECT]},n)}(e,new B(a)),function(e,t){const n=Y.create(t,new z(vs));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNode",args:[],varArg:!1,sdkTypes:[Ft.DIRECT]},n)}(e,new B(a)),function(e,t,n){t.addBinding(Ts,(async e=>{const[t]=await n.getDependencies();return t.sceneTags().getObjects(e.tags)})),e.addCommandCreator({namespace:"Scene",name:"query",args:["tags"],sdkTypes:[Ft.DIRECT]},(e=>new Ts(e)))}(e,t,new B(a,o)),function(e,t,n,a){a.getDependencies().then((([e])=>{n.addBinding(Is,(async n=>{n.callback(e.threeRenderer,t,e.getScene().effectComposer)}))})),e.addCommandCreator({namespace:"Scene",name:"configure",args:["callback"],sdkTypes:[Ft.DIRECT]},(e=>new Is(e)))}(e,n,t,new B(s)),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(bs,(async t=>e.getImageBitmap(t.path,t.width,t.height,t.options)))})),e.addCommandCreator({namespace:"Scene",name:"getImage",args:["path","width","height","options"],sdkTypes:[Ft.DIRECT]},(e=>new bs(e)))}(e,t,new B(r)),function(e,t){const n=Y.create(t,new z(Es));e.addAsyncCommandToInterface({namespace:"Scene",name:"deserialize",args:["text"],varArg:!1,sdkTypes:[Ft.DIRECT]},n)}(e,new B(a)),function(e,t){const n=Y.create(t,new z(Ss));e.addCommandToInterface({namespace:"Scene",name:"serialize",args:["objects"],varArg:!1,sdkTypes:[Ft.DIRECT]},n)}(e,new B(a)),function(e,t){const n=Y.create(t,new z(As));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNodes",args:["count","userContext"],varArg:!1,sdkTypes:[Ft.DIRECT]},n)}(e,new B(a)),function(e,t){const n=Y.create(t,new z(Os));e.addAsyncCommandToInterface({namespace:"Scene",name:"registerComponents",args:["components"],sdkTypes:[Ft.DIRECT]},n)}(e,new B(a)),function(e,t){const n=Y.create(t,new z(Ds));e.addAsyncCommandToInterface({namespace:"Scene",name:"createObjects",args:["count"],varArg:!1,sdkTypes:[Ft.DIRECT]},n)}(e,new B(a)),function(e,t,n){const a=Y.create(n,new z(Ms));e.addCommandToInterface({namespace:"Scene",name:"unregisterComponents",args:["components"],varArg:!1,sdkTypes:[Ft.DIRECT]},a)}(e,0,new B(a))}(Ze,nt,O,Le,xe,Ge,M),sr(O,n.SourceType,n.sensorVolumes)(Ze,new B(Ve)),function(e,t,n,a){n.addBinding(t.SettingGetCommand,(async e=>{const[t]=await a.getDependencies();return t.tryGetSetting(e.key,t.settingsData.getOverrideParam(e.key,void 0))})),e.addCommandCreator({namespace:"Settings",name:"get",args:["key"]},(e=>new t.SettingGetCommand(e.key)))}(Ze,n,nt,new B(Fe)),function(e,t,n,a){n.addBinding(t.SettingUpdateCommand,(async e=>{if(!e.key||"string"!=typeof e.key)throw Error("Settings: invalid key");const[t]=await a.getDependencies();return t.updateSetting(e.key,e.value),t.tryGetSetting(e.key,void 0)})),e.addCommandCreator({namespace:"Settings",name:"update",args:["key","value"]},(e=>new t.SettingUpdateCommand(e.key,e.value)))}(Ze,n,nt,new B(Fe)),function(e,t,n){n.getDependencies().then((([n])=>{new ir(t.waitForUpdate,n).calcAndBroadcast(e)})),e.addEnumToInterface({namespace:"Stat",name:"Event",values:rr})}(Ze,nt,new B(Te)),function(e,t){const n=Y.create(t,new z(dr));e.addAsyncCommandToInterface({namespace:"XStorage",name:"setItem",args:["key","data"],origins:ne},n)}(Ze,new B(le)),function(e,t){const n=Y.create(t,new z(lr));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getItem",args:["key"],origins:ne},n)}(Ze,new B(le)),function(e,t){const n=Y.create(t,new z(ur));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getAllItems",args:["modelId"],origins:ne},n)}(Ze,new B(le)),function(e,t){const n=Y.create(t,new z(hr));e.addAsyncCommandToInterface({namespace:"XStorage",name:"removeItem",args:["key"],origins:ne},n)}(Ze,new B(le)),function(){!function(e){e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:g.TransitionType}),e.addEnumToInterface({namespace:"Sweep",name:"Alignment",values:A.Alignment}),e.addEnumToInterface({namespace:"Sweep",name:"Placement",values:A.Placement})}(Ze);const e=B.getBuilder().addDependencies(Ee,Se,W,at,ot).addOptionals(ye).build();!function(e,t,n,a){const o=ce.create(a,new fr,new z(wr,t,n));e.addObservableToInterface({namespace:"Sweep",name:"current"},o)}(Ze,n,nt,e),function(e,t,n,a){e.addEnumToInterface({namespace:"Sweep",name:"Event",values:A.Event});const o=["",""],s=()=>o;n.subscribe(t.BeginMoveToSweepMessage,(async t=>{const n=await a;t.fromSweep&&t.fromSweep!==t.toSweep&&(o[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,o[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(A.Event.EXIT,s,t))})),n.subscribe(t.BeginSwitchViewmodeMessage,(n=>{n.fromMode===t.Viewmode.Panorama&&n.toMode!==t.Viewmode.Panorama&&(o[0]=r[1],o[1]=void 0,e.broadcast(A.Event.EXIT,s))}));const r=["",""],i=()=>r;n.subscribe(t.EndMoveToSweepMessage,(async t=>{const n=await a;r[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,r[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(A.Event.ENTER,i)}))}(Ze,n,nt,at),function(e,t,n,a){const o=Y.create(a,new z(yr,t,n));e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:g.TransitionType}),e.addCommandToInterface({namespace:"Sweep",name:"moveTo",args:["sweep","options"]},o)}(Ze,n,nt,new B(Ee,at,Pe)),function(e,t){const n=Y.create(t,new z(br));e.addCommandToInterface({namespace:"Sweep.Conversion",name:"createIdMap",args:["invert"]},n);const a=Y.create(t,new z(Er));e.addCommandToInterface({namespace:"Sweep.Conversion",name:"getLabelFromId",args:["id"]},a)}(Ze,new B(Ee));const t=B.getBuilder().addDependencies(Ee,W,at,ot).addOptionals(ye).build();!function(e,t,n){const a=oa.create(n,new vr,new z(Tr,t.conversionUtils,t.sweepPlacementConverter));e.addCollectionToInterface({namespace:"Sweep",name:"data"},a)}(Ze,nt,t),function(e,t){const n=Y.create(t,new z(Cr)),a=Y.create(t,new z(Sr));e.addCommandToInterface({namespace:"Sweep",name:"enable",args:["sweepIds"],varArg:!0},n),e.addCommandToInterface({namespace:"Sweep",name:"disable",args:["sweepIds"],varArg:!0},a)}(Ze,new B(Ee,at)),function(e,t,n,a){const o=Y.create(a,new z(Dr,t,n));e.addCommandToInterface({namespace:"Sweep",name:"addNeighbors",args:["sweepId","toAdd"]},o);const s=Y.create(a,new z(Mr,t,n));e.addCommandToInterface({namespace:"Sweep",name:"removeNeighbors",args:["sweepId","toRemove"]},s)}(Ze,n,nt,new B(Ee))}(),Ki(Ze,f),function(e){e.addEnumToInterface({namespace:"Tour",name:"PlayState",values:D.PlayState})}(Ze),function(e,t,n){e.addEnumToInterface({namespace:"Tour",name:"Event",values:D.Event}),n.subscribe(t.TourStartedMessage,(()=>e.broadcast(D.Event.STARTED))),n.subscribe(t.TourStoppedMessage,(()=>e.broadcast(D.Event.STOPPED))),n.subscribe(t.TourEndedMessage,(()=>e.broadcast(D.Event.ENDED)));const a=[-1],o=e=>(a[0]=e.index,a);n.subscribe(t.TourSteppedMessage,(t=>e.broadcast(D.Event.STEPPED,o,t)))}(Ze,n,nt),ic(Ze,n,nt,new B(Ue,Ce,Te)),function(e,t){const n=ce.create(t,new dc,new z(lc));e.addObservableToInterface({namespace:"Tour",name:"currentStep"},n)}(Ze,new B(Ce)),function(e,t,n){const a=ce.create(n,new uc,new z(hc,t));e.addObservableToInterface({namespace:"Tour",name:"state"},a)}(Ze,nt,new B(Ce)),function(e,t){const n=ce.create(t,new mc,new z(gc));e.addObservableToInterface({namespace:"Tour",name:"transition"},n)}(Ze,new B(Ce)),function(e,t,n){const a=Y.create(n,new z(Qc,t)),o=Y.create(n,new z(Jc,t));e.addCommandToInterface({namespace:"App.Input",name:"disable",args:[]},a),e.addCommandToInterface({namespace:"App.Input",name:"enable",args:[]},o)}(Ze,{issueCommand:nt.issueCommand,DisableInputCommand:n.DisableInputCommand,EnableInputCommand:n.EnableInputCommand},new B),Ye&&Xe&&(Yc(Ze,f,nt,[Xe]),Ze.interruptCommands(new Zc(We,Xe)))}rd.info("Showcase SDK interface version","25.12.2_webgl-1476-gb1a50f26e1");var cd=a.m;export{cd as setup};