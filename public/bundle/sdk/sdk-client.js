/*! SDK Client v26.1.3_webgl-190-ge117742b46 */(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{SdkBuilder:()=>zr});const s=window.navigationStart||Date.now(),i=new WeakMap;var n;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(n||(n={}));class r{static for(e){let t=i.get(e);if(!t){const s=e.name||e.constructor.name;t=new r(s),i.set(e,t)}return t}constructor(e){this.timers={},this.handlers={[n.DEBUG]:console.debug,[n.INFO]:console.info,[n.WARN]:console.warn,[n.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(r.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(n.DEBUG)}get devInfo(){return()=>{}}get debugInfo(){return this.debug}get warnError(){return this.warn}get debugWarn(){return this.message(r.level>=n.DEBUG?n.WARN:n.DEBUG)}get info(){return this.message(n.INFO)}get warn(){return this.message(n.WARN)}get error(){return this.message(n.ERROR)}get assert(){return(e,...t)=>{if(e)return;const s="Assertion failed";0===t.length?t=[s]:"string"==typeof t[0]?t[0]=s+": "+t[0]:t.unshift(s);this.message(n.ERROR)(...t)}}time(e){r.level>=n.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(r.level>=n.DEBUG){const t=this.timers[e];if(!t)return;const s=(Date.now()-t)/1e3;this.debug(e,s+"s")}}getPrefix(){const e=(Date.now()-s)/1e3+"s";return`${this.prefix} ${e}`}}r.level=n.INFO;class o{constructor(e){this.messageReceiver=e}notify(e,t){this.messageReceiver.onMessageReceived(e,t)}}class a{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const s=this.values[e];if(s){const e=s.indexOf(t);e>-1&&s.splice(e,1)}}removeKey(e){delete this.values[e]}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}find(e,t){return this.values[e]&&this.values[e].find(t)}get keys(){return Object.keys(this.values)}hasKey(e){return e in this.values}has(e,t){return this.hasKey(e)&&this.values[e].includes(t)}*[Symbol.iterator](){for(const e in this.values)for(const t of this.values[e])yield[e,t]}}Symbol.iterator;Symbol.iterator;class c extends Map{constructor(e,t){super(t),this.getDefault=e}get(e){return super.get(e)||this.getDefault()}}class h{listen(){}stopListening(){}send(){throw Error("The sdk has been disconnected and can't make any new calls")}}class l{constructor(e,t,s){this.sourceId=e,this.targetId=t,this.messageBridge=s,this.observers=new a}static toFilteredMessenger(e,t,s){const i=new u(e.sourceId,e.targetId,e,t);for(const t of s)for(const s of e.observers.getValuesAtKey(t))i.addObserver(s);return i}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e,t){this.messenger.onMessageReceived(e,t)}}(this),t=new o(e);this.messageBridge.listen(t)}dispose(){this.messageBridge.stopListening(),this.messageBridge=new h}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e){const t=this.sourceId,s=this.targetId;this.messageBridge.send(Object.assign(Object.assign({},e),{fromId:t,toId:s,timestamp:Date.now()}))}onMessageReceived(e,t){if(!this.filterMessageId(e))return;const s=e.type,i=this.observers.getValuesAtKey(s);if(i)for(const s of i){const i=e.payload||e;s.notify(i,t,e.timestamp)}}filterMessageId(e){const t=e.toId,s=e.fromId;return t instanceof Array?t.indexOf(this.sourceId)>-1:(void 0===t||t===this.sourceId)&&s===this.targetId}}class u extends l{constructor(e,t,s,i){super(e,t,new h),this.messenger=s,this.sendFilter=i,this.errorBridge=new h}send(e){this.sendFilter.includes(e.type)?this.messenger.send(e):this.errorBridge.send()}}var d,p,f;!function(e){e.EVENT="postmessage.event",e.RESPONSE="postmessage.response",e.OBSERVATION="postmessage.observation",e.COLLECTION_UPDATE="collection.updated",e.PRIVATE_MESSAGE="private.message"}(d||(d={})),function(e){e.ITEM_ADDED="collection.item.added",e.ITEM_REMOVED="collection.item.removed",e.ITEM_UPDATED="collection.item.updated",e.COLL_UPDATED="collection.coll.updated"}(p||(p={}));class m{constructor(e){this.observer=e,this.messageType=d.EVENT}notify(e){this.observer.receiveEvent(e)}}class y{constructor(e,t,s,i){this.type=d.RESPONSE,this.payload={uid:e,message:t,success:s,error:i},this.uid=e,this.message=t,this.success=s,this.error=i}}class g{constructor(e,t){this.type=d.EVENT,this.payload={eventType:e,eventData:t},this.eventType=e,this.eventData=t}}class b{constructor(e,t){this.type=d.OBSERVATION,this.payload={observableKey:e,observableData:t}}}class v{constructor(e,t,s,i){this.type=d.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:s,item:i}}}class w{constructor(e,t,s){this.type=d.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:s}}}class x{constructor(e,t,s,i){this.type=d.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:s,item:i}}}class O{constructor(e,t){this.type=d.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t}}}class C{constructor(e,t){this.type=d.PRIVATE_MESSAGE,this.payload={messageType:e,messagePayload:t}}}!function(e){e.DISCONNECT="sdk.client.disconnect",e.ACTION="postmessage.action",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.COLLECTION_SUB="collection.sub",e.COLLECTION_UNSUB="collection.unsub",e.PRIVATE_MESSAGE="private.message"}(f||(f={}));class M{constructor(e,t){this.receiver=e,this.clientInfo=t,this.messageType=f.ACTION}notify(e){this.receiver.onActionReceived(e,this.clientInfo)}}class E{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=f.EVENT_SUB}notify(e){this.observer.onEventSubReceived(e,this.clientInfo)}}class T{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=f.EVENT_UNSUB}notify(e){this.observer.onEventUnsubReceived(e,this.clientInfo)}}class _{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=f.OBSERVABLE_SUB}notify(e){this.observer.onObservableSubReceived(e,this.clientInfo)}}class S{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=f.OBSERVABLE_UNSUB}notify(e){this.observer.onObservableUnsubReceived(e,this.clientInfo)}}class I{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=f.COLLECTION_SUB}notify(e){this.observer.onCollectionSubReceived(e,this.clientInfo)}}class R{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=f.COLLECTION_UNSUB}notify(e){this.observer.onCollectionUnsubReceived(e,this.clientInfo)}}class A{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=f.PRIVATE_MESSAGE}notify(e){this.observer.onPrivateMessageReceived(e,this.clientInfo)}}class k{constructor(e){this.type=f.EVENT_SUB,this.payload={subscription:e}}}class N{constructor(e){this.type=f.EVENT_UNSUB,this.payload={subscription:e}}}class D{constructor(e){this.getMessenger=e,this.eventHandlers=new a;const t=new class{constructor(e){this.eventHandler=e}receiveEvent(e){this.eventHandler.receiveEvent(e)}}(this);this.eventObserver=new m(t),this.getMessenger().addObserver(this.eventObserver)}build(){return{on:(e,t)=>this.subscribe(e,t),off:(e,t)=>this.unsubscribe(e,t)}}dispose(){for(const e of this.eventHandlers.keys)this.getMessenger().send(new N(e));this.getMessenger().removeObserver(this.eventObserver)}receiveEvent(e){const t=this.eventHandlers.getValuesAtKey(e.eventType);if(t)for(const s of t)e.eventData?s(...e.eventData):s()}subscribe(e,t){0===this.eventHandlers.valuesPerKey(e)&&this.getMessenger().send(new k(e)),this.eventHandlers.add(e,t)}unsubscribe(e,t){this.eventHandlers.remove(e,t),0===this.eventHandlers.valuesPerKey(e)&&this.getMessenger().send(new N(e))}}class P{}function z(e,t){const s=e.split(".");let i=t;for(const e of s){const t=i[e]||new P;i[e]=t,i=t}return i}class U{constructor(){}build(e){const t=new P;for(const s of Object.keys(e)){const i=e[s];if(i){z(i.namespace,t)[i.name]=i.values}}return t}dispose(){}}class L{constructor(e,t){this.type=f.PRIVATE_MESSAGE,this.payload={messageType:e,messagePayload:t}}}class j{constructor(e){this.getMessenger=e,this.values=new Map}dispose(){}register(e,t){const s=t.value();return this.values.set(e,s),"function"==typeof s?(...e)=>(this.getMessenger().send(new L("client call",{namespace:t.namespace,name:t.name})),s(...e)):s}lookup(e){return this.values.get(e)}}class F{constructor(e){this.registration=e}build(e){const t=new P;for(const s of Object.keys(e)){const i=e[s];if(i){z(i.namespace,t)[i.name]=this.registration.register(s,i)}}return t}}function V(e,t){return(t=t||{x:0,y:0,z:0}).x=e.anchorPosition.x,t.y=e.anchorPosition.y,t.z=e.anchorPosition.z,t.x+=e.stemVector.x,t.y+=e.stemVector.y,t.z+=e.stemVector.z,t}const H=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const B=Math.PI/180,W=180/Math.PI;function K(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(H[255&e]+H[e>>8&255]+H[e>>16&255]+H[e>>24&255]+"-"+H[255&t]+H[t>>8&255]+"-"+H[t>>16&15|64]+H[t>>24&255]+"-"+H[63&s|128]+H[s>>8&255]+"-"+H[s>>16&255]+H[s>>24&255]+H[255&i]+H[i>>8&255]+H[i>>16&255]+H[i>>24&255]).toLowerCase()}function q(e,t,s){return Math.max(t,Math.min(s,e))}class G{constructor(e=0,t=0,s=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=i}static slerpFlat(e,t,s,i,n,r,o){let a=s[i+0],c=s[i+1],h=s[i+2],l=s[i+3];const u=n[r+0],d=n[r+1],p=n[r+2],f=n[r+3];if(0===o)return e[t+0]=a,e[t+1]=c,e[t+2]=h,void(e[t+3]=l);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(l!==f||a!==u||c!==d||h!==p){let e=1-o;const t=a*u+c*d+h*p+l*f,s=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const n=Math.sqrt(i),r=Math.atan2(n,t*s);e=Math.sin(e*r)/n,o=Math.sin(o*r)/n}const n=o*s;if(a=a*e+u*n,c=c*e+d*n,h=h*e+p*n,l=l*e+f*n,e===1-o){const e=1/Math.sqrt(a*a+c*c+h*h+l*l);a*=e,c*=e,h*=e,l*=e}}e[t]=a,e[t+1]=c,e[t+2]=h,e[t+3]=l}static multiplyQuaternionsFlat(e,t,s,i,n,r){const o=s[i],a=s[i+1],c=s[i+2],h=s[i+3],l=n[r],u=n[r+1],d=n[r+2],p=n[r+3];return e[t]=o*p+h*l+a*d-c*u,e[t+1]=a*p+h*u+c*l-o*d,e[t+2]=c*p+h*d+o*u-a*l,e[t+3]=h*p-o*l-a*u-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,i){return this._x=e,this._y=t,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const s=e._x,i=e._y,n=e._z,r=e._order,o=Math.cos,a=Math.sin,c=o(s/2),h=o(i/2),l=o(n/2),u=a(s/2),d=a(i/2),p=a(n/2);switch(r){case"XYZ":this._x=u*h*l+c*d*p,this._y=c*d*l-u*h*p,this._z=c*h*p+u*d*l,this._w=c*h*l-u*d*p;break;case"YXZ":this._x=u*h*l+c*d*p,this._y=c*d*l-u*h*p,this._z=c*h*p-u*d*l,this._w=c*h*l+u*d*p;break;case"ZXY":this._x=u*h*l-c*d*p,this._y=c*d*l+u*h*p,this._z=c*h*p+u*d*l,this._w=c*h*l-u*d*p;break;case"ZYX":this._x=u*h*l-c*d*p,this._y=c*d*l+u*h*p,this._z=c*h*p-u*d*l,this._w=c*h*l+u*d*p;break;case"YZX":this._x=u*h*l+c*d*p,this._y=c*d*l+u*h*p,this._z=c*h*p-u*d*l,this._w=c*h*l-u*d*p;break;case"XZY":this._x=u*h*l-c*d*p,this._y=c*d*l-u*h*p,this._z=c*h*p+u*d*l,this._w=c*h*l+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,i=Math.sin(s);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],i=t[4],n=t[8],r=t[1],o=t[5],a=t[9],c=t[2],h=t[6],l=t[10],u=s+o+l;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(h-a)*e,this._y=(n-c)*e,this._z=(r-i)*e}else if(s>o&&s>l){const e=2*Math.sqrt(1+s-o-l);this._w=(h-a)/e,this._x=.25*e,this._y=(i+r)/e,this._z=(n+c)/e}else if(o>l){const e=2*Math.sqrt(1+o-s-l);this._w=(n-c)/e,this._x=(i+r)/e,this._y=.25*e,this._z=(a+h)/e}else{const e=2*Math.sqrt(1+l-s-o);this._w=(r-i)/e,this._x=(n+c)/e,this._y=(a+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(q(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(0===s)return this;const i=Math.min(1,t/s);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,i=e._y,n=e._z,r=e._w,o=t._x,a=t._y,c=t._z,h=t._w;return this._x=s*h+r*o+i*c-n*a,this._y=i*h+r*a+n*o-s*c,this._z=n*h+r*c+s*a-i*o,this._w=r*h-s*o-i*a-n*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const s=this._x,i=this._y,n=this._z,r=this._w;let o=r*e._w+s*e._x+i*e._y+n*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*r+t*this._w,this._x=e*s+t*this._x,this._y=e*i+t*this._y,this._z=e*n+t*this._z,this.normalize(),this}const c=Math.sqrt(a),h=Math.atan2(c,o),l=Math.sin((1-t)*h)/c,u=Math.sin(t*h)/c;return this._w=r*l+this._w*u,this._x=s*l+this._x*u,this._y=i*l+this._y*u,this._z=n*l+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(e),i*Math.cos(e),n*Math.sin(t),n*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}const X=2e3;class ${constructor(e=0,t=0,s=0){$.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return void 0===s&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Z.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Z.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*s+n[6]*i,this.y=n[1]*t+n[4]*s+n[7]*i,this.z=n[2]*t+n[5]*s+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,i=this.z,n=e.elements,r=1/(n[3]*t+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*s+n[8]*i+n[12])*r,this.y=(n[1]*t+n[5]*s+n[9]*i+n[13])*r,this.z=(n[2]*t+n[6]*s+n[10]*i+n[14])*r,this}applyQuaternion(e){const t=this.x,s=this.y,i=this.z,n=e.x,r=e.y,o=e.z,a=e.w,c=2*(r*i-o*s),h=2*(o*t-n*i),l=2*(n*s-r*t);return this.x=t+a*c+r*l-o*h,this.y=s+a*h+o*c-n*l,this.z=i+a*l+n*h-r*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*s+n[8]*i,this.y=n[1]*t+n[5]*s+n[9]*i,this.z=n[2]*t+n[6]*s+n[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=q(this.x,e.x,t.x),this.y=q(this.y,e.y,t.y),this.z=q(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=q(this.x,e,t),this.y=q(this.y,e,t),this.z=q(this.z,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(q(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,i=e.y,n=e.z,r=t.x,o=t.y,a=t.z;return this.x=i*a-n*o,this.y=n*r-s*a,this.z=s*o-i*r,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return Y.copy(this).projectOnVector(e),this.sub(Y)}reflect(e){return this.sub(Y.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(q(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,i=this.z-e.z;return t*t+s*s+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const i=Math.sin(t)*e;return this.x=i*Math.sin(s),this.y=Math.cos(t)*e,this.z=i*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,s=Math.sqrt(1-t*t);return this.x=s*Math.cos(e),this.y=t,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Y=new $,Z=new G;class J{constructor(e,t,s,i,n,r,o,a,c,h,l,u,d,p,f,m){J.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,s,i,n,r,o,a,c,h,l,u,d,p,f,m)}set(e,t,s,i,n,r,o,a,c,h,l,u,d,p,f,m){const y=this.elements;return y[0]=e,y[4]=t,y[8]=s,y[12]=i,y[1]=n,y[5]=r,y[9]=o,y[13]=a,y[2]=c,y[6]=h,y[10]=l,y[14]=u,y[3]=d,y[7]=p,y[11]=f,y[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new J).fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,s=e.elements,i=1/Q.setFromMatrixColumn(e,0).length(),n=1/Q.setFromMatrixColumn(e,1).length(),r=1/Q.setFromMatrixColumn(e,2).length();return t[0]=s[0]*i,t[1]=s[1]*i,t[2]=s[2]*i,t[3]=0,t[4]=s[4]*n,t[5]=s[5]*n,t[6]=s[6]*n,t[7]=0,t[8]=s[8]*r,t[9]=s[9]*r,t[10]=s[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,s=e.x,i=e.y,n=e.z,r=Math.cos(s),o=Math.sin(s),a=Math.cos(i),c=Math.sin(i),h=Math.cos(n),l=Math.sin(n);if("XYZ"===e.order){const e=r*h,s=r*l,i=o*h,n=o*l;t[0]=a*h,t[4]=-a*l,t[8]=c,t[1]=s+i*c,t[5]=e-n*c,t[9]=-o*a,t[2]=n-e*c,t[6]=i+s*c,t[10]=r*a}else if("YXZ"===e.order){const e=a*h,s=a*l,i=c*h,n=c*l;t[0]=e+n*o,t[4]=i*o-s,t[8]=r*c,t[1]=r*l,t[5]=r*h,t[9]=-o,t[2]=s*o-i,t[6]=n+e*o,t[10]=r*a}else if("ZXY"===e.order){const e=a*h,s=a*l,i=c*h,n=c*l;t[0]=e-n*o,t[4]=-r*l,t[8]=i+s*o,t[1]=s+i*o,t[5]=r*h,t[9]=n-e*o,t[2]=-r*c,t[6]=o,t[10]=r*a}else if("ZYX"===e.order){const e=r*h,s=r*l,i=o*h,n=o*l;t[0]=a*h,t[4]=i*c-s,t[8]=e*c+n,t[1]=a*l,t[5]=n*c+e,t[9]=s*c-i,t[2]=-c,t[6]=o*a,t[10]=r*a}else if("YZX"===e.order){const e=r*a,s=r*c,i=o*a,n=o*c;t[0]=a*h,t[4]=n-e*l,t[8]=i*l+s,t[1]=l,t[5]=r*h,t[9]=-o*h,t[2]=-c*h,t[6]=s*l+i,t[10]=e-n*l}else if("XZY"===e.order){const e=r*a,s=r*c,i=o*a,n=o*c;t[0]=a*h,t[4]=-l,t[8]=c*h,t[1]=e*l+n,t[5]=r*h,t[9]=s*l-i,t[2]=i*l-s,t[6]=o*h,t[10]=n*l+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(te,e,se)}lookAt(e,t,s){const i=this.elements;return re.subVectors(e,t),0===re.lengthSq()&&(re.z=1),re.normalize(),ie.crossVectors(s,re),0===ie.lengthSq()&&(1===Math.abs(s.z)?re.x+=1e-4:re.z+=1e-4,re.normalize(),ie.crossVectors(s,re)),ie.normalize(),ne.crossVectors(re,ie),i[0]=ie.x,i[4]=ne.x,i[8]=re.x,i[1]=ie.y,i[5]=ne.y,i[9]=re.y,i[2]=ie.z,i[6]=ne.z,i[10]=re.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,n=this.elements,r=s[0],o=s[4],a=s[8],c=s[12],h=s[1],l=s[5],u=s[9],d=s[13],p=s[2],f=s[6],m=s[10],y=s[14],g=s[3],b=s[7],v=s[11],w=s[15],x=i[0],O=i[4],C=i[8],M=i[12],E=i[1],T=i[5],_=i[9],S=i[13],I=i[2],R=i[6],A=i[10],k=i[14],N=i[3],D=i[7],P=i[11],z=i[15];return n[0]=r*x+o*E+a*I+c*N,n[4]=r*O+o*T+a*R+c*D,n[8]=r*C+o*_+a*A+c*P,n[12]=r*M+o*S+a*k+c*z,n[1]=h*x+l*E+u*I+d*N,n[5]=h*O+l*T+u*R+d*D,n[9]=h*C+l*_+u*A+d*P,n[13]=h*M+l*S+u*k+d*z,n[2]=p*x+f*E+m*I+y*N,n[6]=p*O+f*T+m*R+y*D,n[10]=p*C+f*_+m*A+y*P,n[14]=p*M+f*S+m*k+y*z,n[3]=g*x+b*E+v*I+w*N,n[7]=g*O+b*T+v*R+w*D,n[11]=g*C+b*_+v*A+w*P,n[15]=g*M+b*S+v*k+w*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],i=e[8],n=e[12],r=e[1],o=e[5],a=e[9],c=e[13],h=e[2],l=e[6],u=e[10],d=e[14];return e[3]*(+n*a*l-i*c*l-n*o*u+s*c*u+i*o*d-s*a*d)+e[7]*(+t*a*d-t*c*u+n*r*u-i*r*d+i*c*h-n*a*h)+e[11]*(+t*c*l-t*o*d-n*r*l+s*r*d+n*o*h-s*c*h)+e[15]*(-i*o*h-t*a*l+t*o*u+i*r*l-s*r*u+s*a*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],n=e[3],r=e[4],o=e[5],a=e[6],c=e[7],h=e[8],l=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],y=e[15],g=l*m*c-f*u*c+f*a*d-o*m*d-l*a*y+o*u*y,b=p*u*c-h*m*c-p*a*d+r*m*d+h*a*y-r*u*y,v=h*f*c-p*l*c+p*o*d-r*f*d-h*o*y+r*l*y,w=p*l*a-h*f*a-p*o*u+r*f*u+h*o*m-r*l*m,x=t*g+s*b+i*v+n*w;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const O=1/x;return e[0]=g*O,e[1]=(f*u*n-l*m*n-f*i*d+s*m*d+l*i*y-s*u*y)*O,e[2]=(o*m*n-f*a*n+f*i*c-s*m*c-o*i*y+s*a*y)*O,e[3]=(l*a*n-o*u*n-l*i*c+s*u*c+o*i*d-s*a*d)*O,e[4]=b*O,e[5]=(h*m*n-p*u*n+p*i*d-t*m*d-h*i*y+t*u*y)*O,e[6]=(p*a*n-r*m*n-p*i*c+t*m*c+r*i*y-t*a*y)*O,e[7]=(r*u*n-h*a*n+h*i*c-t*u*c-r*i*d+t*a*d)*O,e[8]=v*O,e[9]=(p*l*n-h*f*n-p*s*d+t*f*d+h*s*y-t*l*y)*O,e[10]=(r*f*n-p*o*n+p*s*c-t*f*c-r*s*y+t*o*y)*O,e[11]=(h*o*n-r*l*n-h*s*c+t*l*c+r*s*d-t*o*d)*O,e[12]=w*O,e[13]=(h*f*i-p*l*i+p*s*u-t*f*u-h*s*m+t*l*m)*O,e[14]=(p*o*i-r*f*i-p*s*a+t*f*a+r*s*m-t*o*m)*O,e[15]=(r*l*i-h*o*i+h*s*a-t*l*a-r*s*u+t*o*u)*O,this}scale(e){const t=this.elements,s=e.x,i=e.y,n=e.z;return t[0]*=s,t[4]*=i,t[8]*=n,t[1]*=s,t[5]*=i,t[9]*=n,t[2]*=s,t[6]*=i,t[10]*=n,t[3]*=s,t[7]*=i,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,i))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),i=Math.sin(t),n=1-s,r=e.x,o=e.y,a=e.z,c=n*r,h=n*o;return this.set(c*r+s,c*o-i*a,c*a+i*o,0,c*o+i*a,h*o+s,h*a-i*r,0,c*a-i*o,h*a+i*r,n*a*a+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,i,n,r){return this.set(1,s,n,0,e,1,r,0,t,i,1,0,0,0,0,1),this}compose(e,t,s){const i=this.elements,n=t._x,r=t._y,o=t._z,a=t._w,c=n+n,h=r+r,l=o+o,u=n*c,d=n*h,p=n*l,f=r*h,m=r*l,y=o*l,g=a*c,b=a*h,v=a*l,w=s.x,x=s.y,O=s.z;return i[0]=(1-(f+y))*w,i[1]=(d+v)*w,i[2]=(p-b)*w,i[3]=0,i[4]=(d-v)*x,i[5]=(1-(u+y))*x,i[6]=(m+g)*x,i[7]=0,i[8]=(p+b)*O,i[9]=(m-g)*O,i[10]=(1-(u+f))*O,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,s){const i=this.elements;let n=Q.set(i[0],i[1],i[2]).length();const r=Q.set(i[4],i[5],i[6]).length(),o=Q.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],ee.copy(this);const a=1/n,c=1/r,h=1/o;return ee.elements[0]*=a,ee.elements[1]*=a,ee.elements[2]*=a,ee.elements[4]*=c,ee.elements[5]*=c,ee.elements[6]*=c,ee.elements[8]*=h,ee.elements[9]*=h,ee.elements[10]*=h,t.setFromRotationMatrix(ee),s.x=n,s.y=r,s.z=o,this}makePerspective(e,t,s,i,n,r,o=2e3){const a=this.elements,c=2*n/(t-e),h=2*n/(s-i),l=(t+e)/(t-e),u=(s+i)/(s-i);let d,p;if(o===X)d=-(r+n)/(r-n),p=-2*r*n/(r-n);else{if(2001!==o)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-r/(r-n),p=-r*n/(r-n)}return a[0]=c,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=h,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,s,i,n,r,o=2e3){const a=this.elements,c=1/(t-e),h=1/(s-i),l=1/(r-n),u=(t+e)*c,d=(s+i)*h;let p,f;if(o===X)p=(r+n)*l,f=-2*l;else{if(2001!==o)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=n*l,f=-1*l}return a[0]=2*c,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let e=0;e<16;e++)if(t[e]!==s[e])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}const Q=new $,ee=new J,te=new $(0,0,0),se=new $(1,1,1),ie=new $,ne=new $,re=new $,oe=new J,ae=new G;class ce{constructor(e=0,t=0,s=0,i=ce.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=s,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,s,i=this._order){return this._x=e,this._y=t,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,s=!0){const i=e.elements,n=i[0],r=i[4],o=i[8],a=i[1],c=i[5],h=i[9],l=i[2],u=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(q(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-q(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-l,n),this._z=0);break;case"ZXY":this._x=Math.asin(q(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-q(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(q(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-l,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-q(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===s&&this._onChangeCallback(),this}setFromQuaternion(e,t,s){return oe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(oe,t,s)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ae.setFromEuler(this),this.setFromQuaternion(ae,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ce.DEFAULT_ORDER="XYZ";class he{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const s=this._listeners;void 0===s[e]&&(s[e]=[]),-1===s[e].indexOf(t)&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return void 0!==s&&(void 0!==s[e]&&-1!==s[e].indexOf(t))}removeEventListener(e,t){const s=this._listeners;if(void 0===s)return;const i=s[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const s=t[e.type];if(void 0!==s){e.target=this;const t=s.slice(0);for(let s=0,i=t.length;s<i;s++)t[s].call(this,e);e.target=null}}}class le{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}class ue{constructor(e,t,s,i,n,r,o,a,c){ue.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,s,i,n,r,o,a,c)}set(e,t,s,i,n,r,o,a,c){const h=this.elements;return h[0]=e,h[1]=i,h[2]=o,h[3]=t,h[4]=n,h[5]=a,h[6]=s,h[7]=r,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,n=this.elements,r=s[0],o=s[3],a=s[6],c=s[1],h=s[4],l=s[7],u=s[2],d=s[5],p=s[8],f=i[0],m=i[3],y=i[6],g=i[1],b=i[4],v=i[7],w=i[2],x=i[5],O=i[8];return n[0]=r*f+o*g+a*w,n[3]=r*m+o*b+a*x,n[6]=r*y+o*v+a*O,n[1]=c*f+h*g+l*w,n[4]=c*m+h*b+l*x,n[7]=c*y+h*v+l*O,n[2]=u*f+d*g+p*w,n[5]=u*m+d*b+p*x,n[8]=u*y+d*v+p*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[1],i=e[2],n=e[3],r=e[4],o=e[5],a=e[6],c=e[7],h=e[8];return t*r*h-t*o*c-s*n*h+s*o*a+i*n*c-i*r*a}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],n=e[3],r=e[4],o=e[5],a=e[6],c=e[7],h=e[8],l=h*r-o*c,u=o*a-h*n,d=c*n-r*a,p=t*l+s*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=l*f,e[1]=(i*c-h*s)*f,e[2]=(o*s-i*r)*f,e[3]=u*f,e[4]=(h*t-i*a)*f,e[5]=(i*n-o*t)*f,e[6]=d*f,e[7]=(s*a-c*t)*f,e[8]=(r*t-s*n)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,i,n,r,o){const a=Math.cos(n),c=Math.sin(n);return this.set(s*a,s*c,-s*(a*r+c*o)+r+e,-i*c,i*a,-i*(-c*r+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(de.makeScale(e,t)),this}rotate(e){return this.premultiply(de.makeRotation(-e)),this}translate(e,t){return this.premultiply(de.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,s,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,s=e.elements;for(let e=0;e<9;e++)if(t[e]!==s[e])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const de=new ue;let pe=0;const fe=new $,me=new G,ye=new J,ge=new $,be=new $,ve=new $,we=new G,xe=new $(1,0,0),Oe=new $(0,1,0),Ce=new $(0,0,1),Me={type:"added"},Ee={type:"removed"},Te={type:"childadded",child:null},_e={type:"childremoved",child:null};class Se extends he{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:pe++}),this.uuid=K(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Se.DEFAULT_UP.clone();const e=new $,t=new ce,s=new G,i=new $(1,1,1);t._onChange((function(){s.setFromEuler(t,!1)})),s._onChange((function(){t.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new J},normalMatrix:{value:new ue}}),this.matrix=new J,this.matrixWorld=new J,this.matrixAutoUpdate=Se.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Se.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new le,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return me.setFromAxisAngle(e,t),this.quaternion.multiply(me),this}rotateOnWorldAxis(e,t){return me.setFromAxisAngle(e,t),this.quaternion.premultiply(me),this}rotateX(e){return this.rotateOnAxis(xe,e)}rotateY(e){return this.rotateOnAxis(Oe,e)}rotateZ(e){return this.rotateOnAxis(Ce,e)}translateOnAxis(e,t){return fe.copy(e).applyQuaternion(this.quaternion),this.position.add(fe.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(xe,e)}translateY(e){return this.translateOnAxis(Oe,e)}translateZ(e){return this.translateOnAxis(Ce,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ye.copy(this.matrixWorld).invert())}lookAt(e,t,s){e.isVector3?ge.copy(e):ge.set(e,t,s);const i=this.parent;this.updateWorldMatrix(!0,!1),be.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ye.lookAt(be,ge,this.up):ye.lookAt(ge,be,this.up),this.quaternion.setFromRotationMatrix(ye),i&&(ye.extractRotation(i.matrixWorld),me.setFromRotationMatrix(ye),this.quaternion.premultiply(me.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Me),Te.child=e,this.dispatchEvent(Te),Te.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ee),_e.child=e,this.dispatchEvent(_e),_e.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ye.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ye.multiply(e.parent.matrixWorld)),e.applyMatrix4(ye),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Me),Te.child=e,this.dispatchEvent(Te),Te.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let s=0,i=this.children.length;s<i;s++){const i=this.children[s].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,s=[]){this[e]===t&&s.push(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].getObjectsByProperty(e,t,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(be,e,ve),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(be,we,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let s=0,i=t.length;s<i;s++)t[s].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let s=0,i=t.length;s<i;s++)t[s].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let s=0,i=t.length;s<i;s++){t[s].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const s=this.parent;if(!0===e&&null!==s&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,s=e.length;t<s;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,s={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function n(t,s){return void 0===t[s.uuid]&&(t[s.uuid]=s.toJSON(e)),s.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map((e=>({...e,boundingBox:e.boundingBox?{min:e.boundingBox.min.toArray(),max:e.boundingBox.max.toArray()}:void 0,boundingSphere:e.boundingSphere?{radius:e.boundingSphere.radius,center:e.boundingSphere.center.toArray()}:void 0}))),i.instanceInfo=this._instanceInfo.map((e=>({...e}))),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const s=t.shapes;if(Array.isArray(s))for(let t=0,i=s.length;t<i;t++){const i=s[t];n(e.shapes,i)}else n(e.shapes,s)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let s=0,i=this.material.length;s<i;s++)t.push(n(e.materials,this.material[s]));i.material=t}else i.material=n(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const s=this.animations[t];i.animations.push(n(e.animations,s))}}if(t){const t=r(e.geometries),i=r(e.materials),n=r(e.textures),o=r(e.images),a=r(e.shapes),c=r(e.skeletons),h=r(e.animations),l=r(e.nodes);t.length>0&&(s.geometries=t),i.length>0&&(s.materials=i),n.length>0&&(s.textures=n),o.length>0&&(s.images=o),a.length>0&&(s.shapes=a),c.length>0&&(s.skeletons=c),h.length>0&&(s.animations=h),l.length>0&&(s.nodes=l)}return s.object=i,s;function r(e){const t=[];for(const s in e){const i=e[s];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const s=e.children[t];this.add(s.clone())}return this}}Se.DEFAULT_UP=new $(0,1,0),Se.DEFAULT_MATRIX_AUTO_UPDATE=!0,Se.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class Ie extends Se{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new J,this.projectionMatrix=new J,this.projectionMatrixInverse=new J,this.coordinateSystem=X}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Re{constructor(e=0,t=0){Re.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,s=this.y,i=e.elements;return this.x=i[0]*t+i[3]*s+i[6],this.y=i[1]*t+i[4]*s+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=q(this.x,e.x,t.x),this.y=q(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=q(this.x,e,t),this.y=q(this.y,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(q(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(q(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const s=Math.cos(t),i=Math.sin(t),n=this.x-e.x,r=this.y-e.y;return this.x=n*s-r*i+e.x,this.y=n*i+r*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}const Ae=new $,ke=new Re,Ne=new Re;class De extends Ie{constructor(e=50,t=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*W*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*B*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*W*Math.atan(Math.tan(.5*B*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,s){Ae.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ae.x,Ae.y).multiplyScalar(-e/Ae.z),Ae.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(Ae.x,Ae.y).multiplyScalar(-e/Ae.z)}getViewSize(e,t){return this.getViewBounds(e,ke,Ne),t.subVectors(Ne,ke)}setViewOffset(e,t,s,i,n,r){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*B*this.fov)/this.zoom,s=2*t,i=this.aspect*s,n=-.5*i;const r=this.view;if(null!==this.view&&this.view.enabled){const e=r.fullWidth,o=r.fullHeight;n+=r.offsetX*i/e,t-=r.offsetY*s/o,i*=r.width/e,s*=r.height/o}const o=this.filmOffset;0!==o&&(n+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-s,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Pe=(e,t,s=1e-5)=>Math.abs(e-t)<=s,ze=(e,t,s=1e-5)=>Pe(e.x,t.x,s)&&Pe(e.y,t.y,s),Ue=(e,t,s=1e-5)=>ze(e,t,s)&&Pe(e.z,t.z,s);function Le(e,t){e.x=t.x,e.y=t.y}function je(e,t){Le(e,t),e.z=t.z}class Fe extends Error{constructor(e,t){var s;super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(s=e)&&s instanceof Error&&s.isMock&&(this.isMock=!0))}}function Ve(e,t){const s=t.length;e.length=s;for(let i=0;i<s;++i)e[i]=t[i];return e}class He extends Fe{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}function Be(e,t){const s=1e-5;return e.mode===t.mode&&e.sweep===t.sweep&&Ue(e.position,t.position,s)&&ze(e.rotation,t.rotation,s)&&((e,t,s=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,i)=>!Pe(e,t[i],s))))(e.projection,t.projection,s)}function We(e,t){e.sweep=t.sweep,e.mode=t.mode,je(e.position,t.position),Le(e.rotation,t.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new He;const s=t.length;for(let i=0;i<s;++i)e[i]=t[i]}(e.projection,t.projection)}var Ke,qe,Ge,Xe,$e,Ye,Ze,Je,Qe,et,tt,st,it,nt,rt,ot,at,ct;!function(e){let t,s,i,n;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(s=e.Phase||(e.Phase={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(i=e.Application||(e.Application={})),function(e){e.RoomBounds="feature.roombounds",e.Defurnish="feature.defurnish"}(n=e.Feature||(e.Feature={}))}(Ke||(Ke={})),function(e){let t,s,i;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(s=e.Direction||(e.Direction={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade",e.MOVEFADE="transition.movefade",e.ORBIT="transition.orbit"}(i=e.TransitionType||(e.TransitionType={}))}(qe||(qe={})),function(e){let t;!function(e){let t,s,i;!function(e){e.TO_API="coordinatesToAPI",e.TO_SDK="coordinatesToSDK"}(t=e.Coordinates||(e.Coordinates={})),function(e){e.TO_API="sweepRotationToAPI",e.TO_SDK="sweepRotationToSDK"}(s=e.SweepRotation||(e.SweepRotation={})),function(e){e.TO_API="cameraRotationToAPI",e.TO_SDK="cameraRotationToSDK"}(i=e.CameraRotation||(e.CameraRotation={}))}(t=e.TransformType||(e.TransformType={}))}(Ge||(Ge={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(Xe||(Xe={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}($e||($e={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(Ye||(Ye={})),function(e){let t,s,i;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.default",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(s=e.OpenPolicy||(e.OpenPolicy={})),function(e){e.DEFAULT="link.destination.default",e.MATTERPORT="link.destination.matterport"}(i=e.DestinationPolicy||(e.DestinationPolicy={}))}(Ze||(Ze={})),function(e){let t,s,i,n;e.Transition=qe.TransitionType,function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(t=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(s=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(i=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(n=e.MediaType||(e.MediaType={}))}(Je||(Je={})),function(e){let t,s;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning",e.EXTERIOR="mode.exterior"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(s=e.Event||(e.Event={})),e.TransitionType=qe.TransitionType}(Qe||(Qe={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(et||(et={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(tt||(tt={})),function(e){let t,s;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(s=e.SourceType||(e.SourceType={}))}(st||(st={})),function(e){let t,s,i;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),e.Transition=qe.TransitionType,function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(s=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(i=e.Placement||(e.Placement={}))}(it||(it={})),function(e){let t;!function(e){e.UNKNOWN="tag.attachment.unknown",e.APPLICATION="tag.attachment.application",e.AUDIO="tag.attachment.audio",e.IMAGE="tag.attachment.image",e.MODEL="tag.attachment.model",e.PDF="tag.attachment.pdf",e.RICH="tag.attachment.rich",e.TEXT="tag.attachment.text",e.VIDEO="tag.attachment.video",e.ZIP="tag.attachment.zip",e.SANDBOX="tag.attachment.sandbox"}(t=e.AttachmentType||(e.AttachmentType={}))}(nt||(nt={})),function(e){let t,s;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={})),function(e){e.INACTIVE="tour.inactive",e.ACTIVE="tour.active",e.STOP_SCHEDULED="tour.stopscheduled"}(s=e.PlayState||(e.PlayState={}))}(rt||(rt={})),function(e){let t,s;!function(e){e.BASE="viewtype.base",e.LAYERED_BASE="viewtype.layeredbase",e.USER="viewtype.user",e.DEFURNISH="viewtype.defurnish",e.OTHER="viewtype.other"}(t=e.ViewType||(e.ViewType={})),function(e){e.BASE="layertype.base",e.VIEW_DATA="layertype.viewdata",e.USER="layertype.user",e.IN_MEMORY="layertype.inmemory",e.OTHER="layertype.other"}(s=e.LayerType||(e.LayerType={}))}(ot||(ot={})),function(e){let t,s,i;!function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(t=e.Component||(e.Component={})),function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(s=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(i=e.PathType||(e.PathType={}))}(at||(at={})),function(e){let t;!function(e){e.ON="on",e.OFF="off"}(t=e.Visibility||(e.Visibility={}))}(ct||(ct={}));const ht=Math.PI/180;class lt{constructor(){this.tempEuler=new ce,this.tempPosition=new $,this.camera=new De,this.cameraPose=null}setCameraFromPose(e){if(this.cameraPose&&Be(this.cameraPose,e))return;this.cameraPose=this.cameraPose||ut,We(this.cameraPose,e);const t=e.position;this.camera.position.set(t.x,t.y,t.z);const s=e.rotation;this.tempEuler.set(s.x*ht,s.y*ht,0,"YXZ"),this.camera.quaternion.setFromEuler(this.tempEuler),this.camera.updateMatrixWorld(),this.camera.projectionMatrix.fromArray(e.projection).transpose()}worldToNDC(e,t){return this.tempPosition.set(e.x,e.y,e.z),this.tempPosition.project(this.camera),(t=t||{x:0,y:0,z:0}).x=this.tempPosition.x,t.y=this.tempPosition.y,t.z=this.tempPosition.z,t}worldToScreen(e,t,s){return(s=this.worldToNDC(e,s)).x=.5*(s.x+1)*t.w,s.y=-.5*(s.y-1)*t.h,(s.z<-1||s.z>1)&&(s.x=-Math.abs(s.x),s.y=-Math.abs(s.y)),s}}const ut={sweep:"",mode:Qe.Mode.DOLLHOUSE,position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16)};function dt(e){return"number"==typeof e&&!isNaN(e)}function pt(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return dt(t.x)&&dt(t.y)&&dt(t.z)&&dt(t.w)}return!1}const ft=function(e,t){if(t===Ge.TransformType.Coordinates.TO_API||t===Ge.TransformType.Coordinates.TO_SDK){const s=yt[t];if(function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return dt(t.x)&&dt(t.y)&&dt(t.z)}return!1}(e)&&!pt(e)&&s instanceof Function)return s(e);throw new Error("Invalid coordinates: all values must be numbers")}if(t===Ge.TransformType.CameraRotation.TO_API||t===Ge.TransformType.CameraRotation.TO_SDK||t===Ge.TransformType.SweepRotation.TO_API||t===Ge.TransformType.SweepRotation.TO_SDK){const s=yt[t];if(pt(e)&&s instanceof Function)return s(e);throw new Error("Invalid rotation: all values must be numbers")}throw new Error("Invalid coordinates: all values must be numbers")};function mt(e,t){const{w:s,x:i,y:n,z:r}=e,{w:o,x:a,y:c,z:h}=t;return{w:s*o-i*a-n*c-r*h,x:s*a+i*o+n*h-r*c,y:s*c-i*h+n*o+r*a,z:s*h+i*c-n*a+r*o}}const yt={coordinatesToSDK:function(e){return{x:e.x,y:e.z,z:-e.y}},coordinatesToAPI:function(e){return{x:e.x,y:-e.z,z:e.y}},cameraRotationToSDK:function(e){return mt({x:e.x,y:e.z,z:-e.y,w:e.w},{x:Math.sqrt(.5),y:0,z:0,w:Math.sqrt(.5)})},cameraRotationToAPI:function(e){return mt({x:e.x,y:-e.z,z:e.y,w:e.w},{x:-Math.sqrt(.5),y:0,z:0,w:Math.sqrt(.5)})},sweepRotationToSDK:function(e){return mt({x:e.x,y:e.z,z:-e.y,w:e.w},{x:0,y:Math.sqrt(.5),z:0,w:Math.sqrt(.5)})},sweepRotationToAPI:function(e){return mt({x:e.x,y:-e.z,z:e.y,w:e.w},{x:0,y:0,z:-Math.sqrt(.5),w:Math.sqrt(.5)})}};const gt={namespace:"OAuth",name:"updateToken",args:["token"]};var bt,vt;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(bt||(bt={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(vt||(vt={}));const wt=new WeakMap;class xt{constructor({retries:e=0,concurrency:t=6}={}){this.totalBytesDownloaded=0,this.queue=[],this.retries=e,this.concurrency=t}get(e,t){return this.request("GET",e,t)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}request(e,t,s){const i=new Ot(e,t,s);if(null==s?void 0:s.signal){const e=()=>{this.queue.includes(i)&&(i.status===vt.SENDING&&i.abort(),this.dequeue(i),i.onFail(new DOMException("Aborted","AbortError")))};s.signal.addEventListener("abort",e),wt.set(i,(()=>{var t;null===(t=s.signal)||void 0===t||t.removeEventListener("abort",e),wt.delete(i)}))}return this.enqueue(i),i.promise}update(){let e;for(;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=vt.PENDING;this.updateTimeout=null}enqueue(e){let t=0;for(t=0;t<this.queue.length;t++){if(this.queue[t].priority<e.priority)break}this.queue.splice(t,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((()=>{this.update()}),1))}dequeue(e){var t;null===(t=wt.get(e))||void 0===t||t();const s=this.queue.indexOf(e);if(-1===s)throw new Error("Can't dequeue request not in queue");this.queue.splice(s,1),this.update()}getNextPendingRequest(){for(let e=0;e<this.queue.length&&e<this.concurrency;e++){const t=this.queue[e];if(t.status===vt.PENDING)return t}return null}getNextOverflowingGet(){for(let e=this.concurrency;e<this.queue.length;e++){const t=this.queue[e];if(t.status===vt.SENDING&&t.priority!==bt.HIGHEST&&"GET"===t.method)return t}return null}shouldRetryStatusCode(e){return!xt.doNotRetryStatusCodes[e]}sendRequest(e){e.status=vt.SENDING,e.send().then((t=>{e.status=vt.DONE,this.dequeue(e),e.contentLength&&e.contentLength>0&&(this.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(t)})).catch((t=>{const s=null!==e.maxRetries?e.maxRetries:this.retries;let i=e.sendAttempts<s;if("object"==typeof t){const e=t.status_code||0;i=i&&this.shouldRetryStatusCode(e)}i?(e.status=vt.PENDING,this.update(),console.warn(`Retried ${e.url}`),console.warn(t)):(e.status=vt.FAILED,this.dequeue(e),console.warn(`Failed ${e.url}`),e.onFail(t))}))}}xt.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0};class Ot{constructor(e,t,s={}){this.sendAttempts=0,this.status=vt.PENDING,this.contentLength=0,this.isAborting=!1,this.url=t,this.method=e,this.auth=s.auth||null,this.withCredentials=s.withCredentials||!1,this.priority=s.priority||bt.MEDIUM,this.responseType=s.responseType||null,this.body=s.body||null,this.headers=s.headers||{},this.maxRetries=s.maxRetries||null,this.onProgress=s.onProgress,this.promise=new Promise(((e,t)=>{this.onDone=e,this.onFail=t}))}send(){const e=this.xhr=function(e,t,s){let i;if("undefined"!=typeof XMLHttpRequest)i=new XMLHttpRequest,i.withCredentials=s;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");i=new XDomainRequest}return i.open(e,t,!0),i}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)e.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');e.responseType="blob"}"json"===this.responseType&&e.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&e.setRequestHeader("Authorization",this.auth);for(const t in this.headers)e.setRequestHeader(t,this.headers[t]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),e.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(e.onprogress=this.onProgress),new Promise(((t,s)=>{e.onreadystatechange=()=>{if(4===e.readyState){if(200===e.status||201===e.status||204===e.status)return this.parseResponse(this.xhr).then((e=>{t(e)}));if(!this.isAborting)return this.parseResponse(this.xhr).then((t=>{s(Object.assign({status_code:e.status},t))})).catch((()=>{s({status_code:e.status})}));this.isAborting=!1}},e.onerror=function(e){s(e)},e.send(this.body),this.sendAttempts++}))}parseResponse(e){return new Promise(((t,s)=>{var i;try{if(!e)throw new Error(`No request received. Trying ${this.method} on ${this.url} and expecting ${this.responseType}, but request was ${this.xhr}`);let s=e.response;if(this.contentLength=parseInt(null!==(i=e.getResponseHeader("Content-Length"))&&void 0!==i?i:"0",10),"json"===this.responseType&&"object"!=typeof s)t(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==this.responseType)t(s);else{const e=URL.createObjectURL(s);s=new Image,s.onload=function(){URL.revokeObjectURL(e),t(s)},s.src=e,s.crossOrigin="Anonymous"}}catch(e){s({error:"Payload was not valid JSON"})}}))}abort(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.isAborting=!0,this.xhr.abort()}}function Ct(e,t){return Object.values(e).includes(t)}function Mt(e){return"string"==typeof e}function Et(e){return!!e&&"object"==typeof e}class Tt{constructor(){this.bindings=[]}init(e,t){return Promise.resolve()}onUpdate(e){}dispose(e){for(const e of this.bindings)null==e||e.cancel();this.bindings=[]}}const _t=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,St=(e,t=[])=>{if(void 0!==e){if(t.includes(e))return Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if(ArrayBuffer.isView(e))for(const t of[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array])if(e instanceof t)return new t(e);if("object"==typeof e){const s=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const i in e){if(_t(i))continue;const n=e[i];n instanceof Date?s[i]=new Date(n):"function"!=typeof n&&(t.push(e),s[i]="object"==typeof n?St(n,t):n,t.pop())}return s}return e}};const It=new r("Subscription");class Rt{constructor(e,t,s=!1,i=""){this.startSubscription=e,this.endSubscription=t,this.id=i,this.isSubbed=!1,s&&this.renew()}renew(){this.isSubbed?It.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function At(e,t,s=!0,i=""){return new Rt(e,t,s,i)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var kt=function(e,t){return kt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])},kt(e,t)};function Nt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}kt(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}function Dt(e,t,s,i){return new(s||(s=Promise))((function(n,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function Pt(e,t){var s,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{s=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}Object.create;function zt(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],i=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ut(e,t){var s="function"==typeof Symbol&&e[Symbol.iterator];if(!s)return e;var i,n,r=s.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}return o}function Lt(e,t){for(var s=0,i=t.length,n=e.length;s<i;s++,n++)e[n]=t[s];return e}function jt(e){return this instanceof jt?(this.v=e,this):new jt(e)}function Ft(e,t,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=s.apply(e,t||[]),r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){n[e]&&(i[e]=function(t){return new Promise((function(s,i){r.push([e,t,s,i])>1||a(e,t)}))})}function a(e,t){try{(s=n[e](t)).value instanceof jt?Promise.resolve(s.value.v).then(c,h):l(r[0][2],s)}catch(e){l(r[0][3],e)}var s}function c(e){a("next",e)}function h(e){a("throw",e)}function l(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}function Vt(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,s=e[Symbol.asyncIterator];return s?s.call(e):(e=zt(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=e[s]&&function(t){return new Promise((function(i,n){(function(e,t,s,i){Promise.resolve(i).then((function(t){e({value:t,done:s})}),t)})(i,n,(t=e[s](t)).done,t.value)}))}}}Object.create;function Ht(e){return"function"==typeof e}function Bt(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Wt=Bt((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function Kt(e,t){if(e){var s=e.indexOf(t);0<=s&&e.splice(s,1)}}var qt=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,s,i,n;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var o=zt(r),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else r.remove(this);var c=this.initialTeardown;if(Ht(c))try{c()}catch(e){n=e instanceof Wt?e.errors:[e]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var l=zt(h),u=l.next();!u.done;u=l.next()){var d=u.value;try{$t(d)}catch(e){n=null!=n?n:[],e instanceof Wt?n=Lt(Lt([],Ut(n)),Ut(e.errors)):n.push(e)}}}catch(e){s={error:e}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(s)throw s.error}}}if(n)throw new Wt(n)}},e.prototype.add=function(t){var s;if(t&&t!==this)if(this.closed)$t(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(s=this._finalizers)&&void 0!==s?s:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Kt(t,e)},e.prototype.remove=function(t){var s=this._finalizers;s&&Kt(s,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Gt=qt.EMPTY;function Xt(e){return e instanceof qt||e&&"closed"in e&&Ht(e.remove)&&Ht(e.add)&&Ht(e.unsubscribe)}function $t(e){Ht(e)?e():e.unsubscribe()}var Yt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Zt={setTimeout:function(e,t){for(var s=[],i=2;i<arguments.length;i++)s[i-2]=arguments[i];var n=Zt.delegate;return(null==n?void 0:n.setTimeout)?n.setTimeout.apply(n,Lt([e,t],Ut(s))):setTimeout.apply(void 0,Lt([e,t],Ut(s)))},clearTimeout:function(e){var t=Zt.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Jt(e){Zt.setTimeout((function(){var t=Yt.onUnhandledError;if(!t)throw e;t(e)}))}function Qt(){}var es=ts("C",void 0,void 0);function ts(e,t,s){return{kind:e,value:t,error:s}}var ss=null;function is(e){if(Yt.useDeprecatedSynchronousErrorHandling){var t=!ss;if(t&&(ss={errorThrown:!1,error:null}),e(),t){var s=ss,i=s.errorThrown,n=s.error;if(ss=null,i)throw n}}else e()}var ns=function(e){function t(t){var s=e.call(this)||this;return s.isStopped=!1,t?(s.destination=t,Xt(t)&&t.add(s)):s.destination=us,s}return Nt(t,e),t.create=function(e,t,s){return new cs(e,t,s)},t.prototype.next=function(e){this.isStopped?ls(function(e){return ts("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?ls(ts("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?ls(es,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(qt),rs=Function.prototype.bind;function os(e,t){return rs.call(e,t)}var as=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){hs(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){hs(e)}else hs(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){hs(e)}},e}(),cs=function(e){function t(t,s,i){var n,r,o=e.call(this)||this;Ht(t)||!t?n={next:null!=t?t:void 0,error:null!=s?s:void 0,complete:null!=i?i:void 0}:o&&Yt.useDeprecatedNextContext?((r=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},n={next:t.next&&os(t.next,r),error:t.error&&os(t.error,r),complete:t.complete&&os(t.complete,r)}):n=t;return o.destination=new as(n),o}return Nt(t,e),t}(ns);function hs(e){var t;Yt.useDeprecatedSynchronousErrorHandling?(t=e,Yt.useDeprecatedSynchronousErrorHandling&&ss&&(ss.errorThrown=!0,ss.error=t)):Jt(e)}function ls(e,t){var s=Yt.onStoppedNotification;s&&Zt.setTimeout((function(){return s(e,t)}))}var us={closed:!0,next:Qt,error:function(e){throw e},complete:Qt},ds="function"==typeof Symbol&&Symbol.observable||"@@observable";function ps(e){return e}function fs(e){return 0===e.length?ps:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var ms=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var s=new e;return s.source=this,s.operator=t,s},e.prototype.subscribe=function(e,t,s){var i,n=this,r=(i=e)&&i instanceof ns||function(e){return e&&Ht(e.next)&&Ht(e.error)&&Ht(e.complete)}(i)&&Xt(i)?e:new cs(e,t,s);return is((function(){var e=n,t=e.operator,s=e.source;r.add(t?t.call(r,s):s?n._subscribe(r):n._trySubscribe(r))})),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var s=this;return new(t=ys(t))((function(t,i){var n=new cs({next:function(t){try{e(t)}catch(e){i(e),n.unsubscribe()}},error:i,complete:t});s.subscribe(n)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ds]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fs(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=ys(e))((function(e,s){var i;t.subscribe((function(e){return i=e}),(function(e){return s(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function ys(e){var t;return null!==(t=null!=e?e:Yt.Promise)&&void 0!==t?t:Promise}var gs="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function bs(e){if(e instanceof ms)return e;if(null!=e){if(function(e){return Ht(e[ds])}(e))return o=e,new ms((function(e){var t=o[ds]();if(Ht(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if((r=e)&&"number"==typeof r.length&&"function"!=typeof r)return n=e,new ms((function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()}));if(Ht(null==(i=e)?void 0:i.then))return s=e,new ms((function(e){s.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Jt)}));if(function(e){return Symbol.asyncIterator&&Ht(null==e?void 0:e[Symbol.asyncIterator])}(e))return vs(e);if(function(e){return Ht(null==e?void 0:e[gs])}(e))return t=e,new ms((function(e){var s,i;try{for(var n=zt(t),r=n.next();!r.done;r=n.next()){var o=r.value;if(e.next(o),e.closed)return}}catch(e){s={error:e}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}}e.complete()}));if(function(e){return Ht(null==e?void 0:e.getReader)}(e))return vs(function(e){return Ft(this,arguments,(function(){var t,s,i;return Pt(this,(function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,jt(t.read())];case 3:return s=n.sent(),i=s.value,s.done?[4,jt(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,jt(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,s,i,n,r,o;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function vs(e){return new ms((function(t){(function(e,t){var s,i,n,r;return Dt(this,void 0,void 0,(function(){var o,a;return Pt(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),s=Vt(e),c.label=1;case 1:return[4,s.next()];case 2:if((i=c.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),n={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(r=s.return)?[4,r.call(s)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}var ws=Bt((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),xs=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Nt(t,e),t.prototype.lift=function(e){var t=new Os(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new ws},t.prototype.next=function(e){var t=this;is((function(){var s,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var n=zt(t.currentObservers),r=n.next();!r.done;r=n.next()){r.value.next(e)}}catch(e){s={error:e}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}}}}))},t.prototype.error=function(e){var t=this;is((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var s=t.observers;s.length;)s.shift().error(e)}}))},t.prototype.complete=function(){var e=this;is((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,s=this,i=s.hasError,n=s.isStopped,r=s.observers;return i||n?Gt:(this.currentObservers=null,r.push(e),new qt((function(){t.currentObservers=null,Kt(r,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,s=t.hasError,i=t.thrownError,n=t.isStopped;s?e.error(i):n&&e.complete()},t.prototype.asObservable=function(){var e=new ms;return e.source=this,e},t.create=function(e,t){return new Os(e,t)},t}(ms),Os=function(e){function t(t,s){var i=e.call(this)||this;return i.destination=t,i.source=s,i}return Nt(t,e),t.prototype.next=function(e){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===s||s.call(t,e)},t.prototype.error=function(e){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===s||s.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,s;return null!==(s=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==s?s:Gt},t}(xs);function Cs(e){return function(t){if(function(e){return Ht(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Ms(e,t){for(var s=[],i=2;i<arguments.length;i++)s[i-2]=arguments[i];if(!0!==t){if(!1!==t){var n=new cs({next:function(){n.unsubscribe(),e()}});return bs(t.apply(void 0,Lt([],Ut(s)))).subscribe(n)}}else e()}class Es{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return At((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){Es.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){Es.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}get asRxJS$(){return this._rxJS$||(this._rxJS$=new ms((e=>{const t=this.onChanged((t=>{e.next(t)}));return()=>{this._rxJS$=null,t.cancel()}})).pipe(function(e){void 0===e&&(e={});var t=e.connector,s=void 0===t?function(){return new xs}:t,i=e.resetOnError,n=void 0===i||i,r=e.resetOnComplete,o=void 0===r||r,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t,i,r,a=0,h=!1,l=!1,u=function(){null==i||i.unsubscribe(),i=void 0},d=function(){u(),t=r=void 0,h=l=!1},p=function(){var e=t;d(),null==e||e.unsubscribe()};return Cs((function(e,f){a++,l||h||u();var m=r=null!=r?r:s();f.add((function(){0!=--a||l||h||(i=Ms(p,c))})),m.subscribe(f),!t&&a>0&&(t=new cs({next:function(e){return m.next(e)},error:function(e){l=!0,u(),i=Ms(d,n,e),m.error(e)},complete:function(){h=!0,u(),i=Ms(d,o),m.complete()}}),bs(e).subscribe(t))}))(e)}}({connector:()=>new xs,resetOnRefCountZero:!0}))),this._rxJS$}static isObservable(e){return e&&e.isObservable}}function Ts(e){return"number"==typeof e?""+e:e}class _s extends Es{constructor(){super(),this.map={},this._keysSet=new Set,this._keysList=[]}get keys(){return this._keysList.slice()}get values(){return this._keysList.map((e=>this.get(e)))}sort(e){this._keysList.sort(((t,s)=>{const i=this.get(t),n=this.get(s);return e?e(i,n):0}))}entries(){const e=[];for(const t in this.map)e.push([t,this.map[t]]);return e}get length(){return this._keysList.length}*[Symbol.iterator](){for(const e of this._keysList)yield this.get(e)}get(e){return this.map[e]}has(e){return void 0!==this.map[e]}set(e,t){e=Ts(e);this.map[e]!==t&&(this.removeChildObservables(this.map[e]),this.addChildObservable(t),this.map[e]=t,this._keysSet.has(e)||(this._keysList.push(e),this._keysSet.add(e)),this.setDirty())}clear(){if(this.length>0){for(const e in this.map)this.removeChildObservables(this.map[e]);this.map={},this._keysSet.clear(),this._keysList=[],this.setDirty()}}replace(e){this.clear();for(const t in e)this.set(t,e[t])}delete(e){e=Ts(e),this.removeChildObservables(this.map[e]);const t=this.map.hasOwnProperty(e);return delete this.map[e],t&&(this._keysSet.delete(e),this._keysList.splice(this._keysList.indexOf(e),1),this.setDirty()),t}forEach(e,t){for(const s of this._keysList){const i=this.map[s];e.call(t,i,s,this)}}onElementChanged({onAdded:e,onRemoved:t,onUpdated:s}){return this.onElementsChanged((({added:i,removed:n,updated:r})=>{if(n&&t)for(const[e,s]of n)t(s,e);if(i&&e)for(const[t,s]of i)e(s,t);if(r&&s)for(const[e,t]of r)s(t,e)}))}onElementsChanged(e){let t=Object.assign({},this.map);return this.onChanged((()=>{const s={};for(const e in t)this.has(e)||(s.removed||(s.removed=[])).push([e,t[e]]);for(const e of this._keysList){const i=this.get(e);void 0===t[e]?(s.added||(s.added=[])).push([e,i]):(Es.isObservable(i)&&i._dirtyObservable||i!==t[e])&&(null!==i?(s.updated||(s.updated=[])).push([e,i]):(s.removed||(s.removed=[])).push([e,t[e]]))}t=Object.assign({},this.map),e(s)}))}deepCopy(){const e={};for(const t of this._keysList)e[t]=St(this.map[t]);return e}}function Ss(e,t){return e instanceof Function?e(t):t===e}class Is extends Es{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return St(this._value)}waitFor(e){return new Promise((t=>{if(Ss(e,this._value))t();else{const s=this.onChanged((i=>{Ss(e,i)&&(s.cancel(),t())}))}}))}}const Rs=new r("ObservableObject"),As=1===function(e,t=null,s=typeof t){return function(e,t=null,s=typeof t){if(null===e)return t;if("boolean"===s)return"true"===e||"1"===e;if("number"===s)return+e;if("object"===s&&t instanceof Array)return""===e?t:e.split(",");return e}(new URLSearchParams(window.location.search).get(e),t,s)}("debug",0);class ks extends Es{constructor(){super(),this._propertyObservables={},this._valueCache={},this._dirtyKeys=new Set,Object.defineProperties(this,{_propertyObservables:{value:this._propertyObservables,writable:!1,enumerable:!1},_valueCache:{value:this._valueCache,writable:!1,enumerable:!1},_dirtyKeys:{value:this._dirtyKeys,writable:!1,enumerable:!1}}),As&&setTimeout((()=>{!function(e){const t={};for(const s in e)e.hasOwnProperty(s)&&(t[s]=e[s],e._valueCache[s]=e[s],Object.defineProperty(e,s,{get:()=>t[s],set:i=>{const n=e._valueCache[s];(n!==i||Es.isObservable(n)&&n._dirtyObservable)&&Ds(e,s),t[s]=i},enumerable:!0}))}(this)}),1)}onPropertyChanged(e,t){const s=e;if(this._propertyObservables[s]||(this._propertyObservables[s]=new Set),this._propertyObservables[s].has(t))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return At((()=>this._propertyObservables[s].add(t)),(()=>this.removeOnPropertyChanged(e,t)),!0,s)}removeOnPropertyChanged(e,t){const s=e;this._propertyObservables[s].delete(t)}commit(){this.setDirtyUp(),this.notifyUp()}setDirtyUp(){for(const e in this){if(!this.hasOwnProperty(e))continue;const t=this._valueCache[e],s=this[e];t!==s?(this.removeChildObservables(t),this.addChildObservable(s),this._valueCache[e]=s,this._dirtyKeys.add(e)):Es.isObservable(t)&&t._dirtyObservable&&this._dirtyKeys.add(e)}super.setDirtyUp()}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._dirtyKeys){for(const t of this._propertyObservables[e]||[])this.notifyPropertyObserver(t,e);As&&Ps(this,e)}this._observerNotifying=!1,this._dirtyKeys.clear()}super.notifyObservers()}notifyPropertyObserver(e,t){e(this._valueCache[t])}notifyObserver(e){e(this)}deepCopy(){const e={};for(const t in this)this.hasOwnProperty(t)&&(e[t]=St(this[t]));return e}}const Ns=new Map;function Ds(e,t){Ns.has(e)||Ns.set(e,{});Ns.get(e)[t]=Error()}function Ps(e,t){if(Ns.has(e)){const s=Ns.get(e);s[t]&&delete s[t]}}if(As){const e=setInterval((()=>{(function(){for(const e of Ns.values())for(const t in e)return Rs.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),Rs.error("See stack trace of the property write below:"),Rs.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}class zs extends ks{}class Us extends Es{constructor(){super(),this.isObservableArray=!0,this.elements=[]}static from(...e){const t=new Us;return t.push(...e),t}push(...e){for(const t of e)this.elements.push(t),this.addChildObservable(t);return this.setDirty(),this.length}concat(e){const t=this.elements.length;this.elements=this.elements.concat(...e);for(let e=t;e<this.elements.length;e++)this.addChildObservable(this.elements[e]);return this.setDirty(),this.length}replace(e){for(const e of this.elements)this.removeChildObservables(e);return this.elements=[],this.concat(e)}remove(e){if(e<0||e>=this.length)throw new Error(`Index ${e} not in range of ObservableArray`);const[t]=this.elements.splice(e,1);this.removeChildObservables(t),this.setDirty()}clear(){for(;this.length;)this.remove(0)}update(e,t){const s=this.elements[e];s!==t&&(this.elements[e]=t,this.removeChildObservables(s),this.addChildObservable(t),this.setDirty())}get length(){return this.elements.length}set length(e){if(e<this.elements.length){for(let t=this.elements.length-1;t>=e;t--){const e=this.elements[t];this.removeChildObservables(e)}this.elements.length=e,this.setDirty()}}entries(){return this.elements.entries()}values(){return[...this.elements]}filter(e){return this.elements.filter(e)}find(e){return this.elements.find(e)}*[Symbol.iterator](){for(const e of this.elements)yield e}map(e,t){return this.elements.map(e,t)}forEach(e,t){this.elements.forEach(e,t)}sort(e){this.elements.sort(e)}get(e){return this.elements[e]}findIndex(e,t){return this.elements.findIndex(e,t)}indexOf(e){return this.elements.indexOf(e)}splice(e,t,...s){let i;if(s.length){i=this.elements.splice(e,t,...s);for(const e of s)this.addChildObservable(e)}else i=this.elements.splice(e,t);for(const e of i)this.removeChildObservables(e);return this.setDirty(),i}insert(e,t){if(e>this.elements.length)throw new Error(`Tried to insert at index ${e} in an array that's only ${this.elements.length} long`);e!==this.elements.length?(this.elements.splice(e,0,t),this.addChildObservable(t),this.setDirty()):this.push(t)}shift(){const e=this.elements.shift();return e&&(this.removeChildObservables(e),this.setDirty()),e}move(e,t){if(t>this.elements.length-1)throw Error("Index to move to is out of bounds");const s=this.elements[e];this.elements.splice(e,1),this.elements.splice(t,0,s),this.setDirty()}includes(e,t){return this.elements.includes(e,t)}some(e,t){return this.elements.some(e,t)}every(e,t){return this.elements.every(e,t)}onElementChanged(e){let t=this.elements.slice();return this.onChanged((()=>{for(const s in t){const i=parseInt(s,10);e.onRemoved&&void 0===this.get(i)&&e.onRemoved(t[i],i)}for(const s in this.elements){const i=parseInt(s,10),n=this.get(i);void 0===t[i]?e.onAdded&&e.onAdded(n,i):(Es.isObservable(n)&&n._dirtyObservable||n!==t[i])&&(e.onUpdated?e.onUpdated(n,i):e.onRemoved&&null===n&&e.onRemoved(t[i],i))}t=this.elements.slice()}))}deepCopy(){return this.map((e=>St(e)))}}class Ls extends zs{constructor(){super(...arguments),this.name="sdk",this.applicationKeys=new Us}}var js,Fs,Vs,Hs,Bs;!function(e){e.CONNECTION="sdk.connection",e.DISCONNECT="sdk.disconnect",e.MESSAGED="sdk.messaged",e.SUBSCRIBED="sdk.subscribed",e.UNSUBSCRIBED="sdk.unsubscribed",e.OBSERVABLE_SUB="sdk.obs.subscribe",e.OBSERVABLE_UNSUB="sdk.obs.unsubscribe",e.COLLECTION_SUB="sdk.coll.subscribe",e.COLLECTION_UNSUB="sdk.coll.unsubscribe"}(js||(js={}));class Ws{constructor(e){this.analytics=e,this.trackedEvents=new a}track(e,t,s){this.trackedEvents.has(e,t)||(this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({},s)))}alwaysTrack(e,t,s){this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({},s))}setOptions(e){this.analytics.setOptions(e)}}class Ks{constructor(e){this.analytics=e,this.messageType="client call"}onMessage(e,t){const{namespace:s,name:i}=e,n={applicationKey:t.applicationKey,namespace:s,name:i,method:t.communicationMethod,provider:t.context.provider,sdkType:t.context.sdkType};this.analytics.track("sdk_call",s+i,n)}}class qs{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}class Gs{constructor(e,t){this.sourceId=e,this.listenerBridge=t,this.observers=new a}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e,t){this.messenger.onMessageReceived(e,t)}}(this),t=new o(e);this.listenerBridge.listen(t)}dispose(){this.listenerBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e,t,s,i){s.send(Object.assign(Object.assign({},e),{fromId:this.sourceId,toId:t,timestamp:Date.now()}),i)}onMessageReceived(e,t){const s=e.type,i=this.observers.getValuesAtKey(s);if(i)for(const s of i){const i=e.payload||e;s.notify(i,t,e.timestamp)}}}class Xs{constructor(e){this.targetWindow=e,this.messageObserver=null,this.onMessage=e=>{if(this.messageObserver){const t=e.data;this.messageObserver.notify(Object.assign({},t),{id:t.fromId,origin:e.origin,source:e.source},e.data.timestamp)}}}listen(e){this.messageObserver||(this.messageObserver=e,this.targetWindow.addEventListener("message",this.onMessage))}stopListening(){this.targetWindow.removeEventListener("message",this.onMessage),this.messageObserver=null}}class $s{constructor(e,t="*"){this.targetWindow=e,this.targetOrigin=t}send(e,t){this.targetWindow.postMessage(e,this.targetOrigin)}}class Ys{constructor(e,t,s="*"){this.sourceWindow=e,this.listener=new Xs(e),this.sender=new $s(t,s)}listen(e){this.listener.listen(e)}stopListening(){this.listener.stopListening()}send(e){this.sender.send(e,this.sourceWindow)}}class Zs{constructor(e,t,s,i,n="*"){this.sourceId=e,this.sourceWindow=t,this.targetId=s,this.targetWindow=i,this.targetOrigin=n}createMessenger(){const e=new Ys(this.sourceWindow,this.targetWindow,this.targetOrigin);return new l(this.sourceId,this.targetId,e)}}!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(Fs||(Fs={})),function(e){e.CONNECT="postmessage.connect"}(Vs||(Vs={})),function(e){e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject"}(Hs||(Hs={}));class Js{constructor(e){this.receiver=e,this.messageType=Vs.CONNECT}notify(e,t){this.receiver.onConnectionReceived(e,t)}}class Qs{constructor(e,t,s,i,n){this.type=Hs.ACCEPT,this.payload={scriptUrl:e,interface:t,sourceId:s,targetId:i,targetOrigin:n},this.interface=t}}class ei{constructor(){this.type=Hs.HANDSHAKE,this.payload={}}}class ti{constructor(e){this.type=Hs.REJECT,this.payload={reason:e.message,errorType:e.type},this.reason=e.message}}class si{constructor(e,t,s,i,n){this.hostWindow=e,this.hostId=t,this.applicationKey=s,this.idGenerator=i,this.connectionReceiver=n,this.inFlightClients=new Set,this.connectionHandler=new Gs(t,new Xs(window)),this.connectionHandler.addObserver(new Js({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){var s,i;if(this.inFlightClients.has(t.id))return;e=e||{},this.inFlightClients.add(t.id);const n=e&&e.bootstrapVersion?this.idGenerator.generate():t.id,r=this.hostId,o=t.source,a=this.hostWindow,c=new Zs(r,a,n,o).createMessenger();this.connectionReceiver.onConnectionReceived(t.origin,e.options,{applicationKey:e.applicationKey||this.applicationKey,id:n,messenger:c,communicationMethod:Fs.POSTMESSAGE,context:{provider:(null===(s=e.options)||void 0===s?void 0:s.provider)||"",sdkType:(null===(i=e.options)||void 0===i?void 0:i.sdkType)||"",bootstrap:{version:e.bootstrapVersion,providedAppKey:!!e.applicationKey}}},{accept(e,t){c.send(new Qs(e,t,n,r,window.location.origin))},handshake(){c.send(new ei)},reject(e){c.send(new ti(e)),c.dispose()}})}}class ii{constructor(e){this.origin=e,this.observers=new Set}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}post(e,t){for(const s of this.observers)s.notify(e,t)}}class ni{constructor(e){this.targetNode=e,this.messageObserver=null,this.onMessage=(e,t)=>{this.messageObserver&&this.messageObserver.notify({payload:Object.assign({},e.payload),type:e.type},{id:e.fromId,source:t},e.timestamp)}}listen(e){this.messageObserver||(this.messageObserver=e,this.targetNode.addObserver({notify:(e,t)=>{this.onMessage(e,t)}}))}stopListening(){this.messageObserver=null}}class ri{constructor(e,t){this.source=e,this.target=t,this.messageObserver=null}listen(e){this.messageObserver||(this.messageObserver=e,this.source.addObserver(e))}stopListening(){this.messageObserver&&this.source.removeObserver(this.messageObserver)}send(e){const t=this.target;t&&t.post(Object.assign({},e),this.source)}}class oi{constructor(e,t,s,i){this.sourceId=e,this.sourceNode=t,this.targetId=s,this.targetNode=i}createMessenger(){const e=new ri(this.sourceNode,this.targetNode);return new l(this.sourceId,this.targetId,e)}}class ai{constructor(e,t={}){this.type=Vs.CONNECT,this.payload={bootstrapVersion:e,options:{auth:t.auth,provider:t.provider,sdkType:t.sdkType},applicationKey:t.applicationKey}}}class ci{constructor(e){this.receiver=e,this.messageType=Hs.ACCEPT}notify(e,t,s){const{sourceId:i,scriptUrl:n,targetId:r,targetOrigin:o}=e,a=e.interface;this.receiver.accept(i,n,a,r,o)}}!function(e){e.CANCELLED="ConnectionCancelled",e.REFUSED="ConnectionRefused",e.INVALID_PROVIDER="InvalidProvider",e.KEY_MISMATCH="KeyReferrerMismatch"}(Bs||(Bs={}));class hi extends Error{constructor(){super(),this.type=Bs.REFUSED,this.name="ConnectionRefusedError"}}class li extends Error{constructor(e){super(e),this.type=Bs.INVALID_PROVIDER,this.name="InvalidProviderError"}}class ui extends Error{constructor(e){super(e),this.type=Bs.KEY_MISMATCH,this.name="KeyReferrerMismatchError"}}const di={[Bs.REFUSED]:hi,[Bs.KEY_MISMATCH]:ui,[Bs.INVALID_PROVIDER]:li};class pi{constructor(e){this.receiver=e,this.messageType=Hs.REJECT}notify(e,t,s){const i=di[e.errorType];if(i){const t=new i(e.reason);this.receiver.reject(t)}}}var fi;!function(e){e.CONNECT_PLUGIN="connect.plugin"}(fi||(fi={}));class mi{constructor(e,t,s,i){this.type=fi.CONNECT_PLUGIN,this.payload={bootstrapVersion:e,applicationKey:s,pluginId:i,options:{auth:t.auth,provider:t.provider,sdkType:t.sdkType}}}}class yi{constructor(e){this.receiver=e,this.messageType=fi.CONNECT_PLUGIN}notify(e,t){this.receiver.onConnectionReceived(e,t)}}function gi(e){return Et(e)&&void 0!==e.pluginId}class bi{constructor(e,t,s){this.idGenerator=t,this.connectionReceiver=s,this.host={id:e,node:new ii(window.location.origin)},this.connectionHandler=new Gs(e,new ni(this.host.node)),this.connectionHandler.addObserver(new yi({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){xi(e,this.host,{info:t,applicationKey:e.applicationKey},this.connectionReceiver,{pluginId:e.pluginId})}connect(e){const t={id:this.idGenerator.generate(),node:new ii(origin)};return wi(this.host,t,(t=>t.send(new mi("plugin",{sdkType:_i.Type.PLUGIN},e.applicationKey,e.pluginId))))}}class vi{constructor(e,t,s,i){this.applicationKey=t,this.idGenerator=s,this.connectionReceiver=i,this.host={id:e,node:new ii(window.location.origin)},this.connectionHandler=new Gs(e,new ni(this.host.node)),this.connectionHandler.addObserver(new Js({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){xi(e,this.host,{info:t,applicationKey:this.applicationKey},this.connectionReceiver)}connect(e,t={}){const s={id:this.idGenerator.generate(),node:new ii(e)};return wi(this.host,s,(e=>e.send(new ai("direct",t))))}}function wi(e,t,s){const{id:i,node:n}=e,{id:r,node:o}=t,a=new oi(r,o,i,n);return new Promise(((e,t)=>{const c=new oi(r,o,i,n).createMessenger();c.init();const h=new class{accept(t,s,i,n){e({targetOrigin:origin,sourceId:t,targetId:n,scriptUrl:s,serializedInterface:i,messengerFactory:a}),c.dispose()}reject(e){t(e),c.dispose()}};c.addObserver(new ci(h)),c.addObserver(new pi(h)),s(c)}))}function xi(e,t,s,i,n){var r,o;const{id:a,node:c}=t,{id:h,source:l,source:{origin:u}}=s.info,d=new oi(a,c,h,l).createMessenger();i.onConnectionReceived(u,e.options,{id:h,applicationKey:s.applicationKey,messenger:d,communicationMethod:Fs.DIRECT,context:{provider:(null===(r=e.options)||void 0===r?void 0:r.provider)||"",sdkType:(null===(o=e.options)||void 0===o?void 0:o.sdkType)||"",pluginId:gi(n)?n.pluginId:void 0,bootstrap:{version:gi(n)?"plugin":"direct",providedAppKey:!!e.applicationKey}}},{accept(e,t){d.send(new Qs(e,t,h,a,u))},handshake(){d.send(new ei)},reject(e){d.send(new ti(e)),d.dispose()}})}class Oi{constructor(){this.dirty=!1}dispose(){}}const Ci=new r("FactAnalytics");class Mi{constructor(e){this.proxy=e}track(e,t,s){const i={};let n=0,r=0,o=0;if(null==s?void 0:s.records)for(const e in s.records){const t=s.records[e];let a="",c=!1;if("number"==typeof t){const e=t.toString();Number.isInteger(t)&&!e.includes(".")?n<3&&(a="integer"+n++,c=!0):r<3&&(a="float"+r++,c=!0)}else"string"==typeof t&&o<3&&(a="string"+o++,c=!0);c?i[a]={name:e,value:t}:Ci.info(`Omitting key: ${a} value: ${t} from fact`)}const a={applicationKey:e.client.applicationKey,pluginId:e.client.pluginId,fact:Object.assign({name:t,version:(null==s?void 0:s.version)||1},i)};(null==s?void 0:s.alwaysTrack)?this.proxy.alwaysTrack("sdk_fact",t,a):this.proxy.track("sdk_fact",t,a)}}const Ei=new r("sdk");class Ti extends Tt{constructor(){super(...arguments),this.name="sdk",this.hostId=Math.floor(1e6*Math.random()),this.connectionHandlers=[],this.clientInterface=St(Object.assign({},Ti.emptyInterface)),this.perOriginInterfaces=new c((()=>St(Object.assign({},Ti.emptyInterface)))),this.perSdkTypeInterfaces=new c((()=>St(Object.assign({},Ti.emptyInterface)))),this.pendingClients=new _s,this.clientConnections=new Map,this.eventToClientSubMap=new a,this.clientToEventSubMap=new a,this.observableToClientSubMap=new a,this.clientToObservableSubMap=new Map,this.collectionToClientSubMap=new a,this.clientToCollectionSubMap=new Map,this.privateMessageHandlers=new a,this.valueToClientInterface={},this.commandCreators={},this.commands={},this.asyncCommands={},this.observables={},this.collections={},this.commandExecutionOrder=0,this.firstTimeCollectionSubs=new a,this.sdkTypeByBuild=_i.Type.EMBED}async init(e,t){this.config=e,this.validationUrl=e.validationUrl,this.facade=new Ti.MessengerHostFacade(this),this.clientIdGenerator=new qs,this.postmessageConnectHandler=new si(window,this.hostId,e.applicationKey,this.clientIdGenerator,this.facade),this.directConnectHandler=new vi(this.hostId,e.applicationKey,this.clientIdGenerator,this.facade),this.pluginConnectHandler=new bi(this.hostId,this.clientIdGenerator,this.facade),this.connectionHandlers.push(this.postmessageConnectHandler,this.directConnectHandler,this.pluginConnectHandler),this.sdkTypeByBuild=_i.Type.EMBED,this.analytics=new Ws(await t.getModuleBySymbol("IAnalytics")),this.factAnalytics=new Mi(this.analytics),this.clientFilter=e.clientFilter||(()=>!0),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),this.getSdkConfig=e.getSdkConfig,this.requestQueue=e.queue,this.data=new Ls,t.market.register(Ls,this.data),this.addPrivateMessageHandler(new Ks(this.analytics)),this.enableHandshaking()}dispose(){for(const e of this.connectionHandlers)e.dispose();this.clearInterface()}connect(e,t){try{new URL(e)}catch(e){return Promise.reject(e)}return this.directConnectHandler.connect(e,t)}connectPlugin(e,t){return this.pluginConnectHandler.connect({applicationKey:e,pluginId:t})}getClientAuth(e){const t=this.pendingClients.get(e);return t?Promise.resolve(t):new Promise((t=>{const s=this.pendingClients.onElementChanged({onAdded(i,n){n===e&&(t(i),s.cancel())}})}))}enableHandshaking(){for(const e of this.connectionHandlers)e.init()}async setupInterface(){return this.interfaceLoading||(this.interfaceLoading=this.config.setupExternalSdk(this)),this.interfaceLoading}clearInterface(){this.clientInterface.functions={},this.clientInterface.commands={},this.clientInterface.enums={},this.clientInterface.observables={},this.clientInterface.collections={},this.commandCreators={}}onUpdate(){for(const[e,t]of this.clientToObservableSubMap)for(const[s,[i,n]]of t)if(i.dirty){try{this.notifyObservableUpdate(s,n.getData(),e)}catch(t){Ei.error(`Error notifying client ${e} of observable ${s} update:`,t)}i.dirty=!1}for(const[e,t]of this.clientToCollectionSubMap)for(const[s,[,i]]of t)if(i.dirty)try{this.notifyCollectionUpdates(s,i.readDiff(),e)}catch(t){Ei.error(`Error notifying client ${e} of collection ${s} update:`,t)}}addCommandCreator(e,t){const s=Ri(e);if(this.clientInterface.functions.hasOwnProperty(s)&&Ei.debugInfo(`Overwriting ${s} function in sdk interface`),e.sdkTypes)for(const t of e.sdkTypes){const i=this.perSdkTypeInterfaces.get(t);i.functions[s]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,i)}if(e.origins)for(const t of e.origins){const i=this.perOriginInterfaces.get(t);i.functions[s]=Object.assign({},e),this.perOriginInterfaces.set(t,i)}this.clientInterface.functions[s]=e,this.commandCreators[s]=t}addEnumToInterface(e){const t=Ri(e);if(this.clientInterface.enums.hasOwnProperty(t)&&Ei.debugInfo(`Overwriting ${t} enum in sdk interface`),e.sdkTypes)for(const s of e.sdkTypes){const i=this.perSdkTypeInterfaces.get(s);i.enums[t]=Object.assign({},e),this.perSdkTypeInterfaces.set(s,i)}if(e.origins)for(const s of e.origins){const i=this.perOriginInterfaces.get(s);i.enums[t]=Object.assign({},e),this.perOriginInterfaces.set(s,i)}if(this.clientInterface.enums[t]=Object.assign(Object.assign({},e),{values:Object.assign({},e.values)}),"Event"===e.name){const t=Object.keys(e.values);for(const s in t){this.valueToClientInterface;const i=e.values[t[s]];this.valueToClientInterface.hasOwnProperty(i)?Ei.warn(`Duplicate event detected for ${JSON.stringify(e)}`):this.valueToClientInterface[i]=e}}}addCommandToInterface(e,t){this.addCommand(e,t)}addAsyncCommandToInterface(e,t){this.addCommand(e,t,{canQueue:!0})}addCommandUnlisted(e,t,s=!1){this.addCommand(e,t,{canQueue:s,unlisted:!0})}addCommand(e,t,s={canQueue:!1,unlisted:!1}){s.unlisted?this.registerUnlistedCommand(e):this.registerCommandInInterface(e);const i=Ri(e),n=s.canQueue?this.asyncCommands:this.commands;if(s.canQueue)return n[i]=t,{dispose(){delete n[i]}};const r=t.then((e=>n[i]=e));return{dispose(){r.then((()=>delete n[i]))}}}registerUnlistedCommand(e){const t=Ri(e);this.clientInterface.unlistedCmds.hasOwnProperty(t)&&Ei.debugInfo(`Overwriting ${t} unlisted command in sdk interface`),this.clientInterface.unlistedCmds[t]=Object.assign({},e)}registerCommandInInterface(e){const t=Ri(e);if(this.clientInterface.commands.hasOwnProperty(t)&&Ei.debugInfo(`Overwriting ${t} command in sdk interface`),e.sdkTypes)for(const s of e.sdkTypes){const i=this.perSdkTypeInterfaces.get(s);i.commands[t]=Object.assign({},e),this.perSdkTypeInterfaces.set(s,i)}if(e.origins)for(const s of e.origins){const i=this.perOriginInterfaces.get(s);i.commands[t]=Object.assign({},e),this.perOriginInterfaces.set(s,i)}this.clientInterface.commands[t]=e}addObservableToInterface(e,t){const s=Ri(e);if(this.addObservable(s,t),e.sdkTypes)for(const t of e.sdkTypes){const i=this.perSdkTypeInterfaces.get(t);i.observables[s]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,i)}if(e.origins)for(const t of e.origins){const i=this.perOriginInterfaces.get(t);i.observables[s]=Object.assign({},e),this.perOriginInterfaces.set(t,i)}this.clientInterface.observables[s]=Object.assign({},e)}addObservable(e,t){this.clientInterface.observables.hasOwnProperty(e)&&Ei.debugInfo(`Overwriting ${e} observable in sdk interface`),this.observables[e]=t;const s=this;return{dispose(){s.removeObservable(e)}}}removeObservable(e){var t;delete this.observables[e];for(const s of this.observableToClientSubMap.getValuesAtKey(e))null===(t=this.clientToObservableSubMap.get(s.id))||void 0===t||t.delete(e);this.observableToClientSubMap.removeKey(e)}addCollectionToInterface(e,t){const s=Ri(e);if(this.addCollection(s,t),e.sdkTypes)for(const t of e.sdkTypes){const i=this.perSdkTypeInterfaces.get(t);i.collections[s]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,i)}if(e.origins)for(const t of e.origins){const i=this.perOriginInterfaces.get(t);i.collections[s]=Object.assign({},e),this.perOriginInterfaces.set(t,i)}this.clientInterface.collections[s]=Object.assign({},e)}addCollection(e,t){this.clientInterface.collections.hasOwnProperty(e)&&Ei.debugInfo(`Overwriting ${e} collection in sdk interface`),this.collections[e]=t;const s=this;return{dispose(){s.removeCollection(e)}}}removeCollection(e){var t;delete this.collections[e];for(const s of this.collectionToClientSubMap.getValuesAtKey(e))null===(t=this.clientToCollectionSubMap.get(s.id))||void 0===t||t.delete(e);this.collectionToClientSubMap.removeKey(e)}addPrivateMessageHandler(e){const{privateMessageHandlers:t}=this;return t.add(e.messageType,e),{dispose(){t.remove(e.messageType,e)}}}sendPrivateMessage(e,t,s){for(const[,i]of this.clientConnections)void 0!==s&&i.executing.id!==s||i.messaging.messenger.send(new C(e,t))}broadcast(e,t,s){for(const[,i]of this.clientConnections)if(t){const n=t(s);i.messaging.messenger.send(new g(e,n||[]))}else i.messaging.messenger.send(new g(e,[]))}notifyObservableUpdate(e,t,s){for(const i of this.observableToClientSubMap.getValuesAtKey(e))i.id===s&&i.messenger.send(new b(e,t))}notifyCollectionUpdates(e,t,s){const{added:i,removed:n,updated:r}=t,o=i.size>0,a=n.size>0,c=r.size>0,h=this.clientConnections.get(s);if(h){const t=h.messaging,s=t.id;if(o)for(const[s,n]of i)t.messenger.send(new v(p.ITEM_ADDED,e,s,n));if(a)for(const[s]of n)t.messenger.send(new w(p.ITEM_REMOVED,e,s));if(c)for(const[s,i]of r)t.messenger.send(new x(p.ITEM_UPDATED,e,s,i));(o||a||c||this.firstTimeCollectionSubs.has(s,e))&&(t.messenger.send(new O(p.COLL_UPDATED,e)),this.firstTimeCollectionSubs.remove(s,e))}}verifyConnection(e,t){const s={cache:!1,headers:{"X-Matterport-Application-Key":t,"X-Matterport-Referrer":e},priority:bt.HIGH};return this.requestQueue.get(this.validationUrl,s)}async onConnectionReceived(e,t={},s,i){if(!this.clientFilter(e))return i.reject(new hi);t&&Ct(_i.Type,t.sdkType)?s.context.sdkType=t.sdkType:s.context.sdkType=this.sdkTypeByBuild;const n=new Ii(t.auth,t.provider);if(!gi(s.context))try{await this.verifyConnection(e,s.applicationKey),this.pendingClients.set(s.applicationKey,n)}catch(t){return n.reject(),i.reject(new ui(`${s.applicationKey}@${e} - Key/referrer mismatch`))}const r=()=>{const t=new URL(e).hostname,i=this.perOriginInterfaces.get(t.toLowerCase()),n=this.perSdkTypeInterfaces.get(s.communicationMethod),r={enums:{},functions:{},unlistedFcns:{},observables:{},collections:{}},o=function(e,t,s,i){const n=e[t].sdkTypes,r=e[t].origins;if(!n&&!r)return!0;const o=n&&r&&(null==s?void 0:s[t])&&(null==i?void 0:i[t]),a=n&&!r&&(null==s?void 0:s[t]),c=!n&&r&&(null==i?void 0:i[t]);return o||a||c};for(const e in this.clientInterface.enums)o(this.clientInterface.enums,e,null==n?void 0:n.enums,null==i?void 0:i.enums)&&(r.enums[e]=this.clientInterface.enums[e]);for(const e in this.clientInterface.observables)o(this.clientInterface.observables,e,null==n?void 0:n.observables,null==i?void 0:i.observables)&&(r.observables[e]=this.clientInterface.observables[e]);for(const e in this.clientInterface.collections)o(this.clientInterface.collections,e,null==n?void 0:n.collections,null==i?void 0:i.collections)&&(r.collections[e]=this.clientInterface.collections[e]);for(const e in this.clientInterface.functions)o(this.clientInterface.functions,e,null==n?void 0:n.functions,null==i?void 0:i.functions)&&(r.functions[e]=this.clientInterface.functions[e]);for(const e in this.clientInterface.commands)o(this.clientInterface.commands,e,null==n?void 0:n.commands,null==i?void 0:i.commands)&&(r.functions[e]=this.clientInterface.commands[e]);for(const e in this.clientInterface.unlistedCmds)r.unlistedFcns[e]=this.clientInterface.unlistedCmds[e];return r};i.handshake();try{if(!gi(s.context)){if(!await this.config.validateProvider(t.provider))throw n.reject(),new li}n.accept(),await this.setupInterface();const o=r();this.onConnectionAccepted(e,s,t);const a=new URL((await this.getSdkConfig).client);a.searchParams.append("applicationKey",s.applicationKey),i.accept(a.href,o),this.data.atomic((()=>{this.data.applicationKeys.push({key:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType}),this.data.commit()}))}catch(e){i.reject(e)}}onConnectionAccepted(e,t,s){const i=t.id,n=t.messenger,r={messaging:Object.assign(Object.assign({},t),{origin:e}),executing:{get id(){return t.context.pluginId||String(i)},applicationKey:t.applicationKey,pluginId:t.context.pluginId}};this.clientConnections.set(i,r);const o=this.facade;n.addObserver(new M(o,r.messaging)),n.addObserver(new E(o,r.messaging)),n.addObserver(new T(o,r.messaging)),n.addObserver(new _(o,r.messaging)),n.addObserver(new S(o,r.messaging)),n.addObserver(new I(o,r.messaging)),n.addObserver(new R(o,r.messaging)),n.addObserver(new A(o,r.messaging)),n.init(),this.trackSdkConnect(r.messaging,s)}onDisconnectReceived(e,t){const s=t.messaging,i=this.clientToEventSubMap.getValuesAtKey(s.id),n=this.clientToObservableSubMap.get(s.id)||[],r=this.clientToCollectionSubMap.get(s.id)||[];for(const e of i)this.eventToClientSubMap.remove(e,s);for(const[e]of n)this.observableToClientSubMap.remove(e,s);for(const[e]of r)this.collectionToClientSubMap.remove(e,s);this.clientToEventSubMap.removeKey(s.id),this.clientToObservableSubMap.delete(s.id),this.clientToCollectionSubMap.delete(s.id);const o=this.data.applicationKeys.indexOf({key:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType});o>-1&&this.data.applicationKeys.splice(o,1)}onActionReceived(e,t){if(this.tryActionThroughCommand(e,t))return;const s=this.commandCreators[e.targetFunction];if(s){this.trackSdkCall(e,t.messaging.id);try{this.issueCommand(s(e.params,t.executing)).then((s=>t.messaging.messenger.send(new y(e.uid,s,!0,"")))).catch((s=>t.messaging.messenger.send(new y(e.uid,{},!1,s.message||s))))}catch(s){Ei.debug(s),t.messaging.messenger.send(new y(e.uid,{},!1,s.message))}}else t.messaging.messenger.send(new y(e.uid,{},!1,`${e.targetFunction} is not a valid command`))}tryActionThroughCommand(e,t){if(this.tryActionThroughAsyncCommand(e,t))return!0;const s=this.commands[e.targetFunction];if(!s)return!!this.clientInterface.commands.hasOwnProperty(e.targetFunction)&&(t.messaging.messenger.send(new y(e.uid,{},!1,`${e.targetFunction} is not ready to be called`)),!0);this.trackSdkCall(e,t.messaging.id);try{s.exec(e.params,Object.assign(Object.assign({},e.context),{client:t.executing,key:e.targetFunction,executionId:this.commandExecutionOrder++})).then((s=>{t.messaging.messenger.send(new y(e.uid,s,!0,""))})).catch((s=>{t.messaging.messenger.send(new y(e.uid,{},!1,s.message||s))}))}catch(s){Ei.debug(s),t.messaging.messenger.send(new y(e.uid,{},!1,s.message))}return!0}tryActionThroughAsyncCommand(e,t){const s=this.asyncCommands[e.targetFunction];return!!s&&(s.then((s=>{this.trackSdkCall(e,t.messaging.id);try{s.exec(e.params,Object.assign(Object.assign({},e.context),{client:t.executing,key:e.targetFunction,executionId:this.commandExecutionOrder++})).then((s=>{t.messaging.messenger.send(new y(e.uid,s,!0,""))})).catch((s=>{t.messaging.messenger.send(new y(e.uid,{},!1,s.message||s))}))}catch(s){Ei.debug(s),t.messaging.messenger.send(new y(e.uid,{},!1,s.message))}})),!0)}onEventSubReceived(e,t){const s=t.messaging;this.eventToClientSubMap.add(e.subscription,s),this.trackSdkEvent(js.SUBSCRIBED,e,s)}onEventUnsubReceived(e,t){const s=t.messaging;this.eventToClientSubMap.remove(e.subscription,s),this.trackSdkEvent(js.UNSUBSCRIBED,e,s)}async onObservableSubReceived(e,t){const s=t.messaging,i=e.observableKey,n=this.observables[i];if(n){const t=await n;if(!this.observables[i])return;if(!this.observableToClientSubMap.has(i,s)){const n=new Oi,r=t.subscribe(n);this.observableToClientSubMap.add(i,s);const o=this.clientToObservableSubMap.get(s.id)||new Map;o.set(i,[n,t,r]),this.clientToObservableSubMap.set(s.id,o),this.trackClientObservableSub(js.OBSERVABLE_SUB,e,s)}}else Ei.error(i,"is not a valid, registered observable")}onObservableUnsubReceived(e,t){const s=t.messaging,i=e.observableKey;this.observableToClientSubMap.remove(i,s);const n=this.clientToObservableSubMap.get(s.id);if(n){const t=n.get(i);if(t){const[,,r]=t;r.cancel(),n.delete(i),this.trackClientObservableSub(js.OBSERVABLE_UNSUB,e,s)}}}async onCollectionSubReceived(e,t){const s=t.messaging,i=e.collectionKey,n=this.collections[i];if(n){const t=await n;if(!this.collections[i])return;if(!this.collectionToClientSubMap.has(i,s)){const n=t.subscribe(s),r=[t,n];this.collectionToClientSubMap.add(i,s);const o=this.clientToCollectionSubMap.get(s.id)||new Map;o.set(i,r),this.clientToCollectionSubMap.set(s.id,o),this.firstTimeCollectionSubs.add(s.id,i),this.trackClientCollectionSub(js.COLLECTION_SUB,e,s)}}else Ei.error(i,"is not a valid, registered collection")}onCollectionUnsubReceived(e,t){const s=t.messaging,i=e.collectionKey;this.collectionToClientSubMap.remove(i,s);const n=this.clientToCollectionSubMap.get(s.id);if(n){const t=n.get(i);if(t){const[,r]=t;r.cancel(),n.delete(i),this.trackClientCollectionSub(js.COLLECTION_UNSUB,e,s)}}}onPrivateMessageReceived(e,t){const{messageType:s,messagePayload:i}=e;for(const e of this.privateMessageHandlers.getValuesAtKey(s))(e.clientId||e.clientId===t.executing.id)&&e.onMessage(i,t.messaging)}trackSdkConnect(e,t){if(!this.analytics)return;const s="string"==typeof(null==t?void 0:t.auth),i={origin:e.origin,applicationKey:e.applicationKey,provider:e.context.provider,method:e.communicationMethod,sdkType:e.context.sdkType,pluginId:e.context.pluginId,authTokenProvided:s,bootstrapVersion:e.context.bootstrap.version,bootstrapProvidedAppKey:e.context.bootstrap.providedAppKey};this.analytics.setOptions({authTokenProvided:s}),this.analytics.alwaysTrack("sdk_connect","connect",i)}trackSdkEvent(e,t,s){if(!this.analytics)return;const i=e===js.SUBSCRIBED?"on":"off",n=this.valueToClientInterface[t.subscription];if(!n)return;const r=Object.keys(n.values),o=r.find(((e,s)=>{const i=r[s];return n.values[i]===t.subscription}));if(!o)return;const a={origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType,name:i,namespace:n.namespace,eventType:o,count:this.eventToClientSubMap.valuesPerKey(t.subscription),method:s.communicationMethod,pluginId:s.context.pluginId};this.analytics.track("sdk_event",t.subscription,a)}trackSdkCall(e,t){const s=this.clientConnections.get(t);if(!s)return;const i=this.clientInterface.functions[e.targetFunction]||this.clientInterface.commands[e.targetFunction],n=s.messaging,r=Object.assign(Object.assign({origin:n.origin,applicationKey:n.applicationKey,provider:n.context.provider,sdkType:n.context.sdkType},i),{method:n.communicationMethod,pluginId:n.context.pluginId});if(this.analytics.track("sdk_call",e.targetFunction,r),i&&"Settings"===i.namespace&&"update"===i.name){const{key:t,value:s}=e.params;Mt(t)&&this.analytics.track("sdk_settings",t,{origin:n.origin,applicationKey:n.applicationKey,provider:n.context.provider,sdkType:n.context.sdkType,pluginId:n.context.pluginId,settingKey:t,settingValue:Et(s)?{}.toString():Mt(s)?s:JSON.stringify(s)})}}trackClientObservableSub(e,t,s){const i=e===js.OBSERVABLE_SUB,n=this.clientInterface.observables[t.observableKey],r=Object.assign(Object.assign({origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType},n),{is_collection:!1,action:i?"subscribe":"cancel",method:s.communicationMethod,pluginId:s.context.pluginId});this.analytics.track("sdk_subscribe",t.observableKey,r)}trackClientCollectionSub(e,t,s){const i=e===js.COLLECTION_SUB,n=this.clientInterface.collections[t.collectionKey],r=Object.assign(Object.assign({origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType},n),{is_collection:!0,action:i?"subscribe":"cancel",method:s.communicationMethod,pluginId:s.context.pluginId});this.analytics.track("sdk_subscribe",t.collectionKey,r)}track(e,t,s){e.client.pluginId&&this.factAnalytics.track(e,t,s)}}var _i,Si;Ti.emptyInterface={functions:{},commands:{},unlistedCmds:{},enums:{},observables:{},collections:{}},Ti.MessengerHostFacade=class{constructor(e){this.messageHandler=e}onConnectionReceived(e,t,s,i){this.messageHandler.onConnectionReceived(e,t,s,i)}onDisconnectReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onDisconnectReceived(e,s)}onActionReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onActionReceived(e,s)}onEventSubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onEventSubReceived(e,s)}onEventUnsubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onEventUnsubReceived(e,s)}onObservableSubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onObservableSubReceived(e,s)}onObservableUnsubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onObservableUnsubReceived(e,s)}onCollectionSubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onCollectionSubReceived(e,s)}onCollectionUnsubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onCollectionUnsubReceived(e,s)}onPrivateMessageReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onPrivateMessageReceived(e,s)}},function(e){let t;e.name="sdk",function(e){e.EMBED="sdk.embed",e.BUNDLE="sdk.bundle",e.PLUGIN="sdk.plugin",e.NPM_SDK="npm.embed",e.NPM_WEB_COMPONENT="npm.webcomponent",e.NPM_R3F="npm.r3f"}(t=e.Type||(e.Type={}))}(_i||(_i={}));class Ii{constructor(e,t){this.token=e,this.provider=t,this.isAccepted=new Is(null)}get accepted(){if(null!==this.isAccepted.value){if(this.isAccepted.value)return Promise.resolve();if(!this.isAccepted.value)return Promise.reject()}return new Promise(((e,t)=>{if(null===this.isAccepted.value){const s=this.isAccepted.onChanged((i=>{i?e():t(),s.cancel()}))}}))}accept(){this.isAccepted.value=!0}reject(){this.isAccepted.value=!1}}function Ri(e){let t=`${e.name}`;return e.namespace&&(t=`${e.namespace}.${t}`),t}class Ai{constructor(e){this.observers=new Set,this.refreshListeners=new Set,this.errorListeners=new Set,this.updateTokenCall=e.functionRegister.lookup(Ri(gt));const t=this;this.TokenRefresher=class{constructor(e,s){t.scheduleRefresh(e,s)}dispose(){clearTimeout(t.refreshTimeout)}on(e,s){if("string"==typeof e){if(!s||"function"!=typeof s)throw Error("The callback provided was not a valid function");if("refresh"===e)return t.addRefreshListener(s);if("error"===e)return t.addErrorListener(s)}else if(!("onRefresh"in e)&&!("onError"in e))throw Error("The observer provided was not a valid IRefreshObserver");return t.addObserver(e)}}}create(e,t){return new this.TokenRefresher(e,t)}addRefreshListener(e){return this.refreshListeners.add(e),{cancel(){this.refreshListeners.delete(e)}}}addErrorListener(e){return this.errorListeners.add(e),{cancel(){this.errorListeners.delete(e)}}}addObserver(e){return this.observers.add(e),{cancel(){this.observers.delete(e)}}}scheduleRefresh(e,t){this.refreshTimeout=setTimeout((async()=>{let s;try{if(s=await t.fetch(e.access_token),!s)throw Error('The "tokenFetcher" did not fetch anything');if("string"!=typeof s.access_token)throw Error('The "tokenFetcher" fetched an object that did not have a valid "access_token" property.');if("number"!=typeof s.expires_in)throw Error('The "tokenFetcher" fetched an object that did not have a valid "expires_in" property')}catch(e){return void this.notifyError(e)}this.updateTokenCall(s.access_token),this.notifyRefresh(),this.scheduleRefresh(s,t)}),1e3*(e.expires_in-60))}notifyRefresh(){for(const e of this.refreshListeners)e();for(const e of this.observers)e.onRefresh&&e.onRefresh()}notifyError(e){for(const t of this.errorListeners)t(e);for(const t of this.observers)t.onError&&t.onError(e)}}class ki{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}class Ni{constructor(e){this.comparator=e,this.nodes=[]}push(e){return this.nodes.push(e),this.siftdown(0,this.nodes.length-1)}pop(){let e,t;return this.nodes.length&&(e=this.nodes.pop(),e)?(this.nodes.length?(t=this.nodes[0],this.nodes[0]=e,this.siftup(0)):t=e,t):null}peek(){return this.nodes[0]}contains(e){return-1!==this.nodes.indexOf(e)}replace(e){if(this.nodes.length){const t=this.nodes[0];return this.nodes[0]=e,this.siftup(0),t}return null}_pushpop(e,t,s){let i;const n=s||this.defaultCompare;return e.length&&n(e[0],t)<0&&(i=[e[0],t],t=i[0],e[0]=i[1],this._siftup(e,0,n)),t}pushpop(e){return this._pushpop(this.nodes,e,this.comparator)}_heapify(e,t){let s,i,n,r,o,a;const c=Math.floor(e.length/2),h=function(){for(a=[],n=0,o=c;0<=o?n<o:n>o;0<=o?n++:n--)a.push(n);return a}.apply(this).reverse(),l=[];for(i=0,r=h.length;i<r;i++)s=h[i],l.push(this._siftup(e,s,t));return l}heapify(){let e,t,s,i,n,r;const o=Math.floor(this.nodes.length/2),a=function(){for(r=[],s=0,n=o;0<=n?s<n:s>n;0<=n?s++:s--)r.push(s);return r}.apply(this).reverse(),c=[];for(t=0,i=a.length;t<i;t++)e=a[t],c.push(this.siftup(e));return c}updateItem(e){const t=this.nodes.indexOf(e);return-1===t?null:(this.siftdown(0,t),this.siftup(t))}clear(){return this.nodes=[]}empty(){return 0===this.nodes.length}size(){return this.nodes.length}clone(){const e=new Ni(this.comparator);return e.nodes=this.nodes.slice(0),e}toArray(){return this.nodes.slice(0)}insert(e){return this.push(e)}top(){return this.peek()}front(){return this.peek()}has(e){return this.contains(e)}copy(){return this.clone()}nlargest(e){let t,s,i;const n=this.nodes.slice(0,e);if(!n.length)return n;this._heapify(n,this.comparator);const r=this.nodes.slice(e);for(s=0,i=r.length;s<i;s++)t=r[s],this._pushpop(n,t,this.comparator);return n.sort(this.comparator).reverse()}defaultCompare(e,t){return e<t?-1:e>t?1:0}_siftdown(e,t,s,i){let n,r;const o=i||this.defaultCompare,a=e[s];for(;s>t&&(r=s-1>>1,n=e[r],o(a,n)<0);)e[s]=n,s=r;return e[s]=a}siftdown(e,t){return this._siftdown(this.nodes,e,t,this.comparator)}_siftup(e,t,s){let i,n;const r=s||this.defaultCompare,o=e.length,a=t,c=e[t];for(i=2*t+1;i<o;)n=i+1,n<o&&!(r(e[i],e[n])<0)&&(i=n),e[t]=e[i],i=2*(t=i)+1;return e[t]=c,this._siftdown(e,a,t,r)}siftup(e){return this._siftup(this.nodes,e,this.comparator)}}function Di(e){if(void 0!==e.parent){const t=Di(e.parent);return t.push(e.data),t}return[e.data]}function Pi(e,t){if(e.f&&t.f)return e.f-t.f;throw new Error('heapComparator() -> Property "f" is undefined.')}!function(e){e[e.Success=0]="Success",e[e.NoPath=1]="NoPath",e[e.Timeout=2]="Timeout"}(Si||(Si={}));const zi="Graph.A*",Ui={[Si.Success]:$e.AStarStatus.SUCCESS,[Si.NoPath]:$e.AStarStatus.NO_PATH,[Si.Timeout]:$e.AStarStatus.TIMEOUT};function Li(){return function(e,t,s,i){const n=(null==i?void 0:i.heuristic)||(()=>0);let r=!0,o=null;const a=new ki;const c=new class{exec(i){if(!r&&o)return o;if(e.vertex(t.id)!==t)return{cost:0,path:[],status:$e.AStarStatus.NO_START_VERTEX};if(e.vertex(s.id)!==s)return{cost:0,path:[],status:$e.AStarStatus.NO_END_VERTEX};if(i=parseFloat(i+"")||5e3,isNaN(i)||i<0)throw Error("the `options.timeout` provided was invalid");const{status:a,cost:c,path:h}=function(e){void 0===e.timeout&&(e.timeout=1/0);const t={data:e.start,g:0,heuristicValue:e.heuristic(e.start)};let s=t;t.f=t.heuristicValue;const i=new Set,n=new Ni(Pi),r=new Map;n.push(t),r.set(t.data,t);const o=Date.now();for(;n.size();){if(Date.now()-o>e.timeout)return{status:Si.Timeout,cost:s.g,path:Di(s)};const t=n.pop();if(!t)throw new Error("[astar.ts]: Node must exist in heap");if(r.delete(t.data),t&&e.isEnd(t.data))return{status:Si.Success,cost:t.g,path:Di(t)};i.add(t.data);const a=e.neighbors(t.data);for(const o of a){if(i.has(o))continue;const a=t.g+e.distance(t.data,o);let c=r.get(o),h=!1;if(void 0===c)c={data:o,g:0,heuristicValue:0,f:0},r.set(o,c);else{if(c.g<a)continue;h=!0}c.parent=t||void 0,c.g=a,c.heuristicValue=e.heuristic(o),c.f=a+c.heuristicValue,c.heuristicValue<s.heuristicValue&&(s=c),h?n.heapify():n.push(c)}}return{status:Si.NoPath,cost:s.g,path:Di(s)}}({start:t,isEnd:e=>e===s,distance(t,s){const i=e.edge(t,s);return i?i.weight:1/0},heuristic(t,s){const i=e.edge(t,s);return i?n(t,s,i):0},neighbors:e=>e.neighbors,timeout:i});return o={status:Ui[a],cost:c,path:Ui[a]===$e.AStarStatus.NO_PATH?[]:h},r=!1,o}subscribe(e){const t=this,s={notify(){"function"==typeof e?e(t):e.onChanged(t)}},i=a.observe(s);return{cancel(){i.cancel()}}}dispose(){for(const e of l)e.cancel()}},h={onChanged(){r=!0,a.notify()}},l=[e.onEdgesChanged(h),e.onVerticesChanged(h)];return c}}class ji extends Es{constructor(){super(...arguments),this.elements=new Set}add(e){return this.has(e)||(this.elements.add(e),this.addChildObservable(e),this.setDirty()),this}clear(){this.atomic((()=>{const e=[...this.elements];for(const t of e)this.delete(t)}))}delete(e){const t=this.elements.delete(e);return t&&(this.removeChildObservables(e),this.setDirty()),t}has(e){return this.elements.has(e)}forEach(e,t){this.elements.forEach(e,t)}get size(){return this.elements.size}*entries(){yield*this.elements.entries()}*keys(){yield*this.elements.keys()}*values(){yield*this.elements.values()}*[Symbol.iterator](){yield*this.elements}addValues(e){for(const t of e)this.add(t);return this}replace(e){this.clear();for(const t of e)this.add(t)}get[Symbol.toStringTag](){return"ObservableSet"}filter(e,t){const s=[...this.elements].filter(e,t);return new Set(s)}find(e,t){return[...this.elements].find((s=>e.call(t,s,this)))}map(e,t){const s=[...this.elements].map(e,t);return new Set(s)}deepCopy(){const e=new Set;for(const t of this)e.add(St(t));return e}onElementChanged(e){let t=new Set(this);return this.onChanged((()=>{for(const s of t)e.onRemoved&&!this.has(s)&&e.onRemoved(s,s);for(const s of this.elements)t.has(s)?Es.isObservable(s)&&s._dirtyObservable&&e.onUpdated&&e.onUpdated(s,s):e.onAdded&&e.onAdded(s,s);t=new Set(this)}))}}var Fi,Vi,Hi,Bi,Wi,Ki=function(e,t,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(e):i?i.value:t.get(e)},qi=function(e,t,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,s):n?n.value=s:t.set(e,s),s};class Gi{constructor(){var e,t,s,i,n,r,o,a,c,h;Fi.set(this,new ji),Vi.set(this,new Set),Hi.set(this,void 0),Bi.set(this,(t=class{constructor(t){e.set(this,void 0),qi(this,e,t,"f")}notify(t){qi(Ki(this,e,"f"),Hi,t,"f");for(const s of Ki(Ki(this,e,"f"),Fi,"f"))Ki(Ki(this,e,"f"),Vi,"f").has(s)||s.onChanged(t);for(const t of Ki(Ki(this,e,"f"),Vi,"f"))Ki(Ki(this,e,"f"),Fi,"f").delete(t);Ki(Ki(this,e,"f"),Vi,"f").clear()}},e=new WeakMap,t)),Wi.set(this,(h=class{constructor(e){s.add(this),i.set(this,void 0),qi(this,i,e,"f")}subscribe(e){return Ki(this,s,"m",n).call(this,e)}waitUntil(e){return Ki(this,s,"m",o).call(this,e)}},i=new WeakMap,s=new WeakSet,n=function(e){const t=Ki(this,s,"m",r).call(this,e);Ki(Ki(this,i,"f"),Fi,"f").add(t);const n=Ki(this,i,"f").data;return n&&Promise.resolve().then((()=>{t.onChanged(n)})),{cancel:()=>{Ki(Ki(this,i,"f"),Vi,"f").add(t),Promise.resolve().then((()=>{Ki(Ki(this,i,"f"),Fi,"f").delete(t),Ki(Ki(this,i,"f"),Vi,"f").delete(t)}))}}},r=function(e){var t,s;class i{constructor(e){t.set(this,void 0),qi(this,t,e,"f")}onChanged(e){Ki(this,t,"f").call(this,e)}}t=new WeakMap;class n{constructor(e){s.set(this,void 0),qi(this,s,e,"f")}onChanged(e){Ki(this,s,"f").onChanged(e)}}if(s=new WeakMap,"function"==typeof e)return new i(e);if(e.onChanged&&"function"==typeof e.onChanged)return new n(e);throw Error("The argument provided to subscribe was not a valid observer\nExpected a function or an object with an `onChanged` function")},o=function(e){if("function"==typeof e)return Ki(this,s,"m",a).call(this,e);if(e.hasOwnProperty("waitUntil")&&"function"==typeof e.waitUntil)return Ki(this,s,"m",c).call(this,e);throw Error("The argument provided to waitUntil was not a valid waiter\nExpected a function or an object with an `waitUntil` function")},a=function(e){class t{constructor(e){this.res=e}onChanged(t){e(t)&&this.res(t)}}return new Promise((e=>{const s=new t((t=>{e(t),Ki(Ki(this,i,"f"),Vi,"f").add(s)}));this.subscribe(s)}))},c=function(e){class t{constructor(e){this.res=e}onChanged(t){e.waitUntil(t)&&this.res(t)}}return new Promise((e=>{const s=new t((t=>{e(t),Ki(Ki(this,i,"f"),Vi,"f").add(s)}));this.subscribe(s)}))},h)),this.notifier=new(Ki(this,Bi,"f"))(this),this.subscriber=new(Ki(this,Wi,"f"))(this)}get observers(){return Ki(this,Fi,"f")}get data(){return Ki(this,Hi,"f")}subscribe(e){return this.subscriber.subscribe(e)}waitUntil(e){return this.subscriber.waitUntil(e)}notify(e){this.notifier.notify(e)}}Fi=new WeakMap,Vi=new WeakMap,Hi=new WeakMap,Bi=new WeakMap,Wi=new WeakMap;var Xi=function(e,t,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(e):i?i.value:t.get(e)};const $i="Graph.createDirect";function Yi(e){var t,s,i,n,r,o;return s=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,t=new WeakSet,o=function(e,t){Xi(this,s,"f").addVertex({id:e,data:t}),Xi(this,r,"f").add(e)},new class{constructor(){t.add(this),s.set(this,function(){const e=new Map,t=new Map,s=new Map,i=new ki,n=new ki;class r{constructor(e,t){this.id=e,this.data=t}get edgesIn(){const e=s.get(this);return e?e.values():[].values()}get edgesInCount(){var e,t;return null!==(t=null===(e=s.get(this))||void 0===e?void 0:e.size)&&void 0!==t?t:0}findEdgeIn(e,t){const i=s.get(this);if(i)for(const[,s]of i)if(e.call(t,s))return s}get edgesOut(){const e=t.get(this);return e?e.values():[].values()}get edgesOutCount(){var e,s;return null!==(s=null===(e=t.get(this))||void 0===e?void 0:e.size)&&void 0!==s?s:0}findEdgeOut(e,s){const i=t.get(this);if(i)for(const[,t]of i)if(e.call(s,t))return t}get neighbors(){const e=t.get(this)||[];return function*(){for(const[t]of e)yield t}()}}class o{constructor(e,t,s){this.src=e,this.dst=t,this.weight=s}}let a=!0,c=!0;return new class{addVertex(...t){for(const s of t)e.set(s.id,new r(s.id,s.data));a=!0}hasVertex(t){return e.has(t)}vertex(t){return e.get(t)}get vertices(){return e.values()}findVertex(t,s){for(const[,i]of e)if(t.call(s,i))return i}filterVertices(t,s){const i=[];for(const[,n]of e)t.call(s,n)&&i.push(n);return i}get vertexCount(){return e.size}removeVertex(...i){var n,r;for(const o of i){e.delete(o.id);const i=s.get(o);if(i)for(const[e]of i)null===(n=t.get(e))||void 0===n||n.delete(o),i.delete(e),c=!0;const a=t.get(o);if(a)for(const[e]of a)null===(r=s.get(e))||void 0===r||r.delete(o),a.delete(e),c=!0}a=!0}get edges(){return function*(){for(const[,e]of t)for(const[,t]of e)yield t}()}get edgeCount(){let e=0;for(const[,s]of t)e+=s.size;return e}setEdge(...i){for(let t=0;t<i.length;++t){const{src:s,dst:n}=i[t],r=i[t].weight||0;if(!e.has(s.id))throw Error(`At index ${t}: ${s.id} is not a vertex of this graph`);if(!e.has(n.id))throw Error(`At index ${t}: ${n.id} is not a vertex of this graph`);if(isNaN(parseFloat(r+""))||r<0)throw Error(`At index ${t}: invalid weight`)}function n(e,i,n=0){const r=new o(e,i,n),a=t.get(e)||new Map;t.set(e,a),a.set(i,r);const c=s.get(i)||new Map;s.set(i,c),c.set(e,r)}for(const{src:e,dst:t,weight:s}of i)n(e,t,s);c=!0}hasEdge(e,s){const i=t.get(e);return!!i&&i.has(s)}edge(e,s){const i=t.get(e);return null==i?void 0:i.get(s)}removeEdge(...e){for(const i of e){const e=t.get(i.src);null==e||e.delete(i.dst);const n=s.get(i.dst);null==n||n.delete(i.src)}c=!0}clear(){e.clear(),t.clear(),s.clear(),a=!1,c=!1}onVerticesChanged(e){return i.observe(e)}onEdgesChanged(e){return n.observe(e)}commit(){a&&(i.notify(),a=!1),c&&(n.notify(),c=!1)}}}()),i.set(this,new Gi),n.set(this,new Gi),r.set(this,new Set),Xi(this,s,"f").onEdgesChanged({notify:()=>Xi(this,n,"f").notify(this)}),Xi(this,s,"f").onVerticesChanged({notify:()=>Xi(this,i,"f").notify(this)})}watch(e){return e.collection.subscribe({onAdded:(s,i)=>{e.shouldAdd&&e.shouldAdd(i)&&Xi(this,t,"m",o).call(this,s,i)},onRemoved:e=>{const t=Xi(this,s,"f").vertex(e);t&&Xi(this,s,"f").removeVertex(t)},onUpdated:(i,n)=>{const r=Xi(this,s,"f").vertex(i);if(r||e.shouldAdd&&!e.shouldAdd(n)||Xi(this,t,"m",o).call(this,i,n),r){e.shouldAdd&&e.shouldAdd(n)||Xi(this,s,"f").removeVertex(r);for(const t of r.edgesIn)e.weightBetween(t.src,t.dst);for(const t of r.edgesOut)e.weightBetween(t.src,t.dst)}},onCollectionUpdated:()=>{for(const t of Xi(this,r,"f")){const i=Xi(this,s,"f").vertex(t);if(i){for(const t of Xi(this,s,"f").vertices)!Xi(this,r,"f").has(t.id)&&e.isNeighborOf(t,i)&&Xi(this,s,"f").setEdge({src:t,dst:i,weight:e.weightBetween(t,i)});for(const t of e.neighborsOf(i)){const n=Xi(this,s,"f").vertex(t);n&&Xi(this,s,"f").setEdge({src:i,dst:n,weight:e.weightBetween(i,n)})}}}Xi(this,r,"f").clear(),Xi(this,s,"f").commit()}})}addVertex(...e){Xi(this,s,"f").addVertex(...e)}hasVertex(e){return Xi(this,s,"f").hasVertex(e)}vertex(e){return Xi(this,s,"f").vertex(e)}removeVertex(...e){Xi(this,s,"f").removeVertex(...e)}get vertices(){return Xi(this,s,"f").vertices}get vertexCount(){return Xi(this,s,"f").vertexCount}findVertex(e,t){return Xi(this,s,"f").findVertex(e,t)}filterVertices(e,t){return Xi(this,s,"f").filterVertices(e,t)}setEdge(...e){Xi(this,s,"f").setEdge(...e)}hasEdge(e,t){return Xi(this,s,"f").hasEdge(e,t)}edge(e,t){return Xi(this,s,"f").edge(e,t)}removeEdge(...e){Xi(this,s,"f").removeEdge(...e)}get edges(){return Xi(this,s,"f").edges}get edgeCount(){return Xi(this,s,"f").edgeCount}dispose(){e&&e(),Xi(this,s,"f").clear()}clear(){Xi(this,s,"f").clear()}onVerticesChanged(e){return Xi(this,i,"f").subscribe(e)}onEdgesChanged(e){return Xi(this,n,"f").subscribe(e)}commit(){Xi(this,s,"f").commit()}}}const Zi="Sweep.graph";function Ji(e,t){e.addVertex(...t.vertices),e.setEdge(...[...t.edges].map((t=>({src:e.vertex(t.src.id),dst:e.vertex(t.dst.id),weight:t.weight}))))}const Qi="Graph.clone";function en(e){const t=Yi();return Ji(t,e),t}function tn(e){return nn(new Set(e.vertices))}function sn(e){const t=[],s=new Set(e.vertices);for(;;){const e=nn(new Set(s)),i=s.size;for(const t of e)s.delete(t);if(i===s.size)break;t.push(e)}return t}function nn(e){if(rn(e),0===e.size)return[];const t=new Set;let s=e.values().next().value;for(;!t.has(s);){t.add(s);const e=s.edgesOut.next().value;s=e.dst}return t}function rn(e){const t=[...e].filter((t=>!t.findEdgeIn((t=>e.has(t.src)))));if(0===t.length)return e;for(const s of t)e.delete(s);return rn(e)}const on="Graph.findCycle",an="Graph.findCycles";function cn(e){const t={namespace:"OAuth",name:"createTokenRefresher",value:()=>function(e){const t=new Ai(e);return(e,s)=>t.create(e,s)}(e)},s={namespace:"Graph",name:"createDirectedGraph",value:()=>Yi},i={namespace:"Graph",name:"createAStarRunner",value:()=>Li()},n={namespace:"Graph",name:"AStarStatus",value:()=>$e.AStarStatus},r={namespace:"Graph",name:"clone",value:()=>en},o={namespace:"Graph",name:"findCycle",value:()=>tn},a={namespace:"Graph",name:"findAllCycle",value:()=>sn},c={namespace:"Sweep",name:"createGraph",value:()=>function(e){const t=e.collectionRegister.lookup("Sweep.data");if(!t)throw Error("sweep.data was misconfigured");return function(){const e=Yi((()=>s.cancel())),s=e.watch({collection:t,isNeighborOf:(e,t)=>e.data.neighbors.includes(t.id),neighborsOf:e=>e.data.neighbors.values(),weightBetween(e,t){const s=t.data.position.x-e.data.position.x,i=t.data.position.y-e.data.position.y,n=t.data.position.z-e.data.position.z;return Math.sqrt(s**2+i**2+n**2)},shouldAdd:e=>e.enabled});let i;const n=new Promise((s=>{i=t.subscribe({onCollectionUpdated(){s(e)}})}));return n.then((()=>i.cancel())),n}}(e)},h={namespace:"Conversion",name:"basisChange",value:()=>ft},l={namespace:"Conversion.TransformType",name:"Coordinates",value:()=>Ge.TransformType.Coordinates},u={namespace:"Conversion.TransformType",name:"SweepRotation",value:()=>Ge.TransformType.SweepRotation},d={namespace:"Conversion.TransformType",name:"CameraRotation",value:()=>Ge.TransformType.CameraRotation};return{"Conversion.worldToScreen":{namespace:"Conversion",name:"worldToScreen",value:()=>{return e=new lt,function(t,s,i,n){return e.setCameraFromPose(s),e.worldToScreen(t,i,n)};var e}},"Mattertag.getDiscPosition":{namespace:"Mattertag",name:"getDiscPosition",value:()=>V},"OAuth.createTokenRefresher":t,[$i]:s,[zi]:i,"Graph.AStarStatus":n,[Qi]:r,[on]:o,[an]:a,[Zi]:c,"Conversion.basisChange":h,"Conversion.TransformType.Coordinates":l,"Conversion.TransformType.SweepRotation":u,"Conversion.TransformType.CameraRotation":d}}class hn{constructor(e){this.receiver=e,this.messageType=d.RESPONSE}notify(e){this.receiver.receiveResponse(e)}}class ln{constructor(e,t,s,i){this.type=f.ACTION,this.payload={uid:e,targetFunction:t,params:s,context:i}}}function un(e,t,s){const i={},n=void 0===s?e.length:s;for(let s=0;s<n;++s)i[e[s]]=t[s];return i}class dn{constructor(e){this.getMessenger=e,this.inFlightActions=new Map,this.responseResolvers={},this.functions=new Map,this.currentMsgId=0,this.registeredRoutines=new Map,this.routines=new Map;const t=new class{constructor(e){this.functions=e}receiveResponse(e){this.functions.receiveResponse(e)}}(this);this.responseObserver=new hn(t),this.getMessenger().addObserver(this.responseObserver)}async dispose(){await Promise.allSettled(this.inFlightActions.values()),this.getMessenger().removeObserver(this.responseObserver)}register(e,t){if(t.subRoutine&&!this.registeredRoutines.get(t.subRoutine))throw new Error(`${t.subRoutine} sub-routine was not provided for ${t}`);const s=(...s)=>this.dispatchAction(e,t,void 0,...s);return s.callWithContext=(s,...i)=>this.dispatchAction(e,t,s,...i),this.functions.set(e,s),s}lookup(e){return this.functions.get(e)}registerMiddleware(...e){for(const[t,s]of e)this.registeredRoutines.set(t,s)}applyMiddleware(){for(const[e,t]of this.registeredRoutines){const s=t();this.routines.set(e,s)}}async dispatchAction(e,t,s,...i){const n=this.currentMsgId,r=new Promise(((r,o)=>{this.responseResolvers[n]={funcKey:e,funcDef:t,resolve:r,reject:o};const a=this.getSubRoutineFromDef(t),c=function(e,t,s=!1){if(s){const s=un(e,t,e.length-1),i=e.length-1;return s[e[i]]=t.slice(i),s}return un(e,t)}(a?a.argsDef.argNames:t.args,i,a?a.argsDef.varArg:t.varArg),h=a?a.buildMessageData(this.currentMsgId,c):c;this.getMessenger().send(new ln(this.currentMsgId,e,h,s)),++this.currentMsgId}));return this.inFlightActions.set(n,r),r}async receiveResponse(e){const t=this.responseResolvers[e.uid];if(t){const s=this.getSubRoutineFromDef(t.funcDef);e.success?t.resolve(s?await s.onResponse(e.uid,e.message):t.resolve(e.message)):t.reject(s&&s.onError?s.onError(e.uid,e.error):e.error)}this.inFlightActions.delete(e.uid),delete this.responseResolvers[e.uid]}getSubRoutineFromDef(e){if(e.subRoutine){const t=this.routines.get(e.subRoutine);if(!t)throw new Error(`${e.subRoutine} sub-routine was not provided for ${e}`);return t}return null}}class pn{constructor(e){this.registration=e}build(e){const t=new P;for(const s of Object.keys(e)){const i=e[s];if(i){const e=z(i.namespace,t),n=this.registration.register(s,i);e[i.name]=(...e)=>n(...e)}}return t}}class fn{constructor(e){this.observer=e,this.messageType=d.OBSERVATION}notify(e){this.observer.observe(e)}}class mn{constructor(e){this.type=f.OBSERVABLE_SUB,this.payload={observableKey:e}}}class yn{constructor(e){this.type=f.OBSERVABLE_UNSUB,this.payload={observableKey:e}}}class gn{constructor(e){this.getMessenger=e,this.observables=new Map,this.subscribedEvents=new Set,this.registeredObjectFactories=new Map,this.objectFactories=new Map,this.observableToFactoryMap=new Map;const t=new class{constructor(e){this.observables=e}observe(e){this.observables.observe(e)}}(this);this.observableObserver=new fn(t),this.getMessenger().addObserver(this.observableObserver)}dispose(){for(const e of this.subscribedEvents)this.getMessenger().send(new yn(e));this.getMessenger().removeObserver(this.observableObserver)}register(e,t){if(t){if(!this.registeredObjectFactories.get(t))throw new Error(`${t} factory was not provided for ${e}`);this.observableToFactoryMap.set(e,t)}const s=new Gi;return s.observers.onElementChanged({onAdded:()=>{this.addObserver(e)},onRemoved:()=>{this.removeObserver(e)}}),this.observables.set(e,s),s.subscriber}lookup(e){var t;return null===(t=this.observables.get(e))||void 0===t?void 0:t.subscriber}registerMiddleware(...e){for(const[t,s]of e)this.registeredObjectFactories.set(t,s)}applyMiddleware(){for(const[e,t]of this.registeredObjectFactories){const s=t();this.objectFactories.set(e,s)}}observe(e){var t,s;const{observableKey:i,observableData:n}=e,r=this.observableToFactoryMap.get(i),o=r&&this.objectFactories.get(r),a=o?o.create(n,null===(t=this.observables.get(i))||void 0===t?void 0:t.data):n;null===(s=this.observables.get(i))||void 0===s||s.notify(a)}addObserver(e){this.subscribedEvents.has(e)||(this.getMessenger().send(new mn(e)),this.subscribedEvents.add(e))}removeObserver(e){const t=this.observables.get(e);0===(null==t?void 0:t.observers.size)&&(this.getMessenger().send(new yn(e)),this.subscribedEvents.delete(e))}}class bn{constructor(e){this.registration=e}build(e){const t=new P;for(const s of Object.keys(e)){const i=e[s];if(i){z(i.namespace,t)[i.name]=this.registration.register(s,i.objectFactory)}}return t}}class vn{constructor(e){this.observer=e,this.messageType=d.COLLECTION_UPDATE}notify(e){this.observer.observe(e)}}class wn{constructor(e){this.type=f.COLLECTION_SUB,this.payload={collectionKey:e}}}class xn{constructor(e){this.type=f.COLLECTION_UNSUB,this.payload={collectionKey:e}}}var On,Cn=function(e,t,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,s):n?n.value=s:t.set(e,s),s},Mn=function(e,t,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(e):i?i.value:t.get(e)};class En{constructor(e){this.getMessenger=e,this.collections=new Map,this.collectionCache=new Map,this.observers=new a,this.cancelledObservers=new a,this.registeredElementFactories=new Map,this.elementFactories=new Map,this.collectionToElementFactoryMap=new Map;this.collectionUpdateObserver=new vn(new class{constructor(e){this.collectionBuilder=e}observe(e){this.collectionBuilder.observe(e)}}(this)),this.getMessenger().addObserver(this.collectionUpdateObserver)}dispose(){for(const e of this.observers.keys)this.getMessenger().send(new xn(e));this.getMessenger().removeObserver(this.collectionUpdateObserver)}register(e,t){var s;if(s=new WeakMap,t){if(!this.registeredElementFactories.get(t))throw new Error(`${t} element factory was not provided for ${e}`);this.collectionToElementFactoryMap.set(e,t)}const i=new class{constructor(e){s.set(this,void 0),Cn(this,s,e,"f")}subscribe(t){return Mn(this,s,"f").subscribe(e,t)}waitUntil(e){return new Promise((t=>{const s={onCollectionUpdated:s=>{("function"==typeof e?e:e.waitUntil.bind(e))(s)&&(t(s),i.cancel())}},i=this.subscribe(s)}))}}(this);return this.collections.set(e,i),i}lookup(e){return this.collections.get(e)}registerMiddleware(...e){for(const[t,s]of e)this.registeredElementFactories.set(t,s)}applyMiddleware(){for(const[e,t]of this.registeredElementFactories){const s=t();this.elementFactories.set(e,s)}}observe(e){const{collectionKey:t}=e;switch(e.operation){case p.ITEM_ADDED:{const{collectionIndex:s,item:i}=e;this.onItemAdded(t,s,i);break}case p.ITEM_REMOVED:{const{collectionIndex:s}=e;this.onItemRemoved(t,s);break}case p.ITEM_UPDATED:{const{collectionIndex:s,item:i}=e;this.onItemUpdated(t,s,i);break}case p.COLL_UPDATED:this.onCollectionUpdated(t)}this.removeCancelledObservers(t)}onItemAdded(e,t,s){const i=this.collectionCache.get(e)||new Tn;this.collectionCache.set(e,i);const n=this.collectionToElementFactoryMap.get(e),r=n&&this.elementFactories.get(n);i[t]=r?r.create(s):s;const o=this.observers.getValuesAtKey(e);for(const s of o)s.onAdded&&(this.cancelledObservers.has(e,s)||s.onAdded(t,i[t],i))}onItemRemoved(e,t){const s=this.collectionCache.get(e);if(!s)return;const i=s[t];if(delete s[t],i){const n=this.observers.getValuesAtKey(e);for(const r of n)r.onRemoved&&(this.cancelledObservers.has(e,r)||r.onRemoved(t,i,s))}}onItemUpdated(e,t,s){const i=this.collectionCache.get(e);if(!i)return;const n=this.collectionToElementFactoryMap.get(e),r=n&&this.elementFactories.get(n);r?r.update(s,i[t]):i[t]=s;const o=this.observers.getValuesAtKey(e);for(const s of o)s.onUpdated&&(this.cancelledObservers.has(e,s)||s.onUpdated(t,i[t],i))}onCollectionUpdated(e){const t=this.collectionCache.get(e)||new Tn;this.collectionCache.set(e,t);const s=this.observers.getValuesAtKey(e);for(const i of s)i.onCollectionUpdated&&(this.cancelledObservers.has(e,i)||i.onCollectionUpdated(t))}subscribe(e,t){0===this.observers.valuesPerKey(e)&&this.getMessenger().send(new wn(e)),this.observers.add(e,t);const s=this.collectionCache.get(e);s&&Promise.resolve().then((()=>{for(const e of Object.keys(s))t.onAdded&&t.onAdded(e,s[e],s);t.onCollectionUpdated&&t.onCollectionUpdated(s)}));const i=this;return new class{cancel(){i.cancelledObservers.add(e,t),Promise.resolve().then((()=>i.unsubscribe(e,t)))}}}unsubscribe(e,t){this.observers.remove(e,t),0===this.observers.valuesPerKey(e)&&(this.getMessenger().send(new xn(e)),this.collectionCache.delete(e))}removeCancelledObservers(e){const t=this.cancelledObservers.getValuesAtKey(e);for(const s of t)this.unsubscribe(e,s),this.cancelledObservers.remove(e,s)}}class Tn{*[Symbol.iterator](){for(const e in this)yield[e,this[e]]}}class _n{constructor(e){this.registration=e}build(e){const t=new P;for(const s of Object.keys(e)){const i=e[s];if(i){z(i.namespace,t)[i.name]=this.registration.register(s,i.elementFactory)}}return t}}class Sn{constructor(e){this.getMessenger=e,this.handlers=new Map,this.registeredHandlers=new Set;this.privateMessageObserver=new In(new class{constructor(e){this.messageHandler=e}observe(e){this.messageHandler.onMessage(e)}}(this)),this.getMessenger().addObserver(this.privateMessageObserver)}dispose(){this.getMessenger().removeObserver(this.privateMessageObserver)}onMessage(e){const t=this.handlers.get(e.messageType);null==t||t(e.messagePayload)}registerMiddleware(...e){for(const t of e)this.registeredHandlers.add(t)}applyMiddleware(){for(const e of this.registeredHandlers){const t=e();this.handlers.set(t.messageType,(e=>t.onMessage(e)))}}}class In{constructor(e){this.observer=e,this.messageType=d.PRIVATE_MESSAGE}notify(e){this.observer.observe(e)}}class Rn{constructor(){this.type=f.DISCONNECT,this.payload={}}}function An(e,t,s=""){for(const i in e){const n=e[i];if(n instanceof P){const e=t[i]||new P;t[i]=e,An(n,e,`${s}${s?".":""}${i}`),t[i]=e}else{if(t[i])throw Error(`clobbering ${s}.${i}`);t[i]=n}}}class kn{constructor(e){this.windowContext=e,this.argsDef={argNames:["policy","options"],varArg:!1}}buildMessageData(e,t){return{policy:t.policy,baseHref:this.windowContext.location.origin+this.windowContext.location.pathname,options:{includeParams:t.options?t.options.includeParams:[]}}}onResponse(e,t){return Promise.resolve()}}class Nn{constructor(e){this.windowContext=e,this.argsDef={argNames:["policy","options"],varArg:!1}}buildMessageData(e,t){var s;return Ct(Ze.DestinationPolicy,t.options)?{policy:t.policy,baseHref:this.windowContext.location.origin+this.windowContext.location.pathname,destinationPolicy:t.options}:{policy:t.policy,baseHref:this.windowContext.location.origin+this.windowContext.location.pathname,options:{templateHref:null===(s=t.options)||void 0===s?void 0:s.templateHref}}}onResponse(e,t){return Promise.resolve()}}!function(e){e.SETUP="sandbox.setup",e.TO_SANDBOX="sandbox.to.sandbox",e.TO_CLIENT="sandbox.to.client"}(On||(On={}));class Dn{constructor(e){this.getMessenger=e,this.RegisterSandbox=class{constructor(e){this.sandboxMiddleware=e,this.argsDef={argNames:["html","options"],varArg:!1}}buildMessageData(e,t){return Object.assign(Object.assign({},t),{clientId:this.sandboxMiddleware.sandboxIdGenerator.generate()})}onResponse(e,t){const{attachmentId:s,sandboxId:i}=t,n=new this.sandboxMiddleware.SandboxMessenger(i,this.sandboxMiddleware);return Promise.resolve([s,n])}},this.InjectHtml=class{constructor(e){this.sandboxMiddleware=e,this.argsDef={argNames:["tagId","html","options"],varArg:!1}}buildMessageData(e,t){return Object.assign(Object.assign({},t),{clientId:this.sandboxMiddleware.sandboxIdGenerator.generate()})}onResponse(e,t){const{sandboxId:s}=t,i=new this.sandboxMiddleware.SandboxMessenger(s,this.sandboxMiddleware);return Promise.resolve(i)}},this.SandboxMessenger=class{constructor(e,t){this.sandboxId=e,this.sandboxMiddleware=t}send(e,...t){this.sandboxMiddleware.getMessenger().send(new L(On.TO_SANDBOX,{type:e,payload:t,sandboxId:this.sandboxId}))}on(e,t){const s=this.sandboxMiddleware.callbacks.get(this.sandboxId)||new Map;this.sandboxMiddleware.callbacks.set(this.sandboxId,s);const i=s.get(e)||new Set;s.set(e,i),i.add(t)}off(e,t){const s=this.sandboxMiddleware.callbacks.get(this.sandboxId),i=null==s?void 0:s.get(e);null==i||i.delete(t)}},this.SandboxMessageHandler=class{constructor(e){this.sandboxMiddleware=e}get messageType(){return On.TO_CLIENT}onMessage(e){const t=this.sandboxMiddleware.callbacks.get(e.sandboxId),s=null==t?void 0:t.get(e.type);if(s)for(const t of s)t(...e.payload)}},this.sandboxIdGenerator=new qs,this.callbacks=new Map,this.registerSandboxRoutine=new this.RegisterSandbox(this),this.injectRoutine=new this.InjectHtml(this),this.messageHandler=new this.SandboxMessageHandler(this)}get registerSandbox(){return this.registerSandboxRoutine}get injectHTML(){return this.injectRoutine}get sandboxMessageHandler(){return this.messageHandler}}const Pn={namespace:"Sensor",name:"addSource",varArg:!0,args:["sensorId","sourceIds"]},zn={namespace:"Sensor",name:"dispose",args:["sensorId"]},Un={namespace:"Sensor",name:"showDebug",args:["sensorId","show"]};var Ln;!function(e){e.map=new Map}(Ln||(Ln={}));class jn{constructor(e,t,s,i){this.id=e,this.sensorCalls=t,this.sensorState=s,this.readingCollection=i,this.origin={x:0,y:0,z:0},this.forward={x:0,y:0,z:-1},this.sources=[];this.stateObservingCancellable=s.subscribe(new class{constructor(e){this.sensor=e}onChanged(e){Hn(this.sensor.origin,e.origin),Hn(this.sensor.forward,e.forward)}}(this))}dispose(){this.sensorCalls.dispose(this.id),this.stateObservingCancellable.cancel()}get facade(){const e=this;class t{constructor(e){this.observer=e}onChanged(){try{this.observerIsCallback(this.observer)?this.observer(i):this.observer.onChanged(i)}catch(e){throw Error("The argument provided to subscribe was not a valid observer\nExpected a function or an object with an `onChanged` function")}}observerIsCallback(e){return!e.onChanged}}class s{constructor(e){this.condition=e}waitUntil(){try{return this.conditionIsCallback(this.condition)?this.condition(i):this.condition.waitUntil(i)}catch(e){throw Error("The argument provided to subscribe was not a valid waiter\nExpected a function or an object with an `waitUntil` function")}}conditionIsCallback(e){return!e.waitUntil}}const i={get origin(){return e.origin},get forward(){return e.forward},addSource(...t){e.addSource(...t)},showDebug(t){e.sensorCalls.showDebug(e.id,t)},readings:{subscribe:t=>e.readingCollection.subscribe(new Fn(t,e.sources))},dispose(){e.dispose()},subscribe:s=>e.sensorState.subscribe(new t(s)),waitUntil:t=>e.sensorState.waitUntil(new s(t))};return i}async addSource(...e){this.sources.push(...e);const t=[];for(const s of e){const e=Ln.map.get(s);if(!e)throw Error(s+" was not a valid source. Sources must be created using createSource");e.id&&t.push(e.id)}this.sensorCalls.addSource(this.id,...t)}}class Fn{constructor(e,t){this.observer=e,this.sources=t,this.sourceMap=new Map,this.internalReadingMap=new Map,this.readingMap=new Map}onAdded(e,t){const s=this.sources[this.sourceMap.size];if(s){this.sourceMap.set(e,s);const i=new Vn(t);this.internalReadingMap.set(s,i),this.readingMap.set(s,i.facade),this.observer.onAdded&&this.observer.onAdded(s,i.facade,this.readingMap)}}onRemoved(e,t){const s=this.sourceMap.get(e);if(s){const e=this.readingMap.get(s);this.internalReadingMap.delete(s),this.readingMap.delete(s),this.observer.onRemoved&&this.observer.onRemoved(s,e,this.readingMap)}}onUpdated(e,t){const s=this.sourceMap.get(e);if(s){if(this.internalReadingMap.get(s).update(t),this.observer.onUpdated){const e=this.readingMap.get(s);this.observer.onUpdated(s,e,this.readingMap)}}}onCollectionUpdated(){this.observer.onCollectionUpdated&&this.observer.onCollectionUpdated(this.readingMap)}}class Vn{constructor(e){this.baseReading=e,this.distanceCache=1/0,this.distanceNeedsUpdate=!0}get facade(){const e=this;return{get inRange(){return e.baseReading.inRange},get inView(){return e.baseReading.inView},get distanceSquared(){return e.baseReading.distanceSquared},get direction(){return e.baseReading.direction},get distance(){return e.distance}}}update(e){this.baseReading.inRange=e.inRange,this.baseReading.inView=e.inView,this.updateDistance(e.distanceSquared),this.updateDirection(e.direction)}updateDirection(e){Hn(this.baseReading.direction,e)}updateDistance(e){e&&(this.distanceNeedsUpdate=!0,this.baseReading.distanceSquared=e)}get distance(){return this.distanceNeedsUpdate&&(this.distanceNeedsUpdate=!1,this.distanceCache=Math.sqrt(this.baseReading.distanceSquared)),this.distanceCache}}function Hn(e,t){e.x=t.x,e.y=t.y,e.z=t.z}class Bn{constructor(e){this.argsDef={argNames:["type"],varArg:!1},this.observableRegistry=e.observableRegister,this.collectionRegistry=e.collectionRegister,this.sensorCalls={addSource:e.functionRegister.lookup(Ri(Pn)),dispose:e.functionRegister.lookup(Ri(zn)),showDebug:e.functionRegister.lookup(Ri(Un))}}buildMessageData(e,t){return t}async onResponse(e,t){const s=this.observableRegistry.register(t.sensorId),i=this.collectionRegistry.register(t.sensorId);return new jn(t.sensorId,this.sensorCalls,s,i).facade}}class Wn{constructor(e,t,s,i){this.id=e,this.updateSourceCall=t,this.userData=s,this.volumeCache={origin:{x:0,y:0,z:0},radius:1/0},this.updateCache(i.origin,i.radius)}get facade(){const e={radius:this.volumeCache.radius,origin:Object.assign({},this.volumeCache.origin)};const t=this,s=new class{get type(){return st.SourceType.SPHERE}get volume(){return e}get userData(){return t.userData}commit(){return t.commit(this)}};return Ln.map.set(s,this),s}async commit(e){this.hasSourceChanged(e)&&(this.updateCache(e.volume.origin,e.volume.radius),await this.updateSourceCall(this.id,st.SourceType.SPHERE,this.volumeCache))}hasSourceChanged(e){return!(this.volumeCache.origin.x===e.volume.origin.x&&this.volumeCache.origin.y===e.volume.origin.y&&this.volumeCache.origin.z===e.volume.origin.z&&this.volumeCache.radius===e.volume.radius)}updateCache(e,t){this.volumeCache.origin.x=e.x,this.volumeCache.origin.y=e.y,this.volumeCache.origin.z=e.z,this.volumeCache.radius=t}}function Kn(e,t,...s){for(const i of s)e[i]=t[i]}class qn{constructor(e,t,s,i){this.id=e,this.updateSourceCall=t,this.userData=s,this.volumeCache={center:{x:0,y:0,z:0},size:{x:1/0,y:1/0,z:1/0},orientation:{yaw:0,pitch:0,roll:0}},this.updateCache(i.center,i.size,i.orientation)}get facade(){const e={center:Object.assign({},this.volumeCache.center),size:Object.assign({},this.volumeCache.size),orientation:Object.assign({},this.volumeCache.orientation)};const t=this,s=new class{get type(){return st.SourceType.BOX}get volume(){return e}get userData(){return t.userData}commit(){return t.commit(this)}};return Ln.map.set(s,this),s}async commit(e){this.hasSourceChanged(e)&&(this.updateCache(e.volume.center,e.volume.size,e.volume.orientation),await this.updateSourceCall(this.id,st.SourceType.BOX,this.volumeCache))}hasSourceChanged(e){return!(this.volumeCache.center.x===e.volume.center.x&&this.volumeCache.center.y===e.volume.center.y&&this.volumeCache.center.z===e.volume.center.z&&this.volumeCache.size.x===e.volume.size.x&&this.volumeCache.size.y===e.volume.size.y&&this.volumeCache.size.z===e.volume.size.z&&this.volumeCache.orientation.yaw===e.volume.orientation.yaw&&this.volumeCache.orientation.pitch===e.volume.orientation.pitch&&this.volumeCache.orientation.roll===e.volume.orientation.roll)}updateCache(e,t,s){je(this.volumeCache.center,e),je(this.volumeCache.size,t),Kn(this.volumeCache.orientation,s,"yaw","pitch","roll")}}class Gn{constructor(e,t,s,i){this.id=e,this.updateSourceCall=t,this.userData=s,this.volumeCache={basePoint:{x:0,y:0,z:0},height:1/0,radius:1/0},this.updateCache(i.basePoint,i.height,i.radius)}get facade(){const e={basePoint:Object.assign({},this.volumeCache.basePoint),height:this.volumeCache.height,radius:this.volumeCache.radius};const t=this,s=new class{get type(){return st.SourceType.CYLINDER}get volume(){return e}get userData(){return t.userData}commit(){return t.commit(this)}};return Ln.map.set(s,this),s}async commit(e){this.hasSourceChanged(e)&&(this.updateCache(e.volume.basePoint,e.volume.height,e.volume.radius),await this.updateSourceCall(this.id,st.SourceType.CYLINDER,this.volumeCache))}hasSourceChanged(e){return!(this.volumeCache.basePoint.x===e.volume.basePoint.x&&this.volumeCache.basePoint.y===e.volume.basePoint.y&&this.volumeCache.basePoint.z===e.volume.basePoint.z&&this.volumeCache.height===e.volume.height&&this.volumeCache.radius===e.volume.radius)}updateCache(e,t,s){je(this.volumeCache.basePoint,e),this.volumeCache.height=t,this.volumeCache.radius=s}}const Xn={namespace:"Sensor",name:"updateSource",args:["sourceId","type","options"]};class $n{constructor(e){this.userDataMap=new Map,this.argsDef={argNames:["type","options"],varArg:!1},this.updateSourceCall=e.functionRegister.lookup(Ri(Xn))}buildMessageData(e,t){const s=t.options.hasOwnProperty("userData")?t.options.userData:{};if(!Et(s))throw new Error("Error creating Source, userData was provided but not an object");this.userDataMap.set(e,Object.assign({},s));const i=Object.assign({},t.options);return delete i.userData,{type:t.type,options:i}}async onResponse(e,t){const s=this.userDataMap.get(e)||{};return this.userDataMap.delete(e),function(e,t,s){const{sourceId:i,type:n,volume:r}=e;switch(n){case st.SourceType.SPHERE:return new Wn(i,t,s,r);case st.SourceType.BOX:return new qn(i,t,s,r);case st.SourceType.CYLINDER:return new Gn(i,t,s,r)}}(t,this.updateSourceCall,s).facade}}window.THREE;const Yn=(e,t)=>e.x===t.x&&e.y===t.y&&e.z===t.z;class Zn{constructor(){this.updateMethodMap=new Map}create(e){const[t,s]=function(e){let t=!0;const s={x:0,y:0,z:0};let i=!0;const n={x:0,y:0,z:0};class r{constructor(){this.bounds={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},this.floorInfo={id:"0",sequence:0}}get size(){return i&&(i=!1,n.x=this.bounds.max.x-this.bounds.min.x,n.y=this.bounds.max.y-this.bounds.min.y,n.z=this.bounds.max.z-this.bounds.min.z),n}get center(){return t&&(t=!1,s.x=.5*(this.bounds.max.x+this.bounds.min.x),s.y=.5*(this.bounds.max.y+this.bounds.min.y),s.z=.5*(this.bounds.max.z+this.bounds.min.z)),s}}const o=new r;function a(e){Yn(o.bounds.max,e.bounds.max)&&Yn(o.bounds.min,e.bounds.min)||(t=!0,i=!0),o.id=e.id,o.label=e.label,je(o.bounds.max,e.bounds.max),je(o.bounds.min,e.bounds.min),o.floorInfo.id=e.floorInfo.id,o.floorInfo.sequence=e.floorInfo.sequence}return a(e),[o,e=>a(e)]}(e);return this.updateMethodMap.set(t,s),t}update(e,t){const s=this.updateMethodMap.get(t);null==s||s(e)}}class Jn{constructor(){this.roomFactory=new Zn}create(e,t){t=t||{rooms:[]};for(let s=0;s<e.rooms.length;++s)t.rooms[s]?this.roomFactory.update(e.rooms[s],t.rooms[s]):t.rooms[s]=this.roomFactory.create(e.rooms[s]);return t.rooms.length=e.rooms.length,t}}const Qn={namespace:"Tag",name:"editKeywords",args:["tagId","keywords"],options:{replay:!0}},er={namespace:"Tag",name:"editEnabled",args:["tagId","enabled"],options:{replay:!0}};var tr,sr,ir,nr=function(e,t,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(e):i?i.value:t.get(e)},rr=function(e,t,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,s):n?n.value=s:t.set(e,s),s};class or{constructor(e){this.updateMethodMap=new Map,this.editKeywords=e.functionRegister.lookup(Ri(Qn)),this.editEnabled=e.functionRegister.lookup(Ri(er))}create(e){const[t,s]=function(e,t,s){var i,n;let r=!0;const o={x:0,y:0,z:0};let a,c=!0;class h{constructor(){this.id=e.id,this.anchorPosition=Object.assign({},e.anchorPosition),this.stemVector=Object.assign({},e.stemVector),this.stemVisible=e.stemVisible,this.label=e.label,this.description=e.description,this.color=Object.assign({},e.color),this.roomId=e.roomId,this.attachments=[...e.attachments],i.set(this,function(e,t,s){const i=new ar(e,t,s);return new Proxy(i,{get(e,s){const i=e[s];return"string"!=typeof s||isNaN(parseInt(s,10))?"length"===s?t.length:"symbol"==typeof s?"function"==typeof i?i.bind(e):i:"function"==typeof i?Object.getPrototypeOf(e).hasOwnProperty(s)?i.bind(e):i.bind(t):i:t[parseInt(s,10)]},set:(i,n,r)=>"string"!=typeof n||isNaN(parseInt(n,10))?"length"===n&&(t.length===r||(t.length=r,s(e.id,t)),!0):(t[parseInt(n,10)]=r,s(e.id,t),!0)})}(this,l,t)),n.set(this,e.enabled),this.fontId=e.fontId,this.iconId=e.iconId}get enabled(){return nr(this,n,"f")}set enabled(e){e!==nr(this,n,"f")&&(rr(this,n,e,"f"),s(this.id,this.enabled))}get discPosition(){return r&&(r=!1,o.x=this.anchorPosition.x+this.stemVector.x,o.y=this.anchorPosition.y+this.stemVector.y,o.z=this.anchorPosition.z+this.stemVector.z),o}get stemHeight(){return c&&(c=!1,a=Math.sqrt(this.stemVector.x**2+this.stemVector.y**2+this.stemVector.z**2)),a}get keywords(){return nr(this,i,"f")}}i=new WeakMap,n=new WeakMap;const l=[...e.keywords],u=new h;function d(e){const t=Yn(u.anchorPosition,e.anchorPosition);Yn(u.stemVector,e.stemVector)||(r=!0,c=!0),t||(r=!0),u.id=e.id,u.enabled=e.enabled,je(u.anchorPosition,e.anchorPosition),je(u.stemVector,e.stemVector),u.stemVisible=e.stemVisible,u.label=e.label,u.description=e.description,Kn(u.color,e.color,"r","g","b"),u.roomId=e.roomId,Ve(u.attachments,e.attachments),((e=[],t=[])=>e.length===t.length&&(e=e.slice().sort(),t=t.slice().sort(),e.every(((e,s)=>e.hasOwnProperty("equals")&&"function"==typeof e.equals?e.equals(t[s]):t[s]===e))))(l,e.keywords)||Ve(l,e.keywords),u.fontId=e.fontId,u.iconId=e.iconId}return d(e),[u,e=>d(e)]}(e,this.editKeywords,this.editEnabled);return this.updateMethodMap.set(t,s),t}update(e,t){const s=this.updateMethodMap.get(t);null==s||s(e)}}class ar extends Array{constructor(e,t,s){super(),tr.set(this,void 0),sr.set(this,void 0),ir.set(this,void 0),rr(this,tr,e,"f"),rr(this,sr,t,"f"),rr(this,ir,s,"f")}get length(){return nr(this,sr,"f").length}set length(e){const t=this.length;nr(this,sr,"f").length=e,t>e&&nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f"))}push(...e){return nr(this,sr,"f").push(...e),nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),nr(this,sr,"f").length}fill(e,t,s){return nr(this,sr,"f").fill(e,t,s),nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),this}pop(){const e=nr(this,sr,"f").pop();return nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),e}reverse(){return nr(this,sr,"f").reverse(),nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),this}shift(){const e=nr(this,sr,"f").shift();return nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),e}sort(e){return nr(this,sr,"f").sort(e),nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),this}splice(e,t,...s){const i=nr(this,sr,"f").splice(e,t,...s);return nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),i}unshift(...e){return nr(this,sr,"f").unshift(...e),nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),nr(this,sr,"f").length}copyWithin(e,t,s){return nr(this,sr,"f").copyWithin(e,t,s),nr(this,ir,"f").call(this,nr(this,tr,"f").id,nr(this,sr,"f")),this}[(tr=new WeakMap,sr=new WeakMap,ir=new WeakMap,Symbol.iterator)](){return nr(this,sr,"f")[Symbol.iterator]()}}class cr{constructor(e){this.windowContext=e}get messageType(){return"open link"}onMessage(e){e.newWindow?window.open(e.href):this.windowContext.location.assign(e.href)}}var hr;!function(e){e.ADD="view.add.layer",e.REMOVE="view.remove.layer"}(hr||(hr={}));const lr={namespace:"View",name:"update",args:["op","viewId","layerId"]},ur={namespace:"View",name:"activate",args:["viewId","returnToStart"]};function dr(e,t){return e.common===t.common&&e.name===t.name&&e.toggled===t.toggled&&e.type===t.type}const pr={namespace:"View",name:"toggleLayer",args:["layerId","activate"]},fr={namespace:"View",name:"queryLayerInterface",args:[]},mr={namespace:"View",name:"persist",args:["viewId"]};var yr,gr,br,vr,wr=function(e,t,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,s):n?n.value=s:t.set(e,s),s},xr=function(e,t,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(e):i?i.value:t.get(e)};class Or{constructor(e,t,s){yr.set(this,void 0),gr.set(this,void 0),br.set(this,void 0),wr(this,gr,e,"f"),wr(this,yr,t,"f"),wr(this,br,s,"f")}get id(){return xr(this,yr,"f").id}get name(){return xr(this,yr,"f").name}get active(){return xr(this,yr,"f").active}get type(){return xr(this,yr,"f").type}setActive(e=!1){return xr(this,gr,"f").activateView(this.id,e)}get layers(){return xr(this,yr,"f").layers.values()}addLayer(e){return xr(this,gr,"f").updateView(hr.ADD,xr(this,yr,"f").id,e.id)}removeLayer(e){return xr(this,gr,"f").updateView(hr.REMOVE,xr(this,yr,"f").id,e.id)}hasLayer(e){return xr(this,yr,"f").layers.has(e)}subscribe(e){return xr(this,br,"f").subscribe(e)}waitUntil(e){return xr(this,br,"f").waitUntil(e)}}yr=new WeakMap,gr=new WeakMap,br=new WeakMap;class Cr extends Or{constructor(e,t,s){super(e,t,s),vr.set(this,void 0),wr(this,vr,e.persist,"f")}async persist(){return xr(this,vr,"f").call(this,this.id)}}vr=new WeakMap;class Mr{constructor(e,t,s){this.updateViewCalls=e,this.layerFactory=t,this.views=s,this.argsDef={argNames:["name"],varArg:!1},this.viewDataMap=new Map}buildMessageData(e,t){return t}async onResponse(e,t){return this.createView(t)}create(e){const t=this.views.get(e.id);if(t)return this.update(e,t),t;return this.createView(e)}update(e,t){const s=this.viewDataMap.get(t.id);if(!s)return void this.create(e);const i=new Map;for(const t of e.layers)i.set(t.id,t);const n=(r=s.baseData,o=e,!(r.active===o.active&&r.name===o.name&&r.type===o.type&&([...s.baseData.layers].every((e=>{const t=i.get(e.id);return t&&dr(t,e)})),e.layers)));var r,o;s.baseData.name=e.name,s.baseData.active=e.active,s.baseData.type=e.type,s.baseData.layers.clear();for(const t of e.layers)s.baseData.layers.add(this.layerFactory.get(t));n&&s.observable.notify(t)}createView(e){const t={id:e.id,name:e.name,active:e.active,type:e.type,layers:new Set(e.layers.map((e=>this.layerFactory.get(e))))},s=new Gi,i=(n=this.updateViewCalls).hasOwnProperty("persist")&&n.persist&&e.transient?new Cr(this.updateViewCalls,t,s.subscriber):new Or(this.updateViewCalls,t,s.subscriber);var n;return s.notify(i),this.views.set(i.id,i),this.viewDataMap.set(i.id,{baseData:t,observable:s}),i}}var Er,Tr,_r,Sr=function(e,t,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,s):n?n.value=s:t.set(e,s),s},Ir=function(e,t,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(e):i?i.value:t.get(e)};class Rr{constructor(e,t,s,i){Er.set(this,void 0),Tr.set(this,void 0),_r.set(this,void 0),Sr(this,Er,e,"f"),Sr(this,Tr,t,"f"),Sr(this,_r,i,"f");for(const e in s)this[e]=s[e]}get id(){return Ir(this,Tr,"f").id}get name(){return Ir(this,Tr,"f").name}get type(){return Ir(this,Tr,"f").type}get toggled(){return Ir(this,Tr,"f").toggled}get common(){return Ir(this,Tr,"f").common}toggle(e){return Ir(this,Er,"f").toggleLayer(this.id,e)}subscribe(e){return Ir(this,_r,"f").subscribe(e)}waitUntil(e){return Ir(this,_r,"f").waitUntil(e)}}Er=new WeakMap,Tr=new WeakMap,_r=new WeakMap;class Ar{constructor(e,t){this.layerId=e,this.baseFunctionRegister=t}build(e){const t=new P;for(const[s,i]of e){const e=this.baseFunctionRegister.lookup(s);if(e){z(i.namespace,t)[i.name]=(...t)=>e.callWithContext({layerId:this.layerId,subType:"layered.op"},...t)}}return t}}class kr{constructor(e,t,s,i){this.functionRegister=e,this.viewCalls=t,this.layers=s,this.getLayerInterface=i,this.argsDef={argNames:["name","options"],varArg:!1},this.layerDataMap=new Map}buildMessageData(e,t){return t}async onResponse(e,t){return this.createLayer(t)}create(e,t){if(t=t||this.layers.get(e.id))return this.update(e,t),t;return this.createLayer(e)}update(e,t){const s=this.layerDataMap.get(t.id);if(!s)return void this.create(e);const i=!dr(s.baseData,e);s.baseData.name=e.name,s.baseData.toggled=e.toggled,i&&s.observable.notify(t)}get(e){return this.layers.get(e.id)||this.create(e)}createLayer(e){const t=this.getLayerInterface(),s=new Ar(e.id,this.functionRegister).build(t),i=new Gi,n=new Rr(this.viewCalls,e,s,i.subscriber);return i.notify(n),this.layers.set(n.id,n),this.layerDataMap.set(n.id,{baseData:e,observable:i}),n}}class Nr{constructor(e){this.registryMap=e,this.views=new Map,this.layers=new Map;e.functionRegister.register(Ri(fr),fr)().then((e=>this.layerInterface=e)).catch((()=>this.layerInterface=new Map))}build(){const e=this.registryMap.functionRegister.lookup(Ri(lr)),t=this.registryMap.functionRegister.lookup(Ri(ur)),s=this.registryMap.functionRegister.lookup(Ri(pr));this.viewCalls={updateView:e,activateView:t,toggleLayer:s};const i=this.registryMap.functionRegister.lookup(Ri(mr));i&&(this.viewCalls.persist=i),this.layerElementFactory=new kr(this.registryMap.functionRegister,this.viewCalls,this.layers,(()=>this.layerInterface)),this.viewElementFactory=new Mr(this.viewCalls,this.layerElementFactory,this.views)}get viewFactory(){return this.viewElementFactory||this.build(),this.viewElementFactory}get layerFactory(){return this.layerElementFactory||this.build(),this.layerElementFactory}}class Dr{constructor(){this.argsDef={argNames:["view"],varArg:!1}}buildMessageData(e,t){return{viewId:t.view.id}}async onResponse(e,t){}}class Pr{constructor(){this.argsDef={argNames:["layer"],varArg:!1}}buildMessageData(e,t){return{layerId:t.layer.id}}async onResponse(e,t){}}class zr{constructor(e,t){this.windowContext=t||window,this.messenger=e.createMessenger();const s=()=>this.messenger;this.clientRegistration=new j(s),this.functionRegistration=new dn(s),this.observableRegistration=new gn(s),this.collectionRegistration=new En(s),this.privateMessageHandler=new Sn(s),this.registryMap={functionRegister:this.functionRegistration,observableRegister:this.observableRegistration,collectionRegister:this.collectionRegistration},this.registerMiddleware(),this.clientHelpers=new F(this.clientRegistration),this.enums=new U,this.eventHandler=new D(s),this.functions=new pn(this.functionRegistration),this.observable=new bn(this.observableRegistration),this.collections=new _n(this.collectionRegistration),this.messenger.init()}build(e){const t={},s=this.eventHandler.build();t.on=(e,i)=>(s.on(e,i),t),t.off=(e,i)=>(s.off(e,i),t);const i=[[this.enums,e.enums],[this.functions,e.functions],[this.observable,e.observables],[this.collections,e.collections]];for(const[e,s]of i)if(s){An(e.build(s),t)}for(const[t,s]of Object.entries(e.unlistedFcns))s&&this.functionRegistration.register(t,s);return this.functionRegistration.applyMiddleware(),this.observableRegistration.applyMiddleware(),this.collectionRegistration.applyMiddleware(),this.privateMessageHandler.applyMiddleware(),An(this.clientHelpers.build(cn(this.registryMap)),t),t.disconnect=()=>{t.disconnect=()=>{},this.dispose()},t}async dispose(){const e=Promise.all([this.enums.dispose(),this.eventHandler.dispose(),this.clientRegistration.dispose(),this.functionRegistration.dispose(),this.observableRegistration.dispose(),this.collectionRegistration.dispose(),this.privateMessageHandler.dispose()]);this.messenger.send(new Rn),this.messenger=l.toFilteredMessenger(this.messenger,[f.OBSERVABLE_UNSUB,f.COLLECTION_UNSUB],[d.RESPONSE]),await e,this.messenger.dispose()}registerMiddleware(){const e=new Nr(this.registryMap),t=new Dn((()=>this.messenger)),s=[["link.setsharepolicy",()=>new kn(this.windowContext)],["link.setopenpolicy",()=>new Nn(this.windowContext)],["mattertag.inject",()=>t.injectHTML],["tag.registerSandbox",()=>t.registerSandbox],["sensor.create",()=>new Bn(this.registryMap)],["source.create",()=>new $n(this.registryMap)],["View",()=>e.viewFactory],["Layer",()=>e.layerFactory],["view.deleteView",()=>new Dr],["view.deleteLayer",()=>new Pr]],i=[["current.room",()=>new Jn],["View",()=>e.viewFactory],["Layer",()=>e.layerFactory]],n=[["tag.data",()=>new or(this.registryMap)],["collection.room",()=>new Zn],["View",()=>e.viewFactory],["Layer",()=>e.layerFactory]],r=[()=>t.sandboxMessageHandler,()=>new cr(this.windowContext)];this.functionRegistration.registerMiddleware(...s),this.observableRegistration.registerMiddleware(...i),this.collectionRegistration.registerMiddleware(...n),this.privateMessageHandler.registerMiddleware(...r)}}new r("SDK client").info("Showcase SDK client version:","26.1.3_webgl-190-ge117742b46"),window["sdk-client"]=t})();