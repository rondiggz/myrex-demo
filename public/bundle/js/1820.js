/*! For license information please see 1820.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[1820],{75162:(e,t,n)=>{n.d(t,{E:()=>D});var s=n(32485),a=n.n(s),o=n(96540),i=n(98236),r=n(20835);const c=(0,i.v_)(r.v);function l(e){const t=c(),[n,s]=(0,o.useState)(d(t,e));return(0,o.useEffect)((()=>{if(!t)return()=>{};function n(){s(d(t,e))}const a=t[e].onChanged(n);return n(),()=>a.cancel()}),[t,e]),n}function d(e,t){return e?e[t].values:[]}var h=n(51831),u=n(3101),m=n(38584),p=n(72909),g=n(77570),v=n(3795),x=n(56147),b=n(40104),f=n(9241),E=n(81923);const C="loadingblocks-a1de59bc8a2acdbefcee",T="block-d19338bf171f44b9457d",A="block__one-e8365c5db4442440dab7",w="block__two-d476fdec10e0a9c43ec5";var y=n(74848);function N(e){let{className:t}=e;return(0,y.jsxs)("div",{className:a()(C,t),"data-testid":"loading_blocks",children:[(0,y.jsx)("div",{className:a()(T,A)}),(0,y.jsx)("div",{className:a()(T,w)}),(0,y.jsx)("div",{className:a()(T)})]})}var k,S,j,_=n(80855),O=n(19389),R=n(48270),L=n(71687);const{ATTACHMENTS:I}=x.A.SHOWCASE;let P=(k=Reflect.metadata("design:type",Function),S=Reflect.metadata("design:paramtypes",["undefined"==typeof PendingUploadProps?Object:PendingUploadProps]),(0,p.A)(j=k(j=S(j=class extends o.Component{static contextType=(()=>g.B)();attachmentsModule;constructor(e){super(e),this.state={containerRef:null}}componentDidMount(){this.context.engine.getModuleBySymbol(L.qy).then((e=>{this.attachmentsModule=e}))}setContainerRef=e=>{this.setState({containerRef:e})};handleCancelClick=e=>{e.preventDefault(),this.attachmentsModule.cancelAttachmentUpload(this.props.id)};onRemoveFailed=e=>{const{id:t,error:n}=this.props;n&&(e.stopPropagation(),this.attachmentsModule.removeFailure(t))};render(){const{className:e,error:t,progress:n,fileName:s}=this.props;let o=I.ERROR_UPLOAD_FAIL;const i=this.context.locale.t(I.REMOVE_TOOLTIP),r=t?this.onRemoveFailed:this.handleCancelClick;switch(t){case v.t2.FILE_TOO_LARGE:o=I.ERROR_FILE_TOO_LARGE;break;case v.t2.EMPTY_FILE:o=I.ERROR_EMPTY_FILE;break;case v.t2.OVER_QUOTA:o=I.ERROR_OVER_QUOTA;break;case v.t2.PERMISSION_DENIED:o=I.ERROR_PERMISSION_DENIED}const c=t?this.context.locale.t(o):s,l={"upload-error":!!t};return(0,y.jsxs)("div",{className:a()("attachment","attachment-upload",l,e),children:[(0,y.jsx)("div",{ref:this.setContainerRef,className:"upload-status",children:t?(0,y.jsx)(b.I,{name:"error",size:f.l.MEDIUM}):"number"==typeof n?(0,y.jsx)(E.A,{progress:n,innerRadius:20,barWidth:4}):(0,y.jsx)(N,{className:"loading-blocks"})}),(0,y.jsx)(_.m,{target:this.state.containerRef,title:c}),(0,y.jsx)(O.$,{icon:"close",className:"attachment-delete",size:R.M.SMALL,variant:R.A.FAB,theme:"dark",tooltip:i,tooltipOptions:{placement:"bottom-start"},onClick:r})]})}})||j)||j)||j);function D(e){let{inline:t,children:n,parentId:s,canDelete:o,nonViewable:i,attachments:r,annotationType:c,onViewAttachment:d}=e;const p=l("uploads"),g=l("failures"),v=(e,t)=>{d&&d(t)},x=e=>s!==e.parentId?null:(0,y.jsx)(P,{id:e.id,fileName:e.file.name,className:"inline",progress:e.progress,error:e.error},e.id),b=c===h.U.NOTE;return(0,y.jsxs)("div",{className:a()("annotation-attachments",{"annotation-attachments-inline":!!t,"annotation-attachments-preview":!i,"annotation-attachments-list":i}),children:[r.map(((e,n)=>{const s=r.length,a=!t&&!i&&(0,u.rV)(e)&&(1===s||0===n&&s>2);let c,l;return b&&(t?(c=60,l=60):a||(c=140,l=140)),(0,y.jsx)(m.o,{attachment:e,inline:!!t,canDelete:!!o,hero:a,onClick:v,thumbnail:!!t||!a,width:c,height:l},e.id)})),p&&p.map(x),g&&g.map(x),n]})}},67280:(e,t,n)=>{n.d(t,{T:()=>De});var s=n(75522),a=n(85204),o=n(53641),i=n(73566),r=n(68419),c=n(5262),l=n(96540),d=n(32485),h=n.n(d),u=n(51831),m=n(40409),p=n(25727),g=n(74453),v=n(40936),x=n(74848);const{UP:b,DOWN:f,LEFT:E,RIGHT:C,UP_LEFT:T,UP_RIGHT:A,DOWN_LEFT:w,DOWN_RIGHT:y}=p.DH,N=(0,l.memo)((e=>{let{className:t,onClick:n,children:s}=e;const a=(0,g.S)(),[o,i]=(0,l.useState)(null),{width:r,height:c,ref:d}=(0,v.A)(),[{width:u,height:m},p]=(0,l.useState)({width:0,height:0}),{ref:N}=(0,v.A)({onResize:e=>{let{width:t,height:n}=e;null===o&&p({width:t||0,height:n||0})}});let k;if((0,l.useEffect)((()=>{if(r&&c&&u&&m&&a){let e=o;const t=a.y<m,n=a.y>c-m,s=a.x<u,l=a.x>r-u;t&&n?e=l&&!s?E:C:t?e=s?y:l?w:f:n?e=s?A:l?T:b:s&&l?e=t?f:b:s?e=C:l?e=E:null===e&&(e=C),e!==o&&i(e)}}),[a,r,c,u,m,o]),r&&a){k=o===C&&a.x>r-u?r-a.x:void 0}return(0,x.jsx)("div",{ref:d,className:"annotations-preview-layer",children:a&&s&&(0,x.jsx)("div",{ref:N,className:h()("annotation-preview",`annotation-preview-${o}`,t),style:{top:a.y,left:a.x,visibility:null===o?"hidden":void 0,width:k},onClick:n,children:s})})}));var k=n(46822),S=n(78063),j=n(17904),_=n(94426),O=n(80700),R=n(80411),L=n(56147),I=n(39869),P=n(32005),D=n(54616);const{NOTES:M}=L.A.SHOWCASE;function V(e){let{comment:t,noteView:n}=e;const s=n?n.created:t.created,a=(0,D.P)(),o=(0,I.Y)(),i=n?n.user.email:t.user.email,r=a.getUserDisplay(i),c=r.color,l=n?n.comments.length-1:0,d=o.t(M.REPLIES,l),h=""===t.text&&!(t.attachments.length>0)?o.t(M.CONTENT_DELETED):s.toLocaleString();return(0,x.jsxs)("header",{className:"note-header",children:[(0,x.jsx)(P.E,{label:r.initials,badgeStyle:{color:c,borderColor:c}}),(0,x.jsxs)("div",{className:"note-details",children:[(0,x.jsx)("span",{className:"note-user",children:r.name}),l>0&&(0,x.jsx)("span",{className:"note-summary-info note-replies",children:d}),(0,x.jsx)("div",{className:"note-subheader",children:h})]})]})}var G=n(45598),B=n(68375);function U(e){const{attachments:t}=e,n=(0,B.s)();if(!(t.length>0))return null;return(0,x.jsx)(G.g,{attachments:t,onClick:(t,s)=>{n.trackToolGuiEvent("notes","notes_preview_click_attachment"),t.stopPropagation(),e.onClick(s)}})}var F=n(51005),H=n(29397),W=n(24865);function $(e){let{text:t,noteId:n}=e;const s=(0,H.V)(),a=(0,W.b)();return(0,x.jsx)("div",{className:h()("note-post",{"note-summary-info":!t}),children:t&&s&&(0,x.jsx)(F.$,{text:t,textParser:s,linkHandler:a,maxLength:150,annotationType:u.U.NOTE,annotationId:n})})}var Y=n(75162);function K(e){const t=(0,I.Y)(),{moreAttachmentsCount:n}=e;if(0===n)return null;const s=t.t(L.A.SHOWCASE.ATTACHMENTS.MORE_ATTACHMENT,n);return(0,x.jsx)("div",{className:"attachment attachments-truncated",children:(0,x.jsx)("div",{className:"attachment-view attachment-other ",children:(0,x.jsx)("div",{className:"attachment-label",children:(0,x.jsx)("div",{className:"file-label",children:s})})})})}var z=n(3101),J=n(12103),q=n(71687);const{ANNOTATIONS:Q}=L.A.SHOWCASE;function X(e){const{previewId:t}=e,n=(0,l.useRef)(null),s=(0,I.Y)(),a=(0,O.e)(t),o=(0,R.Z)(t),i=(0,j.S)(q.Et);if((0,l.useEffect)((()=>(o&&n.current&&n.current.focus(),()=>{})),[o]),!o)return null;const r=o.comments.get(0),c=r&&r.attachments.length>0,d=r.attachments.values(),m=(0,z.c9)(d),p=(0,z.rg)(d),g=p.slice(0,J.p8),v=Math.max(p.length-J.p8,0),b=o.comments.length>1||v>0,f=s.t(Q.READ_MORE_MESSAGE),E=h()("annotation-preview-contents","note-preview-contents",{"viewable-media":c});return(0,x.jsxs)("div",{ref:n,role:"dialog",tabIndex:0,className:E,onClick:t=>{t.stopPropagation(),e.onClick()},onKeyDown:e=>{"Escape"===e.code&&i&&(e.stopPropagation(),i.closeBillboard())},children:[r&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(U,{attachments:m,onClick:e.onClick}),(0,x.jsx)(V,{noteView:o,comment:r}),(0,x.jsx)($,{text:r.text,noteId:t}),(0,x.jsx)(Y.E,{annotationType:u.U.NOTE,attachments:g,children:(0,x.jsx)(K,{moreAttachmentsCount:v})})]}),a&&(0,x.jsxs)("div",{className:"nested-comment-preview",children:[(0,x.jsx)(V,{comment:a}),(0,x.jsx)($,{text:a.text,noteId:t})]}),b&&(0,x.jsx)("div",{className:"link link-more",children:f})]})}var Z=n(3795),ee=n(39905),te=n(12460),ne=n(83649),se=n(17829),ae=n(48270),oe=n(19389),ie=n(89459),re=n(81058),ce=n(38731),le=n(90087),de=n(90683);const{TAGS:he}=L.A.SHOWCASE;function ue(e){const{tag:t,tagType:n,capabilities:s}=e,a=(0,ce.B)(),o=(0,I.Y)(),i=(0,B.s)(),r=(0,le.L)(),c=a?o.t(he.EDIT_TAG_LABEL):void 0,d=a?"toggle-pencil":"dock",m=a?void 0:o.t(he.DOCK_TAG_LABEL),p=t.id,g=(0,de.a)(t.layerId),v=(0,j.S)(q.Et),b=(0,l.useCallback)((e=>{v&&(e.stopPropagation(),a&&n===u.U.OBJECT?(i.trackToolGuiEvent("object_tags","object_tags_billboard_edit_tag"),r.issueCommand(new re.y_(p))):(i.trackToolGuiEvent("tags",a?"tags_billboard_edit_tag":"tags_billboard_dock_tag"),v.dockAnnotation(p,t.layerId,n)))}),[a,n,i,r,p,v,t.layerId]);return n!==u.U.OBJECT||a?g||!s.share&&!s.dock?(0,x.jsx)("div",{}):(0,x.jsxs)("header",{className:h()("tag-billboard-header",{editable:a}),children:[!a&&s.share&&(0,x.jsx)(ie.k,{prefix:"tag",pin:t,id:t.id,darkTheme:!0,includeCameraView:!0,analyticAction:"tags_copy_share_link",buttonVariant:ae.A.TERTIARY}),s.dock&&(0,x.jsx)(oe.$,{icon:d,label:c,size:ae.M.SMALL,variant:ae.A.TERTIARY,theme:"dark",onClick:b,reverse:!0,tooltip:m,tooltipOptions:{placement:"bottom"}})]}):null}var me=n(11943),pe=n(98236),ge=n(29479);const ve=(0,pe.v_)(ge.j);var xe=n(40590);const be=(0,pe.v_)(xe.$);var fe=n(13767);const{ANNOTATIONS:Ee}=L.A.SHOWCASE;function Ce(e){let{onClick:t,previewId:n,previewType:s}=e;const a=new ee.r({links:!0}),o=(0,B.s)(),i=(0,ce.B)(),r=(0,j.S)(q.Et),d=(0,k.d)(),m=(0,te.G)(),p=ve(),g=be(),v=(0,I.Y)(),b=(0,ne.J)(),f=(0,l.useRef)(null),[E,C]=(0,l.useState)(!1),[T,A]=(0,l.useState)(null),[w,y]=(0,l.useState)({dock:!0,share:!0}),N=(0,c.i)(fe.GK,!0),S=(0,c.i)(fe.AM,!0),_=(0,de.a)(T?.layerId),O="true"===(0,c.i)(fe.$Q,!1),R=(0,l.useCallback)((e=>{o.trackToolGuiEvent("tags",e)}),[o]),L=(0,l.useCallback)(((e,n)=>{R("tags_billboard_click_attachment"),t(n)}),[t,R]),P=(0,l.useCallback)((e=>{e.stopPropagation(),_||(R(i?"tags_billboard_click_to_edit":"tags_billboard_click_to_dock"),t())}),[_,t,R,i]),D=(0,l.useCallback)((e=>{C(e)}),[]);(0,l.useEffect)((()=>(T&&f.current&&f.current.focus(),()=>{})),[T]),(0,l.useEffect)((()=>{if(m&&p)switch(s){case u.U.OBJECT:const e=g?.getObjectTag(n);if(!e)return;const t=e.mattertagId?p.getTag(e.mattertagId):void 0,a=e.toTagView(t);A({...a});break;case u.U.TAG:const o=p.getTag(n),i=m.getTagView(n);if(!o||!i)return void A(null);function r(){const e=d?.getCapabilities(n);return e&&y({...e}),e}A({...i});const c=r(),l=c?.onChanged(r),h=o.onChanged((()=>{const e=m.getTagView(n);e&&A({...e})}));return()=>{l?.cancel(),h.cancel()}}}),[d,p,g,n,s,m]);if(!T)return null;const{id:M,label:V,attachments:G,description:U,keywords:H}=T,W=(0,z.c9)(G),$=W.length>0,Q=(0,z.rg)(G),X=G.some((e=>e.mediaType===Z.zu.VIDEO)),ae=Math.max(Q.length-J.p8,0);ae>0&&(Q.length=J.p8);const oe=v.t(Ee.READ_MORE_MESSAGE),ie=(0,x.jsx)(se.P,{attachments:W,onClick:L}),re=V&&(0,x.jsx)("div",{className:"tag-billboard-title",children:V}),le=h()("annotation-preview-contents","tag-billboard",{"viewable-media":$,"has-video":X});return(0,x.jsxs)("div",{ref:f,role:"dialog",tabIndex:0,className:le,onClick:P,onKeyDown:e=>{"Escape"===e.code&&(e.stopPropagation(),r?.closeBillboard())},children:[(0,x.jsx)(ue,{tag:T,tagType:s,capabilities:{share:N&&w.share,dock:S&&w.dock}}),(0,x.jsxs)("div",{className:"tag-billboard-contents",children:[V?(()=>{const e=O?re:ie,t=O?ie:re;return(0,x.jsxs)(x.Fragment,{children:[e,t]})})():ie,U&&(0,x.jsx)("div",{className:"tag-billboard-description",children:(0,x.jsx)(F.$,{text:U,textParser:a,linkHandler:b,annotationType:u.U.TAG,annotationId:M,maxLength:100,maxLines:4,onTruncationChange:D})}),H&&(0,x.jsx)(me.B,{keywords:H,theme:"dark",className:"tag-previewer-keywords"}),Q.length>0&&(0,x.jsx)(Y.E,{annotationType:u.U.TAG,attachments:Q,children:(0,x.jsx)(K,{moreAttachmentsCount:ae})}),E&&(0,x.jsx)("div",{className:"annotation-read-more",children:(0,x.jsx)("span",{className:"link link-more",children:oe})})]})]})}const Te=(0,l.memo)((e=>{let{notesEnabled:t,openModal:n}=e;const s=(0,S.B)(),a=(0,B.s)(),o=(0,j.S)(q.Et),{billboardAnnotation:i,selectedAnnotation:r,dockedAnnotation:c}=(0,_.J)((0,k.d)())||{},d=i?.annotationType===u.U.TAG,p=i?.annotationType===u.U.OBJECT,g=t&&i?.annotationType===u.U.NOTE,v=(0,l.useCallback)((()=>{i&&o&&(a.trackGuiEvent(`annotations_dock_${i.annotationType}`),o.dockAnnotation(i.id,i.layerId,i.annotationType))}),[a,i,o]),b=(0,l.useCallback)((()=>{i&&o&&(a.trackGuiEvent(`annotations_select_${i.annotationType}`),o.selectAnnotation(i.id,i.layerId,i.annotationType))}),[a,i,o]),f=(0,l.useCallback)((e=>{if(i){a.trackGuiEvent(g?"click_note_preview":"tags_click_tag_billboard");const{id:t,annotationType:n}=i;e&&!c||p||v(),e&&s.broadcast(new m.z(n,t,e))}}),[i,a,c,p,g,v,s]),E=(0,l.useCallback)((()=>{if(i)if(r)o?.closeAnnotation(i.id,i.annotationType);else{g||c?v():b()}}),[i,v,c,g,b,r,o]);return n?null:(0,x.jsx)(N,{className:h()({"tag-preview":d||p,"note-preview":g}),onClick:E,children:d||p?(0,x.jsx)(Ce,{previewId:i.id,previewType:i.annotationType,onClick:f}):g?(0,x.jsx)(X,{previewId:i.id,onClick:f}):null},i?.id)}));var Ae,we,ye,Ne=n(72909),ke=n(71397),Se=n(22213),je=n(81088),_e=n(50178),Oe=n(85453),Re=n(28422),Le=n(77570);const{ATTACHMENTS:Ie}=L.A.SHOWCASE;let Pe=(Ae=Reflect.metadata("design:type",Function),we=Reflect.metadata("design:paramtypes",["undefined"==typeof Props?Object:Props]),(0,Ne.A)(ye=Ae(ye=we(ye=class extends l.Component{static contextType=(()=>Le.B)();bindings=[];attachmentsModule;constructor(e){super(e),this.state={open:!1,attachmentIndex:-1,attachments:[]}}componentDidMount(){const{messageBus:e}=this.context;this.bindings.push(e.subscribe(Oe.FA,this.onViewAttachments),e.subscribe(Oe.hd,this.onViewerClosed),e.subscribe(_e.rn,this.onModalToggled)),this.context.engine.getModuleBySymbol(q.qy).then((e=>{this.attachmentsModule=e}))}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.context.mainDiv.getRootNode().removeEventListener("keydown",this.onKey,{capture:!0})}onKey=async e=>{const{attachments:t,attachmentIndex:n}=this.state,s=t.length;let a=-1;switch(e.keyCode){case ke.D.ESCAPE:e.stopPropagation(),this.closeAttachmentViewer();break;case ke.D.LEFTARROW:e.stopPropagation(),a=n-1,a<0&&(a=s-1);break;case ke.D.RIGHTARROW:e.stopPropagation(),a=n+1,a>=s&&(a=0)}-1!==a&&this.setState({attachmentIndex:a})};closeAttachmentViewer=()=>{this.state.open&&this.attachmentsModule.toggleAttachmentViewer(!1)};onModalToggled=e=>{e.modal!==Se.a.ATTACHMENT||e.open||this.closeAttachmentViewer()};onViewerClosed=()=>{this.state.open&&(this.context.mainDiv.getRootNode().removeEventListener("keydown",this.onKey,{capture:!0}),this.context.commandBinder.issueCommand(new je.X6(Se.a.ATTACHMENT,!1)),this.setState({open:!1}))};getCurrentAttachmentId(){const{attachmentIndex:e,attachments:t}=this.state;return t[e]?.id||void 0}onNavigate=e=>{this.setState({attachmentIndex:e})};onViewAttachments=e=>{const{attachments:t,attachmentId:n}=e,s=n||this.getCurrentAttachmentId(),a=t.findIndex((e=>e.id===s));0===t.length||-1===a?this.closeAttachmentViewer():(this.state.open||(this.context.mainDiv.getRootNode().addEventListener("keydown",this.onKey,{capture:!0}),this.context.commandBinder.issueCommand(new je.X6(Se.a.ATTACHMENT,!0)),this.setState({open:!0})),this.setState({attachments:t,attachmentIndex:a}))};render(){const{open:e,attachments:t,attachmentIndex:n}=this.state,{locale:s}=this.context,a=s.t(Ie.CLOSE_TOOLTIP),o=s.t(Ie.VIEWER_INDEX_COUNT,{currentNumber:n+1,totalNumber:t.length});return(0,x.jsx)("div",{className:h()("overlay-layer","attachment-overlay",{open:e}),children:e&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{className:"overlay-top-bar",children:[(0,x.jsx)("div",{className:"overlay-label",children:o}),(0,x.jsx)(Re.J,{theme:"overlay",tooltip:a,onClose:this.closeAttachmentViewer})]}),(0,x.jsx)(G.g,{attachments:t,startIndex:n,onNavigate:this.onNavigate})]})})}})||ye)||ye)||ye);function De(e){let{parentTool:t}=e;const n=(0,c.i)(s.qE,!1),l=(0,c.i)(o.nH,!1),d=(0,c.i)(a.nc,!1),h=(0,r.t)(),u=l&&d;return!u&&!n||n&&t!==i.S0.TAGS||!n&&t!==i.S0.NOTES?null:(0,x.jsxs)("div",{className:"overlay-ui",children:[(0,x.jsx)(Pe,{}),(0,x.jsx)(Te,{notesEnabled:u,openModal:h})]})}},51005:(e,t,n)=>{n.d(t,{$:()=>v});var s=n(96540),a=n(17904),o=n(78063),i=n(50747),r=n(75742),c=n(67430),l=n(71687),d=n(40409),h=n(35404),u=n(80419),m=n(75162),p=n(44097),g=(n(72286),n(74848));function v(e){const{text:t,textParser:n,linkHandler:v,annotationType:x,annotationId:b,edited:f,maxLength:E,maxLines:C,readMore:T,attachments:A,onViewAttachment:w,onTruncationChange:y}=e,[N,k]=(0,s.useState)(!1),S=(0,a.S)(l.Et),j=(0,o.B)(),_=(0,i.F)().tryGetSetting(h.qu,!1);return(0,g.jsxs)("div",{className:"annotation-box",children:[(0,g.jsx)("div",{className:"annotation-text-box",children:(0,g.jsx)(p.A,{text:t,textParser:n,onClickAnchor:_?void 0:e=>{const t=e.target,n=t.dataset.blocktype;if(e.stopPropagation(),n){const s={blockType:n,text:t.innerText,value:t.dataset.value,id:t.dataset.id};if(n===r.n.LINK&&v&&s.value){e.preventDefault();const t=(0,c.A)(s.value),{url:n,modelId:a,pose:o}=t;a?v.handler.openLink({fullLink:n,modelId:a}):o?(v.handler.openLink({fullLink:n,pose:o}),S?.closeAnnotation(b,x)):(v.handler.openLink(n),j.broadcast(new u.Qn(n)))}j.broadcast(new d.v(x,b,s))}},clickableLinks:!_,onTextReplaced:e=>{const t=N;k(e),y&&t!==e&&y(e)},maxLength:E,maxLines:C,readonly:!0})}),f&&(0,g.jsx)("div",{className:"annotation-edited",children:"(edited)"}),T&&N&&(0,g.jsx)("div",{className:"annotation-read-more",children:(0,g.jsx)("span",{className:"link link-more",children:T})}),A&&!_&&(O=A,0===O.length?null:(0,g.jsx)(m.E,{attachments:O,onViewAttachment:w,annotationType:x}))]});var O}},38584:(e,t,n)=>{n.d(t,{o:()=>le});var s=n(96540),a=n(32485),o=n.n(a),i=n(3795),r=n(68375),c=n(28479),l=n(55285),d=n(56147),h=n(72909),u=n(77570),m=n(42390),p=n(9139),g=n(94448);var v=n(74848);class x extends s.Component{constructor(e){super(e)}render(){const{className:e,cover:t,data:n,onClick:s,style:a}=this.props,i=o()("oembed","oembed-text",e,{"oembed-text--cover":t}),r=n.provider_name?`${n.provider_name} content`:"Embedded content",c=n.author_name?`from ${n.author_name}`:"";return(0,v.jsxs)("div",{className:i,style:a,onClick:s,children:[n.title&&(0,v.jsx)("h3",{children:n.title}),(0,v.jsx)("p",{children:`${r} ${c}`})]})}}const b=["soundcloud","spotify"];class f extends s.Component{constructor(e){super(e)}getAttributes(){const{data:e}=this.props;let t=e.thumbnail_url,n=e.thumbnail_width,s=e.thumbnail_height;return(!t||!n||!s)&&e.type===m.n.PHOTO&&(t=e.url,n=e.width,s=e.height),{url:t,width:n,height:s}}render(){const{className:e,cover:t,data:n,disabled:s,maxHeight:a,maxWidth:i,onClick:r,style:c}=this.props,{url:l,width:d,height:h}=this.getAttributes();if(!l||!d||!h)return(0,v.jsx)(x,{...this.props});const u=function(e,t){return e<128||t<128}(d,h),p=!s&&function(e){const t=(e.provider_name||"").toLowerCase();return e.type===m.n.VIDEO?"giphy"!==t:!(e.type!==m.n.RICH||!b.includes(t))}(n),f=o()("oembed","oembed-thumbnail",e,{"oembed-thumbnail--cover":t,"oembed-thumbnail--cover--icon":t&&u}),E={...c,backgroundImage:`url('${l}')`};if(!t){const{width:e,height:t}=function(e,t,n,s){let a=e,o=t;if(n&&a>n){const e=n/a;a*=e,o&&(o*=e)}if(o&&s&&o>s){const e=s/o;a*=e,o*=e}return{width:a,height:o}}(d,h,i,a);E.width=`${e}px`,E.height=`${t}px`}return t&&u&&(E.maxWidth=1.5*d+"px"),(0,v.jsx)("div",{className:f,style:E,onClick:s?void 0:r,children:p&&(0,v.jsx)(g.K0,{className:"oembed-thumbnail__cta",iconClass:"icon-play-unicode",buttonStyle:g.zt.OVERLAY,buttonSize:g.Tp.LARGE})})}}var E=n(39869),C=n(19389),T=n(9241),A=n(48270);const{ATTACHMENTS:w}=d.A.SHOWCASE,y=e=>{let{id:t,className:n,onClick:a,url:i,cover:r,style:c,containerWidth:d,downloadUrl:h,onDownload:u}=e;const m=(0,E.Y)(),{height:p}=(0,l.lW)(),g=(0,s.useCallback)((e=>{a&&a(e,t)}),[a,t]),x=m.t(w.DOWNLOAD_TOOLTIP),b=o()({"image-cover":!!r},n),f=4/3,y=.8*p,N=Math.min(Math.round(d/f),y);return(0,v.jsxs)("div",{className:o()("oembed-image fill-cover-image",b),style:{...c,minHeight:N,maxWidth:d},onClick:a?g:void 0,children:[(0,v.jsx)("div",{className:"fill-blur",style:{backgroundImage:`url('${i}')`}}),(0,v.jsxs)("div",{className:"image-wrapper",children:[(0,v.jsx)("img",{className:o()("image",b),src:i,style:{maxHeight:Math.min(y,Math.round(d*f))},onClick:a?g:void 0}),(0,v.jsx)("div",{className:"image-actions",children:h?(0,v.jsx)(C.$,{icon:"download",theme:"overlay",tooltip:x,iconSize:T.l.SMALL,variant:A.A.TERTIARY,tooltipOptions:{size:"small"},onClick:e=>{window.open(h,"_self"),u?.(e)}}):null})]})]})};class N extends s.Component{constructor(e){super(e)}render(){const{className:e,cover:t,data:n,onClick:s,style:a,containerWidth:i}=this.props,r=o()("oembed","oembed-photo",e,{"oembed-photo--cover":t});return(0,v.jsx)(y,{url:n.url,style:a,onClick:s,className:r,containerWidth:i})}}var k=n(27200);function S(e){const{className:t,children:n}=e;if(!n)return null;const s=o()("oembed","oembed-loading",t);return(0,v.jsx)("div",{className:s,children:n})}var j=n(23716);const _={flickr:!0,instagram:!0},O=/^<iframe.*>.*<\/iframe>$/;function R(e){return O.test(e)}function L(e,t){let n;return n=R(e)?function(e){const t=document.createElement("div");t.innerHTML=e;const n=t.firstChild,s=n.style;return s.maxWidth="100%",s.maxHeight="100%",s.minWidth="",s.minHeight="",n}(e):function(e,t){const n=document.createElement("iframe");n.setAttribute("allow","encrypted-media; autoplay; fullscreen");let s="";return s=t&&t===j.K.Instagram?"\n      <style>\n        html, body { padding: 0; margin: 0; border: 0; }\n        img { display: block; max-width: 100%; height: auto; border: 0; }\n        iframe { display: block; max-width: 100%; border: 0; }\n      </style>\n    ":"\n      <style>\n        html, body { padding: 0; margin: 0; border: 0; }\n        img, iframe { display: block; max-width: 100%; height: auto; border: 0; }\n      </style>\n    ",n.srcdoc=`<!doctype html>${s.replace(/\s+/g," ")}${e}`,n}(e,t),n.src||(e=>void 0!==e&&!!_[e.toLowerCase()])(t)?n.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-presentation allow-popups-to-escape-sandbox"):n.setAttribute("sandbox","allow-same-origin"),n}var I=n(12103);function P(e){const{className:t,data:n,loadingComponent:a,onClick:i,style:r,onLoad:c}=e,[l,d]=(0,s.useState)(),[h,u]=(0,s.useState)(),[p,g]=(0,s.useState)(!0),[x,b]=(0,s.useState)(n.height);(0,s.useLayoutEffect)((()=>{const e=l;let t=null;if(e){for(;e.lastChild;)e.removeChild(e.lastChild);const s=L(n.html,n.provider_name);s.onload=()=>{c&&s&&c(s),g(!1)},e.appendChild(s),t=e=>{const t=(e=>{let t;try{t=JSON.parse(e.data)}catch(e){return}if("iframe.resize"!==t.context)return;const n=t.src.replace(/http(s?):\/\//,"//"),s=document.querySelector('iframe[src="'+n+'"]');return s?{iframe:s,height:t.height}:void 0})(e);t&&t.iframe===s&&b(t.height)},window.addEventListener("message",t)}return()=>{t&&window.removeEventListener("message",t)}}),[l,n.html,n.provider_name,c]);const f=(0,s.useCallback)((e=>{e&&(u(e.offsetWidth),d(e))}),[]),E=(0,s.useMemo)((()=>{if(!x||!h)return"30%";let e;if(n.provider_name?.toLowerCase()===j.K.Flickr)e=(n.height||n.thumbnail_height||220)/n.width;else{let t=x||n.height||n.thumbnail_height||220;n.type===m.n.VIDEO&&window.innerWidth>=I.K$&&(t*=1.3),e=t/h}return`${Math.max(30,100*e).toPrecision(4)}%`}),[x,h,n.height,n.width,n.thumbnail_height,n.provider_name,n.type]);return(0,v.jsxs)("div",{className:o()("oembed-iframe--wrapper",t),style:r,onClick:i,children:[(0,v.jsx)(S,{className:p?"":"is-loaded",children:a}),(0,v.jsx)("div",{className:o()("oembed-iframe__container",n.provider_name&&`oembed-iframe--src-${n.provider_name.replace(/\s/g,"-")}`,p&&"is-loading"),ref:f,style:{paddingBottom:E}})]})}var D=n(93607);const M=new p.Vy("oembed-video");class V extends s.Component{isUnmounting=!1;componentWillUnmount(){this.isUnmounting=!0}onIFrameLoad=async e=>{if(!this.isUnmounting)try{const t=await function(e){const t=new D.Player(e);return new Promise(((e,n)=>{t.on("ready",(()=>{e(t)}))}))}(e);if(this.isUnmounting)return;(0,k.Fr)()||t.play()}catch(e){M.warn("unable to autoplay video"),M.warn(e)}};render(){const{className:e,cover:t}=this.props;if(t)return(0,v.jsx)(f,{...this.props});const n=o()("oembed","oembed-video",e);return(0,v.jsx)(P,{...this.props,className:n,onLoad:this.onIFrameLoad})}}const G=e=>{const{className:t,cover:n}=e;if(n)return(0,v.jsx)(f,{...e});const s=o()("oembed","oembed-rich",t);return(0,v.jsx)(P,{...e,className:s})};function B(e){const{children:t,className:n}=e;if(!t)return null;const s=o()("oembed","oembed-error",n);return(0,v.jsx)("div",{className:s,children:t})}const U=new p.Vy("oembed-errors");class F extends s.Component{constructor(e){super(e),this.state={caughtError:void 0}}static getDerivedStateFromError(e){return{caughtError:e}}componentDidCatch(e){U.warn(e.message)}componentDidUpdate(e){e.data!==this.props.data&&this.setState({caughtError:void 0}),e.error!==this.props.error&&this.props.onError?.()}render(){const{className:e,cover:t,data:n,disabled:s,renderError:a,loadingComponent:o,maxHeight:i,maxWidth:r,onClick:c,style:l,thumbnail:d,error:h,containerWidth:u}=this.props,{caughtError:p}=this.state;if(a&&(h||p))return(0,v.jsx)(B,{className:e,children:a(h,p)});if(!n)return(0,v.jsx)(S,{className:e,children:o});const g={className:e,cover:t,maxHeight:i,maxWidth:r,onClick:c,style:l,containerWidth:u};return d?(0,v.jsx)(f,{data:n,disabled:s,...g}):n.type===m.n.PHOTO?(0,v.jsx)(N,{data:n,...g}):n.type===m.n.VIDEO?(0,v.jsx)(V,{data:n,loadingComponent:o,...g}):n.type===m.n.RICH?(0,v.jsx)(G,{data:n,loadingComponent:o,...g}):null}}var H=n(80855);const{ATTACHMENTS:W}=d.A.SHOWCASE,$={200:W.ERROR_200_MESSAGE,401:W.ERROR_401_MESSAGE,403:W.ERROR_403_MESSAGE,404:W.ERROR_404_MESSAGE,429:W.ERROR_429_MESSAGE},Y=e=>{let{error:t,compact:n,scriptError:a}=e;const[o,i]=(0,s.useState)(null),r=(0,E.Y)(),c=t?.status&&(e=>{const t=$[e];if(t)return t;switch(Math.floor(+e/100)){case 2:return W.ERROR_200_MESSAGE;case 4:return W.ERROR_4XX_MESSAGE;case 5:return W.ERROR_5XX_MESSAGE}})(t.status),l=a?a.message:r.t(c||W.FAILED_TO_LOAD_MESSAGE),d=(0,s.useCallback)((e=>{i(e)}),[]);return(0,v.jsx)("div",{className:"embed-error-container",ref:d,children:n?(0,v.jsx)(H.m,{title:l,target:o}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"icon icon-error"}),(0,v.jsx)("div",{className:"embed-error-message",children:l})]})})};var K,z,J,q=n(71687);let Q=(K=Reflect.metadata("design:type",Function),z=Reflect.metadata("design:paramtypes",["undefined"==typeof EmbeddedMediaProps?Object:EmbeddedMediaProps]),(0,h.A)(J=K(J=z(J=class extends s.Component{static contextType=(()=>u.B)();isUnmounting=!1;constructor(e){super(e),this.state={embed:null,error:void 0}}componentDidMount(){this.getEmbeddedMedia()}componentWillUnmount(){this.isUnmounting=!0}componentDidUpdate(e){this.props.attachment.id!==e.attachment.id&&this.getEmbeddedMedia()}async getEmbeddedMedia(){const{attachment:e}=this.props;let t,n=null;try{const t=await this.context.engine.getModuleBySymbol(q.qy);if(n=await t.loadEmbeddedAttachment(e),!n)throw new Error("embed not found")}catch(e){t=e}this.isUnmounting||this.setState({attachmentId:e.id,embed:n,error:t})}handleError=()=>{const{onError:e}=this.props;e&&e(this.props.attachment.parentId)};renderError=(e,t)=>{const{compact:n}=this.props;return(0,v.jsx)(Y,{error:e,scriptError:t,compact:n})};render(){const{compact:e,height:t,width:n,onClick:s,style:a,thumbnail:i,containerWidth:r}=this.props,{embed:c,error:l}=this.state,d=c&&this.state.attachmentId===this.props.attachment.id,h=(0,v.jsx)("div",{className:"gui-spinner-icon"}),u=!!n&&!!t,m=o()("embedded-media",{clickable:s&&!l});return(0,v.jsx)(F,{className:m,data:d?c??void 0:void 0,style:a,cover:u,loadingComponent:h,renderError:this.renderError,error:l,thumbnail:i,disabled:e,maxWidth:n,maxHeight:t,onClick:l?void 0:s,onError:this.handleError,containerWidth:r})}})||J)||J)||J);var X=n(3101),Z=n(94426),ee=n(6336),te=n(77098),ne=n(64391);const{ATTACHMENTS:se}=d.A.SHOWCASE,ae=new ne.f(void 0,null),oe=(0,s.memo)((e=>{let{attachment:t,style:n,thumbnail:a,inline:c,onClick:l,containerWidth:d}=e;(0,Z.J)(te.c.isObservable(t)?t:null);const h=(0,E.Y)(),u=(0,r.s)(),[m]=(0,ee.i)((0,X.rV)(t)&&t.url||ae),[p]=(0,ee.i)(a&&t.thumbnailUrl||ae),[g]=(0,ee.i)(t.downloadUrl||ae),x=(0,s.useRef)(null),b=e=>{e.stopPropagation(),u.trackGuiEvent("attachment_media_download_clicked",{data:t.mimeType})};if(t.category!==i._A.UPLOAD)return null;const f=o()("attachment-view",!!l&&"clickable"),C=c&&p||m;if(C)return(0,v.jsx)(y,{id:t.id,url:C,style:n,onClick:l,className:f,downloadUrl:c?void 0:g,containerWidth:d,onDownload:b});{const e=t.bytes?(0,X.X6)(t.bytes):"";return(0,v.jsxs)("div",{className:o()(f,"attachment-other",{inline:c}),onClick:l,style:n,children:[!c&&(0,v.jsx)("div",{className:"icon icon-paper-clip"}),(0,v.jsxs)("div",{className:"attachment-label",children:[(0,v.jsx)("div",{className:"file-label",children:t.filename}),e&&!c&&(0,v.jsx)("div",{className:"size-label",children:e})]}),!c&&g&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("a",{className:"link download-link",ref:x,href:g,download:!0,onClick:b,children:(0,v.jsx)("span",{className:"icon-download"})}),(0,v.jsx)(H.m,{target:x.current,title:h.t(se.DOWNLOAD_TOOLTIP)})]})]})}}));function ie(e){let{id:t,width:n,height:a,srcDoc:o,onLoad:i}=e;const r=new URLSearchParams(new URL(t,window.location.href).search).get("parent"),c=(0,s.useCallback)((function(e){i(e.currentTarget,r||"")}),[i,r]);return(0,v.jsx)("iframe",{style:{width:n?`${n}px`:"100%",height:a?`${a}px`:"100%",border:0},srcDoc:o,onLoad:c,referrerPolicy:"no-referrer",sandbox:"allow-scripts"},t)}var re=n(94799);const{ATTACHMENTS:ce}=d.A.SHOWCASE,le=e=>{let{attachment:t,onClick:n,inline:a,canDelete:d,hero:h,containerWidth:u,width:m,height:p,thumbnail:g,onError:x,onDelete:b}=e;const f=(0,E.Y)(),T=(0,r.s)(),[w,y]=(0,s.useState)(null),[N,k]=(0,l.Lh)(),S=(0,s.useMemo)((()=>f.t(ce.DELETE_ATTACHMENT_TOOLTIP)),[f]),j=(0,X.rV)(t),_=(0,c.L)(),O=(0,re.j)(q.qy),R={attachment:t,thumbnail:g,containerWidth:u||k.width||0,onClick:n?e=>{n&&n(e,t.id)}:void 0};return(0,v.jsxs)("div",{className:o()("attachment",`attachment-${t.category}`,{inline:!!a,hero:!!h,"non-viewable":!j}),ref:N,children:[t.category===i._A.UPLOAD?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"attachment-preview",ref:y,children:(0,v.jsx)(oe,{...R,inline:a})}),d&&t?.filename&&(0,v.jsx)(H.m,{target:w,title:t.filename})]}):t.category===i._A.EXTERNAL?(0,v.jsx)(Q,{...R,compact:a,width:m,height:p,onError:x}):de(t)?(0,v.jsx)(ie,{id:t.src,width:t.width,height:t.height,srcDoc:t.srcDoc,onLoad:t.onLoad}):(0,v.jsx)("div",{children:"Unknown Attachment Category"}),d&&(0,v.jsx)(C.$,{icon:"close",className:"attachment-delete",size:A.M.SMALL,variant:A.A.FAB,theme:"dark",tooltip:S,tooltipOptions:{placement:"bottom-start"},onClick:e=>{e.stopPropagation(),e.preventDefault(),d&&(T.trackGuiEvent("attachments_click_remove",{tool:_}),b?b(t):O.removeAttachment(t))}})]})};function de(e){return e.category===i._A.SANDBOX}},45598:(e,t,n)=>{n.d(t,{g:()=>g});var s=n(96540),a=n(32485),o=n.n(a),i=n(55285),r=n(40936),c=n(19389),l=n(28479),d=n(38584),h=n(94448),u=n(68375),m=n(97768),p=n(74848);const g=e=>{let{attachments:t,onClick:n,onNavigate:a,startIndex:c=0,onError:g}=e;const x=(0,u.s)(),[b,{width:f}]=(0,i.Lh)(),E=(0,m.w)(),{ref:C,height:T}=(0,r.A)({box:"border-box"}),[A,w]=(0,s.useState)(c),[y,N]=(0,s.useState)(),k=t.length,S=(0,l.L)();(0,s.useEffect)((()=>{c!==A&&w(c)}),[c,t]),(0,s.useEffect)((()=>{N(E?0:T)}),[T,E]);const j=(0,s.useCallback)((e=>{e.stopPropagation();const t=A+1<k?A+1:0;x.trackGuiEvent("attachments_viewer_next",{tool:S}),w(t),a&&a(t)}),[A,k,x,S,a]),_=(0,s.useCallback)((e=>{e.stopPropagation();const t=A>0?A-1:k-1;x.trackGuiEvent("attachments_viewer_prev",{tool:S}),w(t),a&&a(t)}),[A,k,x,S,a]),O=(0,s.useCallback)(((e,t)=>{e.stopPropagation();const n=t;x.trackGuiEvent("attachments_viewer_dot_clicked",{tool:S}),w(n),a&&a(n)}),[x,S,a]),R=t[A];if(!R)return null;const L=k>1;return(0,p.jsxs)("div",{className:"attachment-carousel",ref:b,children:[(0,p.jsx)("div",{className:"attachment-carousel-view",style:{height:y},children:(0,p.jsx)("div",{className:"attachment-container",ref:C,children:(0,p.jsx)(d.o,{attachment:R,onClick:n,thumbnail:!1,containerWidth:f||318,onError:g})})}),L&&(0,p.jsx)(h.K0,{className:o()("modal-nav","modal-prev"),iconClass:"icon-dpad-left",onClick:_}),L&&(0,p.jsx)(h.K0,{className:o()("modal-nav","modal-next"),iconClass:"icon-dpad-right",onClick:j}),L&&(0,p.jsx)("div",{className:"carousel-bullets",children:t.map(((e,t)=>(0,p.jsx)(v,{index:t,active:t===A,onSelect:O},t)))})]})};function v(e){let{index:t,active:n,onSelect:s}=e;return(0,p.jsx)(c.$,{icon:"simple-tag",onClick:e=>s(e,t),className:o()("carousel-bullet",{"carousel-bullet-active":n})})}},62727:(e,t,n)=>{n.d(t,{q:()=>h});var s=n(96540),a=n(32485),o=n.n(a),i=n(73566),r=n(78956),c=n(3617),l=n(16700),d=n(74848);function h(e){let{children:t,open:n,className:a,onClose:h,scrollingDisabled:u=!1,header:m,footer:p,resizeToContentMax:g,offsetContentByScrollbarWidth:v,ref:x}=e;const b=(0,s.useRef)(null),f=(0,s.useRef)(null),E=(0,r.O)(),C=(0,l.bt)("detail-panel");(0,s.useImperativeHandle)(x,(()=>({resetScrollTop:()=>{f.current&&f.current.resetScrollTop()},scrollToSelector:e=>{f.current&&f.current.scrollToSelector(e)}})),[f]);return(0,d.jsxs)("div",{className:o()("detail-panel",n&&"open",a,C,!m&&"detail-panel-sticky"),onKeyDown:function(e){h&&"Escape"===e.code&&(e.stopPropagation(),h())},ref:b,tabIndex:n?0:void 0,onTransitionEnd:e=>{b.current&&e.target===b.current&&n&&b.current.focus()},children:[m,(0,d.jsx)(c.H,{ref:f,hideThumb:E===i.L$.BOTTOM_PANEL,disabled:u,resizeToContentMax:g,offsetContentByScrollbarWidth:v,children:(0,d.jsx)(s.Suspense,{children:t})}),p]})}},66493:(e,t,n)=>{n.d(t,{r:()=>h});var s,a=n(96540),o=n(72909),i=n(48270),r=n(19389),c=n(71397),l=n(77570),d=n(74848);let h=(0,o.A)(s=class extends a.Component{static contextType=(()=>l.B)();componentDidMount(){this.context.mainDiv.getRootNode().addEventListener("keydown",this.onKey,{capture:!0})}componentWillUnmount(){this.context.mainDiv.getRootNode().removeEventListener("keydown",this.onKey,{capture:!0})}onKey=async e=>{if(this.props.disabled)return;switch(e.keyCode){case c.D.COMMA:this.onGotoPrev();break;case c.D.PERIOD:this.onGotoNext()}};onGotoNext=()=>{const e=this.getNextIndex();-1!==e&&this.props.onNavigate(e)};onGotoPrev=()=>{const e=this.getPrevIndex();-1!==e&&this.props.onNavigate(e)};getNextIndex(){const{total:e,index:t,wrapAround:n}=this.props;return t+1<e?t+1:n?0:-1}getPrevIndex(){const{total:e,index:t,wrapAround:n}=this.props;return t>0?t-1:n?e-1:-1}render(){const{total:e,index:t,disabled:n,overlay:s}=this.props;if(e<2||-1===t)return null;const a=s?"dark":"light",o=s?void 0:i.M.LARGE,c=`${t+1} of ${e}`;return(0,d.jsxs)("div",{className:"list-nav",children:[(0,d.jsx)(r.$,{icon:"dpad-left",variant:i.A.TERTIARY,size:o,disabled:n,theme:a,onClick:this.onGotoPrev}),(0,d.jsx)("span",{className:"list-nav-label",children:c}),(0,d.jsx)(r.$,{icon:"dpad-right",variant:i.A.TERTIARY,size:o,disabled:n,theme:a,onClick:this.onGotoNext})]})}})||s},44097:(e,t,n)=>{n.d(t,{A:()=>p});var s,a,o,i=n(96540),r=n(32485),c=n.n(r),l=n(72909),d=n(77570),h=n(71397),u=n(50178),m=n(74848);let p=(s=Reflect.metadata("design:type",Function),a=Reflect.metadata("design:paramtypes",["undefined"==typeof TextBoxProps?Object:TextBoxProps]),(0,l.F)(o=s(o=a(o=class extends i.Component{static contextType=(()=>d.B)();textElement=(()=>(0,i.createRef)())();editing=!1;isUnmounting=!1;toggleEditingTimeout;replaceTextContentTimeout;constructor(e){super(e)}componentDidMount(){this.replaceTextContent(this.props.text)}componentWillUnmount(){this.isUnmounting=!0,this.textElement.current&&this.textElement.current.blur()}componentDidUpdate(e){const{text:t,active:n}=this.props;t===e.text&&n===e.active||this.replaceTextContent(t)}shouldComponentUpdate(){return!1}getTextElement(){return this.textElement.current}getPlainText(){return this.textElement.current?.innerText||""}focus(){this.editing&&this.textElement.current&&this.textElement.current.focus()}toggleEditing(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];clearTimeout(this.toggleEditingTimeout),this.toggleEditingTimeout=window.setTimeout((()=>{this.textElement.current&&!this.isUnmounting&&(this.editing!==e&&(this.editing=e,this.textElement.current.contentEditable=e?"true":"false",e?this.textElement.current.classList.add("editing"):this.textElement.current.classList.remove("editing")),e&&t?this.textElement.current.focus():this.textElement.current.blur())}),0)}replaceTextContent(e){clearTimeout(this.replaceTextContentTimeout),this.replaceTextContentTimeout=window.setTimeout((()=>{if(!this.textElement.current||this.isUnmounting)return;for(;this.textElement.current.firstChild;)this.textElement.current.removeChild(this.textElement.current.firstChild);const t=document.createDocumentFragment(),{textParser:n,markers:s,onClickAnchor:a,active:o,readonly:i,maxLength:r,clickableLinks:c}=this.props,l=void 0!==c?c:!o,d=n.deserialize(e,l,a,s);let h=0,u=!d.every((e=>{const n=e.textContent?.length||0;if(i&&r&&h+n>r){if("#text"===e.nodeName){const n=e.textContent||"";e.textContent=n.substring(0,r-h),t.appendChild(e)}return!1}return!i&&o&&"A"===e.nodeName&&(e.contentEditable="true"),h+=n,t.appendChild(e),!0}));u&&t.appendChild(document.createTextNode("...")),this.textElement.current.appendChild(t),this.focus(),i&&!u&&this.props.maxLines&&this.textElement.current.scrollHeight>this.textElement.current.offsetHeight&&(u=!0,this.textElement.current.appendChild(document.createTextNode("..."))),this.props.onTextReplaced&&this.props.onTextReplaced(u)}),0)}stopPropagation=e=>e.stopPropagation();onPaste=e=>{if(!e.clipboardData||!this.textElement.current)return;let t=e.clipboardData.getData("text/plain");t=this.props.textParser.sanitizeText(t),e.preventDefault(),t&&document.execCommand("insertText",!1,t)};onKeyDown=e=>{if(!this.textElement.current)return;const{onKeyDown:t}=this.props;(e.which||e.keyCode)===h.D.RETURN&&(e.shiftKey||e.altKey)?document.execCommand("insertText",!1,"\n"):t&&t(e)};onMouseDown=e=>{const{onClick:t,clickToEdit:n,readonly:s}=this.props;t&&(e.stopPropagation(),t(e)),s||!this.editing&&n&&this.toggleEditing(!0)};onFocus=e=>{this.textElement.current&&(this.context.messageBus.broadcast(new u.Yl(this.textElement.current,!0)),this.props.onFocus&&this.props.onFocus(e))};onBlur=e=>{this.textElement.current&&(this.context.messageBus.broadcast(new u.Yl(this.textElement.current,!1)),this.props.onBlur&&this.props.onBlur(e))};render(){const{placeholder:e,tabIndex:t,onInput:n,readonly:s,maxLines:a,text:o}=this.props,i=s&&a,r=i?{WebkitLineClamp:a}:{},l=c()("text-box-text",{clamped:i,placeholder:!!e&&!o});return(0,m.jsx)("div",{ref:this.textElement,className:l,style:r,role:"textbox",draggable:!1,spellCheck:!0,contentEditable:!1,"data-placeholder":e,"aria-label":e,onMouseDown:this.onMouseDown,onKeyDown:s?void 0:this.onKeyDown,onKeyUp:s?void 0:this.stopPropagation,onFocus:s?void 0:this.onFocus,onBlur:s?void 0:this.onBlur,onInput:s?void 0:n,onPaste:s?void 0:this.onPaste,tabIndex:t})}})||o)||o)||o)},89459:(e,t,n)=>{n.d(t,{k:()=>T});var s=n(74328),a=n(68909),o=n(96540),i=n(32485),r=n.n(i),c=n(81609),l=n(56147),d=n(35404),h=n(28479),u=n(48270),m=n(19389),p=n(94165),g=n(68375),v=n(38731),x=n(93702),b=n(39869),f=n(50747),E=n(74848);function C(e){const{label:t,className:n,darkTheme:s,analyticAction:a,urlParams:i,buttonVariant:C,reverse:T}=e,A=(0,v.B)(),w=(0,b.Y)(),y=(0,f.F)(),N=(0,g.s)(),k=(0,x.K)(),[S,j]=(0,o.useState)(!1),_=A||y.tryGetSetting(d.wD,!1),O=(0,h.L)(),R=(0,o.useCallback)((e=>{e.stopPropagation()}),[]),L=(0,o.useCallback)((e=>{e.stopPropagation(),S||(!async function(e,t){const n=(await t.getModuleBySymbol(p.r)).creator.createDeepLink({additionalParams:e,paramFilter:e=>!["q","qK","qF","tag","note","comment","pin-pos","cloudEdit"].includes(e)});n.hash="",(0,c.l)(n.href)}(i,k),j(!0),N.trackGuiEvent(a,{tool:O}))}),[S,i,k,N,a,O]);(0,o.useEffect)((()=>{if(!S)return()=>{};const e=window.setTimeout((()=>j(!1)),2500);return()=>window.clearTimeout(e)}),[S]);let I=C||(!t?u.A.FAB:u.A.TERTIARY),P="share",D=t,M=t?void 0:w.t(l.A.COPY_LINK),V=!1;return S&&(I=u.A.TERTIARY,P=void 0,D=w.t(l.A.SHARE_COPIED),M=void 0,V=!0),_?(0,E.jsx)("div",{className:r()("url-link-copy",n,{"link-copied":S}),onClick:R,children:(0,E.jsx)(m.$,{icon:P,label:D,size:u.M.SMALL,variant:I,theme:s?"dark":"light",disabled:V,tooltip:M,tooltipOptions:{placement:"bottom"},onClick:L,reverse:T})}):null}function T(e){const{prefix:t,pin:n,id:o,...i}=e,{stemNormal:r,stemLength:c,anchorPosition:l}=n,d=s.s.encodeVector3((new a.Vector3).copy(r).setLength(c).add(l)),h={[`${t}`]:o,"pin-pos":d};return(0,E.jsx)(C,{urlParams:h,...i})}},11943:(e,t,n)=>{n.d(t,{B:()=>p});var s=n(96540),a=n(32485),o=n.n(a),i=n(9702),r=n(94547),c=n(73566),l=n(17084),d=n(90087),h=n(38731),u=n(74848);const m=2,p=e=>{let{keywords:t,className:n,maxVisible:a=m,theme:p}=e;const g=(0,d.L)(),v=(0,h.B)(),x=(0,s.useCallback)(((e,t)=>{let{text:n}=e;t.stopPropagation();const s=v?c.S0.LAYERS:c.S0.SEARCH;g.issueCommand(new l.yU(s,!0)),g.issueCommand(new r.Pb([n]))}),[g,v]);return(0,u.jsx)(i.c,{className:o()("tag-keywords",n),tokens:t.map((e=>({id:e,text:e}))),onTokenClick:x,maxVisibleTruncated:a,tokenSize:"small",tokenTheme:p})}},17829:(e,t,n)=>{n.d(t,{P:()=>m});var s=n(96540),a=n(32485),o=n.n(a),i=n(35404),r=n(45598),c=n(99104),l=n(97768),d=n(90087),h=n(5262),u=n(74848);const m=e=>{let{attachments:t,onClick:n}=e;const a=(0,d.L)(),m=(0,l.w)(),p=(0,h.i)(i.qu,!1);(0,s.useEffect)((()=>{t[0]?.parentId!==m&&a.issueCommand(new c.kd)}),[t,m,a]);const g=(0,s.useCallback)(((e,s)=>{0!==t.length&&(e.stopPropagation(),n(e,s))}),[t,n]),v=(0,s.useCallback)((e=>{1===t.length&&a.issueCommand(new c.kd(e))}),[t.length,a]);return p||0===t.length?null:(0,u.jsx)("div",{className:o()("tag-media",{"embed-error":!!m}),children:(0,u.jsx)(r.g,{attachments:t,onClick:g,onError:v})})}},49505:(e,t,n)=>{n.d(t,{T:()=>v});var s=n(96540),a=n(13893),o=n(95541),i=n(47613),r=n(99104),c=n(12460);var l=n(47271),d=n(66493),h=n(53137),u=n(38731),m=n(90087),p=n(68375),g=n(74848);function v(e){const{overlay:t,analyticAction:n}=e,v=(0,u.B)(),x=(0,p.s)(),b=(0,m.L)(),f=(0,o.H)(),E=function(e){const t=(0,c.G)(),[n,a]=(0,s.useState)((null==t?void 0:t.getOrderedTags(e))||[]);return(0,s.useEffect)((()=>{if(!t)return()=>{};function n(){t&&a(t.getOrderedTags(e))}const s=t.getOrderedTagViewMapFilter().onChanged(n);return n(),()=>s.cancel()}),[t,e]),n}(!0),C=(0,l.D)(),T=(0,i._)(),A=(0,c.G)(),[w,y]=(0,s.useState)(!1),N=v||!T?E:E.filter((e=>T.layerToggled(e.layerId)&&(!A||A.getCapabilities(e.id).focus)));if(!(C&&N.length>1))return null;const k=N.findIndex((e=>e.id===C?.id));if(-1===k)return null;const S=(0,g.jsx)(d.r,{index:k,total:N.length,disabled:w,overlay:t,wrapAround:!0,onNavigate:e=>{const t=N[e];if(!t)return;y(!0);const s=C?f?a.fl.Instant:a.fl.FadeToBlack:a.fl.Interpolate;x.trackToolGuiEvent("tags",n),b.issueCommand(new r.Ki(t.id,{transition:s})).then((()=>{y(!1)}))}});return t?(0,g.jsx)(h.L,{className:"tags-navigation-overlay",children:S}):S}},87870:(e,t,n)=>{n.d(t,{A:()=>H});var s=n(56147),a=n(73566),o=n(17084),i=n(78956),r=n(68419),c=n(75200),l=n(22213),d=n(16700),h=n(28422),u=n(48270),m=n(62727),p=n(32005),g=n(32485),v=n.n(g),x=n(51831),b=n(75162),f=n(51005),E=n(3101),C=n(71687),T=n(94799),A=n(5262),w=n(39905),y=n(35404),N=n(25727),k=n(89459),S=n(32408),j=n(11943),_=n(17829),O=n(47271),R=n(83649),L=n(46822),I=n(96540),P=n(13767);function D(e){const t=(0,L.d)(),[n,s]=(0,I.useState)(!0),a=(0,A.i)(P.GK,!0);return(0,I.useEffect)((()=>{if(!e)return()=>{};function n(e){const n=null==t?void 0:t.getCapabilities(e);return n&&s(n.share&&a),n}const o=n(e),i=null==o?void 0:o.onChanged((()=>n(e)));return()=>{null==i||i.cancel()}}),[t,a,e]),n}var M=n(74848);function V(e){let{hideShare:t}=e;const n=(0,T.j)(C.qy),s=(0,O.D)(),a=(0,R.J)(),o=(0,A.i)(y.qu,!1),i=(0,A.i)(P.Jr,!1),r=(0,d.bt)("tag-view-panel-header"),c=D(s?.id||null),l=(0,O.D)(),h=e=>{n.toggleAttachmentViewer(!0,I,e)};if(!l)return null;const{id:m,description:g,label:L,attachments:I,keywords:V,icon:G,color:B}=l,U=new w.r({links:!0}),F=(0,E.c9)(I),H=(0,E.rg)(I),W=F.length>0;return(0,M.jsxs)("div",{className:v()("tag-view-panel",{"viewable-media":W}),children:[W&&!o&&(0,M.jsx)(_.P,{attachments:F,onClick:(e,t)=>{h(t)}}),(0,M.jsxs)("div",{className:v()("tag-view-panel-header",{"no-media":o||!W},r),children:[(0,M.jsx)(p.E,{badgeStyle:{background:B},iconClass:`icon-${(0,S.RN)(N.yY.MATTERTAG,G,i)}`}),(0,M.jsxs)("div",{className:"tag-view-panel-header-contents",children:[(0,M.jsxs)("div",{className:"tag-view-panel-top",children:[L&&(0,M.jsx)("div",{className:"tag-view-panel-title",children:L}),!t&&(void 0===c||c)&&(0,M.jsx)(k.k,{prefix:"tag",pin:l,id:l.id,darkTheme:!1,includeCameraView:!0,analyticAction:"tags_copy_share_link",buttonVariant:u.A.TERTIARY},l.id)]}),V&&(0,M.jsx)(j.B,{className:"tag-view-panel-keywords",keywords:V,maxVisible:5}),(0,M.jsx)(f.$,{text:g,textParser:U,linkHandler:a,annotationType:x.U.TAG,annotationId:m,attachments:[],onViewAttachment:h})]})]}),H.length>0&&(0,M.jsxs)("div",{className:"tag-view-panel-attachments",children:[(0,M.jsx)("h4",{children:"Attachments"}),(0,M.jsx)(b.E,{annotationType:x.U.TAG,attachments:H})]})]})}var G=n(49505),B=n(90087),U=n(39869);const{TAGS:F}=s.A.SHOWCASE;function H(e){let{resizeToContentMax:t,hideShareInContent:n,offsetContentByScrollbarWidth:s}=e;const d=(0,i.O)(),h=(0,r.t)(),u=(0,B.L)(),p=(0,c.c)(),g=!(!p||p!==a.S0.SEARCH&&p!==a.S0.LAYERS),v=()=>{g?u.issueCommand(new o.kC).then((()=>{u.issueCommand(new o.oe(!1))})):u.issueCommand(new o.u3(a.S0.TAGS))},x=d===a.L$.BOTTOM_PANEL,b=h&&h!==l.a.CONFIRM,f=!x||!b,E=(0,M.jsx)(W,{closeTagsPanel:v,fromSearch:g}),C=n?(0,M.jsx)($,{}):null;return(0,M.jsx)(m.q,{className:"tags-panel",open:f,scrollingDisabled:!1,onClose:v,header:E,footer:C,resizeToContentMax:t,offsetContentByScrollbarWidth:s,children:(0,M.jsx)(V,{hideShare:!!n})})}function W(e){let{closeTagsPanel:t,fromSearch:n}=e;const s=(0,A.i)(P.rp,"1"),a=(0,U.Y)(),o=(0,c.c)(),i=(0,d.bt)("detail-panel-header"),r=o?"back":"close",l=a.t(n?F.NAV_BACK_LABEL:F.CLOSE_TAG_LABEL);return(0,M.jsxs)("div",{className:v()("detail-panel-header",i),children:[(0,M.jsx)(h.J,{icon:r,label:l,onClose:t}),s&&(0,M.jsx)(G.T,{analyticAction:"tags_navigate_in_panel"})]})}function $(){const e=(0,U.Y)(),t=(0,O.D)(),n=(0,d.bt)("tag-share-footer");return D(t?.id||null)&&t?(0,M.jsx)("div",{className:n,children:(0,M.jsx)(k.k,{prefix:"tag",pin:t,id:t.id,darkTheme:!1,includeCameraView:!0,analyticAction:"tags_copy_share_link",buttonVariant:u.A.TERTIARY,reverse:!0,label:e.t(s.A.COPY_LINK)},t.id)}):null}},94502:(e,t,n)=>{n.d(t,{a:()=>m});var s=n(73566),a=n(87870),o=n(67280),i=n(68419),r=n(48411),c=n(49505),l=n(13767),d=n(5262),h=n(74848);function u(){const e=(0,i.t)(),t=(0,r.T)(),n=(0,d.i)(l.rp,"1");return e||t||!n?null:(0,h.jsx)("div",{className:"overlay grid-overlay tags-overlay",children:(0,h.jsx)(c.T,{overlay:!0,analyticAction:"tags_navigate_in_canvas"})})}class m{constructor(){}renderPersistent=e=>{let{createFullViewOverlay:t}=e;return(0,h.jsx)(h.Fragment,{children:t((0,h.jsxs)("div",{children:[(0,h.jsx)(o.T,{parentTool:s.S0.TAGS}),(0,h.jsx)(u,{})]},"tags-panel-ui"))})};renderActive=e=>{let{createRightPanel:t}=e;return(0,h.jsx)(h.Fragment,{children:t((0,h.jsx)(a.A,{}))})}}},32005:(e,t,n)=>{n.d(t,{E:()=>r});var s=n(32485),a=n.n(s),o=n(16700),i=n(74848);const r=e=>{let{iconClass:t,label:n,badgeStyle:s,onClick:r,className:c,imageUrl:l,labelClass:d}=e;const h=(0,o.bt)("badge");return(0,i.jsxs)("span",{className:a()("badge",c,{clickable:!!r},h),onClick:r,style:s,children:[t&&(0,i.jsx)("span",{className:a()("icon","badge-icon",t)}),n&&(0,i.jsx)("span",{className:a()("badge-label",d),children:n}),l&&(0,i.jsx)("span",{className:"badge-img",children:(0,i.jsx)("img",{src:l,alt:"badge"})})]})}},9702:(e,t,n)=>{n.d(t,{c:()=>h});var s=n(96540),a=n(32485),o=n.n(a),i=n(19389),r=n(40104),c=n(9241),l=n(74848);function d(e){let{allowSelect:t,isSelected:n,isFocused:a,onClick:d,onFocus:h,onRemoveClick:u,className:m,size:p="standard",theme:g="light",ref:v,...x}=e;const b=(0,s.useRef)(null);(0,s.useImperativeHandle)(v,(()=>({focus:()=>{b.current?.focus()}})),[b]);const f=(0,s.useCallback)((()=>{u&&u(x)}),[u,x]),E=(0,s.useCallback)((e=>{b.current?.focus(),d&&d(x,e)}),[d,x]),C=(0,s.useCallback)((e=>{h&&h(x)}),[h,x]),T=void 0!==x.count;return(0,l.jsxs)("div",{className:o()("nova-token",`token-size-${p}`,`token-theme-${g}`,m,{"is-selected":n,"is-focused":a,"has-count":T,"can-select":t,"can-remove":!!u}),title:x.text,onClick:E,onFocus:C,tabIndex:0,ref:b,"data-token-id":x.id,children:[t&&n&&(0,l.jsx)(r.I,{size:c.l.SMALL,name:"checkmark"}),(0,l.jsx)("div",{className:"token-text",children:x.text}),T&&(0,l.jsx)("div",{className:"token-count",children:x.count}),!!u&&(0,l.jsx)(i.$,{onClick:f,icon:"close",size:"small"})]})}const h=e=>{let{tokens:t,className:n,allowSelect:a,maxVisibleTruncated:i,selectedTokenIds:r=[],onTokenClick:c,tokenSize:h,tokenTheme:u}=e;const[m,p]=(0,s.useState)(!1),g=(0,s.useCallback)(((e,t)=>{p(!m)}),[p,m]),v=!!i,x=(0,s.useMemo)((()=>v&&t.length-i),[t,i,v]),b=(0,s.useMemo)((()=>m?t:t.slice(0,i)),[t,i,m]);return b.length>0?(0,l.jsxs)("div",{className:o()("nova-token-list",n,{"is-viewing-all":m}),children:[b.map((e=>(0,s.createElement)(d,{...e,isSelected:e.isSelected||r.includes(e.id),key:e.id,onClick:c,allowSelect:a,size:h,theme:u}))),v&&t.length>i&&(0,l.jsx)(d,{className:"view-more-btn",onClick:g,size:h,theme:u,id:"_token_list_view_more_btn",text:m?`Hide ${x}...`:`View ${x} more...`})]}):null}},72286:()=>{},51831:(e,t,n)=>{var s;n.d(t,{U:()=>s}),function(e){e.NOTE="note",e.TAG="tag",e.OBJECT="object"}(s||(s={}))},46822:(e,t,n)=>{n.d(t,{d:()=>o});var s=n(98236),a=n(30926);const o=(0,s.v_)(a.o)},62834:(e,t,n)=>{n.d(t,{X:()=>o});var s=n(96540),a=n(46822);function o(){const e=(0,a.d)(),[t,n]=(0,s.useState)(e?e.dockedAnnotation:null);return(0,s.useEffect)((()=>{if(!e)return()=>{};function t(){n(e?e.dockedAnnotation:null)}const s=e.onChanged(t);return t(),()=>s.cancel()}),[e]),t}(0,n(38064).c)("dockedAnnotation",o)},40409:(e,t,n)=>{n.d(t,{v:()=>o,z:()=>a});var s=n(7478);class a extends s.QB{constructor(e,t,n){super(),this.annotationType=e,this.id=t,this.attachmentId=n}}class o extends s.QB{constructor(e,t,n){super(),this.block=n,this.id=t,this.annotationType=e}}},20835:(e,t,n)=>{n.d(t,{v:()=>i});var s=n(12625),a=n(88325),o=n(30740);class i extends s.B{constructor(){super(),this.name="attachments-data",this.pendingAttachments=(0,a.y)(),this.removedAttachments=(0,a.y)(),this.currentUploads=(0,a.y)(),this.failedUploads=(0,a.y)()}iteratePending(e){for(const t of this.pendingAttachments)e(t)}iterateRemoved(e){for(const t of this.removedAttachments)e(t)}get pendings(){return this.pendingAttachments}get removals(){return this.removedAttachments}getPendingAttachment(e){return this.pendingAttachments.get(e)}getRemovedAttachment(e){return this.removedAttachments.get(e)}addPending(e){this.pendingAttachments.set(e.id,e)}removePendingAttachment(e){this.pendingAttachments.has(e)&&this.pendingAttachments.delete(e)}clearPending(){this.pendingAttachments.clear()}getPendingAttachmentsForAsset(e,t){const n=[];return this.iteratePending((s=>{s.parentType===t&&s.parentId===e&&n.push(s)})),n}getRemovedAttachmentsForAsset(e,t){const n=[];return this.iterateRemoved((s=>{s.parentType===t&&s.parentId===e&&n.push(s)})),n}markAttachmentForDelete(e){const t=new o.o(e);this.removedAttachments.set(t.id,t)}clearRemovals(){this.removedAttachments.clear()}get uploads(){return this.currentUploads}addUpload(e){this.uploads.set(e.id,e)}updateUpload(e){this.uploads.has(e.id)&&this.uploads.set(e.id,e)}removeUpload(e){this.uploads.has(e)&&this.uploads.delete(e)}clearUploads(){this.uploads.clear()}get failures(){return this.failedUploads}addFailure(e){this.failures.set(e.id,e)}removeFailure(e){this.failures.has(e)&&this.failures.delete(e)}clearFailures(){this.failures.clear()}}},85453:(e,t,n)=>{n.d(t,{FA:()=>a,Uf:()=>r,Z4:()=>c,hd:()=>o,hg:()=>i});var s=n(7478);class a extends s.QB{constructor(e,t){super(),this.attachments=e,this.attachmentId=t}}class o extends s.QB{}class i extends s.QB{constructor(e){super(),this.upload=e}}class r extends s.QB{constructor(e){super(),this.upload=e}}class c extends s.QB{constructor(e,t,n,s){super(),this.attachment=e,this.status=t,this.parentId=n,this.parentType=s}}},56023:(e,t,n)=>{n.d(t,{D:()=>o});var s=n(90087),a=n(96540);function o(e,t){const n=(0,s.L)();return(0,a.useCallback)(((...s)=>{const a=t?Array.isArray(t)?t:t(...s):[];n.issueCommand(new e(...a))}),[e,t,n])}},94426:(e,t,n)=>{n.d(t,{J:()=>a});var s=n(96540);function a(e){const t=function(){const[,e]=(0,s.useState)(0);return(0,s.useCallback)((()=>{e((e=>e+1))}),[])}();return(0,s.useEffect)((()=>{if(t(),null!=e){const n=e.onChanged(t);return()=>{n.cancel()}}return()=>{}}),[e,t]),e}},67430:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(74328);function a(e){return e.get("m")||e.get("model")}function o(e){const t=-1!==e.indexOf("matterport.com/show"),n=-1!==e.indexOf(window.location.host+"/show");if(t||n){const t=new URL(e),n=s.s.deserialize(e)||void 0,o=a(t.searchParams),i=a(new URLSearchParams(window.location.search));return{url:e,pose:n,modelId:o&&o!==i?o:void 0}}return{url:e}}},89416:(e,t,n)=>{var s;n.d(t,{f:()=>s}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.OPEN="open",e.EDITING="editing"}(s||(s={}))},78450:(e,t,n)=>{n.d(t,{b:()=>d});var s=n(12625),a=n(88325),o=n(97994),i=n(24479),r=n(89416),c=n(3184),l=n(25727);class d extends s.B{constructor(e,t,n,s){super(),this.data=e,this.textParser=t,this.linkHandler=n,this.backgroundTexture=s,this.name="notes-view-data",this.noteViewsMap=(0,a.y)(),this.isNewNote=!1,this.openNoteViewObservable=(0,o.p)(null),this.focusedCommentObservable=(0,o.p)(null),this.activeNotationObservable=(0,o.p)(null),this.idVisibilityEnabled=!1,this.idVisibility=new Set,this.notesPhaseObservable=(0,o.p)(r.f.CLOSED),this.notesFilterObservable=(0,o.p)(c.S.OPEN),this.updateNoteViews=()=>{const e={};this.data.iterate((t=>{var n;const s=this.createNoteView(t);e[t.id]=s,(null===(n=this.openNoteView)||void 0===n?void 0:n.id)===s.id&&this.setOpenNoteView(s)})),this.noteViewsMap.replace(e)},this.sortByDate=(e,t)=>t.lastCommentMs-e.lastCommentMs,this.filterByResolved=e=>this.notesFilter===c.S.ALL||e.resolved===(this.notesFilter===c.S.RESOLVED),this.noteViews=new i.q(this.noteViewsMap),this.noteViews.priority=i.g.LOW,this.notesFilter!==c.S.ALL&&this.noteViews.setFilter(this.notesFilter,this.filterByResolved),this.noteViews.sort(this.sortByDate),this.updateNoteViews()}getFilteredNotesMap(){return this.noteViews}getNoteViewsMap(){return this.noteViewsMap}getNoteView(e){return this.noteViewsMap.get(e)}getTextParser(){return this.textParser}getLinkHandler(){return this.linkHandler}getComment(e,t){const n=this.getNoteView(e);return(null==n?void 0:n.comments.find((e=>e.id===t)))||null}getReply(e,t){const n=this.getNoteView(e);return(null==n?void 0:n.comments.find(((e,n)=>n>0&&e.id===t)))||null}getAttachment(e,t,n){var s;const a=(null===(s=this.getNoteView(e))||void 0===s?void 0:s.comments.find((e=>e.id===t)))||null;return(null==a?void 0:a.attachments.find((e=>e.id===n)))||null}createNoteView(e){return Object.assign(Object.assign({},e),{backgroundTexture:this.backgroundTexture,icon:l.tf[l.yY.NOTE]})}getCommentUserMentions(e,t){const n=[];return this.textParser.getUserMentions(e).forEach((e=>{const s=t[e];s&&n.push(s)})),n}getNoteAttachments(e){const t=[],n=this.getNoteView(e);return n&&n.comments.forEach((e=>{t.push(...e.attachments)})),t}getPendingNote(){return this.isNewNote&&this.openNoteView?this.openNoteView:null}setNotesPhase(e){this.notesPhaseObservable.value=e}get notesPhase(){return this.notesPhaseObservable.value}onNotesPhaseChanged(e){return this.notesPhaseObservable.onChanged(e)}setNotesFilter(e){const t=this.notesFilterObservable.value;this.notesFilterObservable.value=e,this.noteViews.atomic((()=>{this.noteViews.clearFilter(t),e!==c.S.ALL&&this.noteViews.setFilter(e,this.filterByResolved)}))}get notesFilter(){return this.notesFilterObservable.value}onNotesFilterChanged(e){return this.notesFilterObservable.onChanged(e)}setActiveNotation(e){this.activeNotationObservable.value=e}get activeNotation(){return this.activeNotationObservable.value}onActiveNotationChanged(e){return this.activeNotationObservable.onChanged(e)}setOpenNoteView(e){this.openNoteViewObservable.value=e}get openNoteView(){return this.openNoteViewObservable.value}onOpenNoteViewChanged(e){return this.openNoteViewObservable.onChanged(e)}resetOpenNoteView(){const e=this.openNoteView;if(e){const t=this.data.getNoteProperties(e.id);t&&this.updateOpenNoteView(t)}}updateOpenNoteView(e){const t=this.openNoteView;t&&Object.assign(t,e)}setFocusedComment(e){this.focusedCommentObservable.value=e}get focusedComment(){return this.focusedCommentObservable.value}onFocusedCommentChanged(e){return this.focusedCommentObservable.onChanged(e)}}},3184:(e,t,n)=>{var s,a;n.d(t,{D:()=>a,S:()=>s}),function(e){e.OPEN="open",e.RESOLVED="resolved",e.ALL="all"}(s||(s={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(a||(a={}))},80700:(e,t,n)=>{n.d(t,{e:()=>i});var s=n(96540),a=n(93388);function o(e,t){return t&&e&&e.focusedComment?e.getReply(t,e.focusedComment.id):null}function i(e){const t=(0,a.Y)(),[n,i]=(0,s.useState)(o(t,e));return(0,s.useEffect)((()=>{if(!t)return()=>{};const n=t.onFocusedCommentChanged((function(){i(o(t,e))}));return()=>n.cancel()}),[t,e]),n}},80411:(e,t,n)=>{n.d(t,{Z:()=>o});var s=n(96540),a=n(93388);function o(e){const t=(0,a.Y)(),[n,o]=(0,s.useState)((null==t?void 0:t.getNoteView(e))||null);return(0,s.useEffect)((()=>{if(!t)return()=>{};const n=t.getNoteViewsMap().onChanged((function(){t&&o(t.getNoteView(e))}));return()=>n.cancel()}),[t,e]),n}},24865:(e,t,n)=>{n.d(t,{b:()=>o});var s=n(96540),a=n(93388);function o(){const e=(0,a.Y)();return(0,s.useMemo)((()=>function(e){return e?e.getLinkHandler():null}(e)),[e])}},29397:(e,t,n)=>{n.d(t,{V:()=>o});var s=n(96540),a=n(93388);function o(){const e=(0,a.Y)();return(0,s.useMemo)((()=>function(e){return e?e.getTextParser():null}(e)),[e])}},93388:(e,t,n)=>{n.d(t,{Y:()=>o});var s=n(98236),a=n(78450);const o=(0,s.v_)(a.b)},40590:(e,t,n)=>{n.d(t,{$:()=>o});var s=n(12625),a=n(88325);class o extends s.B{constructor(){super(),this.name="object-tags",this.suggestions=(0,a.y)()}get collection(){return this.suggestions}iterate(e){for(const t of this.suggestions)e(t)}getObjectTag(e){return this.suggestions.get(e)}getObjectTagIds(){return this.suggestions.keys}updateObjectTag(e){this.suggestions.set(e.id,e)}removeObjectTag(e){return this.suggestions.delete(e)}}},81058:(e,t,n)=>{n.d(t,{HZ:()=>o,R5:()=>d,_8:()=>r,lA:()=>i,lg:()=>l,vX:()=>a,y_:()=>h,ye:()=>c});var s=n(11165);class a extends s.u{constructor(e){super(),this.payload={enabled:e}}}a.id="OBJECTS_ANNOTATIONS_ENABLED";class o extends s.u{constructor(e){super(),this.payload={ids:e}}}o.id="FILTER_TAG_SUGGESTION";class i extends s.u{constructor(e){super(),this.payload={id:e}}}i.id="NAVIGATE_TO_TAG_SUGGESTION";class r extends s.u{constructor(e,t){super(),this.payload={id:e,enabled:t}}}r.id="TOGGLE_OBJECT_ENABLED";class c extends s.u{constructor(e,...t){super(),this.payload={ids:t,enabled:e}}}c.id="TOGGLE_OBJECT_TAG_ENABLED";class l extends s.u{constructor(...e){super(),this.payload={ids:e}}}l.id="DISMISS_OBJECT_TAG";class d extends s.u{constructor(e,t,n,s){super(),this.payload={id:e,options:t,pendingAttachments:n,embed:s}}}d.id="CREATE_OBJECT_TAG";class h extends s.u{constructor(e){super(),this.payload={id:e}}}h.id="DOCK_OBJECT_TAG"},74453:(e,t,n)=>{n.d(t,{S:()=>o});var s=n(96540),a=n(93216);function o(){const e=(0,a.d)(),[t,n]=(0,s.useState)((null==e?void 0:e.screenPosition)||null);return(0,s.useEffect)((()=>{if(!e)return()=>{};const t=e.onScreenPositionChanged(n);return n(e.screenPosition),()=>t.cancel()}),[e]),t}},93216:(e,t,n)=>{n.d(t,{d:()=>o});var s=n(98236),a=n(11416);const o=(0,s.v_)(a.U)},32408:(e,t,n)=>{n.d(t,{RN:()=>d,hs:()=>u,m1:()=>h,nK:()=>l,zX:()=>m});var s=n(68909),a=n(28511),o=n(25727),i=n(13893),r=n(74328),c=n(86224);function l(e,t){switch(t){case o.ob.DEFAULT:return e.baseColor;case o.ob.DIMMED:return e.dimmedColor;case o.ob.HIGHLIGHTED:return e.hoverColor}}function d(e,t,n){const s=n?t:void 0;return s&&a.J[s]?s:o.tf[e]}function h(e){return e===o.yY.OBJECT?0:c.A.pinHeadMesh.strokeWidth}function u(e){if("comment-large"===e)return{x:0,y:5}}const m=async(e,t,n)=>{const a=(new s.Vector3).copy(t.stemNormal).setLength(t.stemLength).add(t.anchorPosition),o=r.s.decodeVector3(e.getOverrideParam("pin-pos",r.s.encodeVector3(a)));n(o&&o.distanceTo(a)>.1||null===r.s.deserialize()?i.fl.FadeToBlack:null)}},94547:(e,t,n)=>{n.d(t,{$M:()=>i,Oc:()=>h,Pb:()=>o,Xx:()=>d,_d:()=>c,_w:()=>l,tA:()=>a,tf:()=>u,xg:()=>r});var s=n(11165);class a extends s.u{constructor(e){super(),this.payload={query:e}}}a.id="UPDATE_SEARCH_QUERY";class o extends s.u{constructor(e){super(),this.payload={keywords:e}}}o.id="UPDATE_SEARCH_QUERY_KEYWORDS";class i extends s.u{constructor(e){super(),this.payload={keywordId:e}}}i.id="TOGGLE_SEARCH_QUERY_KEYWORD";class r extends s.u{constructor(e){super(),this.payload={grouping:e}}}r.id="CHANGE_SEARCH_GROUPING";class c extends s.u{constructor(){super()}}c.id="SEARCH_FILTER_CLEAR";class l extends s.u{constructor(e,t){super(),this.payload={groupId:e,enabled:t}}}l.id="SEARCH_FILTER_TOGGLE";class d extends s.u{constructor(e,t){super(),this.payload={id:e,typeId:t}}}d.id="SELECT_SEARCH_RESULT";class h extends s.u{constructor(e){super(),this.payload=e}}h.id="SEARCH_GROUP_REGISTER";class u extends s.u{constructor(e){super(),this.payload={id:e}}}u.id="SEARCH_GROUP_DEREGISTER"},21693:(e,t,n)=>{n.d(t,{P:()=>a});var s=n(56147);const a={id:n(73566).S0.TAGS,namePhraseKey:s.A.TOOLS.TAGS,deepLinkParam:"tag",panel:!0,icon:"icon-toolbar-mattertags",analytic:"tags",dimmed:!1,enabled:!0,hidesAppBar:!0}},73554:(e,t,n)=>{n.d(t,{l:()=>l});var s=n(99104),a=n(93821),o=n(56147),i=n(32408),r=n(95439);const{TAGS:c}=o.A.SHOWCASE;class l{constructor(e,t){this.engine=e,this.settings=t}async activate(){await this.engine.commandBinder.issueCommand(new s.NR(!0))}async deactivate(){await this.engine.commandBinder.issueCommand(new s.NR(!1))}async deepLink(e){const t=(await this.engine.market.waitForData(a.r)).getTagView(e);if(t)(0,i.zX)(this.settings,t,(t=>{this.engine.commandBinder.issueCommand(new s.Ki(e,{transition:t,dock:!0}))}));else{const e={messagePhraseKey:c.MISSING_MESSAGE,timeout:4e3,dismissesOnAction:!0};this.engine.commandBinder.issueCommand(new r.Q(e))}}}},97768:(e,t,n)=>{n.d(t,{w:()=>o});var s=n(87805),a=n(93821);const o=(0,s.u)(a.r,"embedErrorTagId",void 0)},47271:(e,t,n)=>{n.d(t,{D:()=>o});var s=n(96540),a=n(12460);function o(){const e=(0,a.G)(),[t,n]=(0,s.useState)(e?e.openTagView:null);return(0,s.useEffect)((()=>{if(!e)return()=>{};const t=e.onOpenTagViewChanged(n);return n(e.openTagView),()=>t.cancel()}),[e]),t}},83649:(e,t,n)=>{n.d(t,{J:()=>i});var s=n(96540),a=n(12460);function o(e){return e?e.getLinkHandler():null}function i(){const e=(0,a.G)(),[t,n]=(0,s.useState)(o(e));return(0,s.useEffect)((()=>(t||n(o(e)),()=>{})),[t,e]),t}},12460:(e,t,n)=>{n.d(t,{G:()=>o});var s=n(98236),a=n(93821);const o=(0,s.v_)(a.r)},75200:(e,t,n)=>{n.d(t,{c:()=>o});var s=n(87805),a=n(96319);const o=(0,s.u)(a.M,"previousToolName",null)},54616:(e,t,n)=>{n.d(t,{P:()=>o});var s=n(77570),a=n(96540);const o=()=>(0,a.useContext)(s.B).userData}}]);