/*! For license information please see compare.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[8044],{65963:(e,t,i)=>{i.r(t),i.d(t,{default:()=>bt});var a=i(65945),s=i(64882),o=i(90082),r=i(71687),n=i(11180),l=i(88581),c=i(96540),d=i(21728),h=i(68375),u=i(66806),w=i(90087),p=i(25245),m=i(32485),v=i.n(m),g=i(74848);function f(e){let{children:t,className:i,ref:a,...s}=e;const o=v()("dropdown-menu-content",i);return(0,g.jsx)(p.dc,{children:(0,g.jsx)(p.UC,{className:o,...s,ref:a,children:t})})}function M(e){let{children:t,className:i,ref:a,...s}=e;const o=v()("dropdown-menu-radio-group",i);return(0,g.jsx)(p.z6,{className:o,ref:a,...s,children:t})}function y(e){let{children:t,className:i,ref:a,...s}=e;const o=v()("dropdown-menu-radio-item",i);return(0,g.jsxs)(p.hN,{className:o,ref:a,...s,children:[(0,g.jsx)(p.VF,{className:"dropdown-menu-radio-item-indicator",children:(0,g.jsx)("svg",{width:"10",height:"11",viewBox:"0 0 10 11",children:(0,g.jsx)("circle",{cx:"5",cy:"5.5",r:"2",fill:"currentColor"})})}),t]})}var V=i(57726),x=i.n(V),b=i(40104);function S(e){let{onValueChange:t,items:i,Render:a,value:s,ariaLabel:o,className:r,Selected:n,Prompt:l,matchPopupWidthToTrigger:d=!1,selectedIsTrigger:h=!0,RadioItem:u=y,disabled:w}=e;const[m,v]=(0,c.useState)(!1),V=(0,c.useMemo)((()=>{if(!s)return l?(0,g.jsx)(l,{}):null;const{key:e,...t}=s;return n?(0,g.jsx)(n,{...t}):(0,g.jsx)(a,{...t})}),[n,l,a,s]),S=x()("aura-select-menu-content",{"aura-select-menu-content-match-width":d});return(0,g.jsx)("div",{className:"aura-select",children:(0,g.jsxs)(g.Fragment,{children:[!h&&V,(0,g.jsxs)(p.bL,{open:m,onOpenChange:v,children:[(0,g.jsx)(p.l9,{asChild:!0,disabled:w,children:(0,g.jsxs)("div",{"aria-label":o,className:x()("aura-select-trigger",r),children:[h&&V,(0,g.jsx)(b.I,{name:"dpad-down"})]})}),(0,g.jsx)(f,{className:S,side:"top",align:h?"start":"end",children:(0,g.jsx)(M,{value:s?.key?.toString(),children:i.map((e=>{const{key:i,...s}=e;return(0,g.jsx)(u,{onSelect:()=>t(e),value:e.key.toString(),children:(0,g.jsx)(a,{...s})},e.key)}))})})]})]})})}var j=i(9241),E=i(56147),C=i(39869),N=i(46793),D=i(9139),R=i(94609);const T={key:u.N.Dollhouse,value:{analytics:d.r.Dollhouse,icon:"dollhouse",phraseKey:E.A.COMPARE.VIEW_MODE.VIEW_DOLLHOUSE}},I=[{key:u.N.Panorama,value:{analytics:d.r.Inside,icon:"panorama",phraseKey:E.A.COMPARE.VIEW_MODE.VIEW_INSIDE}},T,{key:u.N.Floorplan,value:{analytics:d.r.Floorplan,icon:"floorplan",phraseKey:E.A.COMPARE.VIEW_MODE.VIEW_FLOORPLAN}}],_=new Map(I.map((e=>[e.key,e])));function O(){const e=(0,n.x)(),t=function(){const e=(0,l.o)(),t=(0,R.I)(),[i,a]=(0,c.useState)(null);return(0,c.useEffect)((()=>{if(!e)return()=>{};const i=e=>{e!==u.N.Transition&&(e===u.N.Dollhouse&&t<.5?a(u.N.Floorplan):a(e))},s=e.currentModeObservable.onChanged(i);return i(e.currentMode),()=>s.cancel()}),[e,t]),i}(),i=t&&_.get(t)||T,a=e===u.N.Transition,s=(0,h.s)(),o=(0,w.L)(),r=(0,c.useCallback)((async e=>{if(!a){s.trackGuiEvent(e.value.analytics);try{await o.issueCommand(new N.S2((0,N.gB)(e.key)))}catch(e){D.Vy.for(this).warn(e)}}}),[s,o,a]);return(0,g.jsx)(S,{value:i,onValueChange:r,items:I,Render:k,className:"view-mode-select"})}function k(e){let{value:t}=e;const{icon:i,phraseKey:a}=t,s=(0,C.Y)().t(a);return(0,g.jsxs)("div",{className:"view-mode-label",children:[(0,g.jsx)(b.I,{name:i,size:j.l.MEDIUM}),(0,g.jsx)("span",{children:s})]})}var L=i(19389);function P(e){let{tooltipOptions:t,children:i,style:a={},color:s,...o}=e;return t||(t={}),t.arrow=!1,a["--color-override"]=s,(0,g.jsxs)(L.$,{className:"aura-primary-button",iconSize:j.l.SMALL,appendChildren:!1,tooltipOptions:t,style:a,...o,children:[i,(0,g.jsx)("div",{className:"aura-primary-button-drop-shadow"})]})}function A(){return(0,g.jsx)("span",{className:"gizmo-divider"})}var F=i(98236),U=i(87805),B=i(19592),z=i(36489);const G=()=>(0,F.Bt)(z.n);var W,Y;!function(e){e.DISABLED="disabled",e.SINGLE_VIEW="single_view",e.SPLIT_VIEW="split_view",e.SLIDER_VIEW="slider_view"}(W||(W={})),function(e){e.LOCKED="locked",e.UNLOCKED="unlocked"}(Y||(Y={}));var K=i(17084);function H(e){return Q(e,(0,c.useCallback)((e=>{var t;return null!==(t=null==e?void 0:e.values)&&void 0!==t?t:[]}),[]))}function Q(e,t){const[i,a]=(0,c.useState)(t(e));return(0,c.useEffect)((()=>{if(e){const i=()=>{a(t(e))},s=e.onChanged(i);return i(),()=>s.cancel()}return()=>{}}),[e,t]),i}var Z=i(48411),$=i(76853);const X=new D.Vy("ToolSelect");function q(e){let{tools:t}=e;const i=(0,h.s)(),a=(0,w.L)(),s=(0,Z.T)(),o=(0,$.v)(),[r,n]=(0,c.useState)(s||t[0]);null!==s&&s!==r&&-1!==t.indexOf(s)&&n(s);const l=(0,c.useCallback)((e=>e?t.filter((t=>e.has(t))).map((t=>({key:t,value:e.get(t)}))):[]),[t]),d=Q(o.toolsMap,l),u=(0,c.useMemo)((()=>r?{key:r,value:o.getTool(r)}:null),[r,o]),p=(0,c.useCallback)((async e=>{i.trackGuiEvent(e.value.analytic);try{await a.issueCommand(new K.yU(e.value.id,!0))}catch(e){X.warn(e)}}),[i,a]);return(0,g.jsx)(S,{value:u,onValueChange:p,items:d,Render:ee,className:"tool-select",Selected:te,selectedIsTrigger:!1})}function J(e){const{tool:t,active:i,onClick:a,className:s,...o}=e,r=(0,C.Y)().t(t.namePhraseKey),n=(0,c.useMemo)((()=>t.icon.replace("icon-","")),[t]),l=v()("tool-label",i?"tool-label-selected":null,s);return(0,g.jsxs)("div",{className:l,onClick:a,...o,children:[(0,g.jsx)(b.I,{name:n,size:j.l.MEDIUM}),(0,g.jsx)("span",{children:r})]})}function ee(e){let{value:t}=e;return(0,g.jsx)(J,{tool:t})}function te(e){let{value:t}=e;const i=(0,h.s)(),a=(0,Z.T)(),s=(0,w.L)(),o=t.id===a,r=(0,c.useCallback)((e=>{i.trackGuiEvent(t.analytic),s.issueCommand(new K.yU(t.id,!o)).catch((e=>{X.warn(e)})),e.stopPropagation()}),[t,o,i,s]);return(0,g.jsx)(J,{tool:t,active:o,onClick:r,className:"tool-trigger"})}var ie=i(73566),ae=i(17904),se=i(47613);function oe(e){let{onValueChange:t,items:i,Render:a,RenderGroupHeader:s,ariaLabel:o,className:r,Prompt:n,selectedIsTrigger:l=!0}=e;const[d,h]=(0,c.useState)(!1),u=(0,c.useMemo)((()=>n?(0,g.jsx)(n,{}):null),[n]);return(0,g.jsx)("div",{className:"aura-select",children:(0,g.jsxs)(g.Fragment,{children:[!l&&u,(0,g.jsxs)(p.bL,{open:d,onOpenChange:h,children:[(0,g.jsx)(p.l9,{asChild:!0,children:(0,g.jsxs)("div",{"aria-label":o,className:x()("aura-select-trigger",r),children:[l&&u,(0,g.jsx)(b.I,{name:"dpad-down"})]})}),(0,g.jsx)(f,{className:"aura-select-menu-content",side:"top",align:l?"start":"end",children:Array.from(i.entries()).map((e=>{let[i,o]=e;const{key:r,...n}=i;return(0,g.jsxs)("div",{children:[(0,g.jsx)(s,{...n}),(0,g.jsx)(M,{value:i.selected,children:o.map((e=>{const{key:i,...s}=e;return(0,g.jsx)(y,{onSelect:()=>t(e),value:e.key.toString(),children:(0,g.jsx)(a,{...s})},i)}))})]},r)}))})]})]})})}var re=i(39188);var ne=i(93900);function le(){const e=(0,h.s)(),t=(0,ae.S)(r.QW),i=(0,c.useCallback)((async i=>{e.trackGuiEvent("click_floor_select_button"),await(t?.moveToFloor(i.value.id,{viewportId:i.value.viewportId}))}),[e,t]),a=function(){const e=function(){const e=(0,ae.S)(r.Qm);return e?e.viewportManager.viewports.values:[]}(),t=(0,ae.S)(r.QW),i=H(t?.currentFloors),a=(0,se._)(),s=function(){const e=(0,re.m)();return(0,n.x)()!==u.N.Panorama&&e}(),o=(0,C.Y)(),l=(0,ne.Y)(),c=new Map;if(!t||!a)return null;const d=a.getCurrentView();for(const a of e){const e=t.getViewDataForViewport(a.id),r=e?.sourceViewId||"",n=i.find((e=>e&&e.sourceViewIds.has(r))),h=d.connections.find((e=>e.model.id===r)),u={header:h?h.model.name:r,key:r,selected:n?.id||"all"},w=l.filter((e=>e.sourceViewIds.has(r))).map((e=>({key:e.id,value:{...e,viewportId:a.id}})));s&&w.unshift({key:"all",value:{id:"",index:-1,name:o.t(E.A.FLOOR_ALL),sourceViewIds:new Set([r]),viewportId:a.id}}),c.set(u,w)}return c}();return a?(0,g.jsx)(oe,{Render:de,RenderGroupHeader:ce,items:a,onValueChange:i,Prompt:he}):null}function ce(e){let{header:t}=e;return(0,g.jsx)("div",{className:"floor-model-header",children:t})}function de(e){let{value:t}=e;return(0,g.jsx)("div",{className:"floor-label",children:(0,g.jsx)("span",{children:t.name})})}function he(){const e=(0,C.Y)().t(E.A.COMPARE.FLOORS.FLOOR_SELECT);return(0,g.jsxs)("div",{className:"floor-label",children:[(0,g.jsx)(b.I,{name:"floor-controls-all",size:j.l.MEDIUM}),(0,g.jsx)("span",{children:e})]})}var ue=i(4106);const we=[ie.S0.MEASUREMENTS,ie.S0.NOTES];function pe(){const e=G(),t=(0,U.Z)(z.n,"cameraMode","unlocked"),{_:i}=(0,ue.uB)(),a=(0,U.Z)(z.n,"viewMode","split_view"),s=i({id:"pKVaQn",message:"Link Models"}),o=i({id:"83zYpc",message:"Unlink Models"}),r=i({id:"fyeU1x",message:"Slider View"}),n=i({id:"wj0rNw",message:"Split View"}),l=(0,c.useCallback)((()=>{e&&(e.cameraMode=Y.LOCKED,e.commit())}),[e]),d=(0,c.useCallback)((()=>{e&&(e.cameraMode=Y.UNLOCKED,e.commit())}),[e]),h=(0,c.useCallback)((()=>{e&&(e.viewMode=W.SPLIT_VIEW,e.commit())}),[e]),u=(0,c.useCallback)((()=>{e&&(e.viewMode=W.SLIDER_VIEW,e.commit())}),[e]);return(0,g.jsxs)("div",{className:"tool-bar",children:[t===Y.LOCKED&&(0,g.jsx)(P,{label:o,onClick:d}),t===Y.UNLOCKED&&(0,g.jsx)(P,{label:s,onClick:l}),a===W.SPLIT_VIEW&&(0,g.jsx)(P,{label:r,onClick:u}),a===W.SLIDER_VIEW&&(0,g.jsx)(P,{label:n,onClick:h}),(0,g.jsx)(A,{}),(0,g.jsx)(O,{}),(0,g.jsx)(le,{}),(0,g.jsx)(q,{tools:we})]})}var me=i(16700),ve=i(96556),ge=i(37887),fe=i(59760);function Me(){const e=(0,fe.O)(),t=(0,ve.EG)(),i=(0,$.v)(),a=H(i.toolsMap),s=(0,c.useMemo)((()=>a.map((e=>{const i=e.ui.renderPersistent;return i&&(0,g.jsx)(i,{...t},e.id)})).filter((e=>!!e))),[a,t]),o=e?i.getToolUi(e.id):[];return(0,g.jsxs)(g.Fragment,{children:[s,(0,g.jsx)(g.Fragment,{children:o.map(((i,a)=>{const s=i;return(0,g.jsx)(s,{...t},`${e?.id}_ui_${a}`)}))})]})}var ye=i(6336);var Ve=i(40936);const xe=x().bind({"balanced-text":"balanced-text-b5f89b94606a52963517"}),be=e=>{let{children:t,className:i}=e;const a=xe("balanced-text",i),s=(0,c.useRef)(null),[o,r]=(0,c.useState)(void 0),{width:n=0}=(0,Ve.A)({ref:s});(0,c.useEffect)((()=>{const e=s.current;if(!e)return;const{firstChild:t,lastChild:i}=e;if(!t||!i)return;const a=document.createRange();a.setStartBefore(t),a.setEndAfter(i);const o=a.getBoundingClientRect();r(o.width)}),[n,t]);const l={width:o};return(0,g.jsx)("div",{className:a,ref:s,style:l,children:t})},Se=x().bind({"model-select":"model-select-b39809e46b1dfe9d3813","model-entry":"model-entry-b5a8340f5d795eb151d8","model-item":"model-item-b6e97804587426de73c7","model-thumbnail":"model-thumbnail-de8d99454e3c29fb4811","model-name":"model-name-da429901fdddf99b989e","model-name-wrapper":"model-name-wrapper-f816f64667e300e4a37f","model-trigger":"model-trigger-e53ff27a68de983e2c5c","model-entry-disabled":"model-entry-disabled-d71e0f52f4477d7e130f"}),je=e=>{let{models:t,value:i,onSelect:a,className:s,prompt:o,disabled:r}=e;const n=Se("model-select",s),l=(0,c.useMemo)((()=>t.map((e=>({key:e.id,value:e,disabled:e.disabled})))),[t]),d=(0,c.useMemo)((()=>l.find((e=>e.key===i?.id))??null),[l,i?.id]),h=(0,c.useCallback)((e=>{a(e.value)}),[a]),u=(0,c.useCallback)((()=>{const e=Se("model-trigger");return(0,g.jsx)("div",{className:e,children:o},"prompt")}),[o]);return(0,g.jsx)(S,{className:n,Render:Ee,items:l,value:d,onValueChange:h,RadioItem:Ne,matchPopupWidthToTrigger:!0,Selected:Ce,Prompt:o?u:void 0,disabled:r})},Ee=e=>{let{value:t}=e;const{id:i,imageUrl:a,name:s,disabled:o}=t,[r]=(0,ye.i)(a),n=Se("model-entry",{"model-entry-disabled":o});return(0,g.jsxs)("div",{className:n,children:[(0,g.jsx)("img",{className:Se("model-thumbnail"),src:r}),(0,g.jsx)("div",{className:Se("model-name-wrapper"),children:(0,g.jsx)(be,{className:Se("model-name"),children:s})})]},i)},Ce=e=>{let{value:t}=e;const{id:i,name:a}=t,s=Se("model-trigger");return(0,g.jsx)("div",{className:s,children:(0,g.jsx)(be,{className:Se("model-name"),children:a})},i)};function Ne(e){let{ref:t,...i}=e;const a=Se("model-item");return(0,g.jsx)(p.hN,{ref:t,...i,className:a})}function De(e){let{viewIndex:t}=e;const i=G(),a=(0,U.Z)(z.n,"availableViews",[]),s=(()=>{const e=G();return(0,B.W)(e.activeViews)})(),o=(0,c.useMemo)((()=>a.find((e=>e.id===s[t]))),[a,t,s]);return(0,g.jsx)(je,{models:a,onSelect:e=>{i&&-1===i.activeViews.indexOf(e.id)&&i.activeViews.update(t,e.id)},value:o,className:"compare-view-selector",disabled:2===i.availableViews.length})}var Re=i(41616);const Te=e=>{const t=(0,Re.J)(),i=t?.iconWhite,a=(0,g.jsx)("img",{src:i,className:"compare-logo",alt:"Matterport logo."});return(0,g.jsx)("div",{className:"compare-logo-menu-button",children:a})};function Ie(e){const t=v()("aura-secondary-button",e.className);return(0,g.jsx)(L.$,{iconSize:e.iconSize??j.l.SMALL,tooltipOptions:{arrow:!1},...e,className:t})}var _e=i(56023),Oe=i(4717);function ke(){const{setLeftPanelContainer:e}=(0,ve.OB)(),t=(0,_e.D)(K.yU,[ie.S0.SEARCH,!0]),i=(0,_e.D)(K.Te),a=(0,fe.O)(),s=(0,Oe.G)(),o=(0,c.useCallback)((()=>{a?i():t()}),[a,i,t]);return(0,g.jsxs)("div",{className:"compare-search-panel","data-active-tool":a?.id,children:[(0,g.jsx)("div",{className:"compare-panel-section",children:(0,g.jsxs)("div",{className:"compare-panel-section-content",children:[(0,g.jsxs)("div",{className:"compare-top-panel",children:[(0,g.jsx)(Te,{}),(0,g.jsx)(Ie,{icon:"dock",iconSize:j.l.LARGE,onClick:o})]}),(0,g.jsx)(be,{className:"compare-panel-model-name",children:s?.name})]})}),(0,g.jsx)("div",{className:v()("compare-panel-section","compare-left-panel-portal"),ref:e})]})}function Le(){const{setRightPanelContainer:e}=(0,ve.OB)();return(0,g.jsx)("div",{className:"compare-right-panel",children:(0,g.jsx)("div",{className:v()("compare-panel-section","compare-right-panel-portal"),ref:e})})}var Pe=i(47737),Ae=i(62834);var Fe=i(7477);function Ue(e){let{className:t,calcDimensions:i}=e;const a=function(e){const[t,i]=(0,c.useState)(!1),a=()=>{i(!0)};return(0,c.useEffect)((()=>{if(t){const t=()=>i(!1);return window.addEventListener("pointerup",t),window.addEventListener("pointercancel",t),window.addEventListener("pointermove",e),()=>{window.removeEventListener("pointerup",t),window.removeEventListener("pointercancel",t),window.removeEventListener("pointermove",e)}}return()=>{}}),[t,e,i]),a}(i);return(0,g.jsx)("div",{className:t,draggable:!0,onPointerDown:a})}var Be=i(3249);const ze=x().bind({slider:"slider-dd26ab88a3e233b818bf"}),Ge=()=>{const e=ze("view-slider"),t=(0,U.Z)(z.n,"splitPosition",.5),i=G(),a=(0,Fe.a)(),s="slider_view"===(0,U.Z)(z.n,"viewMode","disabled"),{createPageOverlay:o}=(0,ve.EG)(),r=(0,c.useCallback)((e=>{a&&(a.aspectRatio>1?i.splitPosition=(0,Be.qE)(e.clientX/a.width,0,1):i.splitPosition=(0,Be.qE)(e.clientY/a.height,0,1),i.commit())}),[a,i]);return s?(0,g.jsx)(g.Fragment,{children:o((0,g.jsx)("div",{className:e,style:{"--slider":100*t+"%"},children:(0,g.jsx)(Ue,{className:ze("slider"),calcDimensions:r})}),"view-slider")}):null};function We(){return(0,g.jsx)(me.y,{theme:me.cD.AURA,children:(0,g.jsx)(ve.s6,{children:(0,g.jsx)("div",{className:"compare-ui",children:(0,g.jsx)(Ye,{})})})})}function Ye(){const{setViewOverlayContainer:e}=(0,ve.OB)();return(0,g.jsxs)("div",{className:"compare-main-layout",children:[(0,g.jsx)(ge.Q,{}),(0,g.jsx)(Ke,{}),(0,g.jsx)("div",{className:"compare-left-panel",children:(0,g.jsx)(ke,{})}),(0,g.jsxs)("div",{className:"compare-center-panel",children:[(0,g.jsx)("div",{className:"compare-view-tool-overlay",id:ve.Cz.VIEW_OVERLAY_PORTAL,ref:e}),(0,g.jsx)(pe,{})]}),(0,g.jsx)(Me,{}),(0,g.jsx)(Ge,{})]})}function Ke(){const e=function(){const e=(0,F.Ez)(Pe.P),t=(0,F.Ez)(z.n),i=(0,Ae.X)();if(!(e&&t&&i&&i.layerId))return 0;const a=e.getLayerSource(i.layerId);return t.activeViews.indexOf(a)}();return(0,g.jsxs)("div",{className:"compare-viewport-layout-container",children:[(0,g.jsxs)("div",{className:v()("compare-viewport"),children:[(0,g.jsx)(De,{viewIndex:0}),0===e&&(0,g.jsx)(Le,{})]}),(0,g.jsxs)("div",{className:v()("compare-viewport"),children:[(0,g.jsx)(De,{viewIndex:1}),1===e&&(0,g.jsx)(Le,{})]})]})}var He,Qe=i(76894),Ze=i(78849),$e=i(77570),Xe=i(22e3),qe=i(5338),Je=i(81519),et=i(58480),tt=i(23864),it=i(74381),at=i(56208),st=i(2964),ot=i(52721),rt=i(68965),nt=(i(68909),i(97994));!function(e){e.GRID_COLOR="grid-color",e.PRIMARY_TEXT="primary-text",e.PRIMARY_BUTTON_SELECTED="primary-button-selected",e.PRIMARY_CONTAINER_EDGE="primary-container-edge",e.PRIMARY_CONTAINER_SURFACE_DARK_STOP="primary-container-surface-dark-stop",e.PRIMARY_CONTAINER_SURFACE_LIGHT_STOP="primary-container-surface-med-stop",e.PRIMARY_CONTAINER_SURFACE_MED_STOP="primary-container-surface-light-stop",e.SKYBOX_SURFACE="skybox-surface",e.SELECTION_OUTLINE_VISIBLE_EDGE_COLOR="selection-outline-visible-edge-color",e.SELECTION_OUTLINE_HIDDEN_EDGE_COLOR="selection-outline-hidden-edge-color",e.SELECTION_OUTLINE_EDGE_GLOW="selection-outline-edge-glow",e.TRANSFORM_GIZMO_BUTTON_COLOR="transform-gizmo-button-color",e.TRANSFORM_GIZMO_BUTTON_TEXT_COLOR="transform-gizmo-button-text-color",e.PRIMARY_BUTTON_STATUS_ERROR="primary-button-status-error",e.PRIMARY_BUTTON_STATUS_IN_PROGRESS="primary-button-status-in-progress",e.PRIMARY_BUTTON_STATUS_SUCCESS="primary-button-status-success"}(He||(He={}));const lt="gizmo-data-theme";class ct{constructor(e){var t,i,a;const s=null!==(a=null!==(i=null!==(t=this.getThemeFromParams())&&void 0!==t?t:this.getThemeFromLocalStorage())&&void 0!==i?i:this.getThemeFromBrowserPreference())&&void 0!==a?a:e;this.theme=new nt.L(s),this.theme.onChanged((e=>{this.applyThemeToDocument(e),this.saveThemeToLocalStorage(e)})),this.applyThemeToDocument(s)}getThemeFromParams(){const e=new URLSearchParams(window.location.search).get("theme");return"dark"===e||"light"===e?e:void 0}getThemeFromLocalStorage(){const e=window.localStorage.getItem(lt);return"dark"===e||"light"===e?e:void 0}saveThemeToLocalStorage(e){window.localStorage.setItem(lt,e)}getThemeFromBrowserPreference(){if(window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark";return window.matchMedia("(prefers-color-scheme: light)").matches?"light":void 0}applyThemeToDocument(e){window.document.documentElement.setAttribute("data-theme",e)}}var dt=i(61767),ht=i(25443),ut=i(93821),wt=i(21693),pt=i(87870),mt=i(94502),vt=i(73554);class gt extends mt.a{renderActive=e=>{let{createRightPanel:t}=e;return(0,g.jsx)(g.Fragment,{children:t((0,g.jsx)(pt.A,{resizeToContentMax:"65vh",hideShareInContent:!0,offsetContentByScrollbarWidth:!0}))})}}var ft=function(e,t,i,a){var s,o=arguments.length,r=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Mt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},yt=function(e,t){return function(i,a){t(i,a,e)}},Vt=E.A.TOOLS;let xt=class extends s.n{constructor(e,t,i){var a,s;super(),this.settingsModule=e,this.layersModule=t,this.name="compare-gui",this.themeManager=new ct("dark"),this.loadUi=async(e,t,i)=>{if(!this.enabled)return;e.editMode=!1;const a={locale:e.locale};this.viewportHeight=new Xe.A(this.containerData),this.viewportHeight.update(),this.reactRoot=(0,qe.createRoot)(t),this.engine.market.waitForData(Ze.L).then((e=>{e.simpleSearchView=!0,e.commit()})),this.engine.getModuleBySymbol(r.N7).then((e=>{e.adjustCanvas=!1})),this.reactRoot.render((0,c.createElement)($e.B.Provider,{value:e},[(0,c.createElement)(dt.Y,{key:"compare-ui-locale",value:a},[(0,c.createElement)(Je.u,{key:"error-bar"}),(0,c.createElement)(c.Suspense,{key:"compare-ui"},(0,c.createElement)(We))])])),this.initializeTools()},this.unloadUi=async()=>(this.viewportHeight&&this.viewportHeight.dispose(),!!this.reactRoot&&(this.reactRoot.unmount(),await this.engine.market.waitForData(Ze.L).then((e=>{e.simpleSearchView=!1,e.commit()})),await this.engine.getModuleBySymbol(r.N7).then((e=>{e.adjustCanvas=!0})),!0)),this.enabled=null!==(s=null===(a=this.settingsModule)||void 0===a?void 0:a.settingsData.tryGetSetting(Qe.$,!0))&&void 0!==s&&s,this.viewportManager=null==i?void 0:i.viewportManager}async init(e,t){this.engine=t,this.themeManager.theme.value="dark",this.containerData=await t.market.waitForData(et.G)}get theme(){return this.themeManager.theme}initializeTools(){const e=[new tt.N({id:ie.S0.MEASUREMENTS,searchModeType:it.jM.MEASUREMENTPATH,namePhraseKey:Vt.MEASUREMENTS,panel:!1,icon:"icon-tape-measure",analytic:"measurements",dimmed:!1,enabled:this.settingsModule.tryGetSetting(at.Q$.Measurements,!0),ui:new st.o,manager:new ot.R(this.engine,this.settingsModule.settingsData)}),new tt.N({id:ie.S0.SUMMARY,namePhraseKey:Vt.SUMMARY,panel:!0,panelLeft:!0,analytic:"summary",dimmed:!1,enabled:!0,hidesAppBar:!0,ui:new rt.t})];this.engine.commandBinder.issueCommand(new K.Kw(e)),async function(e){await e.market.waitForData(ut.r);const t=await e.market.waitForData(ht.o),i=new tt.N({...wt.P,ui:new gt,manager:new vt.l(e,t)});e.commandBinder.issueCommand(new K.Kw([i]))}(this.engine)}};xt=ft([(0,a._q)(),yt(0,(0,a.y_)(o.ZF)),yt(1,(0,a.y_)(r.az)),yt(2,(0,a.y_)(r.Qm)),Mt("design:paramtypes",[Object,Object,Object])],xt);const bt=xt},33548:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var a=i(65945),s=i(68909),o=i(64882),r=i(62802),n=i(90082),l=i(9139),c=i(71687),d=i(93821),h=i(13893),u=i(52026),w=i(12069),p=i(66806),m=i(76894),v=i(36489),g=i(30926),f=i(13767),M=function(e,t,i,a){var s,o=arguments.length,r=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},V=function(e,t){return function(i,a){t(i,a,e)}};let x=class extends o.n{constructor(e,t,i,a,o,r,n,c){var d,u;super(),this.settingsModule=e,this.layersModule=i,this.rendererModule=a,this.cameraModule=o,this.sweepDataModule=n,this.cameraStartModule=c,this.name="compare",this.viewData=new v.n,this.viewportToModel=new Map,this.viewportsUnordered=[],this.lockViewportBindings=null,this.lastViewportNavSweep=new Map,this.orderedTagViewFilterCleanup=null,this.renderingViewportChanged=e=>{var t;const i=this.rendererModule.getScene(),a=this.layersModule.layersData.getCurrentView(),s=null!==(t=null==e?void 0:e.id)&&void 0!==t?t:this.viewportManager.activeViewport.id;for(const e of a.connections){const t="disabled"===this.viewData.viewMode||"single_view"===this.viewData.viewMode||this.viewportToModel.get(s)===e.model.id;i.getSubTree([a.id,"meshes",e.model.id]).visible=t,i.getSubTree([e.model.id]).visible=t}for(const e of this.viewportManager.viewports){const t=e.id===s;e.annotationLayerIds.forEach((e=>{i.getSubTree([e]).visible=t}))}},this.watchLockMode=e=>{l.Vy.for(this).debugInfo("watchLockMode",e),"locked"===e?this._lockViewports():this._unlockViewports()},this.viewChanged=(e,t)=>{l.Vy.for(this).debugInfo("viewChanged",e,t,this.viewData.viewMode),"split_view"!==this.viewData.viewMode&&"slider_view"!==this.viewData.viewMode||this.matchSweepState(this.viewportsUnordered[1-t],[this.viewportsUnordered[t]],h.fl.Instant)},this.resizeViewports=()=>{const{width:e,height:t}=this.canvasData,i=this.viewportsUnordered.map((e=>this.viewportManager.viewports.get(e))),a=Math.max(i.length,1);if("slider_view"===this.viewData.viewMode&&2===a){const a=new s.Box2(new s.Vector2(0,0),new s.Vector2(e,t)),o=this.viewData.splitPosition;e>=t?(i[0].updateRect(a,new s.Box2(new s.Vector2(0,0),new s.Vector2(e*o,t))),i[1].updateRect(a,new s.Box2(new s.Vector2(e*o,0),new s.Vector2(e,t)))):(i[1].updateRect(a,new s.Box2(new s.Vector2(0,0),new s.Vector2(e,t*(1-o)))),i[0].updateRect(a,new s.Box2(new s.Vector2(0,t*(1-o)),new s.Vector2(e,t))))}else e>=t?i.forEach(((i,o)=>{i.updateRect(new s.Box2(new s.Vector2(o*(e/a),0),new s.Vector2((o+1)*(e/a),t)))})):i.reverse().forEach(((i,o)=>{i.updateRect(new s.Box2(new s.Vector2(0,o*(t/a)),new s.Vector2(e,(o+1)*(t/a))))}))},this.refreshViewportMap=()=>{const e=this.viewportToModel.values();this.viewportToModel.clear();const t=this.viewportManager.viewports.length>1;this.viewData.activeViews.forEach(((e,i)=>{const a=this.viewportManager.viewports;if(i<a.length){const s=this.viewportsUnordered[i];if(this.viewportToModel.set(s,e),this.floorsViewDataModule){const t=this.floorsViewDataModule.getViewDataForViewport(s);t&&(t.sourceViewId=e,t.commit())}const o=a.get(s);if(o){const i=this.rendererModule.getScene();t&&o.annotationLayerIds.forEach((e=>i.getSubTree([e]).visible=!1)),o.annotationLayerIds.replace(this.layersModule.layersData.currentLayers().filter((t=>t.sourceViewId===e)).map((e=>e.id))||[])}}})),this.onActiveModelsChanged({previous:new Set(e),current:new Set(this.viewportToModel.values())})},this.enabled=null!==(u=null===(d=this.settingsModule)||void 0===d?void 0:d.settingsData.tryGetSetting(m.$,!0))&&void 0!==u&&u,this.canvasData=null==t?void 0:t.data,this.viewportManager=null==r?void 0:r.viewportManager,this.viewData=new v.n}async init(e,t){if(!this.enabled)return;this.engine=t,t.market.register(v.n,this.viewData);const i=this.layersModule.layersData.getCurrentView(),a=i.isCompareView()&&!1!==e.initialCompareActive;a&&(this.settingsModule.updateSetting(f.GK,!1),this.viewData.viewMode="split_view",this.viewData.commit()),this.applyViewMode(),Promise.all([t.getModuleBySymbol(c.SD),t.getModuleBySymbol(c.GR),t.getModuleBySymbol(c.Kv),t.getModuleBySymbol(c.QW)]).then((async e=>{this.viewmodeModule=e[0],this.watchLockMode(this.viewData.cameraMode),this.modelMeshModule=e[1],this.navigationModule=e[2],this.floorsViewDataModule=e[3],this.navigationModule.addNavigationFilter(this.navigationFilter.bind(this)),a&&await this.applyConnections(i.connections.values(),"split_view")})),!1!==e.tags&&Promise.all([t.market.waitForData(d.r),t.market.waitForData(g.o)]).then((([e,t])=>{this.bindings.push(t.onDockedAnnotationChanged((()=>{const i=!!t.dockedAnnotation;i&&!this.orderedTagViewFilterCleanup?this.orderedTagViewFilterCleanup=e.addOrderedTagFilter("compare-tags-view-data",(e=>!t.dockedAnnotation||this.viewportManager.activeViewport.annotationLayerIds.has(e.layerId))):!i&&this.orderedTagViewFilterCleanup&&(this.orderedTagViewFilterCleanup(),this.orderedTagViewFilterCleanup=null)})))})),this.bindings.push(this.canvasData.onChanged(this.resizeViewports),this.viewportManager.onPropertyChanged("renderingViewport",this.renderingViewportChanged),this.viewData.onPropertyChanged("cameraMode",this.watchLockMode),this.viewData.onPropertyChanged("viewMode",this.applyViewMode.bind(this)),this.viewData.onPropertyChanged("splitPosition",this.resizeViewports),this.viewData.activeViews.onChanged(this.refreshViewportMap),this.viewData.activeViews.onElementChanged({onUpdated:this.viewChanged.bind(this)}))}async applyConnections(e,t){this.viewData.availableViews=e.map((e=>e.model));const i=Array.from(this.viewData.availableViews).map((e=>e.id));switch(e.length){case 0:this.viewData.viewMode="disabled",this.viewData.activeViews.replace([]);break;case 1:this.viewData.viewMode=t,this.viewData.activeViews.replace([i[0]]);break;default:this.viewData.viewMode=t,this.viewData.activeViews.replace(i.slice(0,2))}this.viewData.commit(),this.refreshViewportMap(),await this.setInitialPanos()}dispose(e){this.orderedTagViewFilterCleanup&&this.orderedTagViewFilterCleanup()}async setInitialPanos(){var e,t;const i=this.viewportsUnordered[0],a=this.viewportToModel.get(i);l.Vy.for(this).debugInfo(`setInitialPanos for ${a} on view ${i}`);const s="split_view"===this.viewData.viewMode||"slider_view"===this.viewData.viewMode,o="locked"===this.viewData.cameraMode;if(!s||!i||!a)return;o&&this._unlockViewports(),await this.modelMeshModule.firstMeshLoadPromise;const r=e=>e.sourceViewId===a,n=this.cameraStartModule.data.getStartingPose(),c=n.camera.position,d=n.pano.uuid,u=d?this.sweepDataModule.getSweepOnView(d):void 0,w=(null==u?void 0:u.id)||!!c&&(null===(e=this.sweepDataModule.data.getClosestSweep(c,!0,r))||void 0===e?void 0:e.id)||(null===(t=this.sweepDataModule.data.getFirstSweep(!0,r))||void 0===t?void 0:t.id);this.viewmodeModule.data.isInside()||await this.viewmodeModule.switchToMode(p.N.Panorama,h.fl.Instant,{sweepID:w,rotation:n.camera.rotation},0,!1,this.cameraModule.getCameraDataForViewport(i),this.sweepDataModule.data.getStateForViewport(i)),await this.matchSweepState(i,this.viewportsUnordered.slice(1),h.fl.Instant),o&&this._lockViewports(),this.rendererModule.startRender(!0)}_lockViewports(){var e;null===(e=this.lockViewportBindings)||void 0===e||e.cancel(),this.lockViewportBindings=new r.P(this.sweepDataModule.data.state.onChanged((()=>{this.matchSweepState(this.viewportManager.activeViewport.id,this.viewportManager.viewports.values.filter((e=>e.id!==this.viewportManager.activeViewport.id)).map((e=>e.id)),h.fl.Interpolate)})),this.cameraModule.cameraData.pose.onChanged((()=>{for(const e of this.viewportManager.viewports)if(e!==this.viewportManager.activeViewport){const t=this.cameraModule.getCameraDataForViewport(e.id);this.viewmodeModule.data.isInside()?t.pose.rotation.copy(this.cameraModule.cameraData.pose.rotation):t.pose.copy(this.cameraModule.cameraData.pose),t.pose.projection.copy(this.cameraModule.cameraData.pose.projection),t.pose.commit()}})))}matchSweepState(e,t,i){var a,o;const r=this.sweepDataModule.data.getStateForViewport(e),n=r.transition.to||r.currentSweep,l=this.cameraModule.getCameraDataForViewport(e);if(!n)return Promise.resolve();const c=this.sweepDataModule.data.getSweep(n),d=(new s.Vector3).copy(c.position),h=[];for(const e of t){const t=this.viewportManager.viewports.get(e),s=this.sweepDataModule.data.getStateForViewport(t.id);if(!t||!s||!s.canTransition())continue;const r=this.viewportToModel.get(t.id),n=e=>e.sourceViewId===r,c=null===(o=null===(a=(0,u.du)({sweepData:this.sweepDataModule.data,inside:!1,point:d,callerScorers:[],callerFilters:[n]}).filter((e=>e.sweep&&n(e.sweep)))[0])||void 0===a?void 0:a.sweep)||void 0===o?void 0:o.id,w=this.lastViewportNavSweep.get(t.id);c&&w!==c&&(this.lastViewportNavSweep.set(t.id,c),h.push(this.navigationModule.navigateToSweep(c,{rotation:l.pose.rotation,transitionType:i,transitionSpeedMultiplier:1.1},this.cameraModule.getCameraDataForViewport(t.id),this.sweepDataModule.data.getStateForViewport(t.id)).then((()=>{this.lastViewportNavSweep.get(t.id)===c&&this.lastViewportNavSweep.set(t.id,"")}))))}return Promise.all(h).then()}_unlockViewports(){var e;null===(e=this.lockViewportBindings)||void 0===e||e.cancel(),this.lockViewportBindings=null}navigationFilter(e){return!this.viewportManager.activeViewport||e.sourceViewId===this.viewportToModel.get(this.viewportManager.activeViewport.id)}applyViewMode(){const e=e=>{this.viewportManager.viewports.set(e.id,e),this.viewportsUnordered.push(e.id)};switch(this.viewData.viewMode){case"single_view":this.viewportManager.viewports.clear(),this.viewportsUnordered.length=0,e(new w.L);break;case"split_view":case"slider_view":2!==this.viewportManager.viewports.length&&(this.viewportManager.viewports.clear(),this.viewportsUnordered.length=0,e(new w.L),e(new w.L));break;case"disabled":this.viewportManager.viewports.clear(),this.viewportsUnordered.length=0,this.viewportManager.viewports.set(this.viewportManager.defaultViewport.id,this.viewportManager.defaultViewport)}this.resizeViewports();const t=this.viewportManager.viewports.values[0];t&&(this.viewportManager.activeViewport=null!=t?t:this.viewportManager.defaultViewport),this.refreshViewportMap(),this.viewportManager.commit()}onActiveModelsChanged({previous:e,current:t}){this.sweepDataModule.updateSweepFiltering({removed:e,added:t})}};x=M([(0,a._q)(),V(0,(0,a.y_)(n.ZF)),V(1,(0,a.y_)(c.CE)),V(2,(0,a.y_)(c.az)),V(3,(0,a.y_)(c.M7)),V(4,(0,a.y_)(c.jh)),V(5,(0,a.y_)(c.Qm)),V(6,(0,a.y_)(c.Wh)),V(7,(0,a.y_)(c.di)),y("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object])],x);const b=x},36489:(e,t,i)=>{i.d(t,{n:()=>o});var a=i(12625),s=i(4850);class o extends a.B{constructor(){super(...arguments),this.name="compare-view-data",this.viewMode="disabled",this.cameraMode="locked",this.activeViews=new s.X,this.availableViews=[],this.splitPosition=.5}}},12069:(e,t,i)=>{i.d(t,{L:()=>l,g:()=>c});var a=i(3928),s=i(51219),o=i(88325),r=i(81662),n=i(68909);class l extends a.v{constructor(e=new n.Box2){var t;super(),this.id=""+l.nextId++,this.camera=new n.PerspectiveCamera,this.scene=null,this.annotationLayerIds=new s.y,null===(t=this.camera.layers)||void 0===t||t.enableAll(),this.rect=e,this.scissorRect=e.clone(),this.size=e.getSize(new n.Vector2),this.commit()}updateRect(e,t=e.clone()){this.rect=e,this.size=e.getSize(new n.Vector2),this.scissorRect=t,this.commit()}}l.nextId=0;class c extends a.v{constructor(e){super(),this.domElement=e,this.defaultViewport=new l,this.viewports=(0,o.y)({[this.defaultViewport.id]:this.defaultViewport}),this.activeViewport=this.defaultViewport,this.renderingViewport=null,this.getPickPosNDC=(()=>{const e=new n.Vector2,t=new n.Vector2;return(i,a,s)=>{if(!this.domElement)throw new Error("ViewportManager: No domElement set");const o=this.domElement.getBoundingClientRect(),r=s?[...this.viewports.values.reverse(),this.defaultViewport]:[this.activeViewport];for(const n of r)if(e.set(i-o.left,o.bottom-a),s&&n!==this.defaultViewport||e.clamp(n.scissorRect.min,n.scissorRect.max),n.scissorRect.containsPoint(e))return e.sub(n.rect.min),n.rect.getSize(t),s&&this.activeViewport!==n&&(this.activeViewport=n,this.commit()),{x:e.x/t.x*2-1,y:e.y/t.y*2-1,viewport:n};throw new Error("No viewport for this position")}})(),this.worldToScreenPosition=(()=>{const e=new n.Matrix4,t=new n.Matrix4;return(i,a,s,o,l,c,d)=>{var h,u;if(void 0===l&&(l=(null===(h=this.activeViewport)||void 0===h?void 0:h.id)||(null===(u=this.defaultViewport)||void 0===u?void 0:u.id)),!this.domElement)throw new Error("ViewportManager: No domElement set");const w=this.viewports.get(l);if(!w)throw new Error("Invalid viewport id passed to worldToScreenPosition");c=c||new n.Vector2,d=d||new n.Vector3,t.compose(i,a,r.B1.UNIT),e.copy(t),e.invert(),d.set(o.x,o.y,o.z).applyMatrix4(e).applyMatrix4(s);const p=w.rect.max.x-w.rect.min.x,m=w.rect.max.y-w.rect.min.y;c.set((d.x+1)*p/2,(1-d.y)*m/2);const v=this.domElement.getBoundingClientRect(),g=v.bottom-(w.rect.min.y+m);return c.y+=g,c.y-=v.top,c.x+=w.rect.min.x,{screenPosition:c,ndcPosition:d}}})(),this.updateDefaultViewport=()=>{if(!this.domElement)throw new Error("ViewportManager: No domElement set");const e=this.domElement.getBoundingClientRect();this.defaultViewport.updateRect(new n.Box2(new n.Vector2(0,0),new n.Vector2(e.width,e.height)))},e&&this.setDomElement(e),this.onPropertyChanged("activeViewport",(()=>{this.viewports.sort(((e,t)=>e===this.activeViewport?1:t===this.activeViewport?-1:0))}))}dispose(){this.resizeObserver.disconnect(),this.viewports.clear()}setDomElement(e){this.domElement=e,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.updateDefaultViewport),this.resizeObserver.observe(e),this.updateDefaultViewport()}viewportIdForLayerId(e){if(1===this.viewports.length)return this.viewports.values[0].id;for(const t of this.viewports)if(t.annotationLayerIds.has(e))return t.id;return this.viewports.values[0].id}}}}]);