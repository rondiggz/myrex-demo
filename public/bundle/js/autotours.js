/*! For license information please see autotours.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[7587],{80500:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetExtensionTags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namespaces"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"extensiontags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"namespaces"},value:{kind:"Variable",name:{kind:"Name",value:"namespaces"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExtensionTagDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddExtensionTag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namespace"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"values"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addExtensionTag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"namespace"},value:{kind:"Variable",name:{kind:"Name",value:"namespace"}}},{kind:"Argument",name:{kind:"Name",value:"values"},value:{kind:"Variable",name:{kind:"Name",value:"values"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExtensionTagDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchExtensionTag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namespace"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"values"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchExtensionTag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"namespace"},value:{kind:"Variable",name:{kind:"Name",value:"namespace"}}},{kind:"Argument",name:{kind:"Name",value:"values"},value:{kind:"Variable",name:{kind:"Name",value:"values"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExtensionTagDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteExtensionTag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namespace"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteExtensionTag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"namespace"},value:{kind:"Variable",name:{kind:"Name",value:"namespace"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ExtensionTagDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ExtensionTag"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"namespace"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"values"},arguments:[],directives:[]}]}}],loc:{start:0,end:960}};t.loc.source={body:"# Extension Tags allow storing arbitrary data for a model.\n\nquery GetExtensionTags($modelId: ID!, $namespaces: [String!]) {\n  model(id: $modelId) {\n    extensiontags(namespaces: $namespaces) {\n      ...ExtensionTagDetails\n    }\n  }\n}\n\n# Adds a new extension tag; errors if that namespace already exists.\nmutation AddExtensionTag($modelId: ID!, $namespace: String!, $values: [String!]!) {\n  addExtensionTag(modelId: $modelId, namespace: $namespace, values: $values) {\n    ...ExtensionTagDetails\n  }\n}\n\n# Adds or updates an extension tag.\nmutation PatchExtensionTag($modelId: ID!, $namespace: String!, $values: [String!]) {\n  patchExtensionTag(modelId: $modelId, namespace: $namespace, values: $values) {\n    ...ExtensionTagDetails\n  }\n}\n\nmutation DeleteExtensionTag($modelId: ID!, $namespace: String!) {\n  deleteExtensionTag(modelId: $modelId, namespace: $namespace)\n}\n\nfragment ExtensionTagDetails on ExtensionTag {\n  namespace\n  created\n  modified\n  values\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,s=new Set,d=new Set;for(o.forEach((function(e){d.add(e)}));d.size>0;){var l=d;d=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){d.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetExtensionTags=o(t,"GetExtensionTags"),e.exports.AddExtensionTag=o(t,"AddExtensionTag"),e.exports.PatchExtensionTag=o(t,"PatchExtensionTag"),e.exports.DeleteExtensionTag=o(t,"DeleteExtensionTag"),e.exports.ExtensionTagDetails=o(t,"ExtensionTagDetails")},63846:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Floorplans"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floorplans"},arguments:[{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"StringValue",value:"Matterport",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"flags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"provider"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:402}};t.loc.source={body:'query Floorplans($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      floorplans(provider: "Matterport") {\n        id\n        status\n        url\n        validUntil\n        filename\n        format\n        height\n        width,\n        resolution,\n        origin {\n          x,\n          y\n        }\n        floor {\n          id\n        }\n        flags\n        provider\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.Floorplans=function(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,s=new Set,d=new Set;for(o.forEach((function(e){d.add(e)}));d.size>0;){var l=d;d=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){d.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}(t,"Floorplans")},46672:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ImportAutoGallery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"importAutoGallery"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"StartAutoGalleryImport"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startAutoGalleryImport"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetAutoGalleryImportWorkflow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"workflowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"autoGalleryImportWorkflow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"workflowId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:319}};t.loc.source={body:"mutation ImportAutoGallery($modelId: ID!) {\n  importAutoGallery(modelId: $modelId)\n}\n\nmutation StartAutoGalleryImport($modelId: ID!) {\n  startAutoGalleryImport(modelId: $modelId)\n}\n\nquery GetAutoGalleryImportWorkflow($workflowId: ID!) {\n  autoGalleryImportWorkflow(id: $workflowId) {\n    modelId\n    id\n    state\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,s=new Set,d=new Set;for(o.forEach((function(e){d.add(e)}));d.size>0;){var l=d;d=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){d.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.ImportAutoGallery=o(t,"ImportAutoGallery"),e.exports.StartAutoGalleryImport=o(t,"StartAutoGalleryImport"),e.exports.GetAutoGalleryImportWorkflow=o(t,"GetAutoGalleryImportWorkflow")},58619:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshots"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rootModelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"Field",alias:{kind:"Name",value:"defurnishedViews"},name:{kind:"Name",value:"views"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"StringValue",value:"matterport.model.defurnished",block:!1}}],directives:[{kind:"Directive",name:{kind:"Name",value:"onError"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"StringValue",value:"not.found",block:!1}},{kind:"Argument",name:{kind:"Name",value:"null"},value:{kind:"BooleanValue",value:!0}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshotsForView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},defaultValue:{kind:"NullValue"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"Variable",name:{kind:"Name",value:"viewType"}}},{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchPhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeletePhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadHighlightReelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadHighlightReelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadModelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}},{kind:"Argument",name:{kind:"Name",value:"photoType"},value:{kind:"Variable",name:{kind:"Name",value:"photoType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}],loc:{start:0,end:1684}};n.loc.source={body:'#import "./photo-fragments.gql"\n\n# Get photo snapshot details.\n# This query is run as anonymous in Showcase, so it must only contain public fields.\nquery GetSnapshots($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    rootModelId\n    assets {\n      photos { ...PhotoDetails }\n    }\n    defurnishedViews: views(types: "matterport.model.defurnished") @onError(id: "not.found", null: true) {\n      model {\n        id\n        assets {\n          photos {\n            ...PhotoDetails\n          }\n        }\n      }\n    }\n  }\n}\n\nquery GetSnapshotsForView($modelId: ID!, $viewType: ID!, $viewId: ID = null) {\n  model(id: $modelId) {\n    id\n    view(type: $viewType, id: $viewId) {\n      model {\n        assets {\n          photos {\n            ...PhotoDetails\n          }\n        }\n      }\n    }\n  }\n}\n\nmutation PatchPhoto($modelId: ID!, $photoId: ID!, $label: String!) {\n  patchPhoto(modelId: $modelId, photoId: $photoId, label: $label) {\n    ...PhotoDetails\n  }\n}\n\nmutation DeletePhoto($modelId: ID!, $photoId: ID!) {\n  deletePhoto(modelId: $modelId, photoId: $photoId)\n}\n\nmutation UploadHighlightReelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!) {\n  snapshot: uploadHighlightReelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation) {\n    ...PhotoDetails\n  }\n}\n\nmutation UploadModelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!, $photoType: PhotoType!) {\n  snapshot: uploadModelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation, photoType: $photoType) {\n    ...PhotoDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(i(10600).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!a[t]&&(a[t]=!0,!0)})));var s={};function d(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[d(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=s[t]||new Set,a=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var l=o;o=new Set,l.forEach((function(e){a.has(e)||(a.add(e),(s[e]||new Set).forEach((function(e){o.add(e)})))}))}return a.forEach((function(t){var n=d(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),s[e.name.value]=t}})),e.exports=n,e.exports.GetSnapshots=l(n,"GetSnapshots"),e.exports.GetSnapshotsForView=l(n,"GetSnapshotsForView"),e.exports.PatchPhoto=l(n,"PatchPhoto"),e.exports.DeletePhoto=l(n,"DeletePhoto"),e.exports.UploadHighlightReelSnapshot=l(n,"UploadHighlightReelSnapshot"),e.exports.UploadModelSnapshot=l(n,"UploadModelSnapshot")},35159:(e,t,i)=>{"use strict";var n;i.d(t,{_:()=>n}),function(e){e.CREATED="created",e.CAPTURING="capturing",e.UPLOADING="uploading",e.ERROR="error",e.DONE="done"}(n||(n={}))},86426:(e,t,i)=>{"use strict";i.d(t,{Ns:()=>s,gp:()=>a,t6:()=>d,tZ:()=>o});var n=i(11165);class a extends n.u{constructor(e,t){super(),this.payload={id:e,name:t}}}a.id="RENAME_SNAPSHOT";class o extends n.u{constructor(e){super(),this.payload={id:e}}}o.id="DELETE_SNAPSHOT";class s extends n.u{constructor(e,t){super(),this.payload={snapshot:e,viewId:t}}}s.id="UPLOAD_SNAPSHOT";class d extends n.u{constructor(e){super(),this.payload={id:e}}}d.id="SET_CURRENT_SNAPSHOT_PHOTO"},47067:(e,t,i)=>{"use strict";i.d(t,{P:()=>o});var n=i(3928),a=i(4850);class o extends n.v{constructor(e){super(),this.reel=(0,a.Z)([]),this.modified=new Date,this.mode=e,this.commit()}replace(e){this.atomic((()=>{this.sid=e.sid,this.reel.replace(Array.from(e.reel.values())),this.mode=e.mode,this.modified=e.modified}))}copy(e){return this.atomic((()=>{this.sid=e.sid,this.mode=e.mode,this.modified=e.modified,this.reel=(0,a.Z)([...e.reel.map((e=>Object.assign({},e)))])})),this}clone(){return new o(this.mode).copy(this)}}},15506:(e,t,i)=>{"use strict";i.d(t,{Ux:()=>r,j7:()=>l,nl:()=>d,np:()=>m,vr:()=>u,zc:()=>s});var n=i(74381),a=i(13893),o=i(1333);const s={[n.ES.FADE_TO_BLACK]:a.fl.FadeToBlack,[n.ES.INSTANT]:a.fl.Instant,[n.ES.INTERPOLATE]:a.fl.Interpolate},d={[n.Zw.LEFT]:o.ND.Left,[n.Zw.RIGHT]:o.ND.Right,[n.Zw.AUTO]:o.ND.Auto},l={[n.h6.START]:"start",[n.h6.CENTER]:"center"},r={[a.fl.FadeToBlack]:n.ES.FADE_TO_BLACK,[a.fl.Instant]:n.ES.INSTANT,[a.fl.Interpolate]:n.ES.INTERPOLATE,[a.fl.MoveToBlack]:n.ES.FADE_TO_BLACK,[a.fl.OrbitTo]:n.ES.INTERPOLATE},u={[o.ND.Left]:n.Zw.LEFT,[o.ND.Right]:n.Zw.RIGHT,[o.ND.Auto]:n.Zw.AUTO},m={start:n.h6.START,center:n.h6.CENTER}},37e3:(e,t,i)=>{"use strict";i.d(t,{W:()=>m});var n=i(9139),a=i(25481),o=i(44094),s=i(95234),d=i(57186),l=i(93877),r=i(15506);const u=new n.Vy("mds-reel-element-serializer");class m{constructor(e){this.sweepTagRequirements=e,this.assetDeserializer=new s.S,this.viewDeserailizer=new d.K}deserialize(e){var t;if(!e||!(null===(t=null==e?void 0:e.asset)||void 0===t?void 0:t.id))return u.debug("Deserialized invalid highlight reel entry from MDS",e),null;const i=e.overrides,n={},s=(null==i?void 0:i.transitionType)?r.zc[null==i?void 0:i.transitionType]:void 0,d=(null==i?void 0:i.panDirection)?r.nl[null==i?void 0:i.panDirection]:void 0,m=null==i?void 0:i.panAngle,c=null==i?void 0:i.panAlignment,p=null==i?void 0:i.tourShowRoomMeasurements;(0,o.sw)(s)&&(n.transitionType=s),(0,o.sw)(d)&&(n.panDirection=d),(0,a.Et)(m)&&(n.panAngle=m),(0,o.sw)(c)&&(n.panAlignment=r.j7[c]),!0===p&&(n.showRoomMeasurements=p);const h=this.assetDeserializer.deserialize(e.asset),v=null==h?void 0:h.metadata.scanTags,g=!this.sweepTagRequirements||!v||v.includes(this.sweepTagRequirements);if(!h||!g)return null;let k;const f=this.viewDeserailizer.getModelViewType(e.sourceView);f!==l.jK.DEFURNISH&&f!==l.jK.DIGIPRO_SESSION||(k=e.sourceView.id),h.sourceViewId=k;const w={id:e.asset.id,overrides:n,snapshot:h,sourceViewId:k,source:e.source};return e.title&&(w.title=e.title),e.description&&(w.description=e.description),w}}},28165:(e,t,i)=>{"use strict";i.d(t,{C0:()=>u,H$:()=>p,JK:()=>g,OU:()=>h,Vq:()=>m,Ye:()=>s,au:()=>c,cD:()=>v,hd:()=>l,lB:()=>o,nz:()=>r,pH:()=>d});var n=i(64650),a=i(60152);const o=n.pk.SCOUT,s="autotours_template",d="autotours_generate",l={width:480,height:270},r="autotours_pan_angle",u=50,m="autotours_pan_speed",c=a.BU,p="autotours_regen_text",h=!1,v="autotours_defurnish",g=!0},64650:(e,t,i)=>{"use strict";var n,a,o,s;i.d(t,{ei:()=>a,pT:()=>s,pk:()=>n,sA:()=>o}),function(e){e.SCOUT="scout",e.VISION="vision",e.DIGITAL_PRO="digitalpro"}(n||(n={})),function(e){e.IDLE="idle",e.ACCEPTED="accepted",e.DISCARDED="discarded"}(a||(a={})),function(e){e.CANCELED="canceled",e.COMPLETED="completed",e.CONTINUED="continued",e.FAILED="failed",e.RUNNING="running",e.TERMINATED="terminated",e.TIMEOUT="timeout",e.UNKNOWN="unknown"}(o||(o={})),function(e){e.BALCONY="balcony",e.BASEMENT="basement",e.BATHROOM="bathroom",e.BEDROOM="bedroom",e.CLOSET="closet",e.CORRIDOR="corridor",e.DINING="dining",e.DOLLHOUSE="dollhouse",e.DRIVEWAY="driveway",e.ENTRANCE="entrance",e.EXERCISE="exercise",e.FACADE="facade",e.GAME="game",e.GARAGE="garage",e.HALLWAY="hallway",e.KITCHEN="kitchen",e.LAUNDRY="laundry",e.LIVING="living",e.LOBBY="lobby",e.LOFT="loft",e.MIXED="mixed",e.OFFICE="office",e.OTHER="other",e.OUTDOOR="outdoor",e.PANTRY="pantry",e.PATIO="patio",e.POOL="pool",e.STAIRCASE="staircase",e.UNFURNISHED="unfurnished",e.UNKNOWN="unknown",e.UTILITY="utility",e.YARD="yard"}(s||(s={}))},80769:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>We});var n,a;!function(e){e.ACTION_BAR_LEFT="tour_editor_action_bar_left",e.ACTION_BAR_RIGHT="tour_editor_action_bar_right",e.OVERLAY="tour_editor_overlay"}(n||(n={})),function(e){e.AUTOSAVE="autosave",e.DRAFT="draft"}(a||(a={}));var o=i(65945),s=i(64882),d=i(14614),l=i(45987),r=i(90082),u=i(9139),m=i(93136),c=i(84651),p=i(24790),h=i(71687),v=i(28165);const g={disable:"upscale",frame:1},k=(e,t={})=>{const i=Object.assign(Object.assign({},g),t),n=new URL(e,window.location.origin);return Object.entries(i).forEach((([e,t])=>{void 0===t?n.searchParams.delete(e):n.searchParams.set(e,String(t))})),n.toString()};var f=i(66416),w=i(6478),N=i(86426),D=i(73566),S=i(64650),y=i(52018);class I extends y.t{constructor(e){super(e),this.name="TourGenerationError"}}class T extends y.t{constructor(e){super(e),this.name="TourGenerationCancelledError"}}class b extends y.t{constructor(e){super(`Workflow failed with status ${e}`),this.code=e,this.name="WorkflowError"}}class E extends y.t{constructor(e){super(e),this.name="HighlightsNotFoundError"}}var A=i(73094),O=i(7478);class V extends O.QB{constructor(e){super(),this.error=e}}class R extends O.QB{constructor({config:e,timeGenerating:t,templateType:i}){super(),this.config=e,this.timeGenerating=t,this.templateType=i}}class M extends O.QB{constructor({timeSaving:e,tourStopsAdded:t,tourStopsRemoved:i,tourStopsUpdated:n}){super(),this.timeSaving=e,this.tourStopsAdded=t,this.tourStopsRemoved=i,this.tourStopsUpdated=n}}var F=i(87965),x=i(25712),P=i(74381),U=i(13893),G=i(47067),B=i(64391),C=i(96276),L=i(93327),$=i(37e3);const _=new u.Vy("get-highlights-for-view"),j=async({modelId:e,viewId:t,viewType:i,client:n,addStaleListeners:a=!0,ignoreVisionLabels:o=!0})=>{var s,d,l,r;const{data:u,errors:m}=await n.query(L.GetHighlightReelForView,{modelId:e,viewId:t,viewType:i}),c=Object.values(S.pT),p=null===(r=null===(l=null===(d=null===(s=null==u?void 0:u.model)||void 0===s?void 0:s.view)||void 0===d?void 0:d.model)||void 0===l?void 0:l.activeHighlightReel)||void 0===r?void 0:r.reel;if(m&&m.length>0)throw new C.CU({errors:m,gql:L.GetHighlightReelForView});p&&0!==p.length||_.warn(`No highlights found for view [${t}] on model [${e}]`);const h=[],v=new $.W(null);if(null==p||p.forEach((e=>{const t=v.deserialize(e);t?(t.title&&o&&c.includes(t.title)&&(t.title=""),t.sourceViewId=t.snapshot.sourceViewId=void 0,h.push(t)):_.warn("Failed to deserialize reel")})),a){let a=!1;(0,B._)(h,(async()=>{var o;if(!a){a=!0;const s=await j({modelId:e,viewId:t,viewType:i,client:n,addStaleListeners:!1});for(const{snapshot:e}of h){const t=null===(o=s.find((t=>t.snapshot.sid===e.sid)))||void 0===o?void 0:o.snapshot;t?e.refresh(t):_.warn("No snapshot to refresh from",e)}a=!1}}))}return h};var H=i(58619),W=i(95234);const z=async({modelId:e,viewId:t,viewType:i,client:n})=>{var a,o,s,d;const{data:l}=await n.query(H.GetSnapshotsForView,{modelId:e,viewId:t,viewType:i}),r=null===(d=null===(s=null===(o=null===(a=null==l?void 0:l.model)||void 0===a?void 0:a.view)||void 0===o?void 0:o.model)||void 0===s?void 0:s.assets)||void 0===d?void 0:d.photos,u=new W.S;return(null==r?void 0:r.map((e=>u.deserialize(e))).filter((e=>!!e)))||[]};var q=i(46672);const Y=10,K=3e3,Q={[P.Bu.CANCELED]:S.sA.CANCELED,[P.Bu.COMPLETED]:S.sA.COMPLETED,[P.Bu.CONTINUEDASNEW]:S.sA.CONTINUED,[P.Bu.FAILED]:S.sA.FAILED,[P.Bu.RUNNING]:S.sA.RUNNING,[P.Bu.TERMINATED]:S.sA.TERMINATED,[P.Bu.TIMEDOUT]:S.sA.TIMEOUT,[P.Bu.UNRECOGNIZED]:S.sA.UNKNOWN,[P.Bu.UNSPECIFIED]:S.sA.UNKNOWN},Z=({workflowId:e,maxRetries:t=1/0,client:i})=>((e,t={})=>{const i=new u.Vy("poller"),{maxRetries:n=Y,minDelay:a=K}=t,o=performance.now();let s,d,l=0,r=!0,c=!1,p="";const h=async()=>{let t;l+=1;try{t=await e()}catch(e){throw d=e,e}return void 0!==t?t:(a&&await(0,m.c)(a),r&&l<n?(i.debug(`polling for changes (${l}/${n})`),h()):void 0)};return{promise:h().finally((()=>{i.debug(`polling ended in ${l}/${n} attempts`),s=performance.now(),r=!1})),cancel:e=>{r=!1,c=!0,p=e||""},error:()=>d,isPolling:()=>r,isCanceled:()=>c,isCanceledReason:()=>p,retries:()=>l,elapsed:()=>Math.round((s||performance.now())-o)}})((async()=>{var t;const n=await(async({workflowId:e,client:t})=>{var i,n,a;const{data:o}=await t.query(q.GetAutoGalleryImportWorkflow,{workflowId:e});return(null===(i=null==o?void 0:o.autoGalleryImportWorkflow)||void 0===i?void 0:i.id)&&(null===(n=null==o?void 0:o.autoGalleryImportWorkflow)||void 0===n?void 0:n.modelId)?{id:o.autoGalleryImportWorkflow.id,modelId:o.autoGalleryImportWorkflow.modelId,status:(s=null===(a=null==o?void 0:o.autoGalleryImportWorkflow)||void 0===a?void 0:a.state,s&&Q[s]?Q[s]:S.sA.UNKNOWN)}:null;var s})({workflowId:e,client:i});switch(null==n?void 0:n.status){case S.sA.COMPLETED:return n;case S.sA.RUNNING:return;default:throw new b(null!==(t=null==n?void 0:n.status)&&void 0!==t?t:S.sA.UNKNOWN)}}),{maxRetries:t}),X=new u.Vy("import-auto-gallery"),J=async({client:e,modelId:t,generateText:i=!1})=>{if(!i)return(async({modelId:e,client:t})=>{const{data:i}=await t.mutate(q.ImportAutoGallery,{modelId:e});return!!(null==i?void 0:i.importAutoGallery)})({modelId:t,client:e});const n=await(async({modelId:e,client:t})=>{const{data:i}=await t.mutate(q.StartAutoGalleryImport,{modelId:e});return(null==i?void 0:i.startAutoGalleryImport)||void 0})({modelId:t,client:e});if(!n)throw new I("Unable to start workflow");X.debug(`started workflow ${n}`);const{promise:a,elapsed:o}=Z({workflowId:n,client:e}),s=await a;return X.debug(`workflow ${n} completed in ${o()/1e3} seconds`),!!s};var ee=i(81662),te=i(28404),ie=i(35159),ne=i(38069),ae=i(63846),oe=i(61430);var se=i(66806),de=i(95300),le=i(40397),re=i(68909);const ue=e=>{const{sweepData:t,roomBoundDataModule:i}=e;return e=>e.reduce(((e,n)=>{var a,o;const{cameraPosition:s,cameraQuaternion:d,scanId:l}=n.snapshot.metadata;if(!s||!l)return e;const r=null===(a=t.getSweep(l))||void 0===a?void 0:a.floorId;if(!r)return e;const u=i.data.findRoomIdForPosition(s,r)||null,m=(null===(o=i.findRoomFromCameraPose({position:s,rotation:d,floorId:r}))||void 0===o?void 0:o.id)||null;return e.push(Object.assign(Object.assign({},n),{floorId:r,roomId:u,viewingRoomId:m,sweepId:l})),e}),[])},me=async({modelId:e,client:t,pose:i,viewmodeModule:n})=>{const a=await z({modelId:e,viewType:"matterport.user.insights",client:t}),o=null==a?void 0:a.find((e=>e.metadata.cameraMode===se.N.Dollhouse));if(!o)return new u.Vy("tours-generator:makeDollhouseReelEntry").debug("No dollhouse snapshot found"),null;if(i){const e=await n.getFlyinEndPose(i);e.position&&(o.metadata.cameraPosition=e.position),e.rotation&&(o.metadata.cameraQuaternion=e.rotation),i.sweepID&&(o.metadata.scanId=i.sweepID)}const s=k(await o.thumbnailUrl.get(),Object.assign(Object.assign({},v.hd),{fit:"crop"})),d=await fetch(s).then((e=>e.blob())),l=new B.f(URL.createObjectURL(d),null),r=(new te.F).copy(Object.assign(Object.assign({},o),{sid:(0,x.W0)(),thumbnailUrl:l,imageUrl:l,downloadUrl:l,imageBlob:d,width:v.hd.width,height:v.hd.height,sourceViewId:void 0}));return{id:(0,x.W0)(),snapshot:r,overrides:{transitionType:U.fl.Interpolate},source:"vision"}},ce=async(e,t,i)=>{const{floorsData:n,meshBounds:a,client:o}=e,s=a.getTrimmedBounds();let d=(s.max.z-s.min.z)/2;d*=1.6;const l=s.getCenter(new re.Vector3).setY((0,le.xF)(d)),r=(new re.Quaternion).setFromUnitVectors(ee.B1.FORWARD,ee.B1.DOWN),{width:m,height:c}=v.hd,p=await async function(e,t,i,n,a,o=.2*a){var s,d,l,r,m;const c=new OffscreenCanvas(n,a),p=c.getContext("2d");p&&(p.fillStyle=ne.V.BLACK.getHexString(),p.fillRect(0,0,n,a));try{let u=null===(m=null===(r=null===(l=null===(d=null===(s=(await e.query(ae.Floorplans,{modelId:t})).data)||void 0===s?void 0:s.model)||void 0===d?void 0:d.assets)||void 0===l?void 0:l.floorplans)||void 0===r?void 0:r.find((e=>{var t,n;return e.flags.includes(oe.o9.ALPHA)&&e.flags.includes(oe.o9.PHOTOGRAMY)&&(null===(t=e.url)||void 0===t?void 0:t.includes("vr_colorplan"))&&(!i||(null===(n=e.floor)||void 0===n?void 0:n.id)===i)})))||void 0===m?void 0:m.url;if(u){u=k(u,{width:n-2*o,height:a-2*o,fit:"crop",bgColor:"black",pad:"15%"});const e=await fetch(u).then((e=>e.blob()));null==p||p.drawImage(await createImageBitmap(e),o,o)}}catch(e){new u.Vy("getFloorplanImageBlob").error("Error fetching floorplan image",e)}return c.convertToBlob()}(o,t,i,m,c),h=new B.f(URL.createObjectURL(p),null),g=(new te.F).copy({sid:(0,x.W0)(),metadata:{cameraMode:se.N.Floorplan,cameraPosition:l,cameraQuaternion:r,orthoZoom:d,ssZoom:d,floorId:i,floorVisibility:n.getOrderedValues().map((e=>e.id===i?1:0)),scanTags:null},name:"floorplan",label:"floorplan",is360:!1,category:f.X.TOUR,origin:w.j.AUTOTOUR,created:new Date,modified:new Date,visionLabel:"",visionName:"",state:ie._.CREATED,thumbnailUrl:h,imageUrl:h,downloadUrl:h,imageBlob:p,height:c,width:m});return{id:(0,x.W0)(),snapshot:g,overrides:{transitionType:U.fl.Interpolate},source:"vision"}};function pe(e,t,i){if(!(null==e?void 0:e.length))return e;const n=new Set,a=e.reduce(((e,t)=>(e[t.id]=t,e)),{}),o=(e=>{const{sweepData:t}=e;return(e,i)=>{if(!e.snapshot.metadata.scanId||i.length<=1)return i[0];const n=t.getSweep(e.snapshot.metadata.scanId);return i.map((e=>{const i=e.snapshot.metadata.scanId,a=t.getSweep(i);return{highlight:e,distance:n.position.distanceToSquared(a.position)}})).sort(((e,t)=>e.distance-t.distance))[0].highlight}})({sweepData:t}),s=e=>{const t=Object.values(a).find((t=>t.floorId===e.floorId&&!n.has(t)));if(t)return t;if(i.getFloorCount()>1){const t=e.floorId?i.getFloor(e.floorId):null,o=((e,t=0)=>{const i=Math.min(Math.max(t,0),e.length-1);return{*[Symbol.iterator](){for(let t=0;t<e.length;t++){const n=i+t>=e.length?e.length-t-1:i+t;yield e[n]}}}})(i.getOrderedValues(),null==t?void 0:t.index);for(const e of o){const t=Object.values(a).find((t=>t.floorId===e.id&&!n.has(t)));if(t)return t}}return Object.values(a).find((e=>!n.has(e)))},d=e=>{n.add(e);const i=(e=>{if(!(null==e?void 0:e.roomId))return;const t=Object.values(a).filter((t=>t.roomId===e.roomId&&!n.has(t)));return t.length>1?o(e,t):t[0]})(e)||(e=>{if(!e.floorId)return;const i=Object.values(a).filter((t=>t.floorId===e.floorId&&!n.has(t))),s=t.getSweep(e.sweepId).neighbours,d=i.filter((e=>!!e.sweepId&&s.includes(e.sweepId))),l=d.length?d:i;return o(e,l)})(e)||s(e);i&&d(i)},l=a[e[0].id];d(l);return Array.from(n)}function he(e,t,i){const n={resizeAspect:de.BE},a=(e=>{const{cameraStartModule:t,snapshotsModule:i}=e;return(e={})=>{const n=t.data.icon;if(!n)return;let a=i.snapshotsData.get(n);if(a){if(e.snapshot&&(a=a.copy(Object.assign(Object.assign({},a),e.snapshot))),e.resizeAspect){const t=(0,de.IX)(a.width,a.height,e.resizeAspect);a.width=t.width,a.height=t.height}return{id:a.sid,snapshot:a,source:"vision"}}}})({cameraStartModule:e,snapshotsModule:t})(n);return a?(!i||a.title||a.description||(a.title=i),a):null}var ve=i(11579),ge=i(90160);const ke=(e,t,i={})=>t.reduce(((e,t)=>i.shouldContinue&&!i.shouldContinue(e)?e:t(e,i.exceptions)),[...e]),fe=({excludeUnaligned:e=!0,excludeDisabled:t=!0,minDistance:i,maxStopsPerSweep:n,sweepData:a})=>{const o=new u.Vy("tours-generator:removeSweepsFilter");return(s,d)=>{let l=null;const r={};return s.filter((s=>{if(null==d?void 0:d.has(s.id))return!0;const{sweepId:u,snapshot:{sid:m}}=s;if(!u)return o.debug(`Excluding snapshot ${m}, sweep id not found`),!1;const c=a.getSweep(u);if(!c)return o.debug(`Excluding snapshot ${m}, sweep not found`),!1;if(e&&!c.isAligned())return o.debug(`Excluding snapshot ${m}, sweep unaligned`),!1;if(t&&!c.enabled)return o.debug(`Excluding snapshot ${m}, sweep disabled`),!1;if(i&&l){const e=l.position.distanceTo(c.position);if(e<i)return o.debug(`Excluding snapshot ${m}, too close to previous sweep (${e.toFixed(2)})`),!1}return n&&r[u]&&r[u]>=n?(o.debug(`Excluding snapshot ${m}, already visited sweep ${r[u]} times`),!1):(r[u]=r[u]?r[u]+1:1,l=c,!0)}))}},we=({excludeOutOfBounds:e,excludeClassifications:t,maxStopsPerClassification:i,maxStopsPerRoom:n,roomBoundData:a})=>(o,s)=>{const d=new u.Vy("tours-generator:removeRoomsFilter"),l={};return o.filter((o=>{if(null==s?void 0:s.has(o.id))return!0;const{roomId:r,snapshot:{sid:u}}=o;if(!r)return e&&d.debug(`Excluding snapshot ${u}, room id not found`),!e;const m=a.getRoom(r);if(!m)return e&&d.debug(`Excluding snapshot ${u}, room not found`),!e;const c=m.classifications.map((e=>e.id));if(t&&t.some((e=>c.includes(e))))return d.debug(`Excluding snapshot ${u}, room classification excluded: ${c.join(", ")}`),!1;const p=c.length>0&&i&&c.some((e=>e in i));if(n||p){const e=p?Math.min(...c.map((e=>i[e]))):n;if(e&&l[r]>=e)return d.debug(`Excluding snapshot ${u}, already visited room ${l[r]} times`),!1;l[r]=l[r]?l[r]+1:1}return!0}))},Ne=({invalidMetadata:e=!0})=>{const t=new u.Vy("tours-generator:removeSnapshotsFilter");return(i,n)=>i.filter((i=>{if(null==n?void 0:n.has(i.id))return!0;const{snapshot:a}=i,{cameraPosition:o,cameraMode:s}=a.metadata||{};return!!(!e||o&&s)||(t.debug(`Excluding snapshot ${a.sid}, invalid metadata`),!1)}))};var De=i(30169),Se=i(4330),ye=i(23339),Ie=i(93818),Te=i(56147),be=i(80500);const Ee="mp:showcase:autotours:importerVersion",Ae=new u.Vy("importerVersion");const Oe=[ve.mg,ve.GC],Ve=new Set([ve.bA,ve.Cp,ve.xI,ve.ZQ,ve.Xq,ve.m1,ve.SE,ve._1,ve.Hy,ve.FI,ve.LX,ve.pl,ve.v1,ve.SK,ve.u9]),Re=new Set([ve.YV,ve.GC]);class Me{constructor({roomBoundDataModule:e,sweepData:t,cameraStartModule:i,snapshotsModule:n,floorsData:a,layersData:o,meshBounds:s,modelData:d,locale:l,settingsData:r,viewmodeModule:u}){this.name="scout-tour-template",this.floorsData=a,this.sweepData=t,this.roomBoundDataModule=e,this.cameraStartModule=i,this.snapshotsModule=n,this.layersData=o,this.meshBounds=s,this.modelData=d,this.locale=l,this.settingsData=r,this.viewmodeModule=u,this.filteringExceptions=new Set}async generateTour(e){const{modelId:t,panAngle:i,panSpeed:n,client:a,includeDefurnish:o}=e;this.filteringExceptions.clear();let s=await this.getHighlights(e);u.Vy.for(this).debug(`Starting with ${s.length} tour stops generated for model: ${t}`,s),s=this.addStartLocation(s),s.forEach((e=>{if(e.snapshot.metadata.cameraMode===se.N.Panorama&&(e.overrides={transitionType:U.fl.Interpolate,panAlignment:"center",panAngle:i,panSpeed:n}),!e.snapshot.metadata.scanId&&e.snapshot.metadata.cameraPosition){const t=this.sweepData.getClosestSweep(e.snapshot.metadata.cameraPosition,!0);t&&(e.snapshot.metadata.scanId=t.platformId)}}));const d=new G.P(P.UR.STORY);let l=ue({sweepData:this.sweepData,roomBoundDataModule:this.roomBoundDataModule})(s);const r=fe({excludeUnaligned:!0,excludeDisabled:!0,sweepData:this.sweepData}),m=Ne({invalidMetadata:!0}),c=we({excludeOutOfBounds:!1,excludeClassifications:Oe,roomBoundData:this.roomBoundDataModule.data});return l=ke(l,[r,m,c],{exceptions:this.filteringExceptions}),l=pe(l,this.sweepData,this.floorsData),l=await this.addDollhouse(l,t,a),o&&(l=this.addDefurnishEntries(l)),l=await this.addFinalStop(l,t,a),l=this.updateSnapshotLabels(l),u.Vy.for(this).debug(`Final tour has ${l.length} stops`,l),d.reel.replace(l),d}async getHighlights(e){var t;const{modelId:i,regenerateText:n,client:a,importerVersion:o=null}=e,s=null===(t=this.layersData.getInsightsView())||void 0===t?void 0:t.id,d="matterport.user.insights";let l=[];if(!n&&s){const e=await async function({modelId:e,client:t}){var i,n,a,o,s,d;try{return null!==(d=null===(s=null===(o=null===(a=null===(n=null===(i=(await t.query(be.GetExtensionTags,{modelId:e,namespaces:[Ee]})).data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.extensiontags)||void 0===a?void 0:a[0])||void 0===o?void 0:o.values)||void 0===s?void 0:s[0])&&void 0!==d?d:null}catch(e){return Ae.warnError("Error querying importer version",e),null}}({modelId:i,client:a});if(e===o)try{l=await j({modelId:i,viewId:s,viewType:d,client:a})}catch(e){u.Vy.for(this).info("Could not load insights reel; starting autogallery import",e)}}if((n||Fe(l))&&(await J({modelId:i,generateText:!0,client:a}),await async function({modelId:e,version:t,client:i}){try{await i.query(be.PatchExtensionTag,{modelId:e,namespace:Ee,values:t?[t]:[]})}catch(e){Ae.warnError("Error saving importer version",e)}}({modelId:i,client:a,version:o}),l=await j({modelId:i,viewId:s,viewType:d,client:a})),!l.length){if(l=(await z({client:a,viewId:s,modelId:i,viewType:d})).filter((e=>e.origin===w.j.VISION)).map((e=>function(e,t={}){const i=(new te.F).copy(Object.assign(Object.assign({},e),{sourceViewId:void 0}));return Object.assign({snapshot:i,source:null,id:(0,x.W0)()},t)}(e,{source:"vision"}))),!l.length)throw new E("No highlights found after autogallery import")}return l}async addDollhouse(e,t,i){var n,a;const o=this.cameraStartModule.data.getStartingPose(),s=this.sweepData.getStartSweep(o)||this.sweepData.getSweep(e[0].sweepId),d=this.floorsData.getFloorCount()>1?s.floorId:null,l=(0,Se.f)(o,{sweepID:s.platformId}),r=await me({modelId:t,client:i,pose:l,viewmodeModule:this.viewmodeModule});if(r){const t=[],i=null===(n=this.roomBoundDataModule.getRoomsByClassification([ve.Cp]))||void 0===n?void 0:n.length,o=null===(a=this.roomBoundDataModule.getRoomsByClassification([ve.i_]))||void 0===a?void 0:a.length;(i||o)&&(t.push(this.locale.t(Te.A.WORKSHOP.HLR.BEDROOM_COUNT,{smart_count:i})),t.push(this.locale.t(Te.A.WORKSHOP.HLR.BATHROOM_COUNT,{smart_count:o})));const l=this.settingsData.tryGetSetting(F.Y.UnitType,ye.t.METRIC),m=this.roomBoundDataModule.getGrossIndoorArea(l);m&&t.push((0,Ie.JE)(l,m).area);const c=Object.assign(Object.assign({},r),{title:this.modelData.model.details.name,description:t.join("  "),floorId:d,roomId:null,viewingRoomId:null,sweepId:s.platformId});return u.Vy.for(this).debug("Adding dollhouse as the first tour stop",c),this.filteringExceptions.add(c.id),[c,...e.filter((e=>e.snapshot.metadata.cameraMode!==se.N.Dollhouse))]}return e}addStartLocation(e){let t=he(this.cameraStartModule,this.snapshotsModule,this.modelData.model.details.name);if(!t)return e;const i=e.find((e=>null==t?void 0:t.snapshot.equals(e.snapshot)));return t=i||t,u.Vy.for(this).debug("Adding start location tour stop",t),this.filteringExceptions.add(t.id),[t,...e]}async addFinalStop(e,t,i){const n=this.cameraStartModule.data.getStartingPose(),a=this.sweepData.getStartSweep(n)||this.sweepData.getSweep(e[0].sweepId),o=this.floorsData.getFloorCount()>1?a.floorId:null,s=Object.assign(Object.assign({},await ce({floorsData:this.floorsData,meshBounds:this.meshBounds,client:i},t,o)),{title:"",description:"",floorId:o,roomId:null,viewingRoomId:null,sweepId:a.platformId});return u.Vy.for(this).debug("Adding floorplan as the final tour stop",s),this.filteringExceptions.add(s.id),[...e,s]}addDefurnishEntries(e){var t;const i=null===(t=this.layersData.getDefurnishView())||void 0===t?void 0:t.id,n=i?this.snapshotsModule.snapshotsData.getSortedCollection().filter((e=>e.sourceViewId===i)):null;if(!(null==n?void 0:n.length))return e;const a=[],o=new Set;for(const t of e){a.push(t);if(t.snapshot.metadata.cameraMode===se.N.Panorama&&t.viewingRoomId&&!o.has(t.viewingRoomId)&&this.roomBoundDataModule.data.getRoom(t.viewingRoomId).classifications.some((e=>Ve.has(e.id)))){const e=n.find((e=>(0,ge.Lt)(e,t.snapshot)));if(e){const i=Object.assign(Object.assign({},t),{id:(0,x.hA)(),sourceViewId:e.sourceViewId,snapshot:e,overrides:Object.assign(Object.assign({},t.overrides),{showRoomMeasurements:!0})});u.Vy.for(this).debug("Adding defurnished tour stop",i),a.push(i),o.add(i.roomId||"")}}}return a}updateSnapshotLabels(e){return e.forEach((e=>{const{snapshot:t}=e,i=this.getLabelForEntry(e);t.name=i,t.label=i,t.commit()})),e}getLabelForEntry(e){const{cameraMode:t}=e.snapshot.metadata;if(t===se.N.Floorplan)return"Floorplan";if(t===se.N.Dollhouse)return"Dollhouse";if(t===se.N.Panorama){const t=e.viewingRoomId,i=t&&this.roomBoundDataModule.data.getRoom(t);if(i){if(i.name)return i.name;if(!i.classifications.some((({id:e})=>Re.has(e))))return(0,De.Ay)(t,this.locale,this.roomBoundDataModule.data)}}return""}}const Fe=e=>{if(!e||!e.length)return!0;return e.filter((e=>!!e.description)).length/e.length<.5};class xe{constructor({layersData:e}){this.layersData=e}async generateTour(e){var t;const{modelId:i,client:n}=e,a=null===(t=this.layersData.getInsightsView())||void 0===t?void 0:t.id;await J({modelId:i,client:n});const o=await j({modelId:i,viewType:"matterport.user.insights",viewId:a,client:n}),s=new G.P(P.UR.REEL);return s.reel.replace(o),s}}const Pe=[ve.mg,ve.GC],Ue=[ve.Hy,ve.pl,ve.SE,ve.ZQ],Ge=[ve.ny,ve.om,ve.pZ,ve.eA,ve.QN];class Be{constructor({cameraStartModule:e,roomBoundDataModule:t,snapshotsModule:i,sweepData:n,layersData:a,viewmodeModule:o}){this.name="digital-pro-tour-template",this.cameraStartModule=e,this.roomBoundDataModule=t,this.snapshotsModule=i,this.sweepData=n,this.layersData=a,this.viewmodeModule=o,this.filteringExceptions=new Set}async generateTour(e){var t;const{modelId:i,client:n,panSpeed:a,includeDollhouse:o=!1}=e,s=null===(t=this.layersData.getInsightsView())||void 0===t?void 0:t.id;this.filteringExceptions.clear(),await J({modelId:i,client:n});const d=await z({modelId:i,viewType:"matterport.user.insights",viewId:s,client:n});let l=(e=>{const{sweepData:t,roomBoundDataModule:i}=e;return e=>e.reduce(((e,n)=>{var a,o;const{cameraPosition:s,cameraQuaternion:d,scanId:l}=n.metadata;if(!s||!l)return e;const r=null===(a=t.getSweep(l))||void 0===a?void 0:a.floorId;if(!r)return e;const u=i.data.findRoomIdForPosition(s,r)||null,m=(null===(o=i.findRoomFromCameraPose({position:s,rotation:d,floorId:r}))||void 0===o?void 0:o.id)||null,c={id:n.sid,snapshot:n,source:"vision",floorId:r,roomId:u,viewingRoomId:m,sweepId:l};return e.push(c),e}),[])})({sweepData:this.sweepData,roomBoundDataModule:this.roomBoundDataModule})(d);const r=fe({excludeUnaligned:!0,excludeDisabled:!0,sweepData:this.sweepData}),u=Ne({invalidMetadata:!0}),m=we({excludeOutOfBounds:!1,excludeClassifications:Pe,roomBoundData:this.roomBoundDataModule.data});l=ke(l,[r,u,m],{exceptions:this.filteringExceptions});let c=[...l],p=[];const h=he(this.cameraStartModule,this.snapshotsModule),v=c.find((e=>null==h?void 0:h.snapshot.equals(e.snapshot))),g=v||(h?ue({sweepData:this.sweepData,roomBoundDataModule:this.roomBoundDataModule})([h])[0]:null);if(g&&(p.push(g),c=c.filter((e=>e.id!==g.id&&e.sweepId!==g.sweepId))),o){const e=this.cameraStartModule.data.getStartingPose(),t=this.sweepData.getStartSweep(e)||this.sweepData.getSweep(c[0].sweepId),a=(0,Se.f)(e,{sweepID:t.platformId}),o=await me({modelId:i,client:n,pose:a,viewmodeModule:this.viewmodeModule});o&&p.push(ue({sweepData:this.sweepData,roomBoundDataModule:this.roomBoundDataModule})([o])[0])}const k=new Set;c=c.filter((e=>!e.roomId||!k.has(e.roomId)&&(k.add(e.roomId),!0)));const f=(e,t=1)=>{const i=we({roomBoundData:this.roomBoundDataModule.data,excludeClassifications:void 0,maxStopsPerClassification:{[e]:t}})(c,void 0).filter((t=>{const i=t.roomId&&this.roomBoundDataModule.data.getRoom(t.roomId);return i&&i.classifications.some((t=>t.id===e))})),n=new Set(i.slice(0,t).map((e=>e.id)));return c=c.filter((e=>!n.has(e.id))),i.slice(0,t)};for(const e of Ue){const t=f(e,1);if(t.length>0){p.push(...t);break}}p.push(...f(ve.YK,1));const w=f(ve.Cp,99),N=f(ve.v1,99);w.push(...N);const D=f(ve.i_,99),S=e=>{const t=e.roomId?this.roomBoundDataModule.data.getRoom(e.roomId):null;return(null==t?void 0:t.area)||0};w.sort(((e,t)=>S(t)-S(e))),D.sort(((e,t)=>S(t)-S(e)));let y=0,I=0;w.length&&(p.push(w[0]),y++),D.length&&(p.push(D[0]),I++),w.length>1&&p.push(...w.slice(1,3-y+1)),D.length>1&&p.push(...D.slice(1,3-I+1));let T=!1;for(const e of Ge){const t=f(e,1);if(t.length>0&&(T=!0,p.push(...t.slice(1))),p.length>=7&&T)break}if(p.length<=1){g?(p=[g],p=p.concat(l.slice(0,6).filter((e=>{const t=e.sweepId===g.sweepId,i=e.snapshot.equals(g.snapshot);return!t&&!i})))):p=l.slice(0,7);const e=p.at(0);if(null==e?void 0:e.sweepId){const t=this.sweepData.getSweep(e.sweepId);p=p.map((i=>{if(i.sweepId===e.sweepId)return Object.assign(Object.assign({},i),{distanceFromFirstTourStop:0});const n=this.sweepData.getSweep(i.sweepId),a=t.position.distanceTo(n.position);return Object.assign(Object.assign({},i),{distanceFromFirstTourStop:a})})).sort(((e,t)=>e.distanceFromFirstTourStop-t.distanceFromFirstTourStop))}}for(const e of p)e.title="",e.description="",e.overrides={transitionType:U.fl.FadeToBlack,panAngle:55,panSpeed:a},e.snapshot.label="",e.snapshot.name="",e.snapshot.commit();const b=new G.P(P.UR.STORY);return b.reel.replace(p),b}}var Ce=i(12625);class Le extends Ce.B{constructor(){super(...arguments),this.name="tours-generator-view-data",this.stashedTour=null,this.isTourEdited=!1,this.tourStopsAdded=0,this.tourStopsRemoved=0,this.tourStopsUpdated=0,this.acceptanceStatus=S.ei.IDLE}setStashedTour(e){this.stashedTour=e,this.commit()}resetEditStatistics(){this.tourStopsAdded=0,this.tourStopsRemoved=0,this.tourStopsUpdated=0}setAcceptanceStatus(e){this.acceptanceStatus=e,this.commit()}}var $e=i(22937),_e=function(e,t,i,n){var a,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var d=e.length-1;d>=0;d--)(a=e[d])&&(s=(o<3?a(s):o>3?a(t,i,s):a(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},je=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},He=function(e,t){return function(i,n){t(i,n,e)}};let We=class extends s.n{constructor({data:e},t,{data:i},n,{data:a},{policyData:o},s,d,l,{data:r},m,{toolsData:c},p,{layersData:h},v,g){super(),this.name="tours-generator",this.templates=new Map,this.onAppChange=()=>{this.viewData.stashedTour&&this.discardGeneratedTour({canceled:!0})},this.onError=e=>{this.engine.msgBus.broadcast(new V(e))},this.applicationData=e,this.cameraStartModule=t,this.floorsData=i,this.locale=n,this.modelData=a,this.roomBoundDataModule=s,this.settingsModule=d,this.snapshotsModule=l,this.sweepData=r,this.toursDataModule=p,this.toolsData=c,this.toolAnnouncementModule=m,this.layersData=h,this.viewmodeModule=v,this.visibleMeshBoundsModule=g,this.enabled=(0,A.W)(o),this.controller=new AbortController,u.Vy.for(this).info("AUTO TOURS ENABLED")}async init(e,t){if(this.engine=t,this.config=Object.assign({},e),!(0,A.U)({layersData:this.layersData,modelData:this.modelData}))return void(this.enabled=!1);this.registerTemplates(),this.registerSettings(),this.registerEditBindings(),this.viewData=new Le,t.market.register(Le,this.viewData),this.toursDataModule.tourData.registerTourSetup((async(e,t)=>{const i=e.tryGetSetting(v.Ye,v.lB);await this.generateTourIfNeeded(i,t)}));const i=this.settingsModule.tryGetSetting(v.pH,!1);if(this.applicationData.application===d.lg.SHOWCASE&&i){const e=this.settingsModule.tryGetSetting(v.Ye,v.lB);await this.generateTourFromTemplate(e,{modelId:this.modelData.model.baseModelId})}else this.enabled&&!this.toursDataModule.tourData.isTourAutoGenerated&&(this.announceAutoGenTourCreated(),this.announceAutoGenTourReady())}dispose(e){super.dispose(e),e.market.unregister(Le)}async generateTourIfNeeded(e,t){return this.generatedTour&&!t||await this.generateTourFromTemplate(e,{modelId:this.modelData.model.baseModelId}),this.generatedTour||void 0}async generateTourFromTemplate(e,t){if(!this.enabled)throw new I("Tour generation is not enabled");if(!this.sweepData.getCollection().length)throw new I("Tour generation is not available for models without 3D Scans");const i=this.templates.get(e);if(!i)throw new I(`Template ${e} not found`);this.toolAnnouncementModule.setToolAnnouncementState(D.Q7.HLR_AUTOGEN_TOUR_READY,D.zR.CLOSE);const n=this.cancelled;n&&(this.controller=new AbortController),this.client&&!n||(this.client=(0,c.H)({baseUrl:this.config.baseUrl,server:p.wD,httpOptions:{fetchOptions:{signal:this.controller.signal}}})()),this.setEditorMode(a.DRAFT),this.viewData.stashedTour||this.viewData.setStashedTour(this.toursDataModule.tourData.getReel().clone()),this.viewData.acceptanceStatus!==S.ei.IDLE&&this.viewData.setAcceptanceStatus(S.ei.IDLE);const o=Date.now();return this.generatedTour=await i.generateTour(Object.assign({includeDefurnish:this.settingsModule.tryGetSetting(v.cD,v.JK),panAngle:this.settingsModule.tryGetSetting(v.nz,v.C0),panSpeed:this.settingsModule.tryGetSetting(v.Vq,v.au),regenerateText:this.settingsModule.tryGetSetting(v.H$,v.OU),importerVersion:this.config.importerVersion,client:this.client},t)).catch((e=>{throw this.discardGeneratedTour({errored:!0}),this.onError(e),e})),this.loadSnapshotBlobs(this.generatedTour),this.replaceActiveReel(this.generatedTour.clone()),this.viewData.resetEditStatistics(),this.engine.broadcast(new R({templateType:e,config:t,timeGenerating:Date.now()-o})),this.generatedTour.reel.forEach(((e,t)=>{this.engine.broadcast(new $e.ap({reelEntry:e,index:t,tourLength:t+1}))})),this.generatedTour}announceAutoGenTourCreated(){const e=this.engine.subscribe(l.Fj,(({application:t})=>{t===d.lg.WORKSHOP&&(this.toolAnnouncementModule.setToolAnnouncementState(D.Q7.HLR_AUTOGEN_TOUR_CREATED,D.zR.OPEN),e.cancel())})),t=this.toolsData.onPropertyChanged("activeToolName",(()=>{this.toolAnnouncementModule.getToolAnnouncementState(D.Q7.HLR_AUTOGEN_TOUR_CREATED)===D.zR.OPEN&&this.toolAnnouncementModule.setToolAnnouncementState(D.Q7.HLR_AUTOGEN_TOUR_CREATED,D.zR.CLOSE)}));this.bindings.push(e,t)}announceAutoGenTourReady(){this.bindings.push(this.toolsData.onPropertyChanged("activeToolName",(async e=>{e===D.S0.HLR&&(await(0,m.c)(750),this.toolAnnouncementModule.setToolAnnouncementState(D.Q7.HLR_AUTOGEN_TOUR_READY,D.zR.OPEN)),e===D.S0.HLR||this.toolsData.previousToolName&&this.toolsData.previousToolName!==D.S0.HLR||this.toolAnnouncementModule.setToolAnnouncementState(D.Q7.HLR_AUTOGEN_TOUR_READY,D.zR.CLOSE)})))}replaceActiveReel(e){this.toursDataModule.setHighlightReel(e)}registerEditBindings(){this.bindings.push(this.applicationData.onPropertyChanged("application",this.onAppChange),this.toursDataModule.tourData.getReel().reel.onElementChanged({onAdded:e=>{this.generatedTour&&(this.viewData.tourStopsAdded+=1,this.viewData.commit())},onRemoved:e=>{this.generatedTour&&(this.viewData.tourStopsRemoved+=1,this.viewData.commit())},onUpdated:e=>{if(!this.generatedTour)return;const t=this.generatedTour.reel.find((t=>t.id===e.id));if(t){let i=!1;["description","title"].some((i=>t[i]!==e[i]))&&(i=!0);["transitionType","panDirection","panAngle","panSpeed","panAlignment","showRoomMeasurements"].some((i=>{var n,a;return(null===(n=t.overrides)||void 0===n?void 0:n[i])!==(null===(a=e.overrides)||void 0===a?void 0:a[i])}))&&(i=!0),i&&(this.viewData.tourStopsUpdated+=1,this.viewData.commit())}}}))}registerTemplates(){this.templates.size>0||(this.templates.set(S.pk.SCOUT,new Me({cameraStartModule:this.cameraStartModule,floorsData:this.floorsData,locale:this.locale,roomBoundDataModule:this.roomBoundDataModule,snapshotsModule:this.snapshotsModule,sweepData:this.sweepData,layersData:this.layersData,meshBounds:this.visibleMeshBoundsModule,modelData:this.modelData,settingsData:this.settingsModule.settingsData,viewmodeModule:this.viewmodeModule})),this.templates.set(S.pk.DIGITAL_PRO,new Be({cameraStartModule:this.cameraStartModule,snapshotsModule:this.snapshotsModule,sweepData:this.sweepData,roomBoundDataModule:this.roomBoundDataModule,viewmodeModule:this.viewmodeModule,layersData:this.layersData})),this.templates.set(S.pk.VISION,new xe({layersData:this.layersData})))}async acceptGeneratedTour(){const e=Date.now(),{tourStopsAdded:t,tourStopsRemoved:i,tourStopsUpdated:n}=this.viewData,o=this.toursDataModule.tourData.getReel(),s=await this.copyHlrToView(o).catch((e=>{throw this.onError(e),e}));return o.reel.forEach((({snapshot:e})=>e.dispose())),this.viewData.atomic((()=>{this.viewData.setStashedTour(null),this.viewData.resetEditStatistics(),this.viewData.setAcceptanceStatus(S.ei.ACCEPTED)})),this.generatedTour=void 0,this.replaceActiveReel(s),this.setEditorMode(a.AUTOSAVE),this.engine.broadcast(new M({timeSaving:Date.now()-e,tourStopsAdded:t,tourStopsRemoved:i,tourStopsUpdated:n})),!0}discardGeneratedTour({canceled:e=!1,errored:t=!1}={}){const i=this.viewData.stashedTour;this.viewData.atomic((()=>{this.viewData.setStashedTour(null),this.viewData.resetEditStatistics(),this.viewData.setAcceptanceStatus(e||t?S.ei.IDLE:S.ei.DISCARDED)})),this.toursDataModule.tourData.getReel().reel.forEach((({snapshot:e})=>e.dispose())),i&&this.replaceActiveReel(i),this.generatedTour=void 0,this.setEditorMode(a.AUTOSAVE)}cancelGeneration(){this.controller.abort(new T("Tour generation cancelled by user"))}get cancelled(){return this.controller.signal.aborted}async copyHlrToView(e){var t;const i=u.Vy.for(this),n=e.clone();await this.loadSnapshotBlobs(n);for(const e of n.reel){const n=e.snapshot.clone();n.category=f.X.TOUR;const a=null!==(t=n.sourceViewId)&&void 0!==t?t:this.layersData.getBaseModelId();i.debug(`Uploading snapshot ${e.snapshot.sid} -> ${n.sid} on ${a}`);const o=await this.engine.commandBinder.issueCommand(new N.Ns(n,a));e.snapshot=o,e.id=o.sid}return n}async loadSnapshotBlobs(e){await Promise.all(e.reel.map((async({snapshot:e})=>{if(!e.imageBlob){const t=await e.downloadUrl.get(),i=k(t,Object.assign(Object.assign({},v.hd),{fit:"crop"}));e.imageBlob=await fetch(i).then((e=>e.blob())),e.origin=w.j.AUTOTOUR}})))}setEditorMode(e){const t=this.engine.tryGetModuleBySymbolSync("ITourEditor");t&&t.setEditorMode(e)}registerSettings(){const e="Tours";this.settingsModule.registerMenuEntry({header:e,urlParam:!0,setting:v.Ye,options:[...this.templates.keys()],initialValue:()=>v.lB}),this.settingsModule.registerMenuEntry({header:e,urlParam:!0,setting:v.pH,initialValue:()=>!1}),this.settingsModule.registerMenuEntry({header:e,urlParam:!0,range:[1,360],rangePrecision:0,setting:v.nz,initialValue:()=>v.C0}),this.settingsModule.registerMenuEntry({header:e,urlParam:!0,range:[1,20],rangePrecision:0,setting:v.Vq,initialValue:()=>v.au}),this.settingsModule.registerMenuEntry({header:e,urlParam:!0,setting:v.H$,initialValue:()=>v.OU}),this.settingsModule.registerMenuEntry({header:e,urlParam:!0,setting:v.cD,initialValue:()=>v.JK})}};We=_e([(0,o._q)(),He(0,(0,o.y_)(r.WJ)),He(1,(0,o.y_)(h.di)),He(2,(0,o.y_)(h.HX)),He(3,(0,o.y_)(h.gS)),He(4,(0,o.y_)(h.bj)),He(5,(0,o.y_)(h.Uu)),He(6,(0,o.y_)(h.Vu)),He(7,(0,o.y_)(r.ZF)),He(8,(0,o.y_)(h.Pn)),He(9,(0,o.y_)(h.Wh)),He(10,(0,o.y_)(h.uq)),He(11,(0,o.y_)(h.N7)),He(12,(0,o.y_)(h.XQ)),He(13,(0,o.y_)(h.az)),He(14,(0,o.y_)(h.SD)),He(15,(0,o.y_)(h.UN)),je("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],We)},4330:(e,t,i)=>{"use strict";i.d(t,{b:()=>n,f:()=>a});const n=e=>({position:e.position?e.position.clone():void 0,rotation:e.rotation?e.rotation.clone():void 0,viewmode:e.viewmode?e.viewmode:void 0,sweepID:e.sweepID?e.sweepID:void 0,viewId:e.viewId,zoom:e.zoom?e.zoom:void 0,focalDistance:e.focalDistance?e.focalDistance:void 0,isPitchFactorOrtho:null!=e.isPitchFactorOrtho?e.isPitchFactorOrtho:void 0}),a=(e,t)=>{var i,n,a,o;return Object.assign({position:null===(i=e.camera.position)||void 0===i?void 0:i.clone(),rotation:null===(n=e.camera.rotation)||void 0===n?void 0:n.clone(),zoom:null===(a=e.camera)||void 0===a?void 0:a.zoom,viewmode:e.mode,sweepID:null===(o=e.pano)||void 0===o?void 0:o.uuid,viewId:void 0,focalDistance:void 0,isPitchFactorOrtho:void 0},t)}}}]);